function titleize(e){return null==e?e:(parts=[],$.each(e.replace(/\./,"").replace(/[-_]/," ").split(" "),function(e,t){parts.push(t.substring(0,1).toUpperCase()+t.substring(1))}),parts.join(" "))}(function(e,t){var i=function(){var t=e(document).data("events");return t&&t.click&&e.grep(t.click,function(e){return"rails"===e.namespace}).length};i()&&e.error("jquery-ujs has already been loaded!");var n;e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(t){var i=e('meta[name="csrf-token"]').attr("content");i&&t.setRequestHeader("X-CSRF-Token",i)},fire:function(t,i,n){var o=e.Event(i);return t.trigger(o,n),o.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e.attr("href")},handleRemote:function(i){var o,r,s,a,l,c,d,u;if(n.fire(i,"ajax:before")){if(a=i.data("cross-domain"),l=a===t?null:a,c=i.data("with-credentials")||null,d=i.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,i.is("form")){o=i.attr("method"),r=i.attr("action"),s=i.serializeArray();var h=i.data("ujs:submit-button");h&&(s.push(h),i.data("ujs:submit-button",null))}else i.is(n.inputChangeSelector)?(o=i.data("method"),r=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):(o=i.data("method"),r=n.href(i),s=i.data("params")||null);u={type:o||"GET",data:s,dataType:d,beforeSend:function(e,o){return o.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+o.accepts.script),n.fire(i,"ajax:beforeSend",[e,o])},success:function(e,t,n){i.trigger("ajax:success",[e,t,n])},complete:function(e,t){i.trigger("ajax:complete",[e,t])},error:function(e,t,n){i.trigger("ajax:error",[e,t,n])},xhrFields:{withCredentials:c},crossDomain:l},r&&(u.url=r);var p=n.ajax(u);return i.trigger("ajax:send",p),p}return!1},handleMethod:function(i){var o=n.href(i),r=i.data("method"),s=i.attr("target"),a=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content"),c=e('<form method="post" action="'+o+'"></form>'),d='<input name="_method" value="'+r+'" type="hidden" />';l!==t&&a!==t&&(d+='<input name="'+l+'" value="'+a+'" type="hidden" />'),s&&c.attr("target",s),c.hide().append(d).appendTo("body"),c.submit()},disableFormElements:function(t){t.find(n.disableSelector).each(function(){var t=e(this),i=t.is("button")?"html":"val";t.data("ujs:enable-with",t[i]()),t[i](t.data("disable-with")),t.prop("disabled",!0)})},enableFormElements:function(t){t.find(n.enableSelector).each(function(){var t=e(this),i=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[i](t.data("ujs:enable-with")),t.prop("disabled",!1)})},allowAction:function(e){var t,i=e.data("confirm"),o=!1;return i?(n.fire(e,"confirm")&&(o=n.confirm(i),t=n.fire(e,"confirm:complete",[o])),o&&t):!0},blankInputs:function(t,i,n){var o,r,s=e(),a=i||"input,textarea";return t.find(a).each(function(){o=e(this),r=o.is(":checkbox,:radio")?o.is(":checked"):o.val(),r==!!n&&(s=s.add(o))}),s.length?s:!1},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},callFormSubmitBindings:function(i,n){var o=i.data("events"),r=!0;return o!==t&&o.submit!==t&&e.each(o.submit,function(e,t){return"function"==typeof t.handler?r=t.handler(n):void 0}),r},disableElement:function(e){e.data("ujs:enable-with",e.html()),e.html(e.data("disable-with")),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.data("ujs:enable-with",!1)),e.unbind("click.railsDisable")}},n.fire(e(document),"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,i){e.crossDomain||n.CSRFProtection(i)}),e(document).delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),e(document).delegate(n.linkClickSelector,"click.rails",function(i){var o=e(this),r=o.data("method"),s=o.data("params");return n.allowAction(o)?(o.is(n.linkDisableSelector)&&n.disableElement(o),o.data("remote")!==t?!i.metaKey&&!i.ctrlKey||r&&"GET"!==r||s?(n.handleRemote(o)===!1&&n.enableElement(o),!1):!0:o.data("method")?(n.handleMethod(o),!1):void 0):n.stopEverything(i)}),e(document).delegate(n.inputChangeSelector,"change.rails",function(t){var i=e(this);return n.allowAction(i)?(n.handleRemote(i),!1):n.stopEverything(t)}),e(document).delegate(n.formSubmitSelector,"submit.rails",function(i){var o=e(this),r=o.data("remote")!==t,s=n.blankInputs(o,n.requiredInputSelector),a=n.nonBlankInputs(o,n.fileInputSelector);return n.allowAction(o)?s&&o.attr("novalidate")==t&&n.fire(o,"ajax:aborted:required",[s])?n.stopEverything(i):r?a?(setTimeout(function(){n.disableFormElements(o)},13),n.fire(o,"ajax:aborted:file",[a])):!e.support.submitBubbles&&"1.7">e().jquery&&n.callFormSubmitBindings(o,i)===!1?n.stopEverything(i):(n.handleRemote(o),!1):(setTimeout(function(){n.disableFormElements(o)},13),void 0):n.stopEverything(i)}),e(document).delegate(n.formInputClickSelector,"click.rails",function(t){var i=e(this);if(!n.allowAction(i))return n.stopEverything(t);var o=i.attr("name"),r=o?{name:o,value:i.val()}:null;i.closest("form").data("ujs:submit-button",r)}),e(document).delegate(n.formSubmitSelector,"ajax:beforeSend.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),e(document).delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))}),e(function(){csrf_token=e("meta[name=csrf-token]").attr("content"),csrf_param=e("meta[name=csrf-param]").attr("content"),e('form input[name="'+csrf_param+'"]').val(csrf_token)}))})(jQuery),window.Modernizr=function(e,t,i){function n(e){f.cssText=e}function o(e,t){return typeof e===t}var r,s,a,l="2.5.3",c={},d=!0,u=t.documentElement,h="modernizr",p=t.createElement(h),f=p.style,m=({}.toString,{}),g=[],v=g.slice,y=function(){function e(e,r){r=r||t.createElement(n[e]||"div"),e="on"+e;var s=e in r;return s||(r.setAttribute||(r=t.createElement("div")),r.setAttribute&&r.removeAttribute&&(r.setAttribute(e,""),s=o(r[e],"function"),o(r[e],"undefined")||(r[e]=i),r.removeAttribute(e))),r=null,s}var n={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return e}(),b={}.hasOwnProperty;a=o(b,"undefined")||o(b.call,"undefined")?function(e,t){return t in e&&o(e.constructor.prototype[t],"undefined")}:function(e,t){return b.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var i=v.call(arguments,1),n=function(){if(this instanceof n){var o=function(){};o.prototype=t.prototype;var r=new o,s=t.apply(r,i.concat(v.call(arguments)));return Object(s)===s?s:r}return t.apply(e,i.concat(v.call(arguments)))};return n}),m.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e};for(var _ in m)a(m,_)&&(s=_.toLowerCase(),c[s]=m[_](),g.push((c[s]?"":"no-")+s));return n(""),p=r=null,function(e,t){function i(e,t){var i=e.createElement("p"),n=e.getElementsByTagName("head")[0]||e.documentElement;return i.innerHTML="x<style>"+t+"</style>",n.insertBefore(i.lastChild,n.firstChild)}function n(){var e=d.elements;return"string"==typeof e?e.split(" "):e}function o(e){var t={},i=e.createElement,o=e.createDocumentFragment,r=o();e.createElement=function(e){var n=(t[e]||(t[e]=i(e))).cloneNode();return d.shivMethods&&n.canHaveChildren&&!c.test(e)?r.appendChild(n):n},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+n().join().replace(/\w+/g,function(e){return t[e]=i(e),r.createElement(e),'c("'+e+'")'})+");return n}")(d,r)}function r(e){var t;return e.documentShived?e:(d.shivCSS&&!s&&(t=!!i(e,"article,aside,details,figcaption,figure,footer,header,hgroup,nav,section{display:block}audio{display:none}canvas,video{display:inline-block;*display:inline;*zoom:1}[hidden]{display:none}audio[controls]{display:inline-block;*display:inline;*zoom:1}mark{background:#FF0;color:#000}")),a||(t=!o(e)),t&&(e.documentShived=t),e)}var s,a,l=e.html5||{},c=/^<|^(?:button|form|map|select|textarea)$/i;(function(){var e=t.createElement("a");e.innerHTML="<xyz></xyz>",s="hidden"in e,a=1==e.childNodes.length||function(){try{t.createElement("a")}catch(e){return!0}var i=t.createDocumentFragment();return"undefined"==typeof i.cloneNode||"undefined"==typeof i.createDocumentFragment||"undefined"==typeof i.createElement}()})();var d={elements:l.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:l.shivCSS!==!1,shivMethods:l.shivMethods!==!1,type:"default",shivDocument:r};e.html5=d,r(t)}(this,t),c._version=l,c.hasEvent=y,u.className=u.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(d?" js "+g.join(" "):""),c}(this,this.document),function(e,t,i){function n(e){return"[object Function]"==g.call(e)}function o(e){return"string"==typeof e}function r(){}function s(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function a(){var e=v.shift();y=1,e?e.t?f(function(){("c"==e.t?h.injectCss:h.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),a()):y=0}function l(e,i,n,o,r,l,c){function d(t){if(!p&&s(u.readyState)&&(b.r=p=1,!y&&a(),u.onload=u.onreadystatechange=null,t)){"img"!=e&&f(function(){w.removeChild(u)},50);for(var n in S[i])S[i].hasOwnProperty(n)&&S[i][n].onload()}}var c=c||h.errorTimeout,u={},p=0,g=0,b={t:n,s:i,e:r,a:l,x:c};1===S[i]&&(g=1,S[i]=[],u=t.createElement(e)),"object"==e?u.data=i:(u.src=i,u.type=e),u.width=u.height="0",u.onerror=u.onload=u.onreadystatechange=function(){d.call(this,g)},v.splice(o,0,b),"img"!=e&&(g||2===S[i]?(w.insertBefore(u,_?null:m),f(d,c)):S[i].push(u))}function c(e,t,i,n,r){return y=0,t=t||"j",o(e)?l("c"==t?C:x,e,t,this.i++,i,n,r):(v.splice(this.i++,0,e),1==v.length&&a()),this}function d(){var e=h;return e.loader={load:c,i:0},e}var u,h,p=t.documentElement,f=e.setTimeout,m=t.getElementsByTagName("script")[0],g={}.toString,v=[],y=0,b="MozAppearance"in p.style,_=b&&!!t.createRange().compareNode,w=_?p:m.parentNode,p=e.opera&&"[object Opera]"==g.call(e.opera),p=!!t.attachEvent&&!p,x=b?"object":p?"script":"img",C=p?"script":x,T=Array.isArray||function(e){return"[object Array]"==g.call(e)},k=[],S={},E={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};h=function(e){function t(e){var t,i,n,e=e.split("!"),o=k.length,r=e.pop(),s=e.length,r={url:r,origUrl:r,prefixes:e};for(i=0;s>i;i++)n=e[i].split("="),(t=E[n.shift()])&&(r=t(r,n));for(i=0;o>i;i++)r=k[i](r);return r}function s(e,o,r,s,l){var c=t(e),u=c.autoCallback;c.url.split(".").pop().split("?").shift(),c.bypass||(o&&(o=n(o)?o:o[e]||o[s]||o[e.split("/").pop().split("?")[0]]||a),c.instead?c.instead(e,o,r,s,l):(S[c.url]?c.noexec=!0:S[c.url]=1,r.load(c.url,c.forceCSS||!c.forceJS&&"css"==c.url.split(".").pop().split("?").shift()?"c":i,c.noexec,c.attrs,c.timeout),(n(o)||n(u))&&r.load(function(){d(),o&&o(c.origUrl,l,s),u&&u(c.origUrl,l,s),S[c.url]=2})))}function l(e,t){function i(e,i){if(e){if(o(e))i||(u=function(){var e=[].slice.call(arguments);h.apply(this,e),p()}),s(e,u,t,0,c);else if(Object(e)===e)for(l in a=function(){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i}(),e)e.hasOwnProperty(l)&&(!i&&!--a&&(n(u)?u=function(){var e=[].slice.call(arguments);h.apply(this,e),p()}:u[l]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),p()}}(h[l])),s(e[l],u,t,l,c))}else!i&&p()}var a,l,c=!!e.test,d=e.load||e.both,u=e.callback||r,h=u,p=e.complete||r;i(c?e.yep:e.nope,!!d),d&&i(d)}var c,u,p=this.yepnope.loader;if(o(e))s(e,0,p,0);else if(T(e))for(c=0;e.length>c;c++)u=e[c],o(u)?s(u,0,p,0):T(u)?h(u):Object(u)===u&&l(u,p);else Object(e)===e&&l(e,p)},h.addPrefix=function(e,t){E[e]=t},h.addFilter=function(e){k.push(e)},h.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",u=function(){t.removeEventListener("DOMContentLoaded",u,0),t.readyState="complete"},0)),e.yepnope=d(),e.yepnope.executeStack=a,e.yepnope.injectJs=function(e,i,n,o,l,c){var d,u,p=t.createElement("script"),o=o||h.errorTimeout;p.src=e;for(u in n)p.setAttribute(u,n[u]);i=c?a:i||r,p.onreadystatechange=p.onload=function(){!d&&s(p.readyState)&&(d=1,i(),p.onload=p.onreadystatechange=null)},f(function(){d||(d=1,i(1))},o),l?p.onload():m.parentNode.insertBefore(p,m)},e.yepnope.injectCss=function(e,i,n,o,s,l){var c,o=t.createElement("link"),i=l?a:i||r;o.href=e,o.rel="stylesheet",o.type="text/css";for(c in n)o.setAttribute(c,n[c]);s||(m.parentNode.insertBefore(o,m),f(i,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},/*!
 * jQuery UI 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
function(e,t){function i(t){return!e(t).parents().andSelf().filter(function(){return"hidden"===e.curCSS(this,"visibility")||e.expr.filters.hidden(this)}).length}function n(t,n){var o=t.nodeName.toLowerCase();if("area"===o){var r,s=t.parentNode,a=s.name;return t.href&&a&&"map"===s.nodeName.toLowerCase()?(r=e("img[usemap=#"+a+"]")[0],!!r&&i(r)):!1}return(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"==o?t.href||n:n)&&i(t)}e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.8.17",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({propAttr:e.fn.prop||e.fn.attr,_focus:e.fn.focus,focus:function(t,i){return"number"==typeof t?this.each(function(){var n=this;setTimeout(function(){e(n).focus(),i&&i.call(n)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,o,r=e(this[0]);r.length&&r[0]!==document;){if(n=r.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(o=parseInt(r.css("zIndex"),10),!isNaN(o)&&0!==o))return o;r=r.parent()}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.each(["Width","Height"],function(i,n){function o(t,i,n,o){return e.each(r,function(){i-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,n&&(i-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),o&&(i-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),i}var r="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?a["inner"+n].call(this):this.each(function(){e(this).css(s,o(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?a["outer"+n].call(this,t):this.each(function(){e(this).css(s,o(this,t,!0,i)+"px")})}}),e.extend(e.expr[":"],{data:function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),o=isNaN(i);return(o||i>=0)&&n(t,!o)}}),e(function(){var t=document.body,i=t.appendChild(i=document.createElement("div"));e.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===i.offsetHeight,e.support.selectstart="onselectstart"in i,t.removeChild(i).style.display="none"}),e.extend(e.ui,{plugin:{add:function(t,i,n){var o=e.ui[t].prototype;for(var r in n)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([i,n[r]])},call:function(e,t,i){var n=e.plugins[t];if(n&&e.element[0].parentNode)for(var o=0;n.length>o;o++)e.options[n[o][0]]&&n[o][1].apply(e.element,i)}},contains:function(e,t){return document.compareDocumentPosition?16&e.compareDocumentPosition(t):e!==t&&e.contains(t)},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",o=!1;return t[n]>0?!0:(t[n]=1,o=t[n]>0,t[n]=0,o)},isOverAxis:function(e,t,i){return e>t&&t+i>e},isOver:function(t,i,n,o,r,s){return e.ui.isOverAxis(t,n,r)&&e.ui.isOverAxis(i,o,s)}}))}(jQuery),/*!
 * jQuery UI Widget 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
function(e,t){if(e.cleanData){var i=e.cleanData;e.cleanData=function(t){for(var n,o=0;null!=(n=t[o]);o++)try{e(n).triggerHandler("remove")}catch(r){}i(t)}}else{var n=e.fn.remove;e.fn.remove=function(t,i){return this.each(function(){return i||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}}),n.call(e(this),t,i)})}}e.widget=function(t,i,n){var o,r=t.split(".")[0];t=t.split(".")[1],o=r+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][o]=function(i){return!!e.data(i,t)},e[r]=e[r]||{},e[r][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var s=new i;s.options=e.extend(!0,{},s.options),e[r][t].prototype=e.extend(!0,s,{namespace:r,widgetName:t,widgetEventPrefix:e[r][t].prototype.widgetEventPrefix||t,widgetBaseClass:o},n),e.widget.bridge(t,e[r][t])},e.widget.bridge=function(i,n){e.fn[i]=function(o){var r="string"==typeof o,s=Array.prototype.slice.call(arguments,1),a=this;return o=!r&&s.length?e.extend.apply(null,[!0,o].concat(s)):o,r&&"_"===o.charAt(0)?a:(r?this.each(function(){var n=e.data(this,i),r=n&&e.isFunction(n[o])?n[o].apply(n,s):n;return r!==n&&r!==t?(a=r,!1):void 0}):this.each(function(){var t=e.data(this,i);t?t.option(o||{})._init():e.data(this,i,new n(o,this))}),a)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,i){e.data(i,this.widgetName,this),this.element=e(i),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var n=this;this.element.bind("remove."+this.widgetName,function(){n.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(i,n){var o=i;if(0===arguments.length)return e.extend({},this.options);if("string"==typeof i){if(n===t)return this.options[i];o={},o[i]=n}return this._setOptions(o),this},_setOptions:function(t){var i=this;return e.each(t,function(e,t){i._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,i,n){var o,r,s=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent,r)for(o in r)o in i||(i[o]=r[o]);return this.element.trigger(i,n),!(e.isFunction(s)&&s.call(this.element[0],i,n)===!1||i.isDefaultPrevented())}}}(jQuery),/*!
 * jQuery UI Mouse 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,o=1==i.which,r="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return o&&!r&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.browser.msie||document.documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target==this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),/*
 * jQuery UI Position 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */
function(e){e.ui=e.ui||{};var t=/left|center|right/,i=/top|center|bottom/,n="center",o={},r=e.fn.position,s=e.fn.offset;e.fn.position=function(s){if(!s||!s.of)return r.apply(this,arguments);s=e.extend({},s);var a,l,c,d=e(s.of),u=d[0],h=(s.collision||"flip").split(" "),p=s.offset?s.offset.split(" "):[0,0];return 9===u.nodeType?(a=d.width(),l=d.height(),c={top:0,left:0}):u.setTimeout?(a=d.width(),l=d.height(),c={top:d.scrollTop(),left:d.scrollLeft()}):u.preventDefault?(s.at="left top",a=l=0,c={top:s.of.pageY,left:s.of.pageX}):(a=d.outerWidth(),l=d.outerHeight(),c=d.offset()),e.each(["my","at"],function(){var e=(s[this]||"").split(" ");1===e.length&&(e=t.test(e[0])?e.concat([n]):i.test(e[0])?[n].concat(e):[n,n]),e[0]=t.test(e[0])?e[0]:n,e[1]=i.test(e[1])?e[1]:n,s[this]=e}),1===h.length&&(h[1]=h[0]),p[0]=parseInt(p[0],10)||0,1===p.length&&(p[1]=p[0]),p[1]=parseInt(p[1],10)||0,"right"===s.at[0]?c.left+=a:s.at[0]===n&&(c.left+=a/2),"bottom"===s.at[1]?c.top+=l:s.at[1]===n&&(c.top+=l/2),c.left+=p[0],c.top+=p[1],this.each(function(){var t,i=e(this),r=i.outerWidth(),d=i.outerHeight(),u=parseInt(e.curCSS(this,"marginLeft",!0))||0,f=parseInt(e.curCSS(this,"marginTop",!0))||0,m=r+u+(parseInt(e.curCSS(this,"marginRight",!0))||0),g=d+f+(parseInt(e.curCSS(this,"marginBottom",!0))||0),v=e.extend({},c);"right"===s.my[0]?v.left-=r:s.my[0]===n&&(v.left-=r/2),"bottom"===s.my[1]?v.top-=d:s.my[1]===n&&(v.top-=d/2),o.fractions||(v.left=Math.round(v.left),v.top=Math.round(v.top)),t={left:v.left-u,top:v.top-f},e.each(["left","top"],function(i,n){e.ui.position[h[i]]&&e.ui.position[h[i]][n](v,{targetWidth:a,targetHeight:l,elemWidth:r,elemHeight:d,collisionPosition:t,collisionWidth:m,collisionHeight:g,offset:p,my:s.my,at:s.at})}),e.fn.bgiframe&&i.bgiframe(),i.offset(e.extend(v,{using:s.using}))})},e.ui.position={fit:{left:function(t,i){var n=e(window),o=i.collisionPosition.left+i.collisionWidth-n.width()-n.scrollLeft();t.left=o>0?t.left-o:Math.max(t.left-i.collisionPosition.left,t.left)},top:function(t,i){var n=e(window),o=i.collisionPosition.top+i.collisionHeight-n.height()-n.scrollTop();t.top=o>0?t.top-o:Math.max(t.top-i.collisionPosition.top,t.top)}},flip:{left:function(t,i){if(i.at[0]!==n){var o=e(window),r=i.collisionPosition.left+i.collisionWidth-o.width()-o.scrollLeft(),s="left"===i.my[0]?-i.elemWidth:"right"===i.my[0]?i.elemWidth:0,a="left"===i.at[0]?i.targetWidth:-i.targetWidth,l=-2*i.offset[0];t.left+=0>i.collisionPosition.left?s+a+l:r>0?s+a+l:0}},top:function(t,i){if(i.at[1]!==n){var o=e(window),r=i.collisionPosition.top+i.collisionHeight-o.height()-o.scrollTop(),s="top"===i.my[1]?-i.elemHeight:"bottom"===i.my[1]?i.elemHeight:0,a="top"===i.at[1]?i.targetHeight:-i.targetHeight,l=-2*i.offset[1];t.top+=0>i.collisionPosition.top?s+a+l:r>0?s+a+l:0}}}},e.offset.setOffset||(e.offset.setOffset=function(t,i){/static/.test(e.curCSS(t,"position"))&&(t.style.position="relative");var n=e(t),o=n.offset(),r=parseInt(e.curCSS(t,"top",!0),10)||0,s=parseInt(e.curCSS(t,"left",!0),10)||0,a={top:i.top-o.top+r,left:i.left-o.left+s};"using"in i?i.using.call(t,a):n.css(a)},e.fn.offset=function(t){var i=this[0];return i&&i.ownerDocument?t?this.each(function(){e.offset.setOffset(this,t)}):s.call(this):null}),function(){var t,i,n,r,s,a=document.getElementsByTagName("body")[0],l=document.createElement("div");t=document.createElement(a?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&jQuery.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(var c in n)t.style[c]=n[c];t.appendChild(l),i=a||document.documentElement,i.insertBefore(t,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",r=e(l).offset(function(e,t){return t}).offset(),t.innerHTML="",i.removeChild(t),s=r.top+r.left+(a?2e3:0),o.fractions=s>21&&22>s}()}(jQuery),/*
 * jQuery UI Draggable 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Draggables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(e){e.widget("ui.draggable",e.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"==this.options.helper&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){return this.element.data("draggable")?(this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this):void 0},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(i.iframeFix&&e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=!1;if(e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),!(this.element[0]&&this.element[0].parentNode||"original"!=this.options.helper))return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var n=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return this.options.iframeFix===!0&&e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var i=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(i=!0)}),i},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),n[0]!=this.element[0]&&!/(fixed|absolute)/.test(n.css("position"))&&n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=["document"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{var i=e(t.containment),n=i[0];if(!n)return;var o=(i.offset(),"hidden"!=e(n).css("overflow"));this.containment=[(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0),(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0),(o?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(o?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,o=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(o[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-(e.browser.safari&&526>e.browser.version&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:o.scrollTop())*n),left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-(e.browser.safari&&526>e.browser.version&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:o.scrollLeft())*n)}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName),r=t.pageX,s=t.pageY;if(this.originalPosition){var a;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();a=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else a=this.containment;t.pageX-this.offset.click.left<a[0]&&(r=a[0]+this.offset.click.left),t.pageY-this.offset.click.top<a[1]&&(s=a[1]+this.offset.click.top),t.pageX-this.offset.click.left>a[2]&&(r=a[2]+this.offset.click.left),t.pageY-this.offset.click.top>a[3]&&(s=a[3]+this.offset.click.top)}if(i.grid){var c=i.grid[1]?this.originalPageY+Math.round((s-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;s=a?c-this.offset.click.top<a[1]||c-this.offset.click.top>a[3]?c-this.offset.click.top<a[1]?c+i.grid[1]:c-i.grid[1]:c:c;var d=i.grid[0]?this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;r=a?d-this.offset.click.left<a[0]||d-this.offset.click.left>a[2]?d-this.offset.click.left<a[0]?d+i.grid[0]:d-i.grid[0]:d:d}}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&526>e.browser.version&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&526>e.browser.version&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.extend(e.ui.draggable,{version:"1.8.17"}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("draggable"),o=n.options,r=e.extend({},i,{item:n.element});n.sortables=[],e(o.connectToSortable).each(function(){var i=e.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,r))})},stop:function(t,i){var n=e(this).data("draggable"),o=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,o))})},drag:function(t,i){var n=e(this).data("draggable"),o=this;e.each(n.sortables,function(){this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(o).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),o=e(this).data("draggable").options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(t,i){var n=e(this).data("draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&"HTML"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("draggable"),n=i.options,o=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(n.axis&&"x"==n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=o=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=o=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"==n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=o=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=o=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"==n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?o=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(o=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"==n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?o=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(o=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),o!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){for(var n=e(this).data("draggable"),o=n.options,r=o.snapTolerance,s=i.offset.left,a=s+n.helperProportions.width,l=i.offset.top,c=l+n.helperProportions.height,d=n.snapElements.length-1;d>=0;d--){var u=n.snapElements[d].left,h=u+n.snapElements[d].width,p=n.snapElements[d].top,f=p+n.snapElements[d].height;if(s>u-r&&h+r>s&&l>p-r&&f+r>l||s>u-r&&h+r>s&&c>p-r&&f+r>c||a>u-r&&h+r>a&&l>p-r&&f+r>l||a>u-r&&h+r>a&&c>p-r&&f+r>c){if("inner"!=o.snapMode){var m=r>=Math.abs(p-c),g=r>=Math.abs(f-l),v=r>=Math.abs(u-a),y=r>=Math.abs(h-s);m&&(i.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:u-n.helperProportions.width}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left)}var b=m||g||v||y;if("outer"!=o.snapMode){var m=r>=Math.abs(p-l),g=r>=Math.abs(f-c),v=r>=Math.abs(u-s),y=r>=Math.abs(h-a);m&&(i.position.top=n._convertPositionTo("relative",{top:p,left:0}).top-n.margins.top),g&&(i.position.top=n._convertPositionTo("relative",{top:f-n.helperProportions.height,left:0}).top-n.margins.top),v&&(i.position.left=n._convertPositionTo("relative",{top:0,left:u}).left-n.margins.left),y&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left)}!n.snapElements[d].snapping&&(m||g||v||y||b)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[d].item})),n.snapElements[d].snapping=m||g||v||y||b}else n.snapElements[d].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[d].item})),n.snapElements[d].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options,i=e.makeArray(e(t.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});if(i.length){var n=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=n+e}),this[0].style.zIndex=n+i.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),o=e(this).data("draggable").options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(t,i){var n=e(this).data("draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(jQuery),/*
 * jQuery UI Droppable 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Droppables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.mouse.js
 *	jquery.ui.draggable.js
 */
function(e){e.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var t=this.options,i=t.accept;this.isover=0,this.isout=1,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){for(var t=e.ui.ddmanager.droppables[this.options.scope],i=0;t.length>i;i++)t[i]==this&&t.splice(i,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(t,i){"accept"==t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;!!i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;!!i&&(i.currentItem||i.element)[0]!=this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]==this.element[0])return!1;var o=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope==n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&e.ui.intersect(n,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(o=!0,!1):void 0}),o?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(n)),this.element):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.extend(e.ui.droppable,{version:"1.8.17"}),e.ui.intersect=function(t,i,n){if(!i.offset)return!1;var o=(t.positionAbs||t.position.absolute).left,r=o+t.helperProportions.width,s=(t.positionAbs||t.position.absolute).top,a=s+t.helperProportions.height,l=i.offset.left,c=l+i.proportions.width,d=i.offset.top,u=d+i.proportions.height;switch(n){case"fit":return o>=l&&c>=r&&s>=d&&u>=a;case"intersect":return o+t.helperProportions.width/2>l&&c>r-t.helperProportions.width/2&&s+t.helperProportions.height/2>d&&u>a-t.helperProportions.height/2;case"pointer":var h=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,p=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,f=e.ui.isOver(p,h,d,l,i.proportions.height,i.proportions.width);return f;case"touch":return(s>=d&&u>=s||a>=d&&u>=a||d>s&&a>u)&&(o>=l&&c>=o||r>=l&&c>=r||l>o&&r>c);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var n=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(droppable)").andSelf();e:for(var s=0;n.length>s;s++)if(!(n[s].options.disabled||t&&!n[s].accept.call(n[s].element[0],t.currentItem||t.element))){for(var a=0;r.length>a;a++)if(r[a]==n[s].element[0]){n[s].proportions.height=0;continue e}n[s].visible="none"!=n[s].element.css("display"),n[s].visible&&("mousedown"==o&&n[s]._activate.call(n[s],i),n[s].offset=n[s].element.offset(),n[s].proportions={width:n[s].element[0].offsetWidth,height:n[s].element[0].offsetHeight})}},drop:function(t,i){var n=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){!this.options||(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parents(":not(body,html)").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n=e.ui.intersect(t,this,this.options.tolerance),o=n||1!=this.isover?n&&0==this.isover?"isover":null:"isout";if(!o)return;var r;if(this.options.greedy){var s=this.element.parents(":data(droppable):eq(0)");s.length&&(r=e.data(s[0],"droppable"),r.greedyChild="isover"==o?1:0)}r&&"isover"==o&&(r.isover=0,r.isout=1,r._out.call(r,i)),this[o]=1,this["isout"==o?"isover":"isout"]=0,this["isover"==o?"_over":"_out"].call(this,i),r&&"isout"==o&&(r.isout=0,r.isover=1,r._over.call(r,i))}})},dragStop:function(t,i){t.element.parents(":not(body,html)").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),/*
 * jQuery UI Resizable 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Resizables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(e){e.widget("ui.resizable",e.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var t=this,i=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&e.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=i.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor==String){"all"==this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var n=this.handles.split(",");this.handles={};for(var o=0;n.length>o;o++){var r=e.trim(n[o]),s="ui-resizable-"+r,a=e('<div class="ui-resizable-handle '+s+'"></div>');/sw|se|ne|nw/.test(r)&&a.css({zIndex:++i.zIndex}),"se"==r&&a.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(a)}}this._renderAxis=function(t){t=t||this.element;for(var i in this.handles){if(this.handles[i].constructor==String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var n=e(this.handles[i],this.element),o=0;o=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth();var r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");t.css(r,o),this._proportionallyResize()}e(this.handles[i]).length}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!t.resizing){if(this.className)var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);t.axis=e&&e[1]?e[1]:"se"}}),i.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").hover(function(){i.disabled||(e(this).removeClass("ui-resizable-autohide"),t._handles.show())},function(){i.disabled||t.resizing||(e(this).addClass("ui-resizable-autohide"),t._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var t=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){t(this.element);var i=this.element;i.after(this.originalElement.css({position:i.css("position"),width:i.outerWidth(),height:i.outerHeight(),top:i.css("top"),left:i.css("left")})).remove()}return this.originalElement.css("resize",this.originalResizeStyle),t(this.originalElement),this},_mouseCapture:function(t){var i=!1;for(var n in this.handles)e(this.handles[n])[0]==t.target&&(i=!0);return!this.options.disabled&&i},_mouseStart:function(i){var n=this.options,o=this.element.position(),r=this.element;this.resizing=!0,this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()},(r.is(".ui-draggable")||/absolute/.test(r.css("position")))&&r.css({position:"absolute",top:o.top,left:o.left}),e.browser.opera&&/relative/.test(r.css("position"))&&r.css({position:"relative",top:"auto",left:"auto"}),this._renderProxy();var s=t(this.helper.css("left")),a=t(this.helper.css("top"));n.containment&&(s+=e(n.containment).scrollLeft()||0,a+=e(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:s,top:a},this.size=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalSize=this._helper?{width:r.outerWidth(),height:r.outerHeight()}:{width:r.width(),height:r.height()},this.originalPosition={left:s,top:a},this.sizeDiff={width:r.outerWidth()-r.width(),height:r.outerHeight()-r.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof n.aspectRatio?n.aspectRatio:this.originalSize.width/this.originalSize.height||1;var l=e(".ui-resizable-"+this.axis).css("cursor");return e("body").css("cursor","auto"==l?this.axis+"-resize":l),r.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(t){var i=this.helper,n=(this.options,this.originalMousePosition),o=this.axis,r=t.pageX-n.left||0,s=t.pageY-n.top||0,a=this._change[o];if(!a)return!1;var l=a.apply(this,[t,r,s]);return e.browser.msie&&7>e.browser.version,this.sizeDiff,this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(l=this._updateRatio(l,t)),l=this._respectSize(l,t),this._propagate("resize",t),i.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(l),this._trigger("resize",t,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var i=this.options,n=this;if(this._helper){var o=this._proportionallyResizeElements,r=o.length&&/textarea/i.test(o[0].nodeName),s=r&&e.ui.hasScroll(o[0],"left")?0:n.sizeDiff.height,a=r?0:n.sizeDiff.width,l={width:n.helper.width()-a,height:n.helper.height()-s},c=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,d=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;i.animate||this.element.css(e.extend(l,{top:d,left:c})),n.helper.height(n.size.height),n.helper.width(n.size.width),this._helper&&!i.animate&&this._proportionallyResize()}return e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,o,r,s,a=this.options;s={minWidth:i(a.minWidth)?a.minWidth:0,maxWidth:i(a.maxWidth)?a.maxWidth:1/0,minHeight:i(a.minHeight)?a.minHeight:0,maxHeight:i(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,o=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,r=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),o>s.minHeight&&(s.minHeight=o),s.maxWidth>n&&(s.maxWidth=n),s.maxHeight>r&&(s.maxHeight=r)),this._vBoundaries=s},_updateCache:function(e){this.options,this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=(this.options,this.position),n=this.size,o=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"==o&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"==o&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e,t){var n=(this.helper,this._vBoundaries),o=(this._aspectRatio||t.shiftKey,this.axis),r=i(e.width)&&n.maxWidth&&n.maxWidth<e.width,s=i(e.height)&&n.maxHeight&&n.maxHeight<e.height,a=i(e.width)&&n.minWidth&&n.minWidth>e.width,l=i(e.height)&&n.minHeight&&n.minHeight>e.height;a&&(e.width=n.minWidth),l&&(e.height=n.minHeight),r&&(e.width=n.maxWidth),s&&(e.height=n.maxHeight);var c=this.originalPosition.left+this.originalSize.width,d=this.position.top+this.size.height,u=/sw|nw|w/.test(o),h=/nw|ne|n/.test(o);a&&u&&(e.left=c-n.minWidth),r&&u&&(e.left=c-n.maxWidth),l&&h&&(e.top=d-n.minHeight),s&&h&&(e.top=d-n.maxHeight);var p=!e.width&&!e.height;return p&&!e.left&&e.top?e.top=null:p&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){if(this.options,this._proportionallyResizeElements.length)for(var t=this.helper||this.element,i=0;this._proportionallyResizeElements.length>i;i++){var n=this._proportionallyResizeElements[i];if(!this.borderDif){var o=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],r=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")];this.borderDif=e.map(o,function(e,t){var i=parseInt(e,10)||0,n=parseInt(r[t],10)||0;return i+n})}e.browser.msie&&(e(t).is(":hidden")||e(t).parents(":hidden").length)||n.css({height:t.height()-this.borderDif[0]-this.borderDif[2]||0,width:t.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,i=this.options;if(this.elementOffset=t.offset(),this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var n=e.browser.msie&&7>e.browser.version,o=n?1:0,r=n?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+r,height:this.element.outerHeight()+r,position:"absolute",left:this.elementOffset.left-o+"px",top:this.elementOffset.top-o+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=(this.options,this.originalSize),n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=(this.options,this.originalSize),o=this.originalPosition;return{top:o.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!=t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.extend(e.ui.resizable,{version:"1.8.17"}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10),position:t.css("position")})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("resizable"),o=n.options,r=n.originalSize,s=n.originalPosition,a={height:n.size.height-r.height||0,width:n.size.width-r.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0},l=function(t,o){e(t).each(function(){var t=e(this),r=e(this).data("resizable-alsoresize"),s={},l=o&&o.length?o:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(l,function(e,t){var i=(r[t]||0)+(a[t]||0);i&&i>=0&&(s[t]=i||null)}),e.browser.opera&&/relative/.test(t.css("position"))&&(n._revertToRelativePosition=!0,t.css({position:"absolute",top:"auto",left:"auto"})),t.css(s)})};"object"!=typeof o.alsoResize||o.alsoResize.nodeType?l(o.alsoResize):e.each(o.alsoResize,function(e,t){l(e,t)})},stop:function(){var t=e(this).data("resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.css({position:t.data("resizable-alsoresize").position})})};t._revertToRelativePosition&&(t._revertToRelativePosition=!1,"object"!=typeof i.alsoResize||i.alsoResize.nodeType?n(i.alsoResize):e.each(i.alsoResize,function(e){n(e)})),e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("resizable"),n=i.options,o=i._proportionallyResizeElements,r=o.length&&/textarea/i.test(o[0].nodeName),s=r&&e.ui.hasScroll(o[0],"left")?0:i.sizeDiff.height,a=r?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},c=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,d=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,d&&c?{top:d,left:c}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};o&&o.length&&e(o[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var i=e(this).data("resizable"),n=i.options,o=i.element,r=n.containment,s=r instanceof e?r.get(0):/parent/.test(r)?o.parent().get(0):r;if(s)if(i.containerElement=e(s),/document/.test(r)||r==document)i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight};else{var a=e(s),l=[];e(["Top","Right","Left","Bottom"]).each(function(e,i){l[e]=t(a.css("padding"+i))}),i.containerOffset=a.offset(),i.containerPosition=a.position(),i.containerSize={height:a.innerHeight()-l[3],width:a.innerWidth()-l[1]};var c=i.containerOffset,d=i.containerSize.height,u=i.containerSize.width,h=e.ui.hasScroll(s,"left")?s.scrollWidth:u,p=e.ui.hasScroll(s)?s.scrollHeight:d;i.parentData={element:s,left:c.left,top:c.top,width:h,height:p}}},resize:function(t){var i=e(this).data("resizable"),n=i.options,o=(i.containerSize,i.containerOffset),r=(i.size,i.position),s=i._aspectRatio||t.shiftKey,a={top:0,left:0},l=i.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(a=o),r.left<(i._helper?o.left:0)&&(i.size.width=i.size.width+(i._helper?i.position.left-o.left:i.position.left-a.left),s&&(i.size.height=i.size.width/n.aspectRatio),i.position.left=n.helper?o.left:0),r.top<(i._helper?o.top:0)&&(i.size.height=i.size.height+(i._helper?i.position.top-o.top:i.position.top),s&&(i.size.width=i.size.height*n.aspectRatio),i.position.top=i._helper?o.top:0),i.offset.left=i.parentData.left+i.position.left,i.offset.top=i.parentData.top+i.position.top;var c=Math.abs((i._helper?i.offset.left-a.left:i.offset.left-a.left)+i.sizeDiff.width),d=Math.abs((i._helper?i.offset.top-a.top:i.offset.top-o.top)+i.sizeDiff.height),u=i.containerElement.get(0)==i.element.parent().get(0),h=/relative|absolute/.test(i.containerElement.css("position"));u&&h&&(c-=i.parentData.left),c+i.size.width>=i.parentData.width&&(i.size.width=i.parentData.width-c,s&&(i.size.height=i.size.width/i.aspectRatio)),d+i.size.height>=i.parentData.height&&(i.size.height=i.parentData.height-d,s&&(i.size.width=i.size.height*i.aspectRatio))},stop:function(){var t=e(this).data("resizable"),i=t.options,n=(t.position,t.containerOffset),o=t.containerPosition,r=t.containerElement,s=e(t.helper),a=s.offset(),l=s.outerWidth()-t.sizeDiff.width,c=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(r.css("position"))&&e(this).css({left:a.left-o.left-n.left,width:l,height:c}),t._helper&&!i.animate&&/static/.test(r.css("position"))&&e(this).css({left:a.left-o.left-n.left,width:l,height:c})}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("resizable"),i=t.options,n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("resizable");t.options,t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("resizable");t.options,t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(t){var i=e(this).data("resizable"),n=i.options,o=i.size,r=i.originalSize,s=i.originalPosition,a=i.axis;n._aspectRatio||t.shiftKey,n.grid="number"==typeof n.grid?[n.grid,n.grid]:n.grid;var l=Math.round((o.width-r.width)/(n.grid[0]||1))*(n.grid[0]||1),c=Math.round((o.height-r.height)/(n.grid[1]||1))*(n.grid[1]||1);/^(se|s|e)$/.test(a)?(i.size.width=r.width+l,i.size.height=r.height+c):/^(ne)$/.test(a)?(i.size.width=r.width+l,i.size.height=r.height+c,i.position.top=s.top-c):/^(sw)$/.test(a)?(i.size.width=r.width+l,i.size.height=r.height+c,i.position.left=s.left-l):(i.size.width=r.width+l,i.size.height=r.height+c,i.position.top=s.top-c,i.position.left=s.left-l)}});var t=function(e){return parseInt(e,10)||0},i=function(e){return!isNaN(parseInt(e,10))}}(jQuery),/*
 * jQuery UI Selectable 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Selectables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(e){e.widget("ui.selectable",e.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var t=this;this.element.addClass("ui-selectable"),this.dragged=!1;var i;this.refresh=function(){i=e(t.options.filter,t.element[0]),i.addClass("ui-selectee"),i.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=i.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(t){var i=this;if(this.opos=[t.pageX,t.pageY],!this.options.disabled){var n=this.options;this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.clientX,top:t.clientY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,!t.metaKey&&!t.ctrlKey&&(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().andSelf().each(function(){var n=e.data(this,"selectable-item");if(n){var o=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected");return n.$element.removeClass(o?"ui-unselecting":"ui-selected").addClass(o?"ui-selecting":"ui-unselecting"),n.unselecting=!o,n.selecting=o,n.selected=o,o?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1}})}},_mouseDrag:function(t){var i=this;if(this.dragged=!0,!this.options.disabled){var n=this.options,o=this.opos[0],r=this.opos[1],s=t.pageX,a=t.pageY;if(o>s){var l=s;s=o,o=l}if(r>a){var l=a;a=r,r=l}return this.helper.css({left:o,top:r,width:s-o,height:a-r}),this.selectees.each(function(){var l=e.data(this,"selectable-item");if(l&&l.element!=i.element[0]){var c=!1;"touch"==n.tolerance?c=!(l.left>s||o>l.right||l.top>a||r>l.bottom):"fit"==n.tolerance&&(c=l.left>o&&s>l.right&&l.top>r&&a>l.bottom),c?(l.selected&&(l.$element.removeClass("ui-selected"),l.selected=!1),l.unselecting&&(l.$element.removeClass("ui-unselecting"),l.unselecting=!1),l.selecting||(l.$element.addClass("ui-selecting"),l.selecting=!0,i._trigger("selecting",t,{selecting:l.element}))):(l.selecting&&((t.metaKey||t.ctrlKey)&&l.startselected?(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.$element.addClass("ui-selected"),l.selected=!0):(l.$element.removeClass("ui-selecting"),l.selecting=!1,l.startselected&&(l.$element.addClass("ui-unselecting"),l.unselecting=!0),i._trigger("unselecting",t,{unselecting:l.element}))),l.selected&&!t.metaKey&&!t.ctrlKey&&!l.startselected&&(l.$element.removeClass("ui-selected"),l.selected=!1,l.$element.addClass("ui-unselecting"),l.unselecting=!0,i._trigger("unselecting",t,{unselecting:l.element})))}}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,this.options,e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.extend(e.ui.selectable,{version:"1.8.17"})}(jQuery),/*
 * jQuery UI Sortable 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Sortables
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
function(e){e.widget("ui.sortable",e.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget()[i?"addClass":"removeClass"]("ui-sortable-disabled")):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(t);var o=null,r=this;if(e(t.target).parents().each(function(){return e.data(this,n.widgetName+"-item")==r?(o=e(this),!1):void 0}),e.data(t.target,n.widgetName+"-item")==r&&(o=e(t.target)),!o)return!1;if(this.options.handle&&!i){var s=!1;if(e(this.options.handle,o).find("*").andSelf().each(function(){this==t.target&&(s=!0)}),!s)return!1}return this.currentItem=o,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,i,n){var o=this.options,r=this;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",o.cursor)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(var s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",t,r._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,n=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(t.pageY-e(document).scrollTop()<i.scrollSensitivity?n=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(n=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed)),t.pageX-e(document).scrollLeft()<i.scrollSensitivity?n=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(n=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))),n!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var o=this.items.length-1;o>=0;o--){var r=this.items[o],s=r.item[0],a=this._intersectsWithPointer(r);if(a&&s!=this.currentItem[0]&&this.placeholder[1==a?"next":"prev"]()[0]!=s&&!e.ui.contains(this.placeholder[0],s)&&("semi-dynamic"==this.options.type?!e.ui.contains(this.element[0],s):!0)){if(this.direction=1==a?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,o=n.placeholder.offset();n.reverting=!0,e(this.helper).animate({left:o.left-this.offset.parent.left-n.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:o.top-this.offset.parent.top-n.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){var t=this;if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("deactivate",null,t._uiHash(this)),this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",null,t._uiHash(this)),this.containers[i].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,o=n+this.helperProportions.height,r=e.left,s=r+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,d=this.offset.click.left,u=n+c>a&&l>n+c&&t+d>r&&s>t+d;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?u:t+this.helperProportions.width/2>r&&s>i-this.helperProportions.width/2&&n+this.helperProportions.height/2>a&&l>o-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=i&&n,r=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return o?this.floating?s&&"right"==s||"down"==r?2:1:r&&("down"==r?2:1):!1},_intersectsWithSides:function(t){var i=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),o=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"==r&&n||"left"==r&&!n:o&&("down"==o&&i||"up"==o&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!=e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!=e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i=[],n=[],o=this._connectWith();if(o&&t)for(var r=o.length-1;r>=0;r--)for(var s=e(o[r]),a=s.length-1;a>=0;a--){var l=e.data(s[a],this.widgetName);l&&l!=this&&!l.options.disabled&&n.push([e.isFunction(l.options.items)?l.options.items.call(l.element):e(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}n.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var r=n.length-1;r>=0;r--)n[r][0].each(function(){i.push(this)});return e(i)},_removeCurrentsFromItems:function(){for(var e=this.currentItem.find(":data("+this.widgetName+"-item)"),t=0;this.items.length>t;t++)for(var i=0;e.length>i;i++)e[i]==this.items[t].item[0]&&this.items.splice(t,1)},_refreshItems:function(t){this.items=[],this.containers=[this];var i=this.items,n=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],o=this._connectWith();if(o)for(var r=o.length-1;r>=0;r--)for(var s=e(o[r]),a=s.length-1;a>=0;a--){var l=e.data(s[a],this.widgetName);l&&l!=this&&!l.options.disabled&&(n.push([e.isFunction(l.options.items)?l.options.items.call(l.element[0],t,{item:this.currentItem}):e(l.options.items,l.element),l]),this.containers.push(l))}for(var r=n.length-1;r>=0;r--)for(var c=n[r][1],d=n[r][0],a=0,u=d.length;u>a;a++){var h=e(d[a]);h.data(this.widgetName+"-item",c),i.push({item:h,instance:c,width:0,height:0,left:0,top:0})}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var n=this.items[i];if(n.instance==this.currentContainer||!this.currentContainer||n.item[0]==this.currentItem[0]){var o=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item;t||(n.width=o.outerWidth(),n.height=o.outerHeight());var r=o.offset();n.left=r.left,n.top=r.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var r=this.containers[i].element.offset();this.containers[i].containerCache.left=r.left,this.containers[i].containerCache.top=r.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(t){var i=t||this,n=i.options;if(!n.placeholder||n.placeholder.constructor==String){var o=n.placeholder;n.placeholder={element:function(){var t=e(document.createElement(i.currentItem[0].nodeName)).addClass(o||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return o||(t.style.visibility="hidden"),t},update:function(e,t){(!o||n.forcePlaceholderSize)&&(t.height()||t.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),t.width()||t.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10)))}}}i.placeholder=e(n.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),n.placeholder.update(i,i.placeholder)},_contactContainers:function(t){for(var i=null,n=null,o=this.containers.length-1;o>=0;o--)if(!e.ui.contains(this.currentItem[0],this.containers[o].element[0]))if(this._intersectsWith(this.containers[o].containerCache)){if(i&&e.ui.contains(this.containers[o].element[0],i.element[0]))continue;i=this.containers[o],n=o}else this.containers[o].containerCache.over&&(this.containers[o]._trigger("out",t,this._uiHash(this)),this.containers[o].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1;else if(this.currentContainer!=this.containers[n]){for(var r=1e4,s=null,a=this.positionAbs[this.containers[n].floating?"left":"top"],l=this.items.length-1;l>=0;l--)if(e.ui.contains(this.containers[n].element[0],this.items[l].item[0])){var c=this.items[l][this.containers[n].floating?"left":"top"];r>Math.abs(c-a)&&(r=Math.abs(c-a),s=this.items[l])}if(!s&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[n],s?this._rearrange(t,s,null,!0):this._rearrange(t,null,this.containers[n].element,!0),this._trigger("change",t,this._uiHash()),this.containers[n]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",t,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(""==n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(t.containment)){var i=e(t.containment)[0],n=e(t.containment).offset(),o="hidden"!=e(i).css("overflow");this.containment=[n.left+(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0)-this.margins.top,n.left+(o?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(o?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"==t?1:-1,o=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),r=/(html|body)/i.test(o[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-(e.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:o.scrollTop())*n),left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-(e.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:o.scrollLeft())*n)}},_generatePosition:function(t){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);"relative"==this.cssPosition&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var r=t.pageX,s=t.pageY;if(this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),i.grid)){var a=this.originalPageY+Math.round((s-this.originalPageY)/i.grid[1])*i.grid[1];s=this.containment?a-this.offset.click.top<this.containment[1]||a-this.offset.click.top>this.containment[3]?a-this.offset.click.top<this.containment[1]?a+i.grid[1]:a-i.grid[1]:a:a;var l=this.originalPageX+Math.round((r-this.originalPageX)/i.grid[0])*i.grid[0];r=this.containment?l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2]?l-this.offset.click.left<this.containment[0]?l+i.grid[0]:l-i.grid[0]:l:l}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(e.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(e.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this,r=this.counter;window.setTimeout(function(){r==o.counter&&o.refreshPositions(!n)},0)},_clear:function(t,i){this.reverting=!1;var n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var o in this._storedCSS)("auto"==this._storedCSS[o]||"static"==this._storedCSS[o])&&(this._storedCSS[o]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();if(this.fromOutside&&!i&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!i&&n.push(function(e){this._trigger("update",e,this._uiHash())}),!e.ui.contains(this.element[0],this.currentItem[0])){i||n.push(function(e){this._trigger("remove",e,this._uiHash())});for(var o=this.containers.length-1;o>=0;o--)e.ui.contains(this.containers[o].element[0],this.currentItem[0])&&!i&&(n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.containers[o])),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.containers[o])))}for(var o=this.containers.length-1;o>=0;o--)i||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[o])),this.containers[o].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[o])),this.containers[o].containerCache.over=0);if(this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger("beforeStop",t,this._uiHash());for(var o=0;n.length>o;o++)n[o].call(this,t);this._trigger("stop",t,this._uiHash())}return!1}if(i||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var o=0;n.length>o;o++)n[o].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.extend(e.ui.sortable,{version:"1.8.17"})}(jQuery),/*
 * jQuery UI Autocomplete 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Autocomplete
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */
function(e){var t=0;e.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var t,i=this,n=this.element[0].ownerDocument;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(n){if(!i.options.disabled&&!i.element.propAttr("readOnly")){t=!1;var o=e.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:i._move("previousPage",n);break;case o.PAGE_DOWN:i._move("nextPage",n);break;case o.UP:i._move("previous",n),n.preventDefault();break;case o.DOWN:i._move("next",n),n.preventDefault();break;case o.ENTER:case o.NUMPAD_ENTER:i.menu.active&&(t=!0,n.preventDefault());case o.TAB:if(!i.menu.active)return;i.menu.select(n);break;case o.ESCAPE:i.element.val(i.term),i.close(n);break;default:clearTimeout(i.searching),i.searching=setTimeout(function(){i.term!=i.element.val()&&(i.selectedItem=null,i.search(null,n))},i.options.delay)}}}).bind("keypress.autocomplete",function(e){t&&(t=!1,e.preventDefault())}).bind("focus.autocomplete",function(){i.options.disabled||(i.selectedItem=null,i.previous=i.element.val())}).bind("blur.autocomplete",function(e){i.options.disabled||(clearTimeout(i.searching),i.closing=setTimeout(function(){i.close(e),i._change(e)},150))}),this._initSource(),this.response=function(){return i._response.apply(i,arguments)},this.menu=e("<ul></ul>").addClass("ui-autocomplete").appendTo(e(this.options.appendTo||"body",n)[0]).mousedown(function(t){var n=i.menu.element[0];e(t.target).closest(".ui-menu-item").length||setTimeout(function(){e(document).one("mousedown",function(t){t.target!==i.element[0]&&t.target!==n&&!e.ui.contains(n,t.target)&&i.close()})},1),setTimeout(function(){clearTimeout(i.closing)},13)}).menu({focus:function(e,t){var n=t.item.data("item.autocomplete");!1!==i._trigger("focus",e,{item:n})&&/^key/.test(e.originalEvent.type)&&i.element.val(n.value)},selected:function(e,t){var o=t.item.data("item.autocomplete"),r=i.previous;i.element[0]!==n.activeElement&&(i.element.focus(),i.previous=r,setTimeout(function(){i.previous=r,i.selectedItem=o},1)),!1!==i._trigger("select",e,{item:o})&&i.element.val(o.value),i.term=i.element.val(),i.close(e),i.selectedItem=o},blur:function(){i.menu.element.is(":visible")&&i.element.val()!==i.term&&i.element.val(i.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),e.fn.bgiframe&&this.menu.element.bgiframe(),i.beforeunloadHandler=function(){i.element.removeAttr("autocomplete")},e(window).bind("beforeunload",i.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),e(window).unbind("beforeunload",this.beforeunloadHandler),e.Widget.prototype.destroy.call(this)},_setOption:function(t,i){e.Widget.prototype._setOption.apply(this,arguments),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(e(i||"body",this.element[0].ownerDocument)[0]),"disabled"===t&&i&&this.xhr&&this.xhr.abort()},_initSource:function(){var i,n,o=this;e.isArray(this.options.source)?(i=this.options.source,this.source=function(t,n){n(e.ui.autocomplete.filter(i,t.term))}):"string"==typeof this.options.source?(n=this.options.source,this.source=function(i,r){o.xhr&&o.xhr.abort(),o.xhr=e.ajax({url:n,data:i,dataType:"json",autocompleteRequest:++t,success:function(e){this.autocompleteRequest===t&&r(e)},error:function(){this.autocompleteRequest===t&&r([])}})}):this.source=this.options.source},search:function(e,t){return e=null!=e?e:this.element.val(),this.term=this.element.val(),e.length<this.options.minLength?this.close(t):(clearTimeout(this.closing),this._trigger("search",t)!==!1?this._search(e):void 0)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:e},this.response)},_response:function(e){!this.options.disabled&&e&&e.length?(e=this._normalize(e),this._suggest(e),this._trigger("open")):this.close(),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},close:function(e){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",e))},_change:function(e){this.previous!==this.element.val()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(i,t),this.menu.deactivate(),this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new e.Event("mouseover"))},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var n=this;e.each(i,function(e,i){n._renderItem(t,i)})},_renderItem:function(t,i){return e("<li></li>").data("item.autocomplete",i).append(e("<a></a>").text(i.label)).appendTo(t)},_move:function(e,t){if(this.menu.element.is(":visible")){if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e))return this.element.val(this.term),this.menu.deactivate(),void 0;this.menu[e](t)}else this.search(null,t)},widget:function(){return this.menu.element}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(t,i){var n=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return n.test(e.label||e.value||e)})}})}(jQuery),function(e){e.widget("ui.menu",{_create:function(){var t=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(i){!e(i.target).closest(".ui-menu-item a").length||(i.preventDefault(),t.select(i))}),this.refresh()},refresh:function(){var t=this,i=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");i.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(i){t.activate(i,e(this).parent())}).mouseleave(function(){t.deactivate()})},activate:function(e,t){if(this.deactivate(),this.hasScroll()){var i=t.offset().top-this.element.offset().top,n=this.element.scrollTop(),o=this.element.height();0>i?this.element.scrollTop(n+i):i>=o&&this.element.scrollTop(n+i-o+t.height())}this.active=t.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",e,{item:t})},deactivate:function(){!this.active||(this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null)},next:function(e){this.move("next",".ui-menu-item:first",e)},previous:function(e){this.move("prev",".ui-menu-item:last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,t,i){if(this.active){var n=this.active[e+"All"](".ui-menu-item").eq(0);n.length?this.activate(i,n):this.activate(i,this.element.children(t))}else this.activate(i,this.element.children(t))},nextPage:function(t){if(this.hasScroll()){if(!this.active||this.last())return this.activate(t,this.element.children(".ui-menu-item:first")),void 0;var i=this.active.offset().top,n=this.element.height(),o=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-i-n+e(this).height();return 10>t&&t>-10});o.length||(o=this.element.children(".ui-menu-item:last")),this.activate(t,o)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(t){if(this.hasScroll()){if(!this.active||this.first())return this.activate(t,this.element.children(".ui-menu-item:last")),void 0;var i=this.active.offset().top,n=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-i+n-e(this).height();return 10>t&&t>-10}),result.length||(result=this.element.children(".ui-menu-item:first")),this.activate(t,result)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[e.fn.prop?"prop":"attr"]("scrollHeight")},select:function(e){this._trigger("selected",e,{item:this.active})}})}(jQuery),/*
 * jQuery UI Dialog 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Dialog
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *  jquery.ui.button.js
 *	jquery.ui.draggable.js
 *	jquery.ui.mouse.js
 *	jquery.ui.position.js
 *	jquery.ui.resizable.js
 */
function(e,t){var i="ui-dialog ui-widget ui-widget-content ui-corner-all ",n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},o={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},r=e.attrFn||{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0,click:!0};e.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),"string"!=typeof this.originalTitle&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var t=this,n=t.options,o=n.title||"&#160;",r=e.ui.dialog.getTitleId(t.element),s=(t.uiDialog=e("<div></div>")).appendTo(document.body).hide().addClass(i+n.dialogClass).css({zIndex:n.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(i){n.closeOnEscape&&!i.isDefaultPrevented()&&i.keyCode&&i.keyCode===e.ui.keyCode.ESCAPE&&(t.close(i),i.preventDefault())}).attr({role:"dialog","aria-labelledby":r}).mousedown(function(e){t.moveToTop(!1,e)}),a=(t.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(s),(t.uiDialogTitlebar=e("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(s)),l=e('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){l.addClass("ui-state-hover")},function(){l.removeClass("ui-state-hover")}).focus(function(){l.addClass("ui-state-focus")}).blur(function(){l.removeClass("ui-state-focus")}).click(function(e){return t.close(e),!1}).appendTo(a);(t.uiDialogTitlebarCloseText=e("<span></span>")).addClass("ui-icon ui-icon-closethick").text(n.closeText).appendTo(l),e("<span></span>").addClass("ui-dialog-title").attr("id",r).html(o).prependTo(a),e.isFunction(n.beforeclose)&&!e.isFunction(n.beforeClose)&&(n.beforeClose=n.beforeclose),a.find("*").add(a).disableSelection(),n.draggable&&e.fn.draggable&&t._makeDraggable(),n.resizable&&e.fn.resizable&&t._makeResizable(),t._createButtons(n.buttons),t._isOpen=!1,e.fn.bgiframe&&s.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var e=this;return e.overlay&&e.overlay.destroy(),e.uiDialog.hide(),e.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),e.uiDialog.remove(),e.originalTitle&&e.element.attr("title",e.originalTitle),e},widget:function(){return this.uiDialog},close:function(t){var i,n,o=this;return!1!==o._trigger("beforeClose",t)?(o.overlay&&o.overlay.destroy(),o.uiDialog.unbind("keypress.ui-dialog"),o._isOpen=!1,o.options.hide?o.uiDialog.hide(o.options.hide,function(){o._trigger("close",t)}):(o.uiDialog.hide(),o._trigger("close",t)),e.ui.dialog.overlay.resize(),o.options.modal&&(i=0,e(".ui-dialog").each(function(){this!==o.uiDialog[0]&&(n=e(this).css("z-index"),isNaN(n)||(i=Math.max(i,n)))}),e.ui.dialog.maxZ=i),o):void 0},isOpen:function(){return this._isOpen},moveToTop:function(t,i){var n,o=this,r=o.options;return r.modal&&!t||!r.stack&&!r.modal?o._trigger("focus",i):(r.zIndex>e.ui.dialog.maxZ&&(e.ui.dialog.maxZ=r.zIndex),o.overlay&&(e.ui.dialog.maxZ+=1,o.overlay.$el.css("z-index",e.ui.dialog.overlay.maxZ=e.ui.dialog.maxZ)),n={scrollTop:o.element.scrollTop(),scrollLeft:o.element.scrollLeft()},e.ui.dialog.maxZ+=1,o.uiDialog.css("z-index",e.ui.dialog.maxZ),o.element.attr(n),o._trigger("focus",i),o)},open:function(){if(!this._isOpen){var t=this,i=t.options,n=t.uiDialog;return t.overlay=i.modal?new e.ui.dialog.overlay(t):null,t._size(),t._position(i.position),n.show(i.show),t.moveToTop(!0),i.modal&&n.bind("keydown.ui-dialog",function(t){if(t.keyCode===e.ui.keyCode.TAB){var i=e(":tabbable",this),n=i.filter(":first"),o=i.filter(":last");if(t.target===o[0]&&!t.shiftKey)return n.focus(1),!1;if(t.target===n[0]&&t.shiftKey)return o.focus(1),!1}}),e(t.element.find(":tabbable").get().concat(n.find(".ui-dialog-buttonpane :tabbable").get().concat(n.get()))).eq(0).focus(),t._isOpen=!0,t._trigger("open"),t}},_createButtons:function(t){var i=this,n=!1,o=e("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),s=e("<div></div>").addClass("ui-dialog-buttonset").appendTo(o);i.uiDialog.find(".ui-dialog-buttonpane").remove(),"object"==typeof t&&null!==t&&e.each(t,function(){return!(n=!0)}),n&&(e.each(t,function(t,n){n=e.isFunction(n)?{click:n,text:t}:n;var o=e('<button type="button"></button>').click(function(){n.click.apply(i.element[0],arguments)}).appendTo(s);e.each(n,function(e,t){"click"!==e&&(e in r?o[e](t):o.attr(e,t))}),e.fn.button&&o.button()}),o.appendTo(i.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i,n=this,o=n.options,r=e(document);n.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(r,s){i="auto"===o.height?"auto":e(this).height(),e(this).height(e(this).height()).addClass("ui-dialog-dragging"),n._trigger("dragStart",r,t(s))},drag:function(e,i){n._trigger("drag",e,t(i))},stop:function(s,a){o.position=[a.position.left-r.scrollLeft(),a.position.top-r.scrollTop()],e(this).removeClass("ui-dialog-dragging").height(i),n._trigger("dragStop",s,t(a)),e.ui.dialog.overlay.resize()}})},_makeResizable:function(i){function n(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}i=i===t?this.options.resizable:i;var o=this,r=o.options,s=o.uiDialog.css("position"),a="string"==typeof i?i:"n,e,s,w,se,sw,ne,nw";o.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:o.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:o._minHeight(),handles:a,start:function(t,i){e(this).addClass("ui-dialog-resizing"),o._trigger("resizeStart",t,n(i))},resize:function(e,t){o._trigger("resize",e,n(t))},stop:function(t,i){e(this).removeClass("ui-dialog-resizing"),r.height=e(this).height(),r.width=e(this).width(),o._trigger("resizeStop",t,n(i)),e.ui.dialog.overlay.resize()}}).css("position",s).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(t){var i,n=[],o=[0,0];t?(("string"==typeof t||"object"==typeof t&&"0"in t)&&(n=t.split?t.split(" "):[t[0],t[1]],1===n.length&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(o[e]=n[e],n[e]=t)}),t={my:n.join(" "),at:n.join(" "),offset:o.join(" ")}),t=e.extend({},e.ui.dialog.prototype.options.position,t)):t=e.ui.dialog.prototype.options.position,i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(e.extend({of:window},t)),i||this.uiDialog.hide()},_setOptions:function(t){var i=this,r={},s=!1;e.each(t,function(e,t){i._setOption(e,t),e in n&&(s=!0),e in o&&(r[e]=t)}),s&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",r)},_setOption:function(t,n){var o=this,r=o.uiDialog;switch(t){case"beforeclose":t="beforeClose";break;case"buttons":o._createButtons(n);break;case"closeText":o.uiDialogTitlebarCloseText.text(""+n);break;case"dialogClass":r.removeClass(o.options.dialogClass).addClass(i+n);break;case"disabled":n?r.addClass("ui-dialog-disabled"):r.removeClass("ui-dialog-disabled");break;case"draggable":var s=r.is(":data(draggable)");s&&!n&&r.draggable("destroy"),!s&&n&&o._makeDraggable();break;case"position":o._position(n);break;case"resizable":var a=r.is(":data(resizable)");a&&!n&&r.resizable("destroy"),a&&"string"==typeof n&&r.resizable("option","handles",n),!a&&n!==!1&&o._makeResizable(n);break;case"title":e(".ui-dialog-title",o.uiDialogTitlebar).html(""+(n||"&#160;"))}e.Widget.prototype._setOption.apply(o,arguments)},_size:function(){var t,i,n=this.options,o=this.uiDialog.is(":visible");if(this.element.show().css({width:"auto",minHeight:0,height:0}),n.minWidth>n.width&&(n.width=n.minWidth),t=this.uiDialog.css({height:"auto",width:n.width}).height(),i=Math.max(0,n.minHeight-t),"auto"===n.height)if(e.support.minHeight)this.element.css({minHeight:i,height:"auto"});else{this.uiDialog.show();var r=this.element.css("height","auto").height();o||this.uiDialog.hide(),this.element.height(Math.max(r,i))}else this.element.height(Math.max(n.height-t,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),e.extend(e.ui.dialog,{version:"1.8.17",uuid:0,maxZ:0,getTitleId:function(e){var t=e.attr("id");return t||(this.uuid+=1,t=this.uuid),"ui-dialog-title-"+t},overlay:function(t){this.$el=e.ui.dialog.overlay.create(t)}}),e.extend(e.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:e.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(e){return e+".dialog-overlay"}).join(" "),create:function(t){0===this.instances.length&&(setTimeout(function(){e.ui.dialog.overlay.instances.length&&e(document).bind(e.ui.dialog.overlay.events,function(t){return e(t.target).zIndex()<e.ui.dialog.overlay.maxZ?!1:void 0})},1),e(document).bind("keydown.dialog-overlay",function(i){t.options.closeOnEscape&&!i.isDefaultPrevented()&&i.keyCode&&i.keyCode===e.ui.keyCode.ESCAPE&&(t.close(i),i.preventDefault())}),e(window).bind("resize.dialog-overlay",e.ui.dialog.overlay.resize));var i=(this.oldInstances.pop()||e("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});return e.fn.bgiframe&&i.bgiframe(),this.instances.push(i),i},destroy:function(t){var i=e.inArray(t,this.instances);-1!=i&&this.oldInstances.push(this.instances.splice(i,1)[0]),0===this.instances.length&&e([document,window]).unbind(".dialog-overlay"),t.remove();var n=0;e.each(this.instances,function(){n=Math.max(n,this.css("z-index"))}),this.maxZ=n},height:function(){var t,i;return e.browser.msie&&7>e.browser.version?(t=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),i=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),i>t?e(window).height()+"px":t+"px"):e(document).height()+"px"},width:function(){var t,i;return e.browser.msie?(t=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),i=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),i>t?e(window).width()+"px":t+"px"):e(document).width()+"px"},resize:function(){var t=e([]);e.each(e.ui.dialog.overlay.instances,function(){t=t.add(this)}),t.css({width:0,height:0}).css({width:e.ui.dialog.overlay.width(),height:e.ui.dialog.overlay.height()})}}),e.extend(e.ui.dialog.overlay.prototype,{destroy:function(){e.ui.dialog.overlay.destroy(this.$el)}})}(jQuery),/*
 * jQuery UI Datepicker 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Datepicker
 *
 * Depends:
 *	jquery.ui.core.js
 */
function($,undefined){function isArray(e){return e&&($.browser.safari&&"object"==typeof e&&e.length||e.constructor&&e.constructor.toString().match(/\Array\(\)/))}function extendRemove(e,t){$.extend(e,t);for(var i in t)(null==t[i]||t[i]==undefined)&&(e[i]=t[i]);return e}function bindHover(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.bind("mouseout",function(e){var i=$(e.target).closest(t);!i.length||i.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(i){var n=$(i.target).closest(t);!$.datepicker._isDisabledDatepicker(instActive.inline?e.parent()[0]:instActive.input[0])&&!!n.length&&(n.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),n.addClass("ui-state-hover"),n.hasClass("ui-datepicker-prev")&&n.addClass("ui-datepicker-prev-hover"),n.hasClass("ui-datepicker-next")&&n.addClass("ui-datepicker-next-hover"))})}function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}$.extend($.ui,{datepicker:{version:"1.8.17"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline="div"==nodeName||"span"==nodeName;target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),"input"==nodeName?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(e,t){var i=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:i,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(e,t){var i=$(e);t.append=$([]),t.trigger=$([]),i.hasClass(this.markerClassName)||(this._attachments(i,t),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,i,n){t.settings[i]=n}).bind("getData.datepicker",function(e,i){return this._get(t,i)}),this._autoSize(t),$.data(e,PROP_NAME,t),t.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,t){var i=this._get(t,"appendText"),n=this._get(t,"isRTL");t.append&&t.append.remove(),i&&(t.append=$('<span class="'+this._appendClass+'">'+i+"</span>"),e[n?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove();var o=this._get(t,"showOn");if(("focus"==o||"both"==o)&&e.focus(this._showDatepicker),"button"==o||"both"==o){var r=this._get(t,"buttonText"),s=this._get(t,"buttonImage");t.trigger=$(this._get(t,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:s,alt:r,title:r}):$('<button type="button"></button>').addClass(this._triggerClass).html(""==s?r:$("<img/>").attr({src:s,alt:r,title:r}))),e[n?"before":"after"](t.trigger),t.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==e[0]?$.datepicker._hideDatepicker():$.datepicker._showDatepicker(e[0]),!1})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),i=this._get(e,"dateFormat");if(i.match(/[DM]/)){var n=function(e){for(var t=0,i=0,n=0;e.length>n;n++)e[n].length>t&&(t=e[n].length,i=n);return i};t.setMonth(n(this._get(e,i.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(n(this._get(e,i.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,t){var i=$(e);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,i,n){t.settings[i]=n}).bind("getData.datepicker",function(e,i){return this._get(t,i)}),$.data(e,PROP_NAME,t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block"))},_dialogDatepicker:function(e,t,i,n,o){var r=this._dialogInst;if(!r){this.uuid+=1;var s="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+s+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),r=this._dialogInst=this._newInst(this._dialogInput,!1),r.settings={},$.data(this._dialogInput[0],PROP_NAME,r)}if(extendRemove(r.settings,n||{}),t=t&&t.constructor==Date?this._formatDate(r,t):t,this._dialogInput.val(t),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,!this._pos){var a=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[a/2-100+c,l/2-150+d]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),r.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,r),this},_destroyDatepicker:function(e){var t=$(e),i=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var n=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME),"input"==n?(i.append.remove(),i.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==n||"span"==n)&&t.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(e){var t=$(e),i=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var n=e.nodeName.toLowerCase();if("input"==n)e.disabled=!1,i.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if("div"==n||"span"==n){var o=t.children("."+this._inlineClass);o.children().removeClass("ui-state-disabled"),o.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t})}},_disableDatepicker:function(e){var t=$(e),i=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var n=e.nodeName.toLowerCase();if("input"==n)e.disabled=!0,i.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if("div"==n||"span"==n){var o=t.children("."+this._inlineClass);o.children().addClass("ui-state-disabled"),o.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t}),this._disabledInputs[this._disabledInputs.length]=e}},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]==e)return!0;return!1},_getInst:function(e){try{return $.data(e,PROP_NAME)}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,i){var n=this._getInst(e);if(2==arguments.length&&"string"==typeof t)return"defaults"==t?$.extend({},$.datepicker._defaults):n?"all"==t?$.extend({},n.settings):this._get(n,t):null;var o=t||{};if("string"==typeof t&&(o={},o[t]=i),n){this._curInst==n&&this._hideDatepicker();var r=this._getDateDatepicker(e,!0),s=this._getMinMaxDate(n,"min"),a=this._getMinMaxDate(n,"max");extendRemove(n.settings,o),null!==s&&o.dateFormat!==undefined&&o.minDate===undefined&&(n.settings.minDate=this._formatDate(n,s)),null!==a&&o.dateFormat!==undefined&&o.maxDate===undefined&&(n.settings.maxDate=this._formatDate(n,a)),this._attachments($(e),n),this._autoSize(n),this._setDate(n,r),this._updateAlternate(n),this._updateDatepicker(n)}},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(e){var t=$.datepicker._getInst(e.target),i=!0,n=t.dpDiv.is(".ui-datepicker-rtl");if(t._keyEvent=!0,$.datepicker._datepickerShowing)switch(e.keyCode){case 9:$.datepicker._hideDatepicker(),i=!1;break;case 13:var o=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",t.dpDiv);o[0]&&$.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,o[0]);var r=$.datepicker._get(t,"onSelect");if(r){var s=$.datepicker._formatDate(t);r.apply(t.input?t.input[0]:null,[s,t])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&$.datepicker._clearDate(e.target),i=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&$.datepicker._gotoToday(e.target),i=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,n?1:-1,"D"),i=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,-7,"D"),i=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,n?-1:1,"D"),i=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,7,"D"),i=e.ctrlKey||e.metaKey;break;default:i=!1}else 36==e.keyCode&&e.ctrlKey?$.datepicker._showDatepicker(this):i=!1;i&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t=$.datepicker._getInst(e.target);if($.datepicker._get(t,"constrainInput")){var i=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),n=String.fromCharCode(e.charCode==undefined?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||" ">n||!i||i.indexOf(n)>-1}},_doKeyUp:function(e){var t=$.datepicker._getInst(e.target);if(t.input.val()!=t.lastVal)try{var i=$.datepicker.parseDate($.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,$.datepicker._getFormatConfig(t));i&&($.datepicker._setDateFromField(t),$.datepicker._updateAlternate(t),$.datepicker._updateDatepicker(t))}catch(e){$.datepicker.log(e)}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!=e.nodeName.toLowerCase()&&(e=$("input",e.parentNode)[0]),!$.datepicker._isDisabledDatepicker(e)&&$.datepicker._lastInput!=e){var t=$.datepicker._getInst(e);$.datepicker._curInst&&$.datepicker._curInst!=t&&($.datepicker._curInst.dpDiv.stop(!0,!0),t&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var i=$.datepicker._get(t,"beforeShow"),n=i?i.apply(e,[e,t]):{};if(n===!1)return;extendRemove(t.settings,n),t.lastVal=null,$.datepicker._lastInput=e,$.datepicker._setDateFromField(t),$.datepicker._inDialog&&(e.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(e),$.datepicker._pos[1]+=e.offsetHeight);var o=!1;$(e).parents().each(function(){return o|="fixed"==$(this).css("position"),!o}),o&&$.browser.opera&&($.datepicker._pos[0]-=document.documentElement.scrollLeft,$.datepicker._pos[1]-=document.documentElement.scrollTop);var r={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};if($.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(t),r=$.datepicker._checkOffset(t,r,o),t.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":o?"fixed":"absolute",display:"none",left:r.left+"px",top:r.top+"px"}),!t.inline){var s=$.datepicker._get(t,"showAnim"),a=$.datepicker._get(t,"duration"),l=function(){var e=t.dpDiv.find("iframe.ui-datepicker-cover");if(e.length){var i=$.datepicker._getBorders(t.dpDiv);e.css({left:-i[0],top:-i[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()})}};t.dpDiv.zIndex($(e).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&$.effects[s]?t.dpDiv.show(s,$.datepicker._get(t,"showOptions"),a,l):t.dpDiv[s||"show"](s?a:null,l),(!s||!a)&&l(),t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus(),$.datepicker._curInst=t}}},_updateDatepicker:function(e){var t=this;t.maxRows=4;var i=$.datepicker._getBorders(e.dpDiv);instActive=e,e.dpDiv.empty().append(this._generateHTML(e));var n=e.dpDiv.find("iframe.ui-datepicker-cover");!n.length||n.css({left:-i[0],top:-i[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()}),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var o=this._getNumberOfMonths(e),r=o[1],s=17;if(e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),r>1&&e.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",s*r+"em"),e.dpDiv[(1!=o[0]||1!=o[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e==$.datepicker._curInst&&$.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement&&e.input.focus(),e.yearshtml){var a=e.yearshtml;setTimeout(function(){a===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),a=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,i){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),r=e.input?e.input.outerWidth():0,s=e.input?e.input.outerHeight():0,a=document.documentElement.clientWidth+$(document).scrollLeft(),l=document.documentElement.clientHeight+$(document).scrollTop();return t.left-=this._get(e,"isRTL")?n-r:0,t.left-=i&&t.left==e.input.offset().left?$(document).scrollLeft():0,t.top-=i&&t.top==e.input.offset().top+s?$(document).scrollTop():0,t.left-=Math.min(t.left,t.left+n>a&&a>n?Math.abs(t.left+n-a):0),t.top-=Math.min(t.top,t.top+o>l&&l>o?Math.abs(o+s):0),t},_findPos:function(e){for(var t=this._getInst(e),i=this._get(t,"isRTL");e&&("hidden"==e.type||1!=e.nodeType||$.expr.filters.hidden(e));)e=e[i?"previousSibling":"nextSibling"];var n=$(e).offset();return[n.left,n.top]},_hideDatepicker:function(e){var t=this._curInst;if(t&&(!e||t==$.data(e,PROP_NAME))&&this._datepickerShowing){var i=this._get(t,"showAnim"),n=this._get(t,"duration"),o=this,r=function(){$.datepicker._tidyDialog(t),o._curInst=null};$.effects&&$.effects[i]?t.dpDiv.hide(i,$.datepicker._get(t,"showOptions"),n,r):t.dpDiv["slideDown"==i?"slideUp":"fadeIn"==i?"fadeOut":"hide"](i?n:null,r),i||r(),this._datepickerShowing=!1;var s=this._get(t,"onClose");s&&s.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if($.datepicker._curInst){var t=$(e.target),i=$.datepicker._getInst(t[0]);(t[0].id!=$.datepicker._mainDivId&&0==t.parents("#"+$.datepicker._mainDivId).length&&!t.hasClass($.datepicker.markerClassName)&&!t.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||t.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=i)&&$.datepicker._hideDatepicker()}},_adjustDate:function(e,t,i){var n=$(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,t+("M"==i?this._get(o,"showCurrentAtPos"):0),i),this._updateDatepicker(o))},_gotoToday:function(e){var t=$(e),i=this._getInst(t[0]);if(this._get(i,"gotoCurrent")&&i.currentDay)i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear;else{var n=new Date;i.selectedDay=n.getDate(),i.drawMonth=i.selectedMonth=n.getMonth(),i.drawYear=i.selectedYear=n.getFullYear()}this._notifyChange(i),this._adjustDate(t)},_selectMonthYear:function(e,t,i){var n=$(e),o=this._getInst(n[0]);o["selected"+("M"==i?"Month":"Year")]=o["draw"+("M"==i?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,t,i,n){var o=$(e);if(!$(n).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(o[0])){var r=this._getInst(o[0]);r.selectedDay=r.currentDay=$("a",n).html(),r.selectedMonth=r.currentMonth=t,r.selectedYear=r.currentYear=i,this._selectDate(e,this._formatDate(r,r.currentDay,r.currentMonth,r.currentYear))}},_clearDate:function(e){var t=$(e);this._getInst(t[0]),this._selectDate(t,"")},_selectDate:function(e,t){var i=$(e),n=this._getInst(i[0]);t=null!=t?t:this._formatDate(n),n.input&&n.input.val(t),this._updateAlternate(n);var o=this._get(n,"onSelect");o?o.apply(n.input?n.input[0]:null,[t,n]):n.input&&n.input.trigger("change"),n.inline?this._updateDatepicker(n):(this._hideDatepicker(),this._lastInput=n.input[0],"object"!=typeof n.input[0]&&n.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var i=this._get(e,"altFormat")||this._get(e,"dateFormat"),n=this._getDate(e),o=this.formatDate(i,n,this._getFormatConfig(e));$(t).each(function(){$(this).val(o)})}},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t=new Date(e.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));var i=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((i-t)/864e5)/7)+1},parseDate:function(e,t,i){if(null==e||null==t)throw"Invalid arguments";if(t="object"==typeof t?t.toString():t+"",""==t)return null;var n=(i?i.shortYearCutoff:null)||this._defaults.shortYearCutoff;n="string"!=typeof n?n:(new Date).getFullYear()%100+parseInt(n,10);for(var o=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,r=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=-1,c=-1,d=-1,u=-1,h=!1,p=function(t){var i=e.length>y+1&&e.charAt(y+1)==t;return i&&y++,i},f=function(e){var i=p(e),n="@"==e?14:"!"==e?20:"y"==e&&i?4:"o"==e?3:2,o=new RegExp("^\\d{1,"+n+"}"),r=t.substring(v).match(o);if(!r)throw"Missing number at position "+v;return v+=r[0].length,parseInt(r[0],10)},m=function(e,i,n){var o=$.map(p(e)?n:i,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)}),r=-1;if($.each(o,function(e,i){var n=i[1];return t.substr(v,n.length).toLowerCase()==n.toLowerCase()?(r=i[0],v+=n.length,!1):void 0}),-1!=r)return r+1;throw"Unknown name at position "+v},g=function(){if(t.charAt(v)!=e.charAt(y))throw"Unexpected literal at position "+v;v++},v=0,y=0;e.length>y;y++)if(h)"'"!=e.charAt(y)||p("'")?g():h=!1;else switch(e.charAt(y)){case"d":d=f("d");break;case"D":m("D",o,r);break;case"o":u=f("o");break;case"m":c=f("m");break;case"M":c=m("M",s,a);break;case"y":l=f("y");break;case"@":var b=new Date(f("@"));l=b.getFullYear(),c=b.getMonth()+1,d=b.getDate();break;case"!":var b=new Date((f("!")-this._ticksTo1970)/1e4);l=b.getFullYear(),c=b.getMonth()+1,d=b.getDate();break;case"'":p("'")?g():h=!0;break;default:g()}if(t.length>v)throw"Extra/unparsed characters found in date: "+t.substring(v);if(-1==l?l=(new Date).getFullYear():100>l&&(l+=(new Date).getFullYear()-(new Date).getFullYear()%100+(n>=l?0:-100)),u>-1)for(c=1,d=u;;){var _=this._getDaysInMonth(l,c-1);if(_>=d)break;c++,d-=_}var b=this._daylightSavingAdjust(new Date(l,c-1,d));if(b.getFullYear()!=l||b.getMonth()+1!=c||b.getDate()!=d)throw"Invalid date";return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,r=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,s=(i?i.monthNames:null)||this._defaults.monthNames,a=function(t){var i=e.length>h+1&&e.charAt(h+1)==t;return i&&h++,i},l=function(e,t,i){var n=""+t;if(a(e))for(;i>n.length;)n="0"+n;return n},c=function(e,t,i,n){return a(e)?n[t]:i[t]},d="",u=!1;if(t)for(var h=0;e.length>h;h++)if(u)"'"!=e.charAt(h)||a("'")?d+=e.charAt(h):u=!1;else switch(e.charAt(h)){case"d":d+=l("d",t.getDate(),2);break;case"D":d+=c("D",t.getDay(),n,o);break;case"o":d+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=l("m",t.getMonth()+1,2);break;case"M":d+=c("M",t.getMonth(),r,s);break;case"y":d+=a("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":a("'")?d+="'":u=!0;break;default:d+=e.charAt(h)}return d},_possibleChars:function(e){for(var t="",i=!1,n=function(t){var i=e.length>o+1&&e.charAt(o+1)==t;return i&&o++,i},o=0;e.length>o;o++)if(i)"'"!=e.charAt(o)||n("'")?t+=e.charAt(o):i=!1;else switch(e.charAt(o)){case"d":case"m":case"y":case"@":t+="0123456789";break;case"D":case"M":return null;case"'":n("'")?t+="'":i=!0;break;default:t+=e.charAt(o)}return t},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!=e.lastVal){var i,n,o=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null;i=n=this._getDefaultDate(e);var s=this._getFormatConfig(e);try{i=this.parseDate(o,r,s)||n}catch(a){this.log(a),r=t?"":r}e.selectedDay=i.getDate(),e.drawMonth=e.selectedMonth=i.getMonth(),e.drawYear=e.selectedYear=i.getFullYear(),e.currentDay=r?i.getDate():0,e.currentMonth=r?i.getMonth():0,e.currentYear=r?i.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(e,t,i){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},o=function(t){try{return $.datepicker.parseDate($.datepicker._get(e,"dateFormat"),t,$.datepicker._getFormatConfig(e))}catch(i){}for(var n=(t.toLowerCase().match(/^c/)?$.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),r=n.getMonth(),s=n.getDate(),a=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=a.exec(t);l;){switch(l[2]||"d"){case"d":case"D":s+=parseInt(l[1],10);break;case"w":case"W":s+=7*parseInt(l[1],10);break;case"m":case"M":r+=parseInt(l[1],10),s=Math.min(s,$.datepicker._getDaysInMonth(o,r));break;case"y":case"Y":o+=parseInt(l[1],10),s=Math.min(s,$.datepicker._getDaysInMonth(o,r))}l=a.exec(t)}return new Date(o,r,s)},r=null==t||""===t?i:"string"==typeof t?o(t):"number"==typeof t?isNaN(t)?i:n(t):new Date(t.getTime());return r=r&&"Invalid Date"==r.toString()?i:r,r&&(r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0)),this._daylightSavingAdjust(r)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var n=!t,o=e.selectedMonth,r=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),(o!=e.selectedMonth||r!=e.selectedYear)&&!i&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(n?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""==e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_generateHTML:function(e){var t=new Date;t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var i=this._get(e,"isRTL"),n=this._get(e,"showButtonPanel"),o=this._get(e,"hideIfNoPrevNext"),r=this._get(e,"navigationAsDateFormat"),s=this._getNumberOfMonths(e),a=this._get(e,"showCurrentAtPos"),l=this._get(e,"stepMonths"),c=1!=s[0]||1!=s[1],d=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),u=this._getMinMaxDate(e,"min"),h=this._getMinMaxDate(e,"max"),p=e.drawMonth-a,f=e.drawYear;if(0>p&&(p+=12,f--),h){var m=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-s[0]*s[1]+1,h.getDate()));for(m=u&&u>m?u:m;this._daylightSavingAdjust(new Date(f,p,1))>m;)p--,0>p&&(p=11,f--)}e.drawMonth=p,e.drawYear=f;var g=this._get(e,"prevText");g=r?this.formatDate(g,this._daylightSavingAdjust(new Date(f,p-l,1)),this._getFormatConfig(e)):g;var v=this._canAdjustMonth(e,-1,f,p)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+e.id+"', -"+l+", 'M');\""+' title="'+g+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+g+"</span></a>":o?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+g+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+g+"</span></a>",y=this._get(e,"nextText");y=r?this.formatDate(y,this._daylightSavingAdjust(new Date(f,p+l,1)),this._getFormatConfig(e)):y;var b=this._canAdjustMonth(e,1,f,p)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+e.id+"', +"+l+", 'M');\""+' title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+y+"</span></a>":o?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+y+"</span></a>",_=this._get(e,"currentText"),w=this._get(e,"gotoCurrent")&&e.currentDay?d:t;_=r?this.formatDate(_,w,this._getFormatConfig(e)):_;var x=e.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(e,"closeText")+"</button>",C=n?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(i?x:"")+(this._isInRange(e,w)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._gotoToday('#"+e.id+"');\""+">"+_+"</button>":"")+(i?"":x)+"</div>":"",T=parseInt(this._get(e,"firstDay"),10);T=isNaN(T)?0:T;for(var k=this._get(e,"showWeek"),S=this._get(e,"dayNames"),E=(this._get(e,"dayNamesShort"),this._get(e,"dayNamesMin")),N=this._get(e,"monthNames"),D=this._get(e,"monthNamesShort"),M=this._get(e,"beforeShowDay"),A=this._get(e,"showOtherMonths"),I=this._get(e,"selectOtherMonths"),L=(this._get(e,"calculateWeek")||this.iso8601Week,this._getDefaultDate(e)),P="",R=0;s[0]>R;R++){var W="";this.maxRows=4;for(var O=0;s[1]>O;O++){var H=this._daylightSavingAdjust(new Date(f,p,e.selectedDay)),j=" ui-corner-all",F="";if(c){if(F+='<div class="ui-datepicker-group',s[1]>1)switch(O){case 0:F+=" ui-datepicker-group-first",j=" ui-corner-"+(i?"right":"left");break;case s[1]-1:F+=" ui-datepicker-group-last",j=" ui-corner-"+(i?"left":"right");break;default:F+=" ui-datepicker-group-middle",j=""}F+='">'}F+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+j+'">'+(/all|left/.test(j)&&0==R?i?b:v:"")+(/all|right/.test(j)&&0==R?i?v:b:"")+this._generateMonthYearHeader(e,p,f,u,h,R>0||O>0,N,D)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";for(var z=k?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"",Y=0;7>Y;Y++){var B=(Y+T)%7;z+="<th"+((Y+T+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+S[B]+'">'+E[B]+"</span></th>"}F+=z+"</tr></thead><tbody>";var U=this._getDaysInMonth(f,p);f==e.selectedYear&&p==e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,U));var q=(this._getFirstDayOfMonth(f,p)-T+7)%7,G=Math.ceil((q+U)/7),X=c?this.maxRows>G?this.maxRows:G:G;this.maxRows=X;for(var K=this._daylightSavingAdjust(new Date(f,p,1-q)),V=0;X>V;V++){F+="<tr>";for(var Q=k?'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(K)+"</td>":"",Y=0;7>Y;Y++){var Z=M?M.apply(e.input?e.input[0]:null,[K]):[!0,""],J=K.getMonth()!=p,et=J&&!I||!Z[0]||u&&u>K||h&&K>h;Q+='<td class="'+((Y+T+6)%7>=5?" ui-datepicker-week-end":"")+(J?" ui-datepicker-other-month":"")+(K.getTime()==H.getTime()&&p==e.selectedMonth&&e._keyEvent||L.getTime()==K.getTime()&&L.getTime()==H.getTime()?" "+this._dayOverClass:"")+(et?" "+this._unselectableClass+" ui-state-disabled":"")+(J&&!A?"":" "+Z[1]+(K.getTime()==d.getTime()?" "+this._currentClass:"")+(K.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+(J&&!A||!Z[2]?"":' title="'+Z[2]+'"')+(et?"":' onclick="DP_jQuery_'+dpuuid+".datepicker._selectDay('#"+e.id+"',"+K.getMonth()+","+K.getFullYear()+', this);return false;"')+">"+(J&&!A?"&#xa0;":et?'<span class="ui-state-default">'+K.getDate()+"</span>":'<a class="ui-state-default'+(K.getTime()==t.getTime()?" ui-state-highlight":"")+(K.getTime()==d.getTime()?" ui-state-active":"")+(J?" ui-priority-secondary":"")+'" href="#">'+K.getDate()+"</a>")+"</td>",K.setDate(K.getDate()+1),K=this._daylightSavingAdjust(K)}F+=Q+"</tr>"}p++,p>11&&(p=0,f++),F+="</tbody></table>"+(c?"</div>"+(s[0]>0&&O==s[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),W+=F}P+=W}return P+=C+($.browser.msie&&7>parseInt($.browser.version,10)&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),e._keyEvent=!1,P},_generateMonthYearHeader:function(e,t,i,n,o,r,s,a){var l=this._get(e,"changeMonth"),c=this._get(e,"changeYear"),d=this._get(e,"showMonthAfterYear"),u='<div class="ui-datepicker-title">',h="";if(r||!l)h+='<span class="ui-datepicker-month">'+s[t]+"</span>";else{var p=n&&n.getFullYear()==i,f=o&&o.getFullYear()==i;h+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+e.id+"', this, 'M');\" "+">";for(var m=0;12>m;m++)(!p||m>=n.getMonth())&&(!f||o.getMonth()>=m)&&(h+='<option value="'+m+'"'+(m==t?' selected="selected"':"")+">"+a[m]+"</option>");
h+="</select>"}if(d||(u+=h+(!r&&l&&c?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",r||!c)u+='<span class="ui-datepicker-year">'+i+"</span>";else{var g=this._get(e,"yearRange").split(":"),v=(new Date).getFullYear(),y=function(e){var t=e.match(/c[+-].*/)?i+parseInt(e.substring(1),10):e.match(/[+-].*/)?v+parseInt(e,10):parseInt(e,10);return isNaN(t)?v:t},b=y(g[0]),_=Math.max(b,y(g[1]||""));for(b=n?Math.max(b,n.getFullYear()):b,_=o?Math.min(_,o.getFullYear()):_,e.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+e.id+"', this, 'Y');\" "+">";_>=b;b++)e.yearshtml+='<option value="'+b+'"'+(b==i?' selected="selected"':"")+">"+b+"</option>";e.yearshtml+="</select>",u+=e.yearshtml,e.yearshtml=null}return u+=this._get(e,"yearSuffix"),d&&(u+=(!r&&l&&c?"":"&#xa0;")+h),u+="</div>",u},_adjustInstDate:function(e,t,i){var n=e.drawYear+("Y"==i?t:0),o=e.drawMonth+("M"==i?t:0),r=Math.min(e.selectedDay,this._getDaysInMonth(n,o))+("D"==i?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(n,o,r)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),("M"==i||"Y"==i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),o=i&&i>t?i:t;return o=n&&o>n?n:o},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,n){var o=this._getNumberOfMonths(e),r=this._daylightSavingAdjust(new Date(i,n+(0>t?t:o[0]*o[1]),1));return 0>t&&r.setDate(this._getDaysInMonth(r.getFullYear(),r.getMonth())),this._isInRange(e,r)},_isInRange:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max");return(!i||t.getTime()>=i.getTime())&&(!n||t.getTime()<=n.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,n){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var o=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(n,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),o,this._getFormatConfig(e))}}),$.fn.datepicker=function(e){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv),$.datepicker.initialized=!0);var t=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!=e&&"getDate"!=e&&"widget"!=e?"option"==e&&2==arguments.length&&"string"==typeof arguments[1]?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t)):this.each(function(){"string"==typeof e?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this].concat(t)):$.datepicker._attachDatepicker(this,e)}):$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.8.17",window["DP_jQuery_"+dpuuid]=$}(jQuery);var I18n=I18n||{};I18n.defaultLocale="en",I18n.locale=I18n.locale||null,I18n.lookup=function(e,t){var i=this.prepareOptions(I18n.translations),n=i[I18n.currentLocale()];if(t=this.prepareOptions(t),n){for("object"==typeof e&&(e=e.join(".")),t.scope&&(e=t.scope.toString()+"."+e),e=e.split(".");e.length>0;){var o=e.shift();if(n=n[o],!n)break}return n||null==t.defaultValue||void 0==t.defaultValue||(n=t.defaultValue),n}},I18n.prepareOptions=function(){for(var e,t={},i=arguments.length,n=0;i>n;n++)if(e=arguments[n])for(var o in e)(void 0==t[o]||null==t[o])&&(t[o]=e[o]);return t},I18n.interpolate=function(e,t){t=t||{};var i=/\{\{(.*?)\}\}/gm,n=e.match(i);if(!n)return e;for(var o,r,s,a=0;o=n[a];a++)s=o.replace(/\{\{(.*?)\}\}/gm,"$1"),r=t[s],(null==t[s]||void 0==t[s])&&(r="[missing "+o+" value]"),i=new RegExp(o.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),e=e.replace(i,r);return e},I18n.translate=function(e,t){t=this.prepareOptions(t);var i=this.lookup(e,t);try{return"object"==typeof i?"number"==typeof t.count?this.pluralize(t.count,e,t):i:this.interpolate(i,t)}catch(n){return this.missingTranslation(e)}},I18n.localize=function(e,t){switch(e){case"currency":return this.toCurrency(t);case"number":return e=this.lookup("number.format"),this.toNumber(t,e);default:return e.match(/^(date|time)/)?this.toTime(e,t):t.toString()}},I18n.parseDate=function(e){var t,i;if(t=e.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ |T](\d{2}):(\d{2}):(\d{2}))?(Z)?/)){for(var n=1;6>=n;n++)t[n]=void 0==t[n]?0:parseInt(t[n],10);t[2]=t[2]-1,i=t[7]?new Date(Date.UTC(t[1],t[2],t[3],t[4],t[5],t[6])):isNaN(t[4])?new Date(t[1],t[2],t[3]):new Date(t[1],t[2],t[3],t[4],t[5],t[6])}else"number"==typeof e?(i=new Date,i.setTime(e)):(i=new Date,i.setTime(Date.parse(e)));return i},I18n.toTime=function(e,t){var i=this.parseDate(t),n=this.lookup(e);return i.toString().match(/invalid/i)?i.toString():n?this.strftime(i,n):i.toString()},I18n.strftime=function(e,t){var i=this.lookup("date");if(!i)return e.toString();var n=e.getDay(),o=e.getDate(),r=e.getFullYear(),s=e.getMonth()+1,a=e.getHours(),l=a,c=a>12?"PM":"AM",d=e.getSeconds(),u=e.getMinutes(),h=e.getTimezoneOffset(),p=Math.floor(Math.abs(h/60)),f=Math.abs(h)-60*p,m=(h>0?"-":"+")+(2>p.toString().length?"0"+p:p)+(2>f.toString().length?"0"+f:f);l>12&&(l-=12);var g=function(e){var t="0"+e.toString();return t.substr(t.length-2)},v=t;return v=v.replace("%a",i.abbr_day_names[n]),v=v.replace("%A",i.day_names[n]),v=v.replace("%b",i.abbr_month_names[s]),v=v.replace("%B",i.month_names[s]),v=v.replace("%d",g(o)),v=v.replace("%-d",o),v=v.replace("%H",g(a)),v=v.replace("%-H",a),v=v.replace("%I",g(l)),v=v.replace("%-I",l),v=v.replace("%m",g(s)),v=v.replace("%-m",s),v=v.replace("%M",g(u)),v=v.replace("%-M",u),v=v.replace("%p",c),v=v.replace("%S",g(d)),v=v.replace("%-S",d),v=v.replace("%w",n),v=v.replace("%y",g(r)),v=v.replace("%-y",g(r).replace(/^0+/,"")),v=v.replace("%Y",r),v=v.replace("%z",m)},I18n.toNumber=function(e,t){t=this.prepareOptions(t,this.lookup("number.format"),{precision:3,separator:".",delimiter:","});var i=e.toFixed(t.precision).toString(),n=i.split(".");e=n[0],n[1];for(var o=[];e.length>0;)o.unshift(e.substr(Math.max(0,e.length-3),3)),e=e.substr(0,e.length-3);var r=o.join(t.delimiter);return t.precision>0&&(r+=t.separator+n[1]),r},I18n.toCurrency=function(e,t){return t=this.prepareOptions(t,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),e=this.toNumber(e,t),e=t.format.replace("%u",t.unit).replace("%n",e)},I18n.toPercentage=function(e,t){return t=this.prepareOptions(t,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),e=this.toNumber(e,t),e+"%"},I18n.pluralize=function(e,t,i){var n,o=this.lookup(t,i);switch(i=i||{},i.count=e.toString(),Math.abs(e)){case 0:n=o.zero||o.none||o.other||this.missingTranslation(t,"zero");break;case 1:n=o.one||this.missingTranslation(t,"one");break;default:n=o.other||this.missingTranslation(t,"other")}return this.interpolate(n,i)},I18n.missingTranslation=function(){for(var e='[missing "'+this.currentLocale(),t=arguments.length,i=0;t>i;i++)e+="."+arguments[i];return e+='" translation]'},I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale},I18n.t=I18n.translate,I18n.l=I18n.localize,I18n.p=I18n.pluralize,I18n.locale="en";var I18n=I18n||{};I18n.translations={},/* ===================================================
 * bootstrap-transition.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#transitions
 * ===================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(e){"use strict";e(function(){e.support.transition=function(){var e=function(){var e,t=document.createElement("bootstrap"),i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(e in i)if(void 0!==t.style[e])return i[e]}();return e&&{end:e}}()})}(window.jQuery),/* ==========================================================
 * bootstrap-affix.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#affix
 * ==========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(e){"use strict";var t=function(t,i){this.options=e.extend({},e.fn.affix.defaults,i),this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this)).on("click.affix.data-api",e.proxy(function(){setTimeout(e.proxy(this.checkPosition,this),1)},this)),this.$element=e(t),this.checkPosition()};t.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t,i=e(document).height(),n=this.$window.scrollTop(),o=this.$element.offset(),r=this.options.offset,s=r.bottom,a=r.top,l="affix affix-top affix-bottom";"object"!=typeof r&&(s=a=r),"function"==typeof a&&(a=r.top()),"function"==typeof s&&(s=r.bottom()),t=null!=this.unpin&&n+this.unpin<=o.top?!1:null!=s&&o.top+this.$element.height()>=i-s?"bottom":null!=a&&a>=n?"top":!1,this.affixed!==t&&(this.affixed=t,this.unpin="bottom"==t?o.top-n:null,this.$element.removeClass(l).addClass("affix"+(t?"-"+t:"")))}},e.fn.affix=function(i){return this.each(function(){var n=e(this),o=n.data("affix"),r="object"==typeof i&&i;o||n.data("affix",o=new t(this,r)),"string"==typeof i&&o[i]()})},e.fn.affix.Constructor=t,e.fn.affix.defaults={offset:0},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),i=t.data();i.offset=i.offset||{},i.offsetBottom&&(i.offset.bottom=i.offsetBottom),i.offsetTop&&(i.offset.top=i.offsetTop),t.affix(i)})})}(window.jQuery),/* ==========================================================
 * bootstrap-alert.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#alerts
 * ==========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(e){"use strict";var t='[data-dismiss="alert"]',i=function(i){e(i).on("click",t,this.close)};i.prototype.close=function(t){function i(){n.trigger("closed").remove()}var n,o=e(this),r=o.attr("data-target");r||(r=o.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),n=e(r),t&&t.preventDefault(),n.length||(n=o.hasClass("alert")?o:o.parent()),n.trigger(t=e.Event("close")),t.isDefaultPrevented()||(n.removeClass("in"),e.support.transition&&n.hasClass("fade")?n.on(e.support.transition.end,i):i())},e.fn.alert=function(t){return this.each(function(){var n=e(this),o=n.data("alert");o||n.data("alert",o=new i(this)),"string"==typeof t&&o[t].call(n)})},e.fn.alert.Constructor=i,e(document).on("click.alert.data-api",t,i.prototype.close)}(window.jQuery),/* ============================================================
 * bootstrap-button.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#buttons
 * ============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */
!function(e){"use strict";var t=function(t,i){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,i)};t.prototype.setState=function(e){var t="disabled",i=this.$element,n=i.data(),o=i.is("input")?"val":"html";e+="Text",n.resetText||i.data("resetText",i[o]()),i[o](n[e]||this.options[e]),setTimeout(function(){"loadingText"==e?i.addClass(t).attr(t,t):i.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")},e.fn.button=function(i){return this.each(function(){var n=e(this),o=n.data("button"),r="object"==typeof i&&i;o||n.data("button",o=new t(this,r)),"toggle"==i?o.toggle():i&&o.setState(i)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e(document).on("click.button.data-api","[data-toggle^=button]",function(t){var i=e(t.target);i.hasClass("btn")||(i=i.closest(".btn")),i.button("toggle")})}(window.jQuery),/* ==========================================================
 * bootstrap-carousel.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#carousel
 * ==========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(e){"use strict";var t=function(t,i){this.$element=e(t),this.options=i,this.options.slide&&this.slide(this.options.slide),"hover"==this.options.pause&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},to:function(t){var i=this.$element.find(".item.active"),n=i.parent().children(),o=n.index(i),r=this;if(!(t>n.length-1||0>t))return this.sliding?this.$element.one("slid",function(){r.to(t)}):o==t?this.pause().cycle():this.slide(t>o?"next":"prev",e(n[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle()),clearInterval(this.interval),this.interval=null,this},next:function(){return this.sliding?void 0:this.slide("next")},prev:function(){return this.sliding?void 0:this.slide("prev")},slide:function(t,i){var n,o=this.$element.find(".item.active"),r=i||o[t](),s=this.interval,a="next"==t?"left":"right",l="next"==t?"first":"last",c=this;if(this.sliding=!0,s&&this.pause(),r=r.length?r:this.$element.find(".item")[l](),n=e.Event("slide",{relatedTarget:r[0]}),!r.hasClass("active")){if(e.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(n),n.isDefaultPrevented())return;r.addClass(t),r[0].offsetWidth,o.addClass(a),r.addClass(a),this.$element.one(e.support.transition.end,function(){r.removeClass([t,a].join(" ")).addClass("active"),o.removeClass(["active",a].join(" ")),c.sliding=!1,setTimeout(function(){c.$element.trigger("slid")},0)})}else{if(this.$element.trigger(n),n.isDefaultPrevented())return;o.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}}},e.fn.carousel=function(i){return this.each(function(){var n=e(this),o=n.data("carousel"),r=e.extend({},e.fn.carousel.defaults,"object"==typeof i&&i),s="string"==typeof i?i:r.slide;o||n.data("carousel",o=new t(this,r)),"number"==typeof i?o.to(i):s?o[s]():r.interval&&o.cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e(document).on("click.carousel.data-api","[data-slide]",function(t){var i,n=e(this),o=e(n.attr("data-target")||(i=n.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"")),r=e.extend({},o.data(),n.data());o.carousel(r),t.preventDefault()})}(window.jQuery),/* =============================================================
 * bootstrap-collapse.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#collapse
 * =============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */
!function(e){"use strict";var t=function(t,i){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,i),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,i,n,o;if(!this.transitioning){if(t=this.dimension(),i=e.camelCase(["scroll",t].join("-")),n=this.$parent&&this.$parent.find("> .accordion-group > .in"),n&&n.length){if(o=n.data("collapse"),o&&o.transitioning)return;n.collapse("hide"),o||n.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),e.support.transition&&this.$element[t](this.$element[0][i])}},hide:function(){var t;this.transitioning||(t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0))},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[null!==e?"addClass":"removeClass"]("collapse"),this},transition:function(t,i,n){var o=this,r=function(){"show"==i.type&&o.reset(),o.transitioning=0,o.$element.trigger(n)};this.$element.trigger(i),i.isDefaultPrevented()||(this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,r):r())},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}},e.fn.collapse=function(i){return this.each(function(){var n=e(this),o=n.data("collapse"),r="object"==typeof i&&i;o||n.data("collapse",o=new t(this,r)),"string"==typeof i&&o[i]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e(document).on("click.collapse.data-api","[data-toggle=collapse]",function(t){var i,n=e(this),o=n.attr("data-target")||t.preventDefault()||(i=n.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""),r=e(o).data("collapse")?"toggle":n.data();n[e(o).hasClass("in")?"addClass":"removeClass"]("collapsed"),e(o).collapse(r)})}(window.jQuery),/* ============================================================
 * bootstrap-dropdown.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#dropdowns
 * ============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */
!function(e){"use strict";function t(){e(n).each(function(){i(e(this)).removeClass("open")})}function i(t){var i,n=t.attr("data-target");return n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,"")),i=e(n),i.length||(i=t.parent()),i}var n="[data-toggle=dropdown]",o=function(t){var i=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){i.parent().removeClass("open")})};o.prototype={constructor:o,toggle:function(){var n,o,r=e(this);if(!r.is(".disabled, :disabled"))return n=i(r),o=n.hasClass("open"),t(),o||(n.toggleClass("open"),r.focus()),!1},keydown:function(t){var n,o,r,s,a;if(/(38|40|27)/.test(t.keyCode)&&(n=e(this),t.preventDefault(),t.stopPropagation(),!n.is(".disabled, :disabled"))){if(r=i(n),s=r.hasClass("open"),!s||s&&27==t.keyCode)return n.click();o=e("[role=menu] li:not(.divider) a",r),o.length&&(a=o.index(o.filter(":focus")),38==t.keyCode&&a>0&&a--,40==t.keyCode&&o.length-1>a&&a++,~a||(a=0),o.eq(a).focus())}}},e.fn.dropdown=function(t){return this.each(function(){var i=e(this),n=i.data("dropdown");n||i.data("dropdown",n=new o(this)),"string"==typeof t&&n[t].call(i)})},e.fn.dropdown.Constructor=o,e(document).on("touchstart.dropdown.data-api",".dropdown-menu",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",t).on("click.dropdown touchstart.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",n,o.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",n+", [role=menu]",o.prototype.keydown)}(window.jQuery),/* =========================================================
 * bootstrap-modal.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#modals
 * =========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
!function(e){"use strict";var t=function(t,i){this.options=i,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,i=e.Event("show");this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var i=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),i&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1),t.enforceFocus(),i?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")}))},hide:function(t){t&&t.preventDefault(),t=e.Event("hide"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]===e.target||t.$element.has(e.target).length||t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){27==t.which&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,i=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(i),t.hideModal()})},hideModal:function(){this.$element.hide().trigger("hidden"),this.backdrop()},removeBackdrop:function(){this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var n=e.support.transition&&i;this.$backdrop=e('<div class="modal-backdrop '+i+'" />').appendTo(document.body),this.$backdrop.click("static"==this.options.backdrop?e.proxy(this.$element[0].focus,this.$element[0]):e.proxy(this.hide,this)),n&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),n?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(this.removeBackdrop,this)):this.removeBackdrop()):t&&t()}},e.fn.modal=function(i){return this.each(function(){var n=e(this),o=n.data("modal"),r=e.extend({},e.fn.modal.defaults,n.data(),"object"==typeof i&&i);o||n.data("modal",o=new t(this,r)),"string"==typeof i?o[i]():r.show&&o.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e(document).on("click.modal.data-api",'[data-toggle="modal"]',function(t){var i=e(this),n=i.attr("href"),o=e(i.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),r=o.data("modal")?"toggle":e.extend({remote:!/#/.test(n)&&n},o.data(),i.data());t.preventDefault(),o.modal(r).one("hide",function(){i.focus()})})}(window.jQuery),/* =============================================================
 * bootstrap-scrollspy.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#scrollspy
 * =============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================== */
!function(e){"use strict";function t(t,i){var n,o=e.proxy(this.process,this),r=e(t).is("body")?e(window):e(t);this.options=e.extend({},e.fn.scrollspy.defaults,i),this.$scrollElement=r.on("scroll.scroll-spy.data-api",o),this.selector=(this.options.target||(n=e(t).attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var t,i=this;this.offsets=e([]),this.targets=e([]),t=this.$body.find(this.selector).map(function(){var t=e(this),i=t.data("target")||t.attr("href"),n=/^#\w/.test(i)&&e(i);return n&&n.length&&[[n.position().top,i]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){i.offsets.push(this[0]),i.targets.push(this[1])})},process:function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,i=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=i-this.$scrollElement.height(),o=this.offsets,r=this.targets,s=this.activeTarget;if(t>=n)return s!=(e=r.last()[0])&&this.activate(e);for(e=o.length;e--;)s!=r[e]&&t>=o[e]&&(!o[e+1]||o[e+1]>=t)&&this.activate(r[e])},activate:function(t){var i,n;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',i=e(n).parent("li").addClass("active"),i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate")}},e.fn.scrollspy=function(i){return this.each(function(){var n=e(this),o=n.data("scrollspy"),r="object"==typeof i&&i;o||n.data("scrollspy",o=new t(this,r)),"string"==typeof i&&o[i]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),/* ========================================================
 * bootstrap-tab.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#tabs
 * ========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================== */
!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t,i,n,o=this.element,r=o.closest("ul:not(.dropdown-menu)"),s=o.attr("data-target");s||(s=o.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,"")),o.parent("li").hasClass("active")||(t=r.find(".active:last a")[0],n=e.Event("show",{relatedTarget:t}),o.trigger(n),n.isDefaultPrevented()||(i=e(s),this.activate(o.parent("li"),r),this.activate(i,i.parent(),function(){o.trigger({type:"shown",relatedTarget:t})})))},activate:function(t,i,n){function o(){r.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),n&&n()}var r=i.find("> .active"),s=n&&e.support.transition&&r.hasClass("fade");s?r.one(e.support.transition.end,o):o(),r.removeClass("in")}},e.fn.tab=function(i){return this.each(function(){var n=e(this),o=n.data("tab");o||n.data("tab",o=new t(this)),"string"==typeof i&&o[i]()})},e.fn.tab.Constructor=t,e(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(window.jQuery),/* ===========================================================
 * bootstrap-tooltip.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#tooltips
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ===========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,i,n){var o,r;this.type=t,this.$element=e(i),this.options=this.getOptions(n),this.enabled=!0,"click"==this.options.trigger?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):"manual"!=this.options.trigger&&(o="hover"==this.options.trigger?"mouseenter":"focus",r="hover"==this.options.trigger?"mouseleave":"blur",this.$element.on(o+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(r+"."+this.type,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);return i.options.delay&&i.options.delay.show?(clearTimeout(this.timeout),i.hoverState="in",this.timeout=setTimeout(function(){"in"==i.hoverState&&i.show()},i.options.delay.show),void 0):i.show()},leave:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);return this.timeout&&clearTimeout(this.timeout),i.options.delay&&i.options.delay.hide?(i.hoverState="out",this.timeout=setTimeout(function(){"out"==i.hoverState&&i.hide()},i.options.delay.hide),void 0):i.hide()},show:function(){var e,t,i,n,o,r,s;if(this.hasContent()&&this.enabled){switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),r="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(r),e.detach().css({top:0,left:0,display:"block"}).insertAfter(this.$element),i=this.getPosition(t),n=e[0].offsetWidth,o=e[0].offsetHeight,t?r.split(" ")[1]:r){case"bottom":s={top:i.top+i.height,left:i.left+i.width/2-n/2};break;case"top":s={top:i.top-o,left:i.left+i.width/2-n/2};break;case"left":s={top:i.top+i.height/2-o/2,left:i.left-n};break;case"right":s={top:i.top+i.height/2-o/2,left:i.left+i.width}}e.offset(s).addClass(r).addClass("in")}},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function t(){var t=setTimeout(function(){i.off(e.support.transition.end).detach()},500);i.one(e.support.transition.end,function(){clearTimeout(t),i.detach()})}var i=this.tip();return i.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?t():i.detach(),this},fixTitle:function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,i=this.options;return e=t.attr("data-original-title")||("function"==typeof i.title?i.title.call(t[0]):i.title)},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(t){var i=e(t.currentTarget)[this.type](this._options).data(this.type);i[i.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}},e.fn.tooltip=function(i){return this.each(function(){var n=e(this),o=n.data("tooltip"),r="object"==typeof i&&i;o||n.data("tooltip",o=new t(this,r)),"string"==typeof i&&o[i]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:!1}}(window.jQuery),/* ===========================================================
 * bootstrap-popover.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#popovers
 * ===========================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =========================================================== */
!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),i=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content > *")[this.options.html?"html":"text"](i),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,i=this.options;return e=t.attr("data-content")||("function"==typeof i.content?i.content.call(t[0]):i.content)},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}}),e.fn.popover=function(i){return this.each(function(){var n=e(this),o=n.data("popover"),r="object"==typeof i&&i;o||n.data("popover",o=new t(this,r)),"string"==typeof i&&o[i]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),/* =============================================================
 * bootstrap-typeahead.js v2.2.1
 * http://twitter.github.com/bootstrap/javascript.html#typeahead
 * =============================================================
 * Copyright 2012 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */
!function(e){"use strict";var t=function(t,i){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,i),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.$menu=e(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var t;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(t=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,t?this.process(t):this)},process:function(t){var i=this;return t=e.grep(t,function(e){return i.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){for(var t,i=[],n=[],o=[];t=e.shift();)t.toLowerCase().indexOf(this.query.toLowerCase())?~t.indexOf(this.query)?n.push(t):o.push(t):i.push(t);return i.concat(n,o)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var i=this;return t=e(t).map(function(t,n){return t=e(i.options.item).attr("data-value",n),t.find("a").html(i.highlighter(n)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(){var t=this.$menu.find(".active").removeClass("active"),i=t.next();i.length||(i=e(this.$menu.find("li")[0])),i.addClass("active")},prev:function(){var e=this.$menu.find(".active").removeClass("active"),t=e.prev();t.length||(t=this.$menu.find("li").last()),t.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},eventSupported:function(e){var t=e in this.$element;return t||(this.$element.setAttribute(e,"return;"),t="function"==typeof this.$element[e]),t},move:function(e){if(this.shown){switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()}},keydown:function(t){this.suppressKeyPressRepeat=!~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){this.suppressKeyPressRepeat||this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},blur:function(){var e=this;setTimeout(function(){e.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(i){return this.each(function(){var n=e(this),o=n.data("typeahead"),r="object"==typeof i&&i;o||n.data("typeahead",o=new t(this,r)),"string"==typeof i&&o[i]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var i=e(this);i.data("typeahead")||(t.preventDefault(),i.typeahead(i.data()))})}(window.jQuery);var bootbox=window.bootbox||function(e,t){function i(e,t){return null==t&&(t=n),"string"==typeof u[t][e]?u[t][e]:t!=o?i(e,o):e}var n="en",o="en",r=!0,s="static",a="javascript:;",l="",c={},d={};d.setLocale=function(e){for(var t in u)if(t==e)return n=e,void 0;throw new Error("Invalid locale: "+e)},d.addLocale=function(e,t){"undefined"==typeof u[e]&&(u[e]={});for(var i in t)u[e][i]=t[i]},d.setIcons=function(e){c=e,("object"!=typeof c||null==c)&&(c={})},d.alert=function(){var e="",t=i("OK"),n=null;switch(arguments.length){case 1:e=arguments[0];break;case 2:e=arguments[0],"function"==typeof arguments[1]?n=arguments[1]:t=arguments[1];break;case 3:e=arguments[0],t=arguments[1],n=arguments[2];break;default:throw new Error("Incorrect number of arguments: expected 1-3")}return d.dialog(e,{label:t,icon:c.OK,callback:n},{onEscape:n||!0})},d.confirm=function(){var e="",t=i("CANCEL"),n=i("CONFIRM"),o=null;switch(arguments.length){case 1:e=arguments[0];break;case 2:e=arguments[0],"function"==typeof arguments[1]?o=arguments[1]:t=arguments[1];break;case 3:e=arguments[0],t=arguments[1],"function"==typeof arguments[2]?o=arguments[2]:n=arguments[2];break;case 4:e=arguments[0],t=arguments[1],n=arguments[2],o=arguments[3];break;default:throw new Error("Incorrect number of arguments: expected 1-4")}var r=function(){"function"==typeof o&&o(!1)},s=function(){"function"==typeof o&&o(!0)};return d.dialog(e,[{label:t,icon:c.CANCEL,callback:r},{label:n,icon:c.CONFIRM,callback:s}],{onEscape:r})},d.prompt=function(){var e="",n=i("CANCEL"),o=i("CONFIRM"),r=null,s="";switch(arguments.length){case 1:e=arguments[0];break;case 2:e=arguments[0],"function"==typeof arguments[1]?r=arguments[1]:n=arguments[1];break;case 3:e=arguments[0],n=arguments[1],"function"==typeof arguments[2]?r=arguments[2]:o=arguments[2];break;case 4:e=arguments[0],n=arguments[1],o=arguments[2],r=arguments[3];break;case 5:e=arguments[0],n=arguments[1],o=arguments[2],r=arguments[3],s=arguments[4];break;default:throw new Error("Incorrect number of arguments: expected 1-5")}var a=e,l=t("<form></form>");l.append("<input autocomplete=off type=text value='"+s+"' />");var u=function(){"function"==typeof r&&r(null)},h=function(){"function"==typeof r&&r(l.find("input[type=text]").val())},p=d.dialog(l,[{label:n,icon:c.CANCEL,callback:u},{label:o,icon:c.CONFIRM,callback:h}],{header:a,show:!1,onEscape:u});return p.on("shown",function(){l.find("input[type=text]").focus(),l.on("submit",function(e){e.preventDefault(),p.find(".btn-primary").click()})}),p.modal("show"),p},d.dialog=function(i,n,o){var c="",d=[],o=o||{};null==n?n=[]:"undefined"==typeof n.length&&(n=[n]);for(var u=n.length;u--;){var h=null,p=null,f=null,m="",g=null;if("undefined"==typeof n[u].label&&"undefined"==typeof n[u]["class"]&&"undefined"==typeof n[u].callback){var v=0,y=null;for(var b in n[u])if(y=b,++v>1)break;1==v&&"function"==typeof n[u][b]&&(n[u].label=y,n[u].callback=n[u][b])}"function"==typeof n[u].callback&&(g=n[u].callback),n[u]["class"]?f=n[u]["class"]:u==n.length-1&&2>=n.length&&(f="btn-primary"),h=n[u].label?n[u].label:"Option "+(u+1),n[u].icon&&(m="<i class='"+n[u].icon+"'></i> "),p=n[u].href?n[u].href:a,c="<a data-handler='"+u+"' class='btn "+f+"' href='"+p+"'>"+m+h+"</a>"+c,d[u]=g}var _=["<div class='bootbox modal' tabindex='-1' style='overflow:hidden;'>"];if(o.header){var w="";("undefined"==typeof o.headerCloseButton||o.headerCloseButton)&&(w="<a href='"+a+"' class='close'>&times;</a>"),_.push("<div class='modal-header'>"+w+"<h3>"+o.header+"</h3></div>")}_.push("<div class='modal-body'></div>"),c&&_.push("<div class='modal-footer'>"+c+"</div>"),_.push("</div>");var x=t(_.join("\n")),C="undefined"==typeof o.animate?r:o.animate;C&&x.addClass("fade");var T="undefined"==typeof o.classes?l:o.classes;return T&&x.addClass(T),x.find(".modal-body").html(i),x.on("hidden",function(){x.remove()}),x.on("keyup.dismiss.modal",function(e){27==e.which&&o.onEscape&&("function"==typeof o.onEscape&&o.onEscape(),x.modal("hide"))}),x.on("shown",function(){x.find("a.btn-primary:first").focus()}),x.on("click",".modal-footer a, a.close",function(e){var i=t(this).data("handler"),o=d[i],r=null;("undefined"==typeof i||"undefined"==typeof n[i].href)&&(e.preventDefault(),"function"==typeof o&&(r=o()),r!==!1&&x.modal("hide"))}),t("body").append(x),x.modal({backdrop:"undefined"==typeof o.backdrop?s:o.backdrop,keyboard:!1,show:!1}),x.on("show",function(){t(e).off("focusin.modal")}),("undefined"==typeof o.show||o.show===!0)&&x.modal("show"),x},d.modal=function(){var e,i,n,o={onEscape:null,keyboard:!0,backdrop:s};switch(arguments.length){case 1:e=arguments[0];break;case 2:e=arguments[0],"object"==typeof arguments[1]?n=arguments[1]:i=arguments[1];break;case 3:e=arguments[0],i=arguments[1],n=arguments[2];break;default:throw new Error("Incorrect number of arguments: expected 1-3")}return o.header=i,n="object"==typeof n?t.extend(o,n):o,d.dialog(e,[],n)},d.hideAll=function(){t(".bootbox").modal("hide")},d.animate=function(e){r=e},d.backdrop=function(e){s=e},d.classes=function(e){l=e};var u={en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},ru:{OK:"OK",CANCEL:"",CONFIRM:""},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"}};return d}(document,window.jQuery);window.bootbox=bootbox;/**
 * @license wysihtml5 v0.3.0
 * https://github.com/xing/wysihtml5
 *
 * Author: Christopher Blum (https://github.com/tiff)
 *
 * Copyright (C) 2012 XING AG
 * Licensed under the MIT license (MIT)
 *
 */
var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};/**
 * @license Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2011, Tim Down
 * Licensed under the MIT license.
 * Version: 1.2.2
 * Build date: 13 November 2011
 */
window.rangy=function(){function e(e,t){var i=typeof e[t];return i==u||!(i!=d||!e[t])||"unknown"==i}function t(e,t){return!(typeof e[t]!=d||!e[t])}function i(e,t){return typeof e[t]!=h}function n(e){return function(t,i){for(var n=i.length;n--;)if(!e(t,i[n]))return!1;return!0}}function o(e){return e&&v(e,g)&&b(e,m)}function r(e){window.alert("Rangy not supported in your browser. Reason: "+e),_.initialized=!0,_.supported=!1}function s(e){var t="Rangy warning: "+e;_.config.alertOnWarn?window.alert(t):typeof window.console!=h&&typeof window.console.log!=h&&window.console.log(t)}function a(){if(!_.initialized){var i,n=!1,s=!1;e(document,"createRange")&&(i=document.createRange(),v(i,f)&&b(i,p)&&(n=!0),i.detach());var a=t(document,"body")?document.body:document.getElementsByTagName("body")[0];a&&e(a,"createTextRange")&&(i=a.createTextRange(),o(i)&&(s=!0)),n||s||r("Neither Range nor TextRange are implemented"),_.initialized=!0,_.features={implementsDomRange:n,implementsTextRange:s};for(var l=x.concat(w),c=0,d=l.length;d>c;++c)try{l[c](_)}catch(u){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",u)}}}function l(e){e=e||window,a();for(var t=0,i=C.length;i>t;++t)C[t](e)}function c(e){this.name=e,this.initialized=!1,this.supported=!1}var d="object",u="function",h="undefined",p=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],f=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],m=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],v=n(e),y=n(t),b=n(i),_={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:i,areHostMethods:v,areHostObjects:y,areHostProperties:b,isTextRange:o},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};_.fail=r,_.warn=s,{}.hasOwnProperty?_.util.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}:r("hasOwnProperty not supported");var w=[],x=[];_.init=a,_.addInitListener=function(e){_.initialized?e(_):w.push(e)};var C=[];_.addCreateMissingNativeApiListener=function(e){C.push(e)},_.createMissingNativeApi=l,c.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},c.prototype.warn=function(e){_.warn("Module "+this.name+": "+e)},c.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},_.createModule=function(e,t){var i=new c(e);_.modules[e]=i,x.push(function(e){t(e,i),i.initialized=!0,i.supported=!0})},_.requireModules=function(e){for(var t,i,n=0,o=e.length;o>n;++n){if(i=e[n],t=_.modules[i],!(t&&t instanceof c))throw new Error("Module '"+i+"' not found");if(!t.supported)throw new Error("Module '"+i+"' not supported")}};var T=!1,k=function(){T||(T=!0,_.initialized||a())};return typeof window==h?(r("No window found"),void 0):typeof document==h?(r("No document found"),void 0):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",k,!1),e(window,"addEventListener")?window.addEventListener("load",k,!1):e(window,"attachEvent")?window.attachEvent("onload",k):r("Window does not have required addEventListener or attachEvent method"),_)}(),rangy.createModule("DomUtil",function(e,t){function i(e){var t;return typeof e.namespaceURI==k||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function n(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)t++;return t}function r(e){var t;return c(e)?e.length:(t=e.childNodes)?t.length:0}function s(e,t){var i,n=[];for(i=e;i;i=i.parentNode)n.push(i);for(i=t;i;i=i.parentNode)if(D(n,i))return i;return null}function a(e,t,i){for(var n=i?t:t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1}function l(e,t,i){for(var n,o=i?e:e.parentNode;o;){if(n=o.parentNode,n===t)return o;o=n}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function d(e,t){var i=t.nextSibling,n=t.parentNode;return i?n.insertBefore(e,i):n.appendChild(e),e}function u(e,t){var i=e.cloneNode(!1);return i.deleteData(0,t),e.deleteData(t,e.length-t),d(i,e),i}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=k)return e.ownerDocument;if(typeof e.document!=k)return e.document;if(e.parentNode)return h(e.parentNode);throw new Error("getDocument: no document found for node")}function p(e){var t=h(e);if(typeof t.defaultView!=k)return t.defaultView;if(typeof t.parentWindow!=k)return t.parentWindow;throw new Error("Cannot get a window object for node")}function f(e){if(typeof e.contentDocument!=k)return e.contentDocument;if(typeof e.contentWindow!=k)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function m(e){if(typeof e.contentWindow!=k)return e.contentWindow;if(typeof e.contentDocument!=k)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function g(e){return S.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function v(e){for(var t;t=e.parentNode;)e=t;return e}function y(e,t,i,n){var r,a,c,d,u;if(e==i)return t===n?0:n>t?-1:1;if(r=l(i,e,!0))return o(r)>=t?-1:1;if(r=l(e,i,!0))return n>o(r)?-1:1;if(a=s(e,i),c=e===a?a:l(e,a,!0),d=i===a?a:l(i,a,!0),c===d)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(u=a.firstChild;u;){if(u===c)return-1;if(u===d)return 1;u=u.nextSibling}throw new Error("Should not be here!")}function b(e){for(var t,i=h(e).createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i}function _(e){if(!e)return"[No node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function w(e){this.root=e,this._next=e}function x(e){return new w(e)}function C(e,t){this.node=e,this.offset=t}function T(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var k="undefined",S=e.util;S.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),S.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var E=document.createElement("div");S.areHostMethods(E,["insertBefore","appendChild","cloneNode"]||!S.areHostObjects(E,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),S.isHostProperty(E,"innerHTML")||t.fail("Element is missing innerHTML property");var N=document.createTextNode("test");S.areHostMethods(N,["splitText","deleteData","insertData","appendData","cloneNode"]||!S.areHostObjects(E,["previousSibling","nextSibling","childNodes","parentNode"])||!S.areHostProperties(N,["data"]))||t.fail("Incomplete Text Node implementation");var D=function(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1};w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,i=this._current=this._next;if(this._current)if(e=i.firstChild)this._next=e;else{for(t=null;i!==this.root&&!(t=i.nextSibling);)i=i.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},C.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+_(this.node)+":"+this.offset+")]"}},T.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},T.prototype.toString=function(){return this.message},e.dom={arrayContains:D,isHtmlNamespace:i,parentElement:n,getNodeIndex:o,getNodeLength:r,getCommonAncestor:s,isAncestorOf:a,getClosestAncestorIn:l,isCharacterDataNode:c,insertAfter:d,splitDataNode:u,getDocument:h,getWindow:p,getIframeWindow:m,getIframeDocument:f,getBody:g,getRootContainer:v,comparePoints:y,inspectNode:_,fragmentFromNodeChildren:b,createIterator:x,DomPosition:C},e.DOMException=T}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(R.isAncestorOf(e,t.startContainer,!0)||R.isAncestorOf(e,t.endContainer,!0))}function i(e){return R.getDocument(e.startContainer)}function n(e,t,i){var n=e._listeners[t];if(n)for(var o=0,r=n.length;r>o;++o)n[o].call(e,{target:e,args:i})}function o(e){return new W(e.parentNode,R.getNodeIndex(e))}function r(e){return new W(e.parentNode,R.getNodeIndex(e)+1)}function s(e,t,i){var n=11==e.nodeType?e.firstChild:e;return R.isCharacterDataNode(t)?i==t.length?R.insertAfter(e,t):t.parentNode.insertBefore(e,0==i?t:R.splitDataNode(t,i)):i>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[i]),n}function a(e){for(var t,n,o,r=i(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(o=e.getSubtreeIterator(),n.appendChild(a(o)),o.detach(!0)),10==n.nodeType)throw new O("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function l(e,t,i){var n,o;i=i||{stop:!1};for(var r,s;r=e.next();)if(e.isPartiallySelectedSubtree()){if(t(r)===!1)return i.stop=!0,void 0;if(s=e.getSubtreeIterator(),l(s,t,i),s.detach(!0),i.stop)return}else for(n=R.createIterator(r);o=n.next();)if(t(o)===!1)return i.stop=!0,void 0}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach(!0)):e.remove()}function d(e){for(var t,n,o=i(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(d(n)),n.detach(!0)):e.remove(),10==t.nodeType)throw new O("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function u(e,t,i){var n,o=!(!t||!t.length),r=!!i;o&&(n=new RegExp("^("+t.join("|")+")$"));var s=[];return l(new p(e,!1),function(e){o&&!n.test(e.nodeType)||r&&!i(e)||s.push(e)}),s}function h(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+R.inspectNode(e.startContainer)+":"+e.startOffset+", "+R.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var i=e.commonAncestorContainer;this.sc===this.ec&&R.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==i||R.isCharacterDataNode(this.sc)?R.getClosestAncestorIn(this.sc,i,!0):this.sc.childNodes[this.so],this._last=this.ec!==i||R.isCharacterDataNode(this.ec)?R.getClosestAncestorIn(this.ec,i,!0):this.ec.childNodes[this.eo-1])}}function f(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function m(e,t,i){this.nodes=u(e,t,i),this._next=this.nodes[0],this._position=0}function g(e){return function(t,i){for(var n,o=i?t:t.parentNode;o;){if(n=o.nodeType,R.arrayContains(e,n))return o;o=o.parentNode}return null}}function v(e,t){if(G(e,t))throw new f("INVALID_NODE_TYPE_ERR")}function y(e){if(!e.startContainer)throw new O("INVALID_STATE_ERR")}function b(e,t){if(!R.arrayContains(t,e.nodeType))throw new f("INVALID_NODE_TYPE_ERR")}function _(e,t){if(0>t||t>(R.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new O("INDEX_SIZE_ERR")}function w(e,t){if(U(e,!0)!==U(t,!0))throw new O("WRONG_DOCUMENT_ERR")}function x(e){if(q(e,!0))throw new O("NO_MODIFICATION_ALLOWED_ERR")}function C(e,t){if(!e)throw new O(t)}function T(e){return!R.arrayContains(j,e.nodeType)&&!U(e,!0)}function k(e,t){return(R.isCharacterDataNode(e)?e.length:e.childNodes.length)>=t}function S(e){if(y(e),T(e.startContainer)||T(e.endContainer)||!k(e.startContainer,e.startOffset)||!k(e.endContainer,e.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function E(){}function N(e){e.START_TO_START=J,e.START_TO_END=et,e.END_TO_END=tt,e.END_TO_START=it,e.NODE_BEFORE=nt,e.NODE_AFTER=ot,e.NODE_BEFORE_AND_AFTER=rt,e.NODE_INSIDE=st}function D(e){N(e),N(e.prototype)}function M(e,t){return function(){S(this);var i,n,o=this.startContainer,s=this.startOffset,a=this.commonAncestorContainer,c=new p(this,!0);o!==a&&(i=R.getClosestAncestorIn(o,a,!0),n=r(i),o=n.node,s=n.offset),l(c,x),c.reset();var d=e(c);return c.detach(),t(this,o,s,o,s),d}}function A(i,n,s){function a(e,t){return function(i){y(this),b(i,H),b(B(i),j);var n=(e?o:r)(i);(t?l:u)(this,n.node,n.offset)}}function l(e,t,i){var o=e.endContainer,r=e.endOffset;(t!==e.startContainer||i!==e.startOffset)&&((B(t)!=B(o)||1==R.comparePoints(t,i,o,r))&&(o=t,r=i),n(e,t,i,o,r))}function u(e,t,i){var o=e.startContainer,r=e.startOffset;(t!==e.endContainer||i!==e.endOffset)&&((B(t)!=B(o)||-1==R.comparePoints(t,i,o,r))&&(o=t,r=i),n(e,o,r,t,i))}function h(e,t,i){(t!==e.startContainer||i!==e.startOffset||t!==e.endContainer||i!==e.endOffset)&&n(e,t,i,t,i)}i.prototype=new E,e.util.extend(i.prototype,{setStart:function(e,t){y(this),v(e,!0),_(e,t),l(this,e,t)},setEnd:function(e,t){y(this),v(e,!0),_(e,t),u(this,e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){S(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){y(this),v(e,!0),n(this,e,0,e,R.getNodeLength(e))},selectNode:function(e){y(this),v(e,!1),b(e,H);var t=o(e),i=r(e);n(this,t.node,t.offset,i.node,i.offset)},extractContents:M(d,n),deleteContents:M(c,n),canSurroundContents:function(){S(this),x(this.startContainer),x(this.endContainer);var e=new p(this,!0),i=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!i},detach:function(){s(this)},splitBoundaries:function(){S(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,o=this.endOffset,r=e===i;R.isCharacterDataNode(i)&&o>0&&i.length>o&&R.splitDataNode(i,o),R.isCharacterDataNode(e)&&t>0&&e.length>t&&(e=R.splitDataNode(e,t),r?(o-=t,i=e):i==e.parentNode&&o>=R.getNodeIndex(e)&&o++,t=0),n(this,e,t,i,o)},normalizeBoundaries:function(){S(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,o=this.endOffset,r=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,o=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},s=function(n){var r=n.previousSibling;if(r&&r.nodeType==n.nodeType){e=n;var s=n.length;if(t=r.length,n.insertData(0,r.data),r.parentNode.removeChild(r),e==i)o+=t,i=e;else if(i==n.parentNode){var a=R.getNodeIndex(n);o==a?(i=n,o=s):o>a&&o--}}},a=!0;if(R.isCharacterDataNode(i))i.length==o&&r(i);else{if(o>0){var l=i.childNodes[o-1];l&&R.isCharacterDataNode(l)&&r(l)}a=!this.collapsed}if(a){if(R.isCharacterDataNode(e))0==t&&s(e);else if(e.childNodes.length>t){var c=e.childNodes[t];c&&R.isCharacterDataNode(c)&&s(c)}}else e=i,t=o;n(this,e,t,i,o)},collapseToPoint:function(e,t){y(this),v(e,!0),_(e,t),h(this,e,t)}}),D(i)}function I(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:R.getCommonAncestor(e.startContainer,e.endContainer)}function $(e,t,i,o,r){var s=e.startContainer!==t||e.startOffset!==i,a=e.endContainer!==o||e.endOffset!==r;e.startContainer=t,e.startOffset=i,e.endContainer=o,e.endOffset=r,I(e),n(e,"boundarychange",{startMoved:s,endMoved:a})}function L(e){y(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,n(e,"detach",null),e._listeners=null}function P(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},I(this)}e.requireModules(["DomUtil"]);var R=e.dom,W=R.DomPosition,O=e.DOMException;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,R.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,i=this._current;!R.isCharacterDataNode(i)||i!==this.sc&&i!==this.ec?i.parentNode&&i.parentNode.removeChild(i):(e=i===this.sc?this.so:0,t=i===this.ec?this.eo:i.length,e!=t&&i.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new P(i(this.range));var t=this._current,n=t,o=0,r=t,s=R.getNodeLength(t);R.isAncestorOf(t,this.sc,!0)&&(n=this.sc,o=this.so),R.isAncestorOf(t,this.ec,!0)&&(r=this.ec,s=this.eo),$(e,n,o,r,s)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},f.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},f.prototype.toString=function(){return this.message},m.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var H=[1,3,4,5,7,8,10],j=[2,9,11],F=[5,6,10,12],z=[1,3,4,5,7,8,10,11],Y=[1,3,4,5,7,8],B=R.getRootContainer,U=g([9,11]),q=g(F),G=g([6,10,12]),X=document.createElement("style"),K=!1;try{X.innerHTML="<b>x</b>",K=3==X.firstChild.nodeType}catch(V){}e.features.htmlParsingConforms=K;var Q=K?function(e){var t=this.startContainer,i=R.getDocument(t);if(!t)throw new O("INVALID_STATE_ERR");var n=null;return 1==t.nodeType?n=t:R.isCharacterDataNode(t)&&(n=R.parentElement(t)),n=null===n||"HTML"==n.nodeName&&R.isHtmlNamespace(R.getDocument(n).documentElement)&&R.isHtmlNamespace(n)?i.createElement("body"):n.cloneNode(!1),n.innerHTML=e,R.fragmentFromNodeChildren(n)}:function(e){y(this);var t=i(this),n=t.createElement("body");return n.innerHTML=e,R.fragmentFromNodeChildren(n)},Z=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],J=0,et=1,tt=2,it=3,nt=0,ot=1,rt=2,st=3;E.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){S(this),w(this.startContainer,t.startContainer);var i,n,o,r,s=e==it||e==J?"start":"end",a=e==et||e==J?"start":"end";return i=this[s+"Container"],n=this[s+"Offset"],o=t[a+"Container"],r=t[a+"Offset"],R.comparePoints(i,n,o,r)},insertNode:function(e){if(S(this),b(e,z),x(this.startContainer),R.isAncestorOf(e,this.startContainer,!0))throw new O("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){S(this);var e,t;if(this.collapsed)return i(this).createDocumentFragment();if(this.startContainer===this.endContainer&&R.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=i(this).createDocumentFragment(),t.appendChild(e),t;var n=new p(this,!0);return e=a(n),n.detach(),e},canSurroundContents:function(){S(this),x(this.startContainer),x(this.endContainer);var e=new p(this,!0),i=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!i},surroundContents:function(e){if(b(e,Y),!this.canSurroundContents())throw new f("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){S(this);for(var e,t=new P(i(this)),n=Z.length;n--;)e=Z[n],t[e]=this[e];return t},toString:function(){S(this);var e=this.startContainer;if(e===this.endContainer&&R.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],i=new p(this,!0);return l(i,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),i.detach(),t.join("")},compareNode:function(e){S(this);var t=e.parentNode,i=R.getNodeIndex(e);if(!t)throw new O("NOT_FOUND_ERR");var n=this.comparePoint(t,i),o=this.comparePoint(t,i+1);return 0>n?o>0?rt:nt:o>0?ot:st},comparePoint:function(e,t){return S(this),C(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),0>R.comparePoints(e,t,this.startContainer,this.startOffset)?-1:R.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Q,toHtml:function(){S(this);var e=i(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(S(this),C(e,"NOT_FOUND_ERR"),R.getDocument(e)!==i(this))return!1;var n=e.parentNode,o=R.getNodeIndex(e);C(n,"NOT_FOUND_ERR");var r=R.comparePoints(n,o,this.endContainer,this.endOffset),s=R.comparePoints(n,o+1,this.startContainer,this.startOffset);return t?0>=r&&s>=0:0>r&&s>0},isPointInRange:function(e,t){return S(this),C(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),R.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&0>=R.comparePoints(e,t,this.endContainer,this.endOffset)},intersectsRange:function(e,t){if(S(this),i(e)!=i(this))throw new O("WRONG_DOCUMENT_ERR");var n=R.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),o=R.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=n&&o>=0:0>n&&o>0},intersection:function(e){if(this.intersectsRange(e)){var t=R.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),i=R.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),n=this.cloneRange();return-1==t&&n.setStart(e.startContainer,e.startOffset),1==i&&n.setEnd(e.endContainer,e.endOffset),n}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==R.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==R.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new f("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==st},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&0>=this.comparePoint(e,R.getNodeLength(e))},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var i=t.getNodes([3]);if(i.length>0){t.setStart(i[0],0);var n=i.pop();t.setEnd(n,n.length);var o=this.containsRange(t);return t.detach(),o}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return S(this),new m(this,e,t)},getNodes:function(e,t){return S(this),u(this,e,t)},getDocument:function(){return i(this)},collapseBefore:function(e){y(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){y(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return P.rangesEqual(this,e)},inspect:function(){return h(this)}},A(P,$,L),e.rangePrototype=E.prototype,P.rangeProperties=Z,P.RangeIterator=p,P.copyComparisonConstants=D,P.createPrototypeRange=A,P.inspect=h,P.getRangeDocument=i,P.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=P,e.RangeException=f}),rangy.createModule("WrappedRange",function(e){function t(e){var t=e.parentElement(),i=e.duplicate();i.collapse(!0);var n=i.parentElement();i=e.duplicate(),i.collapse(!1);var o=i.parentElement(),r=n==o?n:s.getCommonAncestor(n,o);return r==t?r:s.getCommonAncestor(t,r)}function i(e){return 0==e.compareEndPoints("StartToEnd",e)}function n(e,t,i,n){var o=e.duplicate();o.collapse(i);var r=o.parentElement();if(s.isAncestorOf(t,r,!0)||(r=t),!r.canHaveHTML)return new a(r.parentNode,s.getNodeIndex(r));var l,c,d,u,h,p=s.getDocument(r).createElement("span"),f=i?"StartToStart":"StartToEnd";do r.insertBefore(p,p.previousSibling),o.moveToElementText(p);while((l=o.compareEndPoints(f,e))>0&&p.previousSibling);if(h=p.nextSibling,-1==l&&h&&s.isCharacterDataNode(h)){o.setEndPoint(i?"EndToStart":"EndToEnd",e);var m;if(/[\r\n]/.test(h.data)){var g=o.duplicate(),v=g.text.replace(/\r\n/g,"\r").length;for(m=g.moveStart("character",v);-1==(l=g.compareEndPoints("StartToEnd",g));)m++,g.moveStart("character",1)}else m=o.text.length;u=new a(h,m)}else c=(n||!i)&&p.previousSibling,d=(n||i)&&p.nextSibling,u=d&&s.isCharacterDataNode(d)?new a(d,0):c&&s.isCharacterDataNode(c)?new a(c,c.length):new a(r,s.getNodeIndex(p));return p.parentNode.removeChild(p),u}function o(e,t){var i,n,o,r,a=e.offset,l=s.getDocument(e.node),c=l.body.createTextRange(),d=s.isCharacterDataNode(e.node);return d?(i=e.node,n=i.parentNode):(r=e.node.childNodes,i=r.length>a?r[a]:null,n=e.node),o=l.createElement("span"),o.innerHTML="&#feff;",i?n.insertBefore(o,i):n.appendChild(o),c.moveToElementText(o),c.collapse(!t),n.removeChild(o),d&&c[t?"moveStart":"moveEnd"]("character",a),c}e.requireModules(["DomUtil","DomRange"]);var r,s=e.dom,a=s.DomPosition,l=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){r=function(e){this.textRange=e,this.refresh()},r.prototype=new l(document),r.prototype.refresh=function(){var e,o,r=t(this.textRange);i(this.textRange)?o=e=n(this.textRange,r,!0,!0):(e=n(this.textRange,r,!0,!1),o=n(this.textRange,r,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(o.node,o.offset)},l.copyComparisonConstants(r);var c=function(){return this}();"undefined"==typeof c.Range&&(c.Range=r),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else(function(){function t(e){for(var t,i=d.length;i--;)t=d[i],e[t]=e.nativeRange[t]}function i(e,t,i,n,o){var r=e.startContainer!==t||e.startOffset!=i,s=e.endContainer!==n||e.endOffset!=o;(r||s)&&(e.setEnd(n,o),e.setStart(t,i))}function n(e){e.nativeRange.detach(),e.detached=!0;for(var t,i=d.length;i--;)t=d[i],e[t]=null}var o,a,c,d=l.rangeProperties;r=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,t(this)},l.createPrototypeRange(r,i,n),o=r.prototype,o.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},o.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},o.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},o.cloneContents=function(){return this.nativeRange.cloneContents()},o.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},o.collapse=function(e){this.nativeRange.collapse(e),t(this)},o.cloneRange=function(){return new r(this.nativeRange.cloneRange())},o.refresh=function(){t(this)},o.toString=function(){return this.nativeRange.toString()};var u=document.createTextNode("test");s.getBody(document).appendChild(u);var h=document.createRange();h.setStart(u,0),h.setEnd(u,0);try{h.setStart(u,1),a=!0,o.setStart=function(e,i){this.nativeRange.setStart(e,i),t(this)},o.setEnd=function(e,i){this.nativeRange.setEnd(e,i),t(this)},c=function(e){return function(i){this.nativeRange[e](i),t(this)}}}catch(p){a=!1,o.setStart=function(e,i){try{this.nativeRange.setStart(e,i)}catch(n){this.nativeRange.setEnd(e,i),this.nativeRange.setStart(e,i)}t(this)},o.setEnd=function(e,i){try{this.nativeRange.setEnd(e,i)}catch(n){this.nativeRange.setStart(e,i),this.nativeRange.setEnd(e,i)}t(this)},c=function(e,i){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[i](n),this.nativeRange[e](n)}t(this)}}}o.setStartBefore=c("setStartBefore","setEndBefore"),o.setStartAfter=c("setStartAfter","setEndAfter"),o.setEndBefore=c("setEndBefore","setStartBefore"),o.setEndAfter=c("setEndAfter","setStartAfter"),h.selectNodeContents(u),o.selectNodeContents=h.startContainer==u&&h.endContainer==u&&0==h.startOffset&&h.endOffset==u.length?function(e){this.nativeRange.selectNodeContents(e),t(this)}:function(e){this.setStart(e,0),this.setEnd(e,l.getEndOffset(e))},h.selectNodeContents(u),h.setEnd(u,3);var f=document.createRange();f.selectNodeContents(u),f.setEnd(u,4),f.setStart(u,2),o.compareBoundaryPoints=-1==h.compareBoundaryPoints(h.START_TO_END,f)&1==h.compareBoundaryPoints(h.END_TO_START,f)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(h,"createContextualFragment")&&(o.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),s.getBody(document).removeChild(u),h.detach(),f.detach()})(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(r.rangeToTextRange=function(e){if(e.collapsed){var t=o(new a(e.startContainer,e.startOffset),!0);return t}var i=o(new a(e.startContainer,e.startOffset),!0),n=o(new a(e.endContainer,e.endOffset),!1),r=s.getDocument(e.startContainer).body.createTextRange();return r.setEndPoint("StartToStart",i),r.setEndPoint("EndToEnd",n),r}),r.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createRange=function(t){return t=t||document,new r(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new l(e)},e.createIframeRange=function(t){return e.createRange(s.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(s.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var i=t.document;"undefined"==typeof i.createRange&&(i.createRange=function(){return e.createRange(this)}),i=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function i(e){return(e||window).getSelection()}function n(e){return(e||window).document.selection}function o(e,t,i){var n=i?"end":"start",o=i?"start":"end";e.anchorNode=t[n+"Container"],e.anchorOffset=t[n+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function r(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function s(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function a(t){var i;return t instanceof T?(i=t._selectionNativeRange,i||(i=e.createNativeRange(x.getDocument(t.startContainer)),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=i,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof k?i=t.nativeRange:e.features.implementsDomRange&&t instanceof x.getWindow(t.startContainer).Range&&(i=t),i}function l(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,i=e.length;i>t;++t)if(!x.isAncestorOf(e[0],e[t]))return!1;return!0}function c(e){var t=e.getNodes();if(!l(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function d(e){return!!e&&"undefined"!=typeof e.text}function u(e,t){var i=new k(t);e._ranges=[i],o(e,i,!1),e.rangeCount=1,e.isCollapsed=i.collapsed}function h(t){if(t._ranges.length=0,"None"==t.docSelection.type)s(t);else{var i=t.docSelection.createRange();if(d(i))u(t,i);else{t.rangeCount=i.length;for(var n,r=x.getDocument(i.item(0)),a=0;t.rangeCount>a;++a)n=e.createRange(r),n.selectNode(i.item(a)),t._ranges.push(n);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,o(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,t){for(var i=e.docSelection.createRange(),n=c(t),o=x.getDocument(i.item(0)),r=x.getBody(o).createControlRange(),s=0,a=i.length;a>s;++s)r.add(i.item(s));try{r.add(n)}catch(l){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),h(e)}function f(e,t,i){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=i,this.refresh()}function m(e,t){for(var i,n=x.getDocument(t[0].startContainer),o=x.getBody(n).createControlRange(),r=0;rangeCount>r;++r){i=c(t[r]);try{o.add(i)}catch(s){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")
}}o.select(),h(e)}function g(e,t){if(e.anchorNode&&x.getDocument(e.anchorNode)!==x.getDocument(t))throw new S("WRONG_DOCUMENT_ERR")}function v(e){var t=[],i=new E(e.anchorNode,e.anchorOffset),n=new E(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var r=0,s=e.rangeCount;s>r;++r)t[r]=T.inspect(e.getRangeAt(r));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+i.inspect()+", focus: "+n.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var y,b,_="boolean",w="_rangySelection",x=e.dom,C=e.util,T=e.DomRange,k=e.WrappedRange,S=e.DOMException,E=x.DomPosition,N="Control",D=e.util.isHostMethod(window,"getSelection"),M=e.util.isHostObject(document,"selection"),A=M&&(!D||e.config.preferTextRange);A?(y=n,e.isSelectionValid=function(e){var t=(e||window).document,i=t.selection;return"None"!=i.type||x.getDocument(i.createRange().parentElement())==t}):D?(y=i,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=y;var I=y(),$=e.createNativeRange(document),L=x.getBody(document),P=C.areHostObjects(I,["anchorNode","focusNode"]&&C.areHostProperties(I,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=P;var R=C.isHostMethod(I,"extend");e.features.selectionHasExtend=R;var W="number"==typeof I.rangeCount;e.features.selectionHasRangeCount=W;var O=!1,H=!0;C.areHostMethods(I,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof I.rangeCount&&e.features.implementsDomRange&&function(){var e=document.createElement("iframe");L.appendChild(e);var t=x.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var i=x.getIframeWindow(e).getSelection(),n=t.documentElement,o=n.lastChild,r=o.firstChild,s=t.createRange();s.setStart(r,1),s.collapse(!0),i.addRange(s),H=1==i.rangeCount,i.removeAllRanges();var a=s.cloneRange();s.setStart(r,0),a.setEnd(r,2),i.addRange(s),i.addRange(a),O=2==i.rangeCount,s.detach(),a.detach(),L.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=O,e.features.collapsedNonEditableSelectionsSupported=H;var j,F=!1;L&&C.isHostMethod(L,"createControlRange")&&(j=L.createControlRange(),C.areHostProperties(j,["item","add"])&&(F=!0)),e.features.implementsControlRange=F,b=P?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var z;C.isHostMethod(I,"getRangeAt")?z=function(e,t){try{return e.getRangeAt(t)}catch(i){return null}}:P&&(z=function(t){var i=x.getDocument(t.anchorNode),n=e.createRange(i);return n.setStart(t.anchorNode,t.anchorOffset),n.setEnd(t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&(n.setStart(t.focusNode,t.focusOffset),n.setEnd(t.anchorNode,t.anchorOffset)),n}),e.getSelection=function(e){e=e||window;var t=e[w],i=y(e),o=M?n(e):null;return t?(t.nativeSelection=i,t.docSelection=o,t.refresh(e)):(t=new f(i,o,e),e[w]=t),t},e.getIframeSelection=function(t){return e.getSelection(x.getIframeWindow(t))};var Y=f.prototype;if(!A&&P&&C.areHostMethods(I,["removeAllRanges","addRange"])){Y.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),s(this)};var B=function(t,i){var n=T.getRangeDocument(i),o=e.createRange(n);o.collapseToPoint(i.endContainer,i.endOffset),t.nativeSelection.addRange(a(o)),t.nativeSelection.extend(i.startContainer,i.startOffset),t.refresh()};Y.addRange=W?function(t,i){if(F&&M&&this.docSelection.type==N)p(this,t);else if(i&&R)B(this,t);else{var n;if(O?n=this.rangeCount:(this.removeAllRanges(),n=0),this.nativeSelection.addRange(a(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==n+1){if(e.config.checkSelectionRanges){var r=z(this.nativeSelection,this.rangeCount-1);r&&!T.rangesEqual(r,t)&&(t=new k(r))}this._ranges[this.rangeCount-1]=t,o(this,t,G(this.nativeSelection)),this.isCollapsed=b(this)}else this.refresh()}}:function(e,t){t&&R?B(this,e):(this.nativeSelection.addRange(a(e)),this.refresh())},Y.setRanges=function(e){if(F&&e.length>1)m(this,e);else{this.removeAllRanges();for(var t=0,i=e.length;i>t;++t)this.addRange(e[t])}}}else{if(!(C.isHostMethod(I,"empty")&&C.isHostMethod($,"select")&&F&&A))return t.fail("No means of selecting a Range or TextRange was found"),!1;Y.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=x.getDocument(this.anchorNode);else if(this.docSelection.type==N){var t=this.docSelection.createRange();t.length&&(e=x.getDocument(t.item(0)).body.createTextRange())}if(e){var i=e.body.createTextRange();i.select(),this.docSelection.empty()}}}catch(n){}s(this)},Y.addRange=function(e){this.docSelection.type==N?p(this,e):(k.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,o(this,e,!1))},Y.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?m(this,e):t&&this.addRange(e[0])}}Y.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new S("INDEX_SIZE_ERR");return this._ranges[e]};var U;if(A)U=function(t){var i;e.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=x.getBody(t.win.document).createTextRange(),i.collapse(!0)),t.docSelection.type==N?h(t):d(i)?u(t,i):s(t)};else if(C.isHostMethod(I,"getRangeAt")&&"number"==typeof I.rangeCount)U=function(t){if(F&&M&&t.docSelection.type==N)h(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,n=t.rangeCount;n>i;++i)t._ranges[i]=new e.WrappedRange(t.nativeSelection.getRangeAt(i));o(t,t._ranges[t.rangeCount-1],G(t.nativeSelection)),t.isCollapsed=b(t)}else s(t)};else{if(!P||typeof I.isCollapsed!=_||typeof $.collapsed!=_||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;U=function(e){var t,i=e.nativeSelection;i.anchorNode?(t=z(i,0),e._ranges=[t],e.rangeCount=1,r(e),e.isCollapsed=b(e)):s(e)}}Y.refresh=function(e){var t=e?this._ranges.slice(0):null;if(U(this),e){var i=t.length;if(i!=this._ranges.length)return!1;for(;i--;)if(!T.rangesEqual(t[i],this._ranges[i]))return!1;return!0}};var q=function(e,t){var i=e.getAllRanges(),n=!1;e.removeAllRanges();for(var o=0,r=i.length;r>o;++o)n||t!==i[o]?e.addRange(i[o]):n=!0;e.rangeCount||s(e)};Y.removeRange=F?function(e){if(this.docSelection.type==N){for(var t,i=this.docSelection.createRange(),n=c(e),o=x.getDocument(i.item(0)),r=x.getBody(o).createControlRange(),s=!1,a=0,l=i.length;l>a;++a)t=i.item(a),t!==n||s?r.add(i.item(a)):s=!0;r.select(),h(this)}else q(this,e)}:function(e){q(this,e)};var G;!A&&P&&e.features.implementsDomRange?(G=function(e){var t=!1;return e.anchorNode&&(t=1==x.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},Y.isBackwards=function(){return G(this)}):G=Y.isBackwards=function(){return!1},Y.toString=function(){for(var e=[],t=0,i=this.rangeCount;i>t;++t)e[t]=""+this._ranges[t];return e.join("")},Y.collapse=function(t,i){g(this,t);var n=e.createRange(x.getDocument(t));n.collapseToPoint(t,i),this.removeAllRanges(),this.addRange(n),this.isCollapsed=!0},Y.collapseToStart=function(){if(!this.rangeCount)throw new S("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Y.collapseToEnd=function(){if(!this.rangeCount)throw new S("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Y.selectAllChildren=function(t){g(this,t);var i=e.createRange(x.getDocument(t));i.selectNodeContents(t),this.removeAllRanges(),this.addRange(i)},Y.deleteFromDocument=function(){if(F&&M&&this.docSelection.type==N){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var i=this.getAllRanges();this.removeAllRanges();for(var n=0,o=i.length;o>n;++n)i[n].deleteContents();this.addRange(i[o-1])}},Y.getAllRanges=function(){return this._ranges.slice(0)},Y.setSingleRange=function(e){this.setRanges([e])},Y.containsNode=function(e,t){for(var i=0,n=this._ranges.length;n>i;++i)if(this._ranges[i].containsNode(e,t))return!0;return!1},Y.toHtml=function(){var e="";if(this.rangeCount){for(var t=T.getRangeDocument(this._ranges[0]).createElement("div"),i=0,n=this._ranges.length;n>i;++i)t.appendChild(this._ranges[i].cloneContents());e=t.innerHTML}return e},Y.getName=function(){return"WrappedSelection"},Y.inspect=function(){return v(this)},Y.detach=function(){this.win[w]=null,this.win=this.anchorNode=this.focusNode=null},f.inspect=v,e.Selection=f,e.selectionPrototype=Y,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})});/*
 Base.js, version 1.1a
 Copyright 2006-2010, Dean Edwards
 License: http://www.opensource.org/licenses/mit-license.php
 */
var Base=function(){};Base.extend=function(e,t){var i=Base.prototype.extend;Base._prototyping=!0;var n=new this;i.call(n,e),n.base=function(){},delete Base._prototyping;var o=n.constructor,r=n.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==r)this._constructing=!0,o.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||i).call(arguments[0],n)};return r.ancestor=this,r.extend=this.extend,r.forEach=this.forEach,r.implement=this.implement,r.prototype=n,r.toString=this.toString,r.valueOf=function(e){return"object"==e?r:o.valueOf()},i.call(r,t),"function"==typeof r.init&&r.init(),r},Base.prototype={extend:function(e,t){if(arguments.length>1){var i=this[e];if(i&&"function"==typeof t&&(!i.valueOf||i.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var n=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=i;var t=n.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return"object"==e?t:n},t.toString=Base.toString}this[e]=t}else if(e){var o=Base.prototype.extend;Base._prototyping||"function"==typeof this||(o=this.extend||o);for(var r={toSource:null},s=["constructor","toString","valueOf"],a=Base._prototyping?0:1;l=s[a++];)e[l]!=r[l]&&o.call(this,l,e[l]);for(var l in e)r[l]||o.call(this,l,e[l])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,i){for(var n in e)void 0===this.prototype[n]&&t.call(i,e[n],n,e)},implement:function(){for(var e=0;arguments.length>e;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function e(e){return(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[,0])[1]}var t=navigator.userAgent,i=document.createElement("div"),n=-1!==t.indexOf("MSIE")&&-1===t.indexOf("Opera"),o=-1!==t.indexOf("Gecko")&&-1===t.indexOf("KHTML"),r=-1!==t.indexOf("AppleWebKit/"),s=-1!==t.indexOf("Chrome/"),a=-1!==t.indexOf("Opera/");return{USER_AGENT:t,supported:function(){var t=this.USER_AGENT.toLowerCase(),n="contentEditable"in i,o=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,r=document.querySelector&&document.querySelectorAll,s=this.isIos()&&5>e(t)||-1!==t.indexOf("opera mobi")||-1!==t.indexOf("hpwos/");return n&&o&&r&&!s},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var e=this.USER_AGENT.toLowerCase();return-1!==e.indexOf("webkit")&&-1!==e.indexOf("mobile")},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!o},hasCurrentStyleProperty:function(){return"currentStyle"in i},insertsLineBreaksOnReturn:function(){return o},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in i||function(){return i.setAttribute("on"+e,"return;"),"function"==typeof i["on"+e]}()},supportsEventsInIframeCorrectly:function(){return!a},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return r||o},supportsDataTransfer:function(){try{return r&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(e){return!1}},supportsHTML5Tags:function(e){var t=e.createElement("div"),i="<article>foo</article>";return t.innerHTML=i,t.innerHTML.toLowerCase()===i},supportsCommand:function(){var e={formatBlock:n,insertUnorderedList:n||a||r,insertOrderedList:n||a||r},t={insertHTML:o};return function(i,n){var o=e[n];if(!o){try{return i.queryCommandSupported(n)}catch(r){}try{return i.queryCommandEnabled(n)}catch(s){return!!t[n]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return o||a||r},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return"1"!=e.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return o||n||a},clearsListsInContentEditableCorrectly:function(){return o||n||r},autoScrollsToCaret:function(){return!r},autoClosesUnclosedTags:function(){var e,t,n=i.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in i},needsSpaceAfterLineBreak:function(){return a},supportsSpeechApiOn:function(e){var i=t.match(/Chrome\/(\d+)/)||[,0];return i[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return n&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return n},hasProblemsSettingCaretAfterImg:function(){return n},hasUndoInContextMenu:function(){return o||s||a}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(e.indexOf)return-1!==e.indexOf(t);for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return!0;return!1},without:function(t){t=wysihtml5.lang.array(t);for(var i=[],n=0,o=e.length;o>n;n++)t.contains(e[n])||i.push(e[n]);return i},get:function(){for(var t=0,i=e.length,n=[];i>t;t++)n.push(e[t]);return n}}},wysihtml5.lang.Dispatcher=Base.extend({observe:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(e,t){this.events=this.events||{};for(var i=this.events[e]||[],n=0;i.length>n;n++)i[n].call(this,t);return this},stopObserving:function(e,t){this.events=this.events||{};var i,n,o=0;if(e){for(i=this.events[e]||[],n=[];i.length>o;o++)i[o]!==t&&t&&n.push(i[o]);this.events[e]=n}else this.events={};return this}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var i in t)e[i]=t[i];return this},get:function(){return e},clone:function(){var t,i={};for(t in e)i[t]=e[t];return i},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)}}},function(){var e=/^\s+/,t=/\s+$/;wysihtml5.lang.string=function(i){return i=String(i),{trim:function(){return i.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)i=this.replace("#{"+t+"}").by(e[t]);return i},replace:function(e){return{by:function(t){return i.split(e).join(t)}}}}}}(),function(e){function t(e){return r(e)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),s(e))}function i(e){return e.replace(l,function(e,t){var i=(t.match(c)||[])[1]||"",n=u[i];t=t.replace(c,""),t.split(n).length>t.split(i).length&&(t+=i,i="");var o=t,r=t;return t.length>d&&(r=r.substr(0,d)+"..."),"www."===o.substr(0,4)&&(o="http://"+o),'<a href="'+o+'">'+r+"</a>"+i})}function n(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function o(e){var t=e.parentNode,o=n(t.ownerDocument);for(o.innerHTML="<span></span>"+i(e.data),o.removeChild(o.firstChild);o.firstChild;)t.insertBefore(o.firstChild,e);t.removeChild(e)}function r(e){for(var t;e.parentNode;){if(e=e.parentNode,t=e.nodeName,a.contains(t))return!0;if("body"===t)return!1}return!1}function s(t){if(!a.contains(t.nodeName)){if(t.nodeType===e.TEXT_NODE&&t.data.match(l))return o(t),void 0;for(var i=e.lang.array(t.childNodes).get(),n=i.length,r=0;n>r;r++)s(i[r]);return t}}var a=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),l=/((https?:\/\/|www\.)[^\s<]{3,})/gi,c=/([^\w\/\-](,?))$/i,d=100,u={")":"(","]":"[","}":"{"};e.dom.autoLink=t,e.dom.autoLink.URL_REG_EXP=l}(wysihtml5),function(e){var t=e.browser.supportsClassList(),i=e.dom;i.addClass=function(e,n){return t?e.classList.add(n):(i.hasClass(e,n)||(e.className+=" "+n),void 0)},i.removeClass=function(e,i){return t?e.classList.remove(i):(e.className=e.className.replace(new RegExp("(^|\\s+)"+i+"(\\s+|$)")," "),void 0)},i.hasClass=function(e,i){if(t)return e.classList.contains(i);var n=e.className;return n.length>0&&(n==i||new RegExp("(^|\\s)"+i+"(\\s|$)").test(n))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),wysihtml5.dom.convertToList=function(){function e(e,t){var i=e.createElement("li");return t.appendChild(i),i}function t(e,t){return e.createElement(t)}function i(i,n){if("UL"===i.nodeName||"OL"===i.nodeName||"MENU"===i.nodeName)return i;var o,r,s,a,l,c,d,u,h,p=i.ownerDocument,f=t(p,n),m=i.querySelectorAll("br"),g=m.length;for(h=0;g>h;h++)for(a=m[h];(l=a.parentNode)&&l!==i&&l.lastChild===a;){if("block"===wysihtml5.dom.getStyle("display").from(l)){l.removeChild(a);break}wysihtml5.dom.insert(a).after(a.parentNode)}for(o=wysihtml5.lang.array(i.childNodes).get(),r=o.length,h=0;r>h;h++)u=u||e(p,f),s=o[h],c="block"===wysihtml5.dom.getStyle("display").from(s),d="BR"===s.nodeName,c?(u=u.firstChild?e(p,f):u,u.appendChild(s),u=null):d?u=u.firstChild?null:u:u.appendChild(s);return i.parentNode.replaceChild(f,i),f}return i}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(i){for(var n,o=0,r=e.length;r>o;o++)n=e[o],"undefined"!=typeof t[n]&&""!==t[n]&&(i[n]=t[n]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],i=function(t){return n(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},n=function(i){for(var n=0,o=t.length;o>n;n++)if("border-box"===e.getStyle(t[n]).from(i))return t[n]};e.copyStyles=function(n){return{from:function(o){i(o)&&(n=wysihtml5.lang.array(n).without(t));for(var r,s="",a=n.length,l=0;a>l;l++)r=n[l],s+=r+":"+e.getStyle(r).from(o)+";";return{to:function(t){return e.setStyles(s).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,i,n,o){return e.dom.observe(t,n,function(n){for(var r=n.target,s=e.lang.array(t.querySelectorAll(i));r&&r!==t;){if(s.contains(r)){o.call(r,n);break}r=r.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var i=t.createElement("div");i.style.display="none",t.body.appendChild(i);try{i.innerHTML=e}catch(n){}return t.body.removeChild(i),i},t=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,n=i.length;n>t;t++)e.createElement(i[t]);e._wysihtml5_supportsHTML5Tags=!0}},i=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(i,n){n=n||document;var o;return"object"==typeof i&&i.nodeType?(o=n.createElement("div"),o.appendChild(i)):wysihtml5.browser.supportsHTML5Tags(n)?(o=n.createElement("div"),o.innerHTML=i):(t(n),o=e(i,n)),o}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return t&&t.length?"string"==typeof t?e===t:wysihtml5.lang.array(t).contains(e):!0}function t(e){return e.nodeType===wysihtml5.ELEMENT_NODE}function i(e,t,i){var n=(e.className||"").match(i)||[];return t?n[n.length-1]===t:!!n.length}function n(t,i,n){for(;n--&&t&&"BODY"!==t.nodeName;){if(e(t.nodeName,i))return t;t=t.parentNode}return null}function o(n,o,r,s,a){for(;a--&&n&&"BODY"!==n.nodeName;){if(t(n)&&e(n.nodeName,o)&&i(n,r,s))return n;n=n.parentNode}return null}return function(e,t,i){return i=i||50,t.className||t.classRegExp?o(e,t.nodeName,t.className,t.classRegExp,i):n(e,t.nodeName,i)}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(i,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},i=/\-[a-z]/g;return function(i){return{from:function(n){if(n.nodeType===wysihtml5.ELEMENT_NODE){var o=n.ownerDocument,r=t[i]||e(i),s=n.style,a=n.currentStyle,l=s[r];if(l)return l;if(a)try{return a[r]}catch(c){}var d,u,h=o.defaultView||o.parentWindow,p=("height"===i||"width"===i)&&"TEXTAREA"===n.nodeName;return h.getComputedStyle?(p&&(d=s.overflow,s.overflow="hidden"),u=h.getComputedStyle(n,null).getPropertyValue(i),p&&(s.overflow=d||""),u):void 0}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){function e(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=i++)}var t={},i=1;return function(i,n){var o=e(i)+":"+n,r=t[o];return r||(r=t[o]=i.getElementsByTagName(n)),r.length>0}}(),function(e){function t(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var i={},n=1;e.dom.hasElementWithClassName=function(n,o){if(!e.browser.supportsNativeGetElementsByClassName())return!!n.querySelector("."+o);var r=t(n)+":"+o,s=i[r];return s||(s=i[r]=n.getElementsByClassName(o)),s.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var i=t.head||t.getElementsByTagName("head")[0],n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(t.createTextNode(e)),i&&i.appendChild(n)}}},wysihtml5.dom.observe=function(e,t,i){t="string"==typeof t?[t]:t;for(var n,o,r=0,s=t.length;s>r;r++)o=t[r],e.addEventListener?e.addEventListener(o,i,!1):(n=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},i.call(e,t)},e.attachEvent("on"+o,n));return{stop:function(){for(var o,r=0,s=t.length;s>r;r++)o=t[r],e.removeEventListener?e.removeEventListener(o,i,!1):e.detachEvent("on"+o,n)}}},wysihtml5.dom.parse=function(){function e(e,i,n,o){wysihtml5.lang.object(u).merge(d).merge(i).get(),n=n||e.ownerDocument||document;var r,s,a,l=n.createDocumentFragment(),c="string"==typeof e;for(r=c?wysihtml5.dom.getAsDom(e,n):e;r.firstChild;)a=r.firstChild,r.removeChild(a),s=t(a,o),s&&l.appendChild(s);return r.innerHTML="",r.appendChild(l),c?wysihtml5.quirks.getCorrectInnerHTML(r):r}function t(e,i){var n,o=e.nodeType,r=e.childNodes,s=r.length,c=a[o],d=0;if(n=c&&c(e),!n)return null;for(d=0;s>d;d++)newChild=t(r[d],i),newChild&&n.appendChild(newChild);return i&&1>=n.childNodes.length&&n.nodeName.toLowerCase()===l&&!n.attributes.length?n.firstChild:n}function i(e){var t,i,o=u.tags,r=e.nodeName.toLowerCase(),s=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;if(s&&"HTML"!=s&&(r=s+":"+r),"outerHTML"in e&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(r="div")),r in o){if(t=o[r],!t||t.remove)return null;t="string"==typeof t?{rename_tag:t}:t}else{if(!e.firstChild)return null;t={rename_tag:l}}return i=e.ownerDocument.createElement(t.rename_tag||r),n(e,i,t),e=null,i}function n(e,t,i){var n,r,s,a,l,d,h,m={},g=i.set_class,v=i.add_class,y=i.set_attributes,b=i.check_attributes,_=u.classes,w=0,x=[],C=[],T=[],k=[];if(y&&(m=wysihtml5.lang.object(y).clone()),b)for(l in b)h=p[b[l]],h&&(d=h(o(e,l)),"string"==typeof d&&(m[l]=d));if(g&&x.push(g),v)for(l in v)h=f[v[l]],h&&(a=h(o(e,l)),"string"==typeof a&&x.push(a));for(_["_wysihtml5-temp-placeholder"]=1,k=e.getAttribute("class"),k&&(x=x.concat(k.split(c))),n=x.length;n>w;w++)s=x[w],_[s]&&C.push(s);for(r=C.length;r--;)s=C[r],wysihtml5.lang.array(T).contains(s)||T.unshift(s);T.length&&(m["class"]=T.join(" "));for(l in m)try{t.setAttribute(l,m[l])}catch(S){}m.src&&("undefined"!=typeof m.width&&t.setAttribute("width",m.width),"undefined"!=typeof m.height&&t.setAttribute("height",m.height))}function o(e,t){t=t.toLowerCase();var i=e.nodeName;if("IMG"==i&&"src"==t&&r(e)===!0)return e.src;if(h&&"outerHTML"in e){var n=e.outerHTML.toLowerCase(),o=-1!=n.indexOf(" "+t+"=");return o?e.getAttribute(t):null}return e.getAttribute(t)}function r(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}}function s(e){return e.ownerDocument.createTextNode(e.data)}var a={1:i,3:s},l="span",c=/\s+/,d={tags:{},classes:{}},u={},h=!wysihtml5.browser.supportsGetAttributeCorrectly(),p={url:function(){var e=/^https?:\/\//i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(e,""):""}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}()},f={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[String(t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[String(t).charAt(0)]}}()};return e}(),wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t,i=wysihtml5.lang.array(e.childNodes).get(),n=i.length,o=0;n>o;o++)t=i[o],t.nodeType===wysihtml5.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){for(var i,n=e.ownerDocument.createElement(t);i=e.firstChild;)n.appendChild(i);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(n),e.parentNode.replaceChild(n,e),n},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode){if(!e.firstChild)return e.parentNode.removeChild(e),void 0;for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function i(e){return"BR"===e.nodeName}function n(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function o(e){if("MENU"===e.nodeName||"UL"===e.nodeName||"OL"===e.nodeName){var o,r,s,a,l,c=e.ownerDocument,d=c.createDocumentFragment(),u=e.previousElementSibling||e.previousSibling;for(u&&!t(u)&&n(d);l=e.firstChild;){for(r=l.lastChild;o=l.firstChild;)s=o===r,a=s&&!t(o)&&!i(o),d.appendChild(o),a&&n(d);l.parentNode.removeChild(l)}e.parentNode.replaceChild(d,e)}}e.resolveList=o}(wysihtml5.dom),function(e){var t=document,i=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],n=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],o=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,i){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(i).get(),this.iframe=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var i=this,n=t.createElement("iframe");return n.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(n),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(n.src="javascript:'<html></html>'"),n.onload=function(){n.onreadystatechange=n.onload=null,i._onLoadIframe(n)},n.onreadystatechange=function(){/loaded|complete/.test(n.readyState)&&(n.onreadystatechange=n.onload=null,i._onLoadIframe(n))},n},_onLoadIframe:function(r){if(e.dom.contains(t.documentElement,r)){var s=this,a=r.contentWindow,l=r.contentWindow.document,c=t.characterSet||t.charset||"utf-8",d=this._getHtml({charset:c,stylesheets:this.config.stylesheets});if(l.open("text/html","replace"),l.write(d),l.close(),this.getWindow=function(){return r.contentWindow},this.getDocument=function(){return r.contentWindow.document},a.onerror=function(e,t,i){throw new Error("wysihtml5.Sandbox: "+e,t,i)},!e.browser.supportsSandboxedIframes()){var u,h;for(u=0,h=i.length;h>u;u++)this._unset(a,i[u]);for(u=0,h=n.length;h>u;u++)this._unset(a,n[u],e.EMPTY_FUNCTION);for(u=0,h=o.length;h>u;u++)this._unset(l,o[u]);this._unset(l,"cookie","",!0)}this.loaded=!0,setTimeout(function(){s.callback(s)},0)}},_getHtml:function(t){var i,n=t.stylesheets,o="",r=0;if(n="string"==typeof n?[n]:n)for(i=n.length;i>r;r++)o+='<link rel="stylesheet" href="'+n[r]+'">';return t.stylesheets=o,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,i,n,o){try{t[i]=n}catch(r){}try{t.__defineGetter__(i,function(){return n})}catch(r){}if(o)try{t.__defineSetter__(i,function(){})}catch(r){}if(!e.browser.crashesWhenDefineProperty(i))try{var s={get:function(){return n}};o&&(s.set=function(){}),Object.defineProperty(t,i,s)}catch(r){}}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(i){for(var n in t)i.setAttribute(e[n]||n,t[n])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var i=t.style;if("string"==typeof e)return i.cssText+=";"+e,void 0;for(var n in e)"float"===n?(i.cssFloat=e[n],i.styleFloat=e[n]):i[n]=e[n]}}},function(e){e.simulatePlaceholder=function(t,i,n){var o="placeholder",r=function(){i.hasPlaceholderSet()&&i.clear(),e.removeClass(i.element,o)},s=function(){i.isEmpty()&&(i.setValue(n),e.addClass(i.element,o))};t.observe("set_placeholder",s).observe("unset_placeholder",r).observe("focus:composer",r).observe("paste:composer",r).observe("blur:composer",s),s()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){function e(e,i,n){i=i||t,n=n||e.ownerDocument||document;var o,r,s,a,l,c="string"==typeof e,d=0;o=c?wysihtml5.dom.getAsDom(e,n):e;for(l in i)for(s=o.querySelectorAll(l),r=i[l],a=s.length;a>d;d++)r(s[d]);return s=e=i=null,c?o.innerHTML:o}var t={"a u":wysihtml5.dom.replaceWithChildNodes};return e}(),function(e){var t=e.dom;e.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)&&(e.innerHTML="")},0)};return function(i){t.observe(i.element,["cut","keydown"],e)}}(),e.quirks.ensureProperClearingOfLists=function(){var i=["OL","UL","MENU"],n=function(n,o){if(o.firstChild&&e.lang.array(i).contains(o.firstChild.nodeName)){var r=t.getParentElement(n,{nodeName:i});if(r){var s=r==o.firstChild;if(s){var a=1>=r.childNodes.length;if(a){var l=r.firstChild?""===r.firstChild.innerHTML:!0;l&&r.parentNode.removeChild(r)}}}}};return function(i){t.observe(i.element,"keydown",function(t){if(t.keyCode===e.BACKSPACE_KEY){var o=i.selection.getSelectedNode();n(o,i.element)}})}}()}(wysihtml5),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(i){var n=i.innerHTML;if(-1===n.indexOf(t))return n;var o,r,s,a,l=i.querySelectorAll("[href*='~'], [src*='~']");for(a=0,s=l.length;s>a;a++)o=l[a].href||l[a].src,r=e.lang.string(o).replace("~").by(t),n=e.lang.string(n).replace(r).by(o);return n}}(wysihtml5),function(e){var t=e.dom,i=["LI","P","H1","H2","H3","H4","H5","H6"],n=["UL","OL","MENU"];e.quirks.insertLineBreakOnReturn=function(o){function r(i){var n=t.getParentElement(i,{nodeName:["P","DIV"]},2);if(n){var r=document.createTextNode(e.INVISIBLE_SPACE);t.insert(r).before(n),t.replaceWithChildNodes(n),o.selection.selectNode(r)}}function s(s){var a=s.keyCode;if(!(s.shiftKey||a!==e.ENTER_KEY&&a!==e.BACKSPACE_KEY)){var l=(s.target,o.selection.getSelectedNode()),c=t.getParentElement(l,{nodeName:i},4);return c?("LI"!==c.nodeName||a!==e.ENTER_KEY&&a!==e.BACKSPACE_KEY?c.nodeName.match(/H[1-6]/)&&a===e.ENTER_KEY&&setTimeout(function(){r(o.selection.getSelectedNode())},0):setTimeout(function(){var e,i=o.selection.getSelectedNode();i&&(e=t.getParentElement(i,{nodeName:n},2),e||r(i))},0),void 0):(a!==e.ENTER_KEY||e.browser.insertsLineBreaksOnReturn()||(o.commands.exec("insertLineBreak"),s.preventDefault()),void 0)}}t.observe(o.element.ownerDocument,"keydown",s)}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(i){e.dom.addClass(i,t),e.dom.removeClass(i,t);try{var n=i.ownerDocument;n.execCommand("italic",!1,null),n.execCommand("italic",!1,null)}catch(o){}}}(wysihtml5),function(e){function t(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}var i=e.dom;e.Selection=Base.extend({constructor:function(e){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(t){var n=rangy.createRange(this.doc),o=t.nodeType===e.ELEMENT_NODE,r="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,s=o?t.innerHTML:t.data,a=""===s||s===e.INVISIBLE_SPACE,l=i.getStyle("display").from(t),c="block"===l||"list-item"===l;if(a&&o&&r)try{t.innerHTML=e.INVISIBLE_SPACE}catch(d){}r?n.selectNodeContents(t):n.selectNode(t),r&&a&&o?n.collapse(c):r&&a&&(n.setStartAfter(t),n.setEndAfter(t)),this.setSelection(n)},getSelectedNode:function(e){var t,i;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(i=this.doc.selection.createRange(),i&&i.length)?i.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(i=this.getRange(this.doc),i?i.commonAncestorContainer:this.doc.body))},executeAndRestore:function(t,i){var n,o=this.doc.body,r=i&&o.scrollTop,s=i&&o.scrollLeft,a="_wysihtml5-temp-placeholder",l='<span class="'+a+'">'+e.INVISIBLE_SPACE+"</span>",c=this.getRange(this.doc);if(!c)return t(o,o),void 0;var d=c.createContextualFragment(l);c.insertNode(d);try{t(c.startContainer,c.endContainer)}catch(u){setTimeout(function(){throw u},0)}caretPlaceholder=this.doc.querySelector("."+a),caretPlaceholder?(n=rangy.createRange(this.doc),n.selectNode(caretPlaceholder),n.deleteContents(),this.setSelection(n)):o.focus(),i&&(o.scrollTop=r,o.scrollLeft=s);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(h){}},executeAndRestoreSimple:function(e){var t,i,n,o,r,s=this.getRange(),a=this.doc.body;if(!s)return e(a,a),void 0;o=s.getNodes([3]),i=o[0]||s.startContainer,n=o[o.length-1]||s.endContainer,r={collapsed:s.collapsed,startContainer:i,startOffset:i===s.startContainer?s.startOffset:0,endContainer:n,endOffset:n===s.endContainer?s.endOffset:n.length};try{e(s.startContainer,s.endContainer)}catch(l){setTimeout(function(){throw l},0)}t=rangy.createRange(this.doc);try{t.setStart(r.startContainer,r.startOffset)}catch(c){}try{t.setEnd(r.endContainer,r.endOffset)}catch(d){}try{this.setSelection(t)}catch(u){}},insertHTML:function(e){var t=rangy.createRange(this.doc),i=t.createContextualFragment(e),n=i.lastChild;this.insertNode(i),n&&this.setAfter(n)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t=this.getRange();if(t)try{t.surroundContents(e),this.selectNode(e)}catch(i){e.appendChild(t.extractContents()),t.insertNode(e)}},scrollIntoView:function(){var i,n=this.doc,o=n.documentElement.scrollHeight>n.documentElement.offsetHeight,r=n._wysihtml5ScrollIntoViewElement=n._wysihtml5ScrollIntoViewElement||function(){var t=n.createElement("span");return t.innerHTML=e.INVISIBLE_SPACE,t}();o&&(this.insertNode(r),i=t(r),r.parentNode.removeChild(r),i>n.body.scrollTop&&(n.body.scrollTop=i))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView,t=e.getSelection();t.modify("extend","left","lineboundary"),t.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e,t,i,n,o,r=this.doc.selection.createRange(),s=r.boundingTop,a=(r.boundingHeight,this.doc.body.scrollWidth);if(r.moveToPoint){for(0===s&&(i=this.doc.createElement("span"),this.insertNode(i),s=i.offsetTop,i.parentNode.removeChild(i)),s+=1,n=-10;a>n;n+=2)try{r.moveToPoint(n,s);break}catch(l){}for(e=s,t=this.doc.selection.createRange(),o=a;o>=0;o--)try{t.moveToPoint(o,e);break}catch(c){}r.setEndPoint("EndToEnd",t),r.select()}},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var i=this.getRange();return i?i.getNodes([e],t):[]},getRange:function(){var e=this.getSelection();return e&&e.rangeCount&&e.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow,i=rangy.getSelection(t);return i.setSingleRange(e)}})}(wysihtml5),function(e,t){function i(e,t,i){if(!e.className)return!1;var n=e.className.match(i)||[];return n[n.length-1]===t}function n(e,t,i){e.className?(o(e,i),e.className+=" "+t):e.className=t}function o(e,t){e.className&&(e.className=e.className.replace(t,""))}function r(e,t){return e.className.replace(p," ")==t.className.replace(p," ")}function s(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}function a(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var i,n,o,r=0,s=e.attributes.length;s>r;++r)if(i=e.attributes[r],o=i.name,"class"!=o){if(n=t.attributes.getNamedItem(o),i.specified!=n.specified)return!1;if(i.specified&&i.nodeValue!==n.nodeValue)return!1}return!0}function l(e,i){return t.dom.isCharacterDataNode(e)?0==i?!!e.previousSibling:i==e.length?!!e.nextSibling:!0:i>0&&e.childNodes.length>i}function c(e,i,n){var o;if(t.dom.isCharacterDataNode(i)&&(0==n?(n=t.dom.getNodeIndex(i),i=i.parentNode):n==i.length?(n=t.dom.getNodeIndex(i)+1,i=i.parentNode):o=t.dom.splitDataNode(i,n)),!o){o=i.cloneNode(!1),o.id&&o.removeAttribute("id");for(var r;r=i.childNodes[n];)o.appendChild(r);t.dom.insertAfter(o,i)}return i==e?o:c(e,o.parentNode,t.dom.getNodeIndex(o))}function d(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function u(e,t,i,n){this.tagNames=e||[h],this.cssClass=t||"",this.similarClassRegExp=i,this.normalize=n,this.applyToAnyTagName=!1}var h="span",p=/\s+/g;d.prototype={doMerge:function(){for(var e,t,i,n=[],o=0,r=this.textNodes.length;r>o;++o)e=this.textNodes[o],t=e.parentNode,n[o]=e.data,o&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=i=n.join(""),i},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,i=this.textNodes.length;i>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},u.prototype={getAncestorWithClass:function(n){for(var o;n;){if(o=this.cssClass?i(n,this.cssClass,this.similarClassRegExp):!0,n.nodeType==e.ELEMENT_NODE&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&o)return n;n=n.parentNode}return!1},postApply:function(e,t){for(var i,n,o,r=e[0],s=e[e.length-1],a=[],l=r,c=s,u=0,h=s.length,p=0,f=e.length;f>p;++p)n=e[p],o=this.getAdjacentMergeableTextNode(n.parentNode,!1),o?(i||(i=new d(o),a.push(i)),i.textNodes.push(n),n===r&&(l=i.firstTextNode,u=l.length),n===s&&(c=i.firstTextNode,h=i.getLength())):i=null;
var m=this.getAdjacentMergeableTextNode(s.parentNode,!0);if(m&&(i||(i=new d(s),a.push(i)),i.textNodes.push(m)),a.length){for(p=0,f=a.length;f>p;++p)a[p].doMerge();t.setStart(l,u),t.setEnd(c,h)}},getAdjacentMergeableTextNode:function(t,i){var n,o=t.nodeType==e.TEXT_NODE,r=o?t.parentNode:t,s=i?"nextSibling":"previousSibling";if(o){if(n=t[s],n&&n.nodeType==e.TEXT_NODE)return n}else if(n=r[s],n&&this.areElementsMergeable(t,n))return n[i?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,i){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase())&&r(e,i)&&a(e,i)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),t},applyToTextNode:function(e){var i=e.parentNode;if(1==i.childNodes.length&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase()))this.cssClass&&n(i,this.cssClass,this.similarClassRegExp);else{var o=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(o,e),o.appendChild(e)}},isRemovable:function(i){return t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&e.lang.string(i.className).trim()==this.cssClass},undoToTextNode:function(e,t,i){if(!t.containsNode(i)){var n=t.cloneRange();n.selectNode(i),n.isPointInRange(t.endContainer,t.endOffset)&&l(t.endContainer,t.endOffset)&&(c(i,t.endContainer,t.endOffset),t.setEndAfter(i)),n.isPointInRange(t.startContainer,t.startOffset)&&l(t.startContainer,t.startOffset)&&(i=c(i,t.startContainer,t.startOffset))}this.similarClassRegExp&&o(i,this.similarClassRegExp),this.isRemovable(i)&&s(i)},applyToRange:function(t){var i=t.getNodes([e.TEXT_NODE]);if(!i.length)try{var n=this.createContainer(t.endContainer.ownerDocument);return t.surroundContents(n),this.selectNode(t,n),void 0}catch(o){}if(t.splitBoundaries(),i=t.getNodes([e.TEXT_NODE]),i.length){for(var r,s=0,a=i.length;a>s;++s)r=i[s],this.getAncestorWithClass(r)||this.applyToTextNode(r);t.setStart(i[0],0),r=i[i.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(i,t)}},undoToRange:function(t){var i,n,o=t.getNodes([e.TEXT_NODE]);if(o.length)t.splitBoundaries(),o=t.getNodes([e.TEXT_NODE]);else{var r=t.endContainer.ownerDocument,s=r.createTextNode(e.INVISIBLE_SPACE);t.insertNode(s),t.selectNode(s),o=[s]}for(var a=0,l=o.length;l>a;++a)i=o[a],n=this.getAncestorWithClass(i),n&&this.undoToTextNode(i,t,n);1==l?this.selectNode(t,o[0]):(t.setStart(o[0],0),i=o[o.length-1],t.setEnd(i,i.length),this.normalize&&this.postApply(o,t))},selectNode:function(t,i){var n=i.nodeType===e.ELEMENT_NODE,o="canHaveHTML"in i?i.canHaveHTML:!0,r=n?i.innerHTML:i.data,s=""===r||r===e.INVISIBLE_SPACE;if(s&&n&&o)try{i.innerHTML=e.INVISIBLE_SPACE}catch(a){}t.selectNodeContents(i),s&&n?t.collapse(!1):s&&(t.setStartAfter(i),t.setEndAfter(i))},getTextSelectedByRange:function(e,t){var i=t.cloneRange();i.selectNodeContents(e);var n=i.intersection(t),o=n?n.toString():"";return i.detach(),o},isAppliedToRange:function(t){var i,n=[],o=t.getNodes([e.TEXT_NODE]);if(!o.length)return i=this.getAncestorWithClass(t.startContainer),i?[i]:!1;for(var r,s=0,a=o.length;a>s;++s){if(r=this.getTextSelectedByRange(o[s],t),i=this.getAncestorWithClass(o[s]),""!=r&&!i)return!1;n.push(i)}return n},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)}},e.selection.HTMLApplier=u}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var i=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),o=i&&i.exec,r=null;if(this.editor.fire("beforecommand:composer"),o)n.unshift(this.composer),r=o.apply(i,n);else try{r=this.doc.execCommand(e,!1,t)}catch(s){}return this.editor.fire("aftercommand:composer"),r},state:function(e){var t=wysihtml5.commands[e],i=wysihtml5.lang.array(arguments).get(),n=t&&t.state;if(n)return i.unshift(this.composer),n.apply(t,i);try{return this.doc.queryCommandState(e)}catch(o){return!1}},value:function(e){var t=wysihtml5.commands[e],i=t&&t.value;if(i)return i.call(t,this.composer,e);try{return this.doc.queryCommandValue(e)}catch(n){return null}}}),function(e){var t;e.commands.bold={exec:function(t,i){return e.commands.formatInline.exec(t,i,"b")},state:function(t,i){return e.commands.formatInline.state(t,i,"b")},value:function(){return t}}}(wysihtml5),function(e){function t(e,t){for(var i,n,o,s=t.length,a=0;s>a;a++)i=t[a],n=r.getParentElement(i,{nodeName:"code"}),o=r.getTextContent(i),o.match(r.autoLink.URL_REG_EXP)&&!n?n=r.renameElement(i,"code"):r.replaceWithChildNodes(i)}function i(t,i){var s,a,l,c,d,u,h,p,f,m=t.doc,g="_wysihtml5-temp-"+ +new Date,v=/non-matching-class/g,y=0;for(e.commands.formatInline.exec(t,n,o,g,v),a=m.querySelectorAll(o+"."+g),s=a.length;s>y;y++){l=a[y],l.removeAttribute("class");for(f in i)l.setAttribute(f,i[f])}u=l,1===s&&(h=r.getTextContent(l),c=!!l.querySelector("*"),d=""===h||h===e.INVISIBLE_SPACE,!c&&d&&(r.setTextContent(l,i.text||l.href),p=m.createTextNode(" "),t.selection.setAfter(l),t.selection.insertNode(p),u=p)),t.selection.setAfter(u)}var n,o="A",r=e.dom;e.commands.createLink={exec:function(e,n,o){var r=this.state(e,n);r?e.selection.executeAndRestore(function(){t(e,r)}):(o="object"==typeof o?o:{href:o},i(e,o))},state:function(t,i){return e.commands.formatInline.state(t,i,"A")},value:function(){return n}}}(wysihtml5),function(e){var t,i=/wysiwyg-font-size-[a-z\-]+/g;e.commands.fontSize={exec:function(t,n,o){return e.commands.formatInline.exec(t,n,"span","wysiwyg-font-size-"+o,i)},state:function(t,n,o){return e.commands.formatInline.state(t,n,"span","wysiwyg-font-size-"+o,i)},value:function(){return t}}}(wysihtml5),function(e){var t,i=/wysiwyg-color-[a-z]+/g;e.commands.foreColor={exec:function(t,n,o){return e.commands.formatInline.exec(t,n,"span","wysiwyg-color-"+o,i)},state:function(t,n,o){return e.commands.formatInline.state(t,n,"span","wysiwyg-color-"+o,i)},value:function(){return t}}}(wysihtml5),function(e){function t(e,t,n){e.className?(i(e,n),e.className+=" "+t):e.className=t}function i(e,t){e.className=e.className.replace(t,"")}function n(t){return t.nodeType===e.TEXT_NODE&&!e.lang.string(t.data).trim()}function o(e){for(var t=e.previousSibling;t&&n(t);)t=t.previousSibling;return t}function r(e){for(var t=e.nextSibling;t&&n(t);)t=t.nextSibling;return t}function s(e){var t=e.ownerDocument,i=r(e),n=o(e);i&&!d(i)&&e.parentNode.insertBefore(t.createElement("br"),i),n&&!d(n)&&e.parentNode.insertBefore(t.createElement("br"),e)}function a(e){var t=r(e),i=o(e);t&&c(t)&&t.parentNode.removeChild(t),i&&c(i)&&i.parentNode.removeChild(i)}function l(e){var t=e.lastChild;t&&c(t)&&t.parentNode.removeChild(t)}function c(e){return"BR"===e.nodeName}function d(e){return c(e)?!0:"block"===m.getStyle("display").from(e)?!0:!1}function u(t,i,n,o){if(o)var r=m.observe(t,"DOMNodeInserted",function(t){var i,n=t.target;n.nodeType===e.ELEMENT_NODE&&(i=m.getStyle("display").from(n),"inline"!==i.substr(0,6)&&(n.className+=" "+o))});t.execCommand(i,!1,n),r&&r.stop()}function h(e,t){e.selection.selectLine(),e.selection.surround(t),a(t),l(t),e.selection.selectNode(t)}function p(t){return!!e.lang.string(t.className).trim()}var f,m=e.dom,g="DIV",v=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE",g];e.commands.formatBlock={exec:function(n,o,r,a,l){var c,d=n.doc,f=this.state(n,o,r,a,l);return r="string"==typeof r?r.toUpperCase():r,f?(n.selection.executeAndRestoreSimple(function(){l&&i(f,l);var e=p(f);e||f.nodeName!==(r||g)?e&&m.renameElement(f,g):(s(f),m.replaceWithChildNodes(f))}),void 0):(null===r||e.lang.array(v).contains(r))&&(c=n.selection.getSelectedNode(),f=m.getParentElement(c,{nodeName:v}))?(n.selection.executeAndRestoreSimple(function(){r&&(f=m.renameElement(f,r)),a&&t(f,a,l)}),void 0):n.commands.support(o)?(u(d,o,r||g,a),void 0):(f=d.createElement(r||g),a&&(f.className=a),h(n,f),void 0)},state:function(e,t,i,n,o){i="string"==typeof i?i.toUpperCase():i;var r=e.selection.getSelectedNode();return m.getParentElement(r,{nodeName:i,className:n,classRegExp:o})},value:function(){return f}}}(wysihtml5),function(e){function t(e){var t=o[e];return t?[e.toLowerCase(),t.toLowerCase()]:[e.toLowerCase()]}function i(i,n,o){var s=i+":"+n;return r[s]||(r[s]=new e.selection.HTMLApplier(t(i),n,o,!0)),r[s]}var n,o={strong:"b",em:"i",b:"strong",i:"em"},r={};e.commands.formatInline={exec:function(e,t,n,o,r){var s=e.selection.getRange();return s?(i(n,o,r).toggleRange(s),e.selection.setSelection(s),void 0):!1},state:function(t,n,r,s,a){var l,c=t.doc,d=o[r]||r;return e.dom.hasElementWithTagName(c,r)||e.dom.hasElementWithTagName(c,d)?s&&!e.dom.hasElementWithClassName(c,s)?!1:(l=t.selection.getRange(),l?i(r,s,a).isAppliedToRange(l):!1):!1},value:function(){return n}}}(wysihtml5),function(e){var t;e.commands.insertHTML={exec:function(e,t,i){e.commands.support(t)?e.doc.execCommand(t,!1,i):e.selection.insertHTML(i)},state:function(){return!1},value:function(){return t}}}(wysihtml5),function(e){var t="IMG";e.commands.insertImage={exec:function(i,n,o){o="object"==typeof o?o:{src:o};var r,s,a,l=i.doc,c=this.state(i);if(c)return i.selection.setBefore(c),a=c.parentNode,a.removeChild(c),e.dom.removeEmptyTextNodes(a),"A"!==a.nodeName||a.firstChild||(i.selection.setAfter(a),a.parentNode.removeChild(a)),e.quirks.redraw(i.element),void 0;c=l.createElement(t);for(s in o)c[s]=o[s];i.selection.insertNode(c),e.browser.hasProblemsSettingCaretAfterImg()?(r=l.createTextNode(e.INVISIBLE_SPACE),i.selection.insertNode(r),i.selection.setAfter(r)):i.selection.setAfter(c)},state:function(i){var n,o,r,s=i.doc;return e.dom.hasElementWithTagName(s,t)?(n=i.selection.getSelectedNode())?n.nodeName===t?n:n.nodeType!==e.ELEMENT_NODE?!1:(o=i.selection.getText(),(o=e.lang.string(o).trim())?!1:(r=i.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==r.length?!1:r[0])):!1:!1},value:function(e){var t=this.state(e);return t&&t.src}}}(wysihtml5),function(e){var t,i="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(t,n){t.commands.support(n)?(t.doc.execCommand(n,!1,null),e.browser.autoScrollsToCaret()||t.selection.scrollIntoView()):t.commands.exec("insertHTML",i)},state:function(){return!1},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.insertOrderedList={exec:function(t,i){var n,o,r=t.doc,s=t.selection.getSelectedNode(),a=e.dom.getParentElement(s,{nodeName:"OL"}),l=e.dom.getParentElement(s,{nodeName:"UL"}),c="_wysihtml5-temp-"+(new Date).getTime();return t.commands.support(i)?(r.execCommand(i,!1,null),void 0):(a?t.selection.executeAndRestoreSimple(function(){e.dom.resolveList(a)}):l?t.selection.executeAndRestoreSimple(function(){e.dom.renameElement(l,"ol")}):(t.commands.exec("formatBlock","div",c),o=r.querySelector("."+c),n=""===o.innerHTML||o.innerHTML===e.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){a=e.dom.convertToList(o,"ol")}),n&&t.selection.selectNode(a.querySelector("li"))),void 0)},state:function(t){var i=t.selection.getSelectedNode();return e.dom.getParentElement(i,{nodeName:"OL"})},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.insertUnorderedList={exec:function(t,i){var n,o,r=t.doc,s=t.selection.getSelectedNode(),a=e.dom.getParentElement(s,{nodeName:"UL"}),l=e.dom.getParentElement(s,{nodeName:"OL"}),c="_wysihtml5-temp-"+(new Date).getTime();return t.commands.support(i)?(r.execCommand(i,!1,null),void 0):(a?t.selection.executeAndRestoreSimple(function(){e.dom.resolveList(a)}):l?t.selection.executeAndRestoreSimple(function(){e.dom.renameElement(l,"ul")}):(t.commands.exec("formatBlock","div",c),o=r.querySelector("."+c),n=""===o.innerHTML||o.innerHTML===e.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){a=e.dom.convertToList(o,"ul")}),n&&t.selection.selectNode(a.querySelector("li"))),void 0)},state:function(t){var i=t.selection.getSelectedNode();return e.dom.getParentElement(i,{nodeName:"UL"})},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.italic={exec:function(t,i){return e.commands.formatInline.exec(t,i,"i")},state:function(t,i){return e.commands.formatInline.state(t,i,"i")},value:function(){return t}}}(wysihtml5),function(e){var t,i="wysiwyg-text-align-center",n=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyCenter={exec:function(t){return e.commands.formatBlock.exec(t,"formatBlock",null,i,n)},state:function(t){return e.commands.formatBlock.state(t,"formatBlock",null,i,n)},value:function(){return t}}}(wysihtml5),function(e){var t,i="wysiwyg-text-align-left",n=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyLeft={exec:function(t){return e.commands.formatBlock.exec(t,"formatBlock",null,i,n)},state:function(t){return e.commands.formatBlock.state(t,"formatBlock",null,i,n)},value:function(){return t}}}(wysihtml5),function(e){var t,i="wysiwyg-text-align-right",n=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyRight={exec:function(t){return e.commands.formatBlock.exec(t,"formatBlock",null,i,n)},state:function(t){return e.commands.formatBlock.state(t,"formatBlock",null,i,n)},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.underline={exec:function(t,i){return e.commands.formatInline.exec(t,i,"u")},state:function(t,i){return e.commands.formatInline.state(t,i,"u")},value:function(){return t}}}(wysihtml5),function(e){function t(e){for(var t;t=e.querySelector("._wysihtml5-temp");)t.parentNode.removeChild(t)}var i=90,n=89,o=8,r=46,s=40,a='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",l='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",c=e.dom;e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.history=[this.composer.getValue()],this.position=1,this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var s,d=this,u=this.composer.sandbox.getDocument();if(c.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var t=e.keyCode,o=t===i&&!e.shiftKey,r=t===i&&e.shiftKey||t===n;o?(d.undo(),e.preventDefault()):r&&(d.redo(),e.preventDefault())}}),c.observe(this.element,"keydown",function(e){var t=e.keyCode;t!==s&&(s=t,(t===o||t===r)&&d.transact())}),e.browser.hasUndoInContextMenu()){var h,p,f=function(){t(u),clearInterval(h)};c.observe(this.element,"contextmenu",function(){f(),d.composer.selection.executeAndRestoreSimple(function(){d.element.lastChild&&d.composer.selection.setAfter(d.element.lastChild),u.execCommand("insertHTML",!1,a),u.execCommand("insertHTML",!1,l),u.execCommand("undo",!1,null)}),h=setInterval(function(){u.getElementById("_wysihtml5-redo")?(f(),d.redo()):u.getElementById("_wysihtml5-undo")||(f(),d.undo())},400),p||(p=!0,c.observe(document,"mousedown",f),c.observe(u,["mousedown","paste","cut","copy"],f))})}this.editor.observe("newword:composer",function(){d.transact()}).observe("beforecommand:composer",function(){d.transact()})},transact:function(){var e=this.history[this.position-1],t=this.composer.getValue();if(t!=e){var i=this.history.length=this.position;i>s&&(this.history.shift(),this.position--),this.position++,this.history.push(t)}},undo:function(){this.transact(),1>=this.position||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-1]),this.editor.fire("redo:composer"))},set:function(e){this.composer.setValue(e),this.editor.focus(!0)}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,i){this.parent=e,this.element=t,this.config=i,this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.observe("beforeload",function(){e.parent.observe("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,i=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,i){this.base(e,t,i),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=i.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t){var i=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t&&(i=this.parent.parse(i)),i=e.lang.string(i).replace(e.INVISIBLE_SPACE).by("")},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.innerHTML=e},show:function(){this.iframe.style.display=this._displayStyle||"",this.disable(),this.enable()},hide:function(){this._displayStyle=t.getStyle("display").from(this.iframe),"none"===this._displayStyle&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable"),this.base()},enable:function(){this.element.setAttribute("contentEditable","true"),this.base()},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var i=this.element.lastChild;t&&i&&("BR"===i.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var e=this.element.innerHTML,t="blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea";return""===e||e===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&!this.element.querySelector(t)},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe();var i=document.createElement("input");i.type="hidden",i.name="_wysihtml5_mode",i.value=1;var n=this.textarea.element;t.insert(this.iframe).after(n),t.insert(i).after(n)},_create:function(){var n=this;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.enable(),this.selection=new e.Selection(this.parent),this.commands=new e.Commands(this.parent),t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var o=this.config.name;o&&(t.addClass(this.element,o),t.addClass(this.iframe,o));var r="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder");r&&t.simulatePlaceholder(this.parent,this,r),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){n.focus()},100),e.quirks.insertLineBreakOnReturn(this),i.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),i.clearsListsInContentEditableCorrectly()||e.quirks.ensureProperClearingOfLists(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var n=this,o=i.canDisableAutoLinking(),r=i.doesAutoLinkingInContentEditable();if(o&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!r||r&&o)&&this.parent.observe("newword:composer",function(){n.selection.executeAndRestore(function(e,i){t.autoLink(i.parentNode)})});var s=this.sandbox.getDocument().getElementsByTagName("a"),a=t.autoLink.URL_REG_EXP,l=function(i){var n=e.lang.string(t.getTextContent(i)).trim();return"www."===n.substr(0,4)&&(n="http://"+n),n};t.observe(this.element,"keydown",function(e){if(s.length){var i,o=n.selection.getSelectedNode(e.target.ownerDocument),r=t.getParentElement(o,{nodeName:"A"},4);r&&(i=l(r),setTimeout(function(){var e=l(r);e!==i&&e.match(a)&&r.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){var n=["width","height"],o=n.length,r=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing),this.config.allowObjectResizing?i.supportsEvent("resizeend")&&t.observe(r,"resizeend",function(t){for(var i,s=t.target||t.srcElement,a=s.style,l=0;o>l;l++)i=n[l],a[i]&&(s.setAttribute(i,parseInt(a[i],10)),a[i]="");e.quirks.redraw(r)}):i.supportsEvent("resizestart")&&t.observe(r,"resizestart",function(e){e.preventDefault()})},_initUndoManager:function(){new e.UndoManager(this.parent)}})}(wysihtml5),function(e){var t=e.dom,i=document,n=window,o=i.createElement("div"),r=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],s=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],a=["width","height","top","left","right","bottom"],l=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],c=function(e){if(e.setActive)try{e.setActive()}catch(o){}else{var r=e.style,s=i.documentElement.scrollTop||i.body.scrollTop,a=i.documentElement.scrollLeft||i.body.scrollLeft,l={position:r.position,top:r.top,left:r.left,WebkitUserSelect:r.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(l).on(e),n.scrollTo&&n.scrollTo(a,s)}};e.views.Composer.prototype.style=function(){var d=this,u=i.querySelector(":focus"),h=this.textarea.element,p=h.hasAttribute("placeholder"),f=p&&h.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||o.cloneNode(!1),this.blurStylesHost=this.blurStylesHost||o.cloneNode(!1),p&&h.removeAttribute("placeholder"),h===u&&h.blur(),t.copyStyles(s).from(h).to(this.iframe).andTo(this.blurStylesHost),t.copyStyles(r).from(h).to(this.element).andTo(this.blurStylesHost),t.insertCSS(l).into(this.element.ownerDocument),c(h),t.copyStyles(s).from(h).to(this.focusStylesHost),t.copyStyles(r).from(h).to(this.focusStylesHost);var m=e.lang.array(s).without(["display"]);if(u?u.focus():h.blur(),p&&h.setAttribute("placeholder",f),!e.browser.hasCurrentStyleProperty())var g=t.observe(n,"resize",function(){if(!t.contains(document.documentElement,d.iframe))return g.stop(),void 0;var e=t.getStyle("display").from(h),i=t.getStyle("display").from(d.iframe);h.style.display="",d.iframe.style.display="none",t.copyStyles(a).from(h).to(d.iframe).andTo(d.focusStylesHost).andTo(d.blurStylesHost),d.iframe.style.display=i,h.style.display=e});return this.parent.observe("focus:composer",function(){t.copyStyles(m).from(d.focusStylesHost).to(d.iframe),t.copyStyles(r).from(d.focusStylesHost).to(d.element)}),this.parent.observe("blur:composer",function(){t.copyStyles(m).from(d.blurStylesHost).to(d.iframe),t.copyStyles(r).from(d.blurStylesHost).to(d.element)}),this}}(wysihtml5),function(e){var t=e.dom,i=e.browser,n={66:"bold",73:"italic",85:"underline"};e.views.Composer.prototype.observe=function(){var o=this,r=this.getValue(),s=this.sandbox.getIframe(),a=this.element,l=i.supportsEventsInIframeCorrectly()?a:this.sandbox.getWindow(),c=i.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];t.observe(s,"DOMNodeRemoved",function(){clearInterval(d),o.parent.fire("destroy:composer")});var d=setInterval(function(){t.contains(document.documentElement,s)||(clearInterval(d),o.parent.fire("destroy:composer"))},250);t.observe(l,"focus",function(){o.parent.fire("focus").fire("focus:composer"),setTimeout(function(){r=o.getValue()},0)}),t.observe(l,"blur",function(){r!==o.getValue()&&o.parent.fire("change").fire("change:composer"),o.parent.fire("blur").fire("blur:composer")}),e.browser.isIos()&&t.observe(a,"blur",function(){var e=a.ownerDocument.createElement("input"),t=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft;try{o.selection.insertNode(e)}catch(n){a.appendChild(e)}e.focus(),e.parentNode.removeChild(e),window.scrollTo(i,t)}),t.observe(a,"dragenter",function(){o.parent.fire("unset_placeholder")}),i.firesOnDropOnlyWhenOnDragOverIsCancelled()&&t.observe(a,["dragover","dragenter"],function(e){e.preventDefault()}),t.observe(a,c,function(e){var t,n=e.dataTransfer;n&&i.supportsDataTransfer()&&(t=n.getData("text/html")||n.getData("text/plain")),t?(a.focus(),o.commands.exec("insertHTML",t),o.parent.fire("paste").fire("paste:composer"),e.stopPropagation(),e.preventDefault()):setTimeout(function(){o.parent.fire("paste").fire("paste:composer")},0)}),t.observe(a,"keyup",function(t){var i=t.keyCode;(i===e.SPACE_KEY||i===e.ENTER_KEY)&&o.parent.fire("newword:composer")}),this.parent.observe("paste:composer",function(){setTimeout(function(){o.parent.fire("newword:composer")},0)}),i.canSelectImagesInContentEditable()||t.observe(a,"mousedown",function(e){var t=e.target;"IMG"===t.nodeName&&(o.selection.selectNode(t),e.preventDefault())}),t.observe(a,"keydown",function(e){var t=e.keyCode,i=n[t];(e.ctrlKey||e.metaKey)&&!e.altKey&&i&&(o.commands.exec(i),e.preventDefault())}),t.observe(a,"keydown",function(t){var i,n=o.selection.getSelectedNode(!0),r=t.keyCode;!n||"IMG"!==n.nodeName||r!==e.BACKSPACE_KEY&&r!==e.DELETE_KEY||(i=n.parentNode,i.removeChild(n),"A"!==i.nodeName||i.firstChild||i.parentNode.removeChild(i),setTimeout(function(){e.quirks.redraw(a)},0),t.preventDefault())});var u={IMG:"Image: ",A:"Link: "};t.observe(a,"mouseover",function(e){var t,i=e.target,n=i.nodeName;if("A"===n||"IMG"===n){var o=i.hasAttribute("title");o||(t=u[n]+(i.getAttribute("href")||i.getAttribute("src")),i.setAttribute("title",t))}})}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,i){this.editor=e,this.textarea=t,this.composer=i,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue()).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue();t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var i,n=this,o=this.textarea.element.form,r=function(){i=setInterval(function(){n.fromComposerToTextarea()},t)},s=function(){clearInterval(i),i=null};r(),o&&(e.dom.observe(o,"submit",function(){n.sync(!0)}),e.dom.observe(o,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.observe("change_view",function(e){"composer"!==e||i?"textarea"===e&&(n.fromComposerToTextarea(!0),s()):(n.fromTextareaToComposer(!0),r())}),this.editor.observe("destroy:composer",s)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,i){this.base(e,t,i),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,i=this.element.value,n=!i;return e&&n||i===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,i={focusin:"focus",focusout:"blur"},n=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.observe("beforeload",function(){wysihtml5.dom.observe(e,n,function(e){var n=i[e.type]||e.type;t.fire(n).fire(n+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t=e.dom,i="wysihtml5-command-dialog-opened",n="input, select, textarea",o="[data-wysihtml5-dialog-field]",r="data-wysihtml5-dialog-field";e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var o=this,r=function(e){var t=o._serialize();t==o.elementToChange?o.fire("edit",t):o.fire("save",t),o.hide(),e.preventDefault(),e.stopPropagation()};t.observe(o.link,"click",function(){t.hasClass(o.link,i)&&setTimeout(function(){o.hide()},0)}),t.observe(this.container,"keydown",function(t){var i=t.keyCode;i===e.ENTER_KEY&&r(t),i===e.ESCAPE_KEY&&o.hide()}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",r),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){o.fire("cancel"),o.hide(),e.preventDefault(),e.stopPropagation()});for(var s=this.container.querySelectorAll(n),a=0,l=s.length,c=function(){clearInterval(o.interval)};l>a;a++)t.observe(s[a],"change",c);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll(o),i=t.length,n=0;i>n;n++)e[t[n].getAttribute(r)]=t[n].value;return e},_interpolate:function(e){for(var t,i,n,s=document.querySelector(":focus"),a=this.container.querySelectorAll(o),l=a.length,c=0;l>c;c++)t=a[c],t!==s&&(e&&"hidden"===t.type||(i=t.getAttribute(r),n=this.elementToChange?this.elementToChange[i]||"":t.defaultValue,t.value=n))},show:function(e){var o=this,r=this.container.querySelector(n);if(this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){o._interpolate(!0)},500)),t.addClass(this.link,i),this.container.style.display="",this.fire("show"),r&&!e)try{r.focus()}catch(s){}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,i),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,i={position:"relative"},n={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},o={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},r={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(s,a){var l=document.createElement("input");if(!e.browser.supportsSpeechApiOn(l))return a.style.display="none",void 0;var c=document.createElement("div");e.lang.object(n).merge({width:a.offsetWidth+"px",height:a.offsetHeight+"px"}),t.insert(l).into(c),t.insert(c).into(a),t.setStyles(o).on(l),t.setAttributes(r).on(l),t.setStyles(n).on(c),t.setStyles(i).on(a);var d="onwebkitspeechchange"in l?"webkitspeechchange":"speechchange";t.observe(l,d,function(){s.execCommand("insertText",l.value),l.value=""}),t.observe(l,"click",function(e){t.hasClass(a,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}}(wysihtml5),function(e){var t="wysihtml5-command-disabled",i="wysihtml5-commands-disabled",n="wysihtml5-command-active",o="wysihtml5-action-active",r=e.dom;
e.toolbar.Toolbar=Base.extend({constructor:function(t,i){this.editor=t,this.container="string"==typeof i?document.getElementById(i):i,this.composer=t.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var n=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),o=n.length,r=0;o>r;r++)new e.toolbar.Speech(this,n[r])},_getLinks:function(t){for(var i,n,o,r,s,a=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),l=a.length,c=0,d=this[t+"Mapping"]={};l>c;c++)i=a[c],o=i.getAttribute("data-wysihtml5-"+t),r=i.getAttribute("data-wysihtml5-"+t+"-value"),n=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+o+"']"),s=this._getDialog(i,o),d[o+":"+r]={link:i,group:n,name:o,value:r,dialog:s,state:!1}},_getDialog:function(t,i){var n,o,r=this,s=this.container.querySelector("[data-wysihtml5-dialog='"+i+"']");return s&&(n=new e.toolbar.Dialog(t,s),n.observe("show",function(){o=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:i,dialogContainer:s,commandLink:t})}),n.observe("save",function(e){o&&r.composer.selection.setBookmark(o),r._execCommand(i,e),r.editor.fire("save:dialog",{command:i,dialogContainer:s,commandLink:t})}),n.observe("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:i,dialogContainer:s,commandLink:t})})),n},execCommand:function(e,t){if(!this.commandsDisabled){var i=this.commandMapping[e+":"+t];i&&i.dialog&&!i.state?i.dialog.show():this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;switch(e){case"change_view":t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")}},_observe:function(){for(var e=this,t=this.editor,n=this.container,o=this.commandLinks.concat(this.actionLinks),s=o.length,a=0;s>a;a++)r.setAttributes({href:"javascript:;",unselectable:"on"}).on(o[a]);r.delegate(n,"[data-wysihtml5-command]","mousedown",function(e){e.preventDefault()}),r.delegate(n,"[data-wysihtml5-command]","click",function(t){var i=this,n=i.getAttribute("data-wysihtml5-command"),o=i.getAttribute("data-wysihtml5-command-value");e.execCommand(n,o),t.preventDefault()}),r.delegate(n,"[data-wysihtml5-action]","click",function(t){var i=this.getAttribute("data-wysihtml5-action");e.execAction(i),t.preventDefault()}),t.observe("focus:composer",function(){e.bookmark=null,clearInterval(e.interval),e.interval=setInterval(function(){e._updateLinkStates()},500)}),t.observe("blur:composer",function(){clearInterval(e.interval)}),t.observe("destroy:composer",function(){clearInterval(e.interval)}),t.observe("change_view",function(t){setTimeout(function(){e.commandsDisabled="composer"!==t,e._updateLinkStates(),e.commandsDisabled?r.addClass(n,i):r.removeClass(n,i)},0)})},_updateLinkStates:function(){var i,s,a,l,c=(this.composer.element,this.commandMapping),d=this.actionMapping;for(i in c)l=c[i],this.commandsDisabled?(s=!1,r.removeClass(l.link,n),l.group&&r.removeClass(l.group,n),l.dialog&&l.dialog.hide()):(s=this.composer.commands.state(l.name,l.value),e.lang.object(s).isArray()&&(s=1===s.length?s[0]:!0),r.removeClass(l.link,t),l.group&&r.removeClass(l.group,t)),l.state!==s&&(l.state=s,s?(r.addClass(l.link,n),l.group&&r.addClass(l.group,n),l.dialog&&("object"==typeof s?l.dialog.show(s):l.dialog.hide())):(r.removeClass(l.link,n),l.group&&r.removeClass(l.group,n),l.dialog&&l.dialog.hide()));for(i in d)a=d[i],"change_view"===a.name&&(a.state=this.editor.currentView===this.editor.textarea,a.state?r.addClass(a.link,o):r.removeClass(a.link,o))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){var t,i={name:t,style:!0,toolbar:t,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:t,allowObjectResizing:!0,supportTouchDevices:!0};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,n){if(this.textareaElement="string"==typeof t?document.getElementById(t):t,this.config=e.lang.object({}).merge(i).merge(n).get(),this.textarea=new e.views.Textarea(this,this.textareaElement,this.config),this.currentView=this.textarea,this._isCompatible=e.browser.supported(),!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var o=this;return setTimeout(function(){o.fire("beforeload").fire("load")},0),void 0}e.dom.addClass(document.body,this.config.bodyClassName),this.composer=new e.views.Composer(this,this.textareaElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.observe("beforeload",function(){this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(r){}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e){return this.currentView.getValue(e)},setValue:function(e,t){return e?(this.currentView.setValue(e,t),this):this.clear()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t){var i=this.config.parser(t,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof t&&e.quirks.redraw(t),i},_initParser:function(){this.observe("paste:composer",function(){var t=!0,i=this;i.composer.selection.executeAndRestore(function(){e.quirks.cleanPastedHTML(i.composer.element),i.parse(i.composer.element)},t)}),this.observe("paste:textarea",function(){var e,t=this.textarea.getValue();e=this.parse(t),this.textarea.setValue(e)})}})}(wysihtml5),!function(e,t){"use strict";var i={"font-styles":"<li class='dropdown'><a class='btn dropdown-toggle' data-toggle='dropdown' href='#'><i class='icon-font'></i>&nbsp;<span class='current-font'>Normal text</span>&nbsp;<b class='caret'></b></a><ul class='dropdown-menu'><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='div'>Texte normal</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h1'>Entte 1</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h2'>Entte 2</a></li></ul></li>",emphasis:"<li><div class='btn-group'><a class='btn' data-wysihtml5-command='bold' title='CTRL+B'>Gras</a><a class='btn' data-wysihtml5-command='italic' title='CTRL+I'>Italic</a><a class='btn' data-wysihtml5-command='underline' title='CTRL+U'>Souslign</a></div></li>",lists:"<li><div class='btn-group'><a class='btn' data-wysihtml5-command='insertUnorderedList' title='Unordered List'><i class='icon-list'></i></a><a class='btn' data-wysihtml5-command='insertOrderedList' title='Ordered List'><i class='icon-th-list'></i></a><a class='btn' data-wysihtml5-command='Outdent' title='Outdent'><i class='icon-indent-right'></i></a><a class='btn' data-wysihtml5-command='Indent' title='Indent'><i class='icon-indent-left'></i></a></div></li>",table:"<li><div class='bootstrap-wysihtml5-insert-table-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Table</h3></div><div class='modal-body'><input value='2' class='bootstrap-wysihtml5-insert-table-columns input-xlarge'><input value='3' class='bootstrap-wysihtml5-insert-table-rows input-xlarge'></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert Table</a></div></div><a class='btn' data-wysihtml5-command='insertTable' title='Table'><i class='icon-tasks'></i></a></li>",link:"<li><div class='bootstrap-wysihtml5-insert-link-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Link</h3></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-link-url input-xlarge'></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert link</a></div></div><a class='btn' data-wysihtml5-command='createLink' title='Link'><i class='icon-share'></i></a></li>",image:"<li><div class='bootstrap-wysihtml5-insert-image-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Image</h3></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-image-url input-xlarge'><iframe id='dialog_iframe' frameborder='0' marginheight='0' marginwidth='0' border='0' width='100%' height='100%'></iframe></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert image</a></div></div><a class='btn' data-wysihtml5-command='insertImage' title='Insert image'><i class='icon-picture'></i></a></li>",html:"<li><div class='btn-group'><a class='btn' data-wysihtml5-action='change_view' title='Edit HTML'><i class='icon-pencil'></i></a></div></li>"},n={"font-styles":!0,emphasis:!0,lists:!0,html:!0,table:!0,link:!0,image:!0,events:{},parserRules:{tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{set_attributes:{target:"_blank",rel:"nofollow"},check_attributes:{href:"url"}}}},stylesheets:[]},o=function(t,i){this.el=t,this.toolbar=this.createToolbar(t,i||n),this.editor=this.createEditor(i),window.editor=this.editor,e("iframe.wysihtml5-sandbox").each(function(t,i){e(i.contentWindow).off("focus.wysihtml5").on({"focus.wysihtml5":function(){e("li.dropdown").removeClass("open")}})})};o.prototype={constructor:o,createEditor:function(i){i=e.extend(n,i||{}),i.toolbar=this.toolbar[0];var o=new t.Editor(this.el[0],i);if(i&&i.events)for(var r in i.events)o.on(r,i.events[r]);return o},createToolbar:function(t,o){var r=this,s=e("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"});for(var a in n){var l=!1;void 0!==o[a]?o[a]===!0&&(l=!0):l=n[a],l===!0&&(s.append(i[a]),"html"==a&&this.initHtml(s),"link"==a&&this.initInsertLink(s),"image"==a&&this.initInsertImage(s),"table"==a&&this.initInsertTable(s))}return s.find("a[data-wysihtml5-command='formatBlock']").click(function(t){var i=e(t.srcElement);r.toolbar.find(".current-font").text(i.html())}),this.el.before(s),s},initHtml:function(e){var t="a[data-wysihtml5-action='change_view']";e.find(t).click(function(){e.find("a.btn").not(t).toggleClass("disabled")})},initInsertTable:function(e){var t=this,i=e.find(".bootstrap-wysihtml5-insert-table-modal"),n=i.find(".bootstrap-wysihtml5-insert-table-columns"),o=i.find(".bootstrap-wysihtml5-insert-table-rows"),r=i.find("a.btn-primary"),s=n.val(),a=o.val(),l=function(){var e=n.val();n.val(s);var i=o.val();o.val(a);for(var r="<tr>",l=0;e>l;l++)r+="<td></td>";r+="</tr>";for(var c="<table class='table'><tbody>",d=0;i>d;d++)c+=r;c+="</tbody></table>",t.editor.composer.commands.exec("insertHTML",c)};r.click(l),i.on("shown",function(){n.focus()}),i.on("hide",function(){t.editor.currentView.element.focus()}),e.find("a[data-wysihtml5-command=insertTable]").click(function(){return i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){e.stopPropagation()}),!1})},initInsertImage:function(e){var t=this,i=e.find(".bootstrap-wysihtml5-insert-image-modal"),n=i.find(".bootstrap-wysihtml5-insert-image-url"),o=i.find("a.btn-primary"),r=n.val(),s=function(){var e=n.val();n.val(r),t.editor.composer.commands.exec("insertImage",e)};n.keypress(function(e){13==e.which&&(s(),i.modal("hide"))}),o.click(s),i.on("shown",function(){n.focus()}),i.on("hide",function(){t.editor.currentView.element.focus()}),e.find("a[data-wysihtml5-command=insertImage]").click(function(){return i.find("#dialog_iframe").attr("src","/admin/sites/1/images/insert?dialog=true"),i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){e.stopPropagation()}),!1})},initInsertLink:function(e){var t=this,i=e.find(".bootstrap-wysihtml5-insert-link-modal"),n=i.find(".bootstrap-wysihtml5-insert-link-url"),o=i.find("a.btn-primary"),r=n.val(),s=function(){var e=n.val();n.val(r),t.editor.composer.commands.exec("createLink",{href:e,target:"_blank",rel:"nofollow"})};n.keypress(function(e){13==e.which&&(s(),i.modal("hide"))}),o.click(s),i.on("shown",function(){n.focus()}),i.on("hide",function(){t.editor.currentView.element.focus()}),e.find("a[data-wysihtml5-command=createLink]").click(function(){return i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){e.stopPropagation()}),!1})}},e.fn.wysihtml5=function(t){return this.each(function(){var i=e(this);i.data("wysihtml5",new o(i,t))})},e.fn.wysihtml5.Constructor=o}(window.jQuery,window.wysihtml5),/*
 * Bootstrap Image Gallery 2.8.1
 * https://github.com/blueimp/Bootstrap-Image-Gallery
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","bootstrap"],e):e(window.jQuery,window.loadImage)}(function(e,t){"use strict";e.extend(e.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0,imageClickDivision:.5});var i=e.fn.modal.Constructor.prototype.show,n=e.fn.modal.Constructor.prototype.hide;e.extend(e.fn.modal.Constructor.prototype,{initLinks:function(){var t=this,i=this.options,n=i.selector||"a[data-target="+i.target+"]";this.$links=e(i.delegate).find(n).filter(i.filter).each(function(e){t.getUrl(this)===i.href&&(i.index=e)}),this.$links[i.index]||(i.index=0)},getUrl:function(t){return t.href||e(t).data("href")},startSlideShow:function(){var e=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){e.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var e=this.$element.find(".modal-slideshow");this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=e.data("slideshow")||5e3,this.startSlideShow()),e.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var t,i,n=this.options,o=n.index+n.preloadRange+1;for(i=n.index-n.preloadRange;o>i;i+=1)t=this.$links[i],t&&i!==n.index&&e("<img>").prop("src",this.getUrl(t))},loadImage:function(){var e,i=this,n=this.$element,o=this.options.index,r=this.getUrl(this.$links[o]);this.abortLoad(),this.stopSlideShow(),n.trigger("beforeLoad"),this._loadingTimeout=window.setTimeout(function(){n.addClass("modal-loading")},100),e=n.find(".modal-image").children().removeClass("in"),window.setTimeout(function(){e.remove()},3e3),n.find(".modal-title").text(this.$links[o].title),n.find(".modal-download").prop("href",r),this._loadingImage=t(r,function(e){i.img=e,window.clearTimeout(i._loadingTimeout),n.removeClass("modal-loading"),n.trigger("load"),i.showImage(e),i.startSlideShow()},this._loadImageOptions),this.preloadImages()},showImage:function(t){var i,n,o=this.$element,r=e.support.transition&&o.hasClass("fade"),s=r?o.animate:o.css,a=o.find(".modal-image");a.css({width:t.width,height:t.height}),o.find(".modal-title").css({width:Math.max(t.width,380)}),r&&(i=o.clone().hide().appendTo(document.body)),e(window).width()>767?s.call(o.stop(),{"margin-top":-((i||o).outerHeight()/2),"margin-left":-((i||o).outerWidth()/2)}):o.css({top:(e(window).height()-(i||o).outerHeight())/2}),i&&i.remove(),a.append(t),n=t.offsetWidth,o.trigger("display"),r?o.is(":visible")?e(t).on(e.support.transition.end,function(i){i.target===t&&(e(t).off(e.support.transition.end),o.trigger("displayed"))}).addClass("in"):(e(t).addClass("in"),o.one("shown",function(){o.trigger("displayed")})):(e(t).addClass("in"),o.trigger("displayed"))},abortLoad:function(){this._loadingImage&&(this._loadingImage.onload=this._loadingImage.onerror=null),window.clearTimeout(this._loadingTimeout)},prev:function(){var e=this.options;e.index-=1,0>e.index&&(e.index=this.$links.length-1),this.loadImage()},next:function(){var e=this.options;e.index+=1,e.index>this.$links.length-1&&(e.index=0),this.loadImage()},keyHandler:function(e){switch(e.which){case 37:case 38:e.preventDefault(),this.prev();break;case 39:case 40:e.preventDefault(),this.next()}},wheelHandler:function(e){e.preventDefault(),e=e.originalEvent,this._wheelCounter=this._wheelCounter||0,this._wheelCounter+=e.wheelDelta||e.detail||0,e.wheelDelta&&this._wheelCounter>=120||!e.wheelDelta&&0>this._wheelCounter?(this.prev(),this._wheelCounter=0):(e.wheelDelta&&-120>=this._wheelCounter||!e.wheelDelta&&this._wheelCounter>0)&&(this.next(),this._wheelCounter=0)},initGalleryEvents:function(){var t=this,i=this.$element;i.find(".modal-image").on("click.modal-gallery",function(i){var n=e(this);1===t.$links.length?t.hide():(i.pageX-n.offset().left)/n.width()<t.options.imageClickDivision?t.prev(i):t.next(i)}),i.find(".modal-prev").on("click.modal-gallery",function(e){t.prev(e)}),i.find(".modal-next").on("click.modal-gallery",function(e){t.next(e)}),i.find(".modal-slideshow").on("click.modal-gallery",function(e){t.toggleSlideShow(e)}),e(document).on("keydown.modal-gallery",function(e){t.keyHandler(e)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(e){t.wheelHandler(e)})},destroyGalleryEvents:function(){var t=this.$element;this.abortLoad(),this.stopSlideShow(),t.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery"),e(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var t=this.$element,n=this.options,o=e(window).width(),r=e(window).height();t.hasClass("modal-fullscreen")?(this._loadImageOptions={maxWidth:o,maxHeight:r,canvas:n.canvas},t.hasClass("modal-fullscreen-stretch")&&(this._loadImageOptions.minWidth=o,this._loadImageOptions.minHeight=r)):this._loadImageOptions={maxWidth:o-n.offsetWidth,maxHeight:r-n.offsetHeight,canvas:n.canvas},o>767?t.css({"margin-top":-(t.outerHeight()/2),"margin-left":-(t.outerWidth()/2)}):t.css({top:(e(window).height()-t.outerHeight())/2}),this.initGalleryEvents(),this.initLinks(),this.$links.length&&(t.find(".modal-slideshow, .modal-prev, .modal-next").toggle(1!==this.$links.length),t.toggleClass("modal-single",1===this.$links.length),this.loadImage())}i.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents()),n.apply(this,arguments)}}),e(function(){e(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(t){var i,n=e(this),o=n.data(),r=e(o.target),s=r.data("modal");s||(o=e.extend(r.data(),o)),o.selector||(o.selector="a[rel=gallery]"),i=e(t.target).closest(o.selector),i.length&&r.length&&(t.preventDefault(),o.href=i.prop("href")||i.data("href"),o.delegate=i[0]!==this?this:document,s&&e.extend(s.options,o),r.modal(o))})})}),function(){function e(){this.returnValue=!1}function t(){this.cancelBubble=!0}var i,n,o=0,r=[],s={},a={},l={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},c=/[<>&\"\']/g,d=window.setTimeout,u={};(function(e){var t,i,n,o=e.split(/,/);for(t=0;o.length>t;t+=2)for(n=o[t+1].split(/ /),i=0;n.length>i;i++)a[n[i]]=o[t]})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var h={VERSION:"1.5.4",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:a,ua:function(){var e,t,i,n=navigator,o=n.userAgent,r=n.vendor;return e=/WebKit/.test(o),i=e&&-1!==r.indexOf("Apple"),t=window.opera&&window.opera.buildNumber,{windows:-1!==navigator.platform.indexOf("Win"),ie:!e&&!t&&/MSIE/gi.test(o)&&/Explorer/gi.test(n.appName),webkit:e,gecko:!e&&/Gecko/.test(o),safari:i,opera:!!t}}(),typeOf:function(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(e){return h.each(arguments,function(t,i){i>0&&h.each(t,function(t,i){e[i]=t})}),e},cleanName:function(e){var t,i;for(i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;i.length>t;t+=2)e=e.replace(i[t],i[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(e,t){return t.name=e,r[e]=t,r.push(t),t},guid:function(){var e,t=(new Date).getTime().toString(32);for(e=0;5>e;e++)t+=Math.floor(65535*Math.random()).toString(32);return(h.guidPrefix||"p")+t+(o++).toString(32)},buildUrl:function(e,t){var i="";return h.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),i&&(e+=(e.indexOf("?")>0?"&":"?")+i),e},each:function(e,t){var n,o,r;if(e)if(n=e.length,n===i){for(o in e)if(e.hasOwnProperty(o)&&t(e[o],o)===!1)return}else for(r=0;n>r;r++)if(t(e[r],r)===!1)return},formatSize:function(e){return e===i||/\D/.test(e)?h.translate("N/A"):e>1073741824?Math.round(e/1073741824,1)+" GB":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"},getPos:function(e,t){function i(e){var t,i,n=0,o=0;return e&&(i=e.getBoundingClientRect(),t="CSS1Compat"===l.compatMode?l.documentElement:l.body,n=i.left+t.scrollLeft,o=i.top+t.scrollTop),{x:n,y:o}}var n,o,r,s=0,a=0,l=document;if(e=e,t=t||l.body,e&&e.getBoundingClientRect&&navigator.userAgent.indexOf("MSIE")>0&&8>l.documentMode)return o=i(e),r=i(t),{x:o.x-r.x,y:o.y-r.y};for(n=e;n&&n!=t&&n.nodeType;)s+=n.offsetLeft||0,a+=n.offsetTop||0,n=n.offsetParent;for(n=e.parentNode;n&&n!=t&&n.nodeType;)s-=n.scrollLeft||0,a-=n.scrollTop||0,n=n.parentNode;return{x:s,y:a}},getSize:function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}},parseSize:function(e){var t;return"string"==typeof e&&(e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),t=e[2],e=+e[1],"g"==t&&(e*=1073741824),"m"==t&&(e*=1048576),"k"==t&&(e*=1024)),e},xmlEncode:function(e){return e?(""+e).replace(c,function(e){return l[e]?"&"+l[e]+";":e}):e},toArray:function(e){var t,i=[];for(t=0;e.length>t;t++)i[t]=e[t];return i},inArray:function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return i}return-1},addI18n:function(e){return h.extend(s,e)},translate:function(e){return s[e]||e},isEmptyObj:function(e){if(e===i)return!0;for(var t in e)return!1;return!0},hasClass:function(e,t){var i;return""==e.className?!1:(i=new RegExp("(^|\\s+)"+t+"(\\s+|$)"),i.test(e.className))},addClass:function(e,t){h.hasClass(e,t)||(e.className=""==e.className?t:e.className.replace(/\s+$/,"")+" "+t)},removeClass:function(e,t){var i=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(i,function(e,t,i){return" "===t&&" "===i?" ":""})},getStyle:function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},addEvent:function(o,r,s){var a,l,c;c=arguments[3],r=r.toLowerCase(),n===i&&(n="Plupload_"+h.guid()),o.addEventListener?(a=s,o.addEventListener(r,a,!1)):o.attachEvent&&(a=function(){var i=window.event;i.target||(i.target=i.srcElement),i.preventDefault=e,i.stopPropagation=t,s(i)},o.attachEvent("on"+r,a)),o[n]===i&&(o[n]=h.guid()),u.hasOwnProperty(o[n])||(u[o[n]]={}),l=u[o[n]],l.hasOwnProperty(r)||(l[r]=[]),l[r].push({func:a,orig:s,key:c})},removeEvent:function(e,t){var o,r,s;if("function"==typeof arguments[2]?r=arguments[2]:s=arguments[2],t=t.toLowerCase(),e[n]&&u[e[n]]&&u[e[n]][t]){o=u[e[n]][t];for(var a=o.length-1;a>=0&&(o[a].key!==s&&o[a].orig!==r||(e.removeEventListener?e.removeEventListener(t,o[a].func,!1):e.detachEvent&&e.detachEvent("on"+t,o[a].func),o[a].orig=null,o[a].func=null,o.splice(a,1),r===i));a--);if(o.length||delete u[e[n]][t],h.isEmptyObj(u[e[n]])){delete u[e[n]];try{delete e[n]}catch(l){e[n]=i}}}},removeAllEvents:function(e){var t=arguments[1];e[n]!==i&&e[n]&&h.each(u[e[n]],function(i,n){h.removeEvent(e,n,t)})}};h.Uploader=function(e){function t(){var e,t,i=0;if(this.state==h.STARTED){for(t=0;l.length>t;t++)e||l[t].status!=h.QUEUED?i++:(e=l[t],e.status=h.UPLOADING,this.trigger("BeforeUpload",e)&&this.trigger("UploadFile",e));i==l.length&&(this.stop(),this.trigger("UploadComplete",l))}}function n(){var e,t;for(o.reset(),e=0;l.length>e;e++)t=l[e],t.size!==i?(o.size+=t.size,o.loaded+=t.loaded):o.size=i,t.status==h.DONE?o.uploaded++:t.status==h.FAILED?o.failed++:o.queued++;o.size===i?o.percent=l.length>0?Math.ceil(100*(o.uploaded/l.length)):0:(o.bytesPerSec=Math.ceil(o.loaded/((+new Date-s||1)/1e3)),o.percent=o.size>0?Math.ceil(100*(o.loaded/o.size)):0)}var o,s,a={},l=[],c=!1;o=new h.QueueProgress,e=h.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},e),h.extend(this,{state:h.STOPPED,runtime:"",features:{},files:l,settings:e,total:o,id:h.guid(),init:function(){function o(){var e,t,i,n=c[f++];if(n){if(e=n.getFeatures(),t=p.settings.required_features)for(t=t.split(","),i=0;t.length>i;i++)if(!e[t[i]])return o(),void 0;n.init(p,function(t){t&&t.success?(p.features=e,p.runtime=n.name,p.trigger("Init",{runtime:n.name}),p.trigger("PostInit"),p.refresh()):o()})}else p.trigger("Error",{code:h.INIT_ERROR,message:h.translate("Init error.")})}var a,c,u,p=this,f=0;if("function"==typeof e.preinit?e.preinit(p):h.each(e.preinit,function(e,t){p.bind(t,e)}),e.page_url=e.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(e.url)||(e.url=e.page_url+e.url),e.chunk_size=h.parseSize(e.chunk_size),e.max_file_size=h.parseSize(e.max_file_size),p.bind("FilesAdded",function(t,n){var o,r,s,a=0,c=e.filters;for(c&&c.length&&(s=[],h.each(c,function(e){h.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?s.push("\\.*"):s.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),s=new RegExp(s.join("|")+"$","i")),o=0;n.length>o;o++)r=n[o],r.loaded=0,r.percent=0,r.status=h.QUEUED,!s||s.test(r.name)?r.size!==i&&r.size>e.max_file_size?t.trigger("Error",{code:h.FILE_SIZE_ERROR,message:h.translate("File size error."),file:r}):(l.push(r),a++):t.trigger("Error",{code:h.FILE_EXTENSION_ERROR,message:h.translate("File extension error."),file:r});return a?(d(function(){p.trigger("QueueChanged"),p.refresh()},1),void 0):!1}),e.unique_names&&p.bind("UploadFile",function(e,t){var i=t.name.match(/\.([^.]+)$/),n="tmp";i&&(n=i[1]),t.target_name=t.id+"."+n}),p.bind("UploadProgress",function(e,t){t.percent=t.size>0?Math.ceil(100*(t.loaded/t.size)):100,n()}),p.bind("StateChanged",function(e){if(e.state==h.STARTED)s=+new Date;else if(e.state==h.STOPPED)for(a=e.files.length-1;a>=0;a--)e.files[a].status==h.UPLOADING&&(e.files[a].status=h.QUEUED,n())}),p.bind("QueueChanged",n),p.bind("Error",function(e,i){i.file&&(i.file.status=h.FAILED,n(),e.state==h.STARTED&&d(function(){t.call(p)},1))}),p.bind("FileUploaded",function(e,i){i.status=h.DONE,i.loaded=i.size,e.trigger("UploadProgress",i),d(function(){t.call(p)},1)}),e.runtimes)for(c=[],u=e.runtimes.split(/\s?,\s?/),a=0;u.length>a;a++)r[u[a]]&&c.push(r[u[a]]);else c=r;o(),"function"==typeof e.init?e.init(p):h.each(e.init,function(e,t){p.bind(t,e)})},refresh:function(){this.trigger("Refresh")},start:function(){l.length&&this.state!=h.STARTED&&(this.state=h.STARTED,this.trigger("StateChanged"),t.call(this))},stop:function(){this.state!=h.STOPPED&&(this.state=h.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(){c=arguments[0]!==i?arguments[0]:!0,this.trigger("DisableBrowse",c)},getFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e)return l[t]},removeFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e.id)return this.splice(t,1)[0]},splice:function(e,t){var n;return n=l.splice(e===i?0:e,t===i?l.length:t),this.trigger("FilesRemoved",n),this.trigger("QueueChanged"),n},trigger:function(e){var t,i,n=a[e.toLowerCase()];if(n)for(i=Array.prototype.slice.call(arguments),i[0]=this,t=0;n.length>t;t++)if(n[t].func.apply(n[t].scope,i)===!1)return!1;return!0},hasEventListener:function(e){return!!a[e.toLowerCase()]},bind:function(e,t,i){var n;e=e.toLowerCase(),n=a[e]||[],n.push({func:t,scope:i||this}),a[e]=n},unbind:function(e){e=e.toLowerCase();var t,n=a[e],o=arguments[1];if(n){if(o!==i){for(t=n.length-1;t>=0;t--)if(n[t].func===o){n.splice(t,1);break}}else n=[];n.length||delete a[e]}},unbindAll:function(){var e=this;h.each(a,function(t,i){e.unbind(i)})},destroy:function(){this.stop(),this.trigger("Destroy"),this.unbindAll()}})},h.File=function(e,t,i){var n=this;n.id=e,n.name=t,n.size=i,n.loaded=0,n.percent=0,n.status=0},h.Runtime=function(){this.getFeatures=function(){},this.init=function(){}},h.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},h.runtimes={},window.plupload=h}(),function(){if(!window.google||!google.gears){var e=null;if("undefined"!=typeof GearsFactory)e=new GearsFactory;else try{e=new ActiveXObject("Gears.Factory"),-1!=e.getBuildInfo().indexOf("ie_mobile")&&e.privateSetGlobalObject(this)}catch(t){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(e=document.createElement("object"),e.style.display="none",e.width=0,e.height=0,e.type="application/x-googlegears",document.documentElement.appendChild(e))}e&&(window.google||(window.google={}),google.gears||(google.gears={factory:e}))}}(),function(e,t,i){function n(e,t,i){var n,o;n=google.gears.factory.create("beta.canvas");try{if(n.decode(e),t.width||(t.width=n.width),t.height||(t.height=n.height),o=Math.min(width/n.width,height/n.height),1>o||1===o&&"image/jpeg"===i)return n.resize(Math.round(n.width*o),Math.round(n.height*o)),t.quality?n.encode(i,{quality:t.quality/100}):n.encode(i)}catch(r){}return e}var o={};i.runtimes.Gears=i.addRuntime("gears",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(r,s){function a(e){var t,n,s,a=[];for(n=0;e.length>n;n++)t=e[n],s=i.guid(),o[s]=t.blob,a.push(new i.File(s,t.name,t.blob.length));r.trigger("FilesAdded",a)}var l,c,d=!1;if(!e.google||!google.gears)return s({success:!1});try{l=google.gears.factory.create("beta.desktop")}catch(u){return s({success:!1})}r.bind("PostInit",function(){var e=r.settings,n=t.getElementById(e.drop_element);n&&(i.addEvent(n,"dragover",function(e){l.setDropEffect(e,"copy"),e.preventDefault()},r.id),i.addEvent(n,"drop",function(e){var t=l.getDragData(e,"application/x-gears-files");t&&a(t.files),e.preventDefault()},r.id),n=0),i.addEvent(t.getElementById(e.browse_button),"click",function(t){var i,n,o,r=[];if(t.preventDefault(),!d){e:for(i=0;e.filters.length>i;i++)for(o=e.filters[i].extensions.split(","),n=0;o.length>n;n++){if("*"===o[n]){r=[];break e}r.push("."+o[n])}l.openFiles(a,{singleFile:!e.multi_selection,filter:r})}},r.id)}),r.bind("CancelUpload",function(){c.abort&&c.abort()}),r.bind("UploadFile",function(e,t){function r(){function n(n){var o,r,s,a="----pluploadboundary"+i.guid(),l="--",d="\r\n";p&&(c.setRequestHeader("Content-Type","multipart/form-data; boundary="+a),o=google.gears.factory.create("beta.blobbuilder"),i.each(i.extend(m,e.settings.multipart_params),function(e,t){o.append(l+a+d+'Content-Disposition: form-data; name="'+t+'"'+d+d),o.append(e+d)}),s=i.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",o.append(l+a+d+'Content-Disposition: form-data; name="'+e.settings.file_data_name+'"; filename="'+t.name+'"'+d+"Content-Type: "+s+d+d),o.append(n),o.append(d+l+a+l+d),r=o.getAsBlob(),f=r.length-n.length,n=r),c.send(n)}var h,p=e.settings.multipart,f=0,m={name:t.target_name||t.name},g=e.settings.url;t.status!=i.DONE&&t.status!=i.FAILED&&e.state!=i.STOPPED&&(l&&(m.chunk=d,m.chunks=s),h=Math.min(a,t.size-d*a),p||(g=i.buildUrl(e.settings.url,m)),c=google.gears.factory.create("beta.httprequest"),c.open("POST",g),p||(c.setRequestHeader("Content-Disposition",'attachment; filename="'+t.name+'"'),c.setRequestHeader("Content-Type","application/octet-stream")),i.each(e.settings.headers,function(e,t){c.setRequestHeader(t,e)}),c.upload.onprogress=function(i){t.loaded=u+i.loaded-f,e.trigger("UploadProgress",t)},c.onreadystatechange=function(){var n;if(4==c.readyState&&e.state!==i.STOPPED)if(200==c.status){if(n={chunk:d,chunks:s,response:c.responseText,status:c.status},e.trigger("ChunkUploaded",t,n),n.cancelled)return t.status=i.FAILED,void 0;u+=h,++d>=s?(t.status=i.DONE,e.trigger("FileUploaded",t,{response:c.responseText,status:c.status})):r()}else e.trigger("Error",{code:i.HTTP_ERROR,message:i.translate("HTTP Error."),file:t,chunk:d,chunks:s,status:c.status})},s>d&&n(o[t.id].slice(d*a,h)))}var s,a,l,d=0,u=0,h=e.settings.resize;h&&/\.(png|jpg|jpeg)$/i.test(t.name)&&(o[t.id]=n(o[t.id],h,/\.png$/i.test(t.name)?"image/png":"image/jpeg")),t.size=o[t.id].length,a=e.settings.chunk_size,l=a>0,s=Math.ceil(t.size/a),l||(a=t.size,s=1),r()}),r.bind("DisableBrowse",function(e,t){d=t}),r.bind("Destroy",function(e){var n,o,r={browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(n in r)o=t.getElementById(r[n]),o&&i.removeAllEvents(o,e.id)}),s({success:!0})}})}(window,document,plupload),function(e,t,i,n){function o(e){var t,i,r,s,a=typeof e;if(e===n||null===e)return"null";if("string"===a)return t="\bb	t\nn\ff\rr\"\"''\\\\",'"'+e.replace(/([\u0080-\uFFFF\x00-\x1f\"])/g,function(e,i){var n=t.indexOf(i);return n+1?"\\"+t.charAt(n+1):(e=i.charCodeAt().toString(16),"\\u"+"0000".substring(e.length)+e)})+'"';if("object"==a){if(i=e.length!==n,t="",i){for(r=0;e.length>r;r++)t&&(t+=","),t+=o(e[r]);t="["+t+"]"}else{for(s in e)e.hasOwnProperty(s)&&(t&&(t+=","),t+=o(s)+":"+o(e[s]));t="{"+t+"}"}return t}return""+e}function r(e){var t,i,n,o,r,s=!1,a=null,l=0;try{try{a=new ActiveXObject("AgControl.AgControl"),a.IsVersionSupported(e)&&(s=!0),a=null}catch(c){var d=navigator.plugins["Silverlight Plug-In"];if(d){for(t=d.description,"1.0.30226.2"===t&&(t="2.0.30226.2"),i=t.split(".");i.length>3;)i.pop();for(;4>i.length;)i.push(0);for(n=e.split(".");n.length>4;)n.pop();do o=parseInt(n[l],10),r=parseInt(i[l],10),l++;while(n.length>l&&o===r);r>=o&&!isNaN(o)&&(s=!0)}}}catch(u){s=!1}return s}var s={},a={};i.silverlight={trigger:function(e,t){var n,o=s[e];o&&(n=i.toArray(arguments).slice(1),n[0]="Silverlight:"+t,setTimeout(function(){o.trigger.apply(o,n)},0))}},i.runtimes.Silverlight=i.addRuntime("silverlight",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(n,l){function c(){return t.getElementById(n.id+"_silverlight").content.Upload}var d,u,h="",p=n.settings.filters,f=t.body;if(!r("2.0.31005.0")||e.opera&&e.opera.buildNumber)return l({success:!1}),void 0;for(a[n.id]=!1,s[n.id]=n,d=t.createElement("div"),d.id=n.id+"_silverlight_container",i.extend(d.style,{position:"absolute",top:"0px",background:n.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100px",height:"100px",overflow:"hidden",opacity:n.settings.shim_bgcolor||t.documentMode>8?"":.01}),d.className="plupload silverlight",n.settings.container&&(f=t.getElementById(n.settings.container),"static"===i.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(d),u=0;p.length>u;u++)h+=(""!=h?"|":"")+p[u].title+" | *."+p[u].extensions.replace(/,/g,";*.");d.innerHTML='<object id="'+n.id+'_silverlight" data="data:application/x-silverlight," type="application/x-silverlight-2" style="outline:none;" width="1024" height="1024"><param name="source" value="'+n.settings.silverlight_xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="id='+n.id+",filter="+h+",multiselect="+n.settings.multi_selection+'"/></object>',n.bind("Silverlight:Init",function(){var e,r={};a[n.id]||(a[n.id]=!0,n.bind("Silverlight:StartSelectFiles",function(){e=[]}),n.bind("Silverlight:SelectFile",function(t,n,o,s){var a;a=i.guid(),r[a]=n,r[n]=a,e.push(new i.File(a,o,s))}),n.bind("Silverlight:SelectSuccessful",function(){e.length&&n.trigger("FilesAdded",e)}),n.bind("Silverlight:UploadChunkError",function(e,t,o,s,a){n.trigger("Error",{code:i.IO_ERROR,message:"IO Error.",details:a,file:e.getFile(r[t])})}),n.bind("Silverlight:UploadFileProgress",function(e,t,n,o){var s=e.getFile(r[t]);s.status!=i.FAILED&&(s.size=o,s.loaded=n,e.trigger("UploadProgress",s))}),n.bind("Refresh",function(e){var n,o,r;n=t.getElementById(e.settings.browse_button),n&&(o=i.getPos(n,t.getElementById(e.settings.container)),r=i.getSize(n),i.extend(t.getElementById(e.id+"_silverlight_container").style,{top:o.y+"px",left:o.x+"px",width:r.w+"px",height:r.h+"px"}))}),n.bind("Silverlight:UploadChunkSuccessful",function(e,t,n,o,s){var a,l=e.getFile(r[t]);a={chunk:n,chunks:o,response:s},e.trigger("ChunkUploaded",l,a),l.status!=i.FAILED&&e.state!==i.STOPPED&&c().UploadNextChunk(),n==o-1&&(l.status=i.DONE,e.trigger("FileUploaded",l,{response:s}))}),n.bind("Silverlight:UploadSuccessful",function(e,t,n){var o=e.getFile(r[t]);o.status=i.DONE,e.trigger("FileUploaded",o,{response:n})}),n.bind("FilesRemoved",function(e,t){var i;for(i=0;t.length>i;i++)c().RemoveFile(r[t[i].id])}),n.bind("UploadFile",function(e,t){var n=e.settings,s=n.resize||{};c().UploadFile(r[t.id],e.settings.url,o({name:t.target_name||t.name,mime:i.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:n.chunk_size,image_width:s.width,image_height:s.height,image_quality:s.quality||90,multipart:!!n.multipart,multipart_params:n.multipart_params||{},file_data_name:n.file_data_name,headers:n.headers}))}),n.bind("CancelUpload",function(){c().CancelUpload()}),n.bind("Silverlight:MouseEnter",function(e){var o,r;o=t.getElementById(n.settings.browse_button),r=e.settings.browse_button_hover,o&&r&&i.addClass(o,r)}),n.bind("Silverlight:MouseLeave",function(e){var o,r;o=t.getElementById(n.settings.browse_button),r=e.settings.browse_button_hover,o&&r&&i.removeClass(o,r)}),n.bind("Silverlight:MouseLeftButtonDown",function(e){var o,r;o=t.getElementById(n.settings.browse_button),r=e.settings.browse_button_active,o&&r&&(i.addClass(o,r),i.addEvent(t.body,"mouseup",function(){i.removeClass(o,r)}))}),n.bind("Sliverlight:StartSelectFiles",function(e){var o,r;o=t.getElementById(n.settings.browse_button),r=e.settings.browse_button_active,o&&r&&i.removeClass(o,r)}),n.bind("DisableBrowse",function(e,t){c().DisableBrowse(t)}),n.bind("Destroy",function(e){var n;i.removeAllEvents(t.body,e.id),delete a[e.id],delete s[e.id],n=t.getElementById(e.id+"_silverlight_container"),n&&f.removeChild(n)}),l({success:!0}))})}})}(window,document,plupload),function(e,t,i){function n(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}var o={},r={};i.flash={trigger:function(e,t,i){setTimeout(function(){var n=o[e];n&&n.trigger("Flash:"+t,i)},0)}},i.runtimes.Flash=i.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(e,s){function a(){return t.getElementById(e.id+"_flash")}function l(){return u++>5e3?(s({success:!1}),void 0):(r[e.id]===!1&&setTimeout(l,1),void 0)}var c,d,u=0,h=t.body;return 10>n()?(s({success:!1}),void 0):(r[e.id]=!1,o[e.id]=e,c=t.getElementById(e.settings.browse_button),d=t.createElement("div"),d.id=e.id+"_flash_container",i.extend(d.style,{position:"absolute",top:"0px",background:e.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),d.className="plupload flash",e.settings.container&&(h=t.getElementById(e.settings.container),"static"===i.getStyle(h,"position")&&(h.style.position="relative")),h.appendChild(d),function(){var n,o;n='<object id="'+e.id+'_flash" type="application/x-shockwave-flash" data="'+e.settings.flash_swf_url+'" ',i.ua.ie&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+e.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(e.id)+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',i.ua.ie?(o=t.createElement("div"),d.appendChild(o),o.outerHTML=n,o=null):d.innerHTML=n}(),l(),c=d=null,e.bind("Destroy",function(e){var n;i.removeAllEvents(t.body,e.id),delete r[e.id],delete o[e.id],n=t.getElementById(e.id+"_flash_container"),n&&h.removeChild(n)}),e.bind("Flash:Init",function(){var n={};try{a().setFileFilters(e.settings.filters,e.settings.multi_selection)}catch(o){return s({success:!1}),void 0}r[e.id]||(r[e.id]=!0,e.bind("UploadFile",function(t,o){var r=t.settings,s=e.settings.resize||{};a().uploadFile(n[o.id],r.url,{name:o.target_name||o.name,mime:i.mimeTypes[o.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:r.chunk_size,width:s.width,height:s.height,quality:s.quality,multipart:r.multipart,multipart_params:r.multipart_params||{},file_data_name:r.file_data_name,format:/\.(jpg|jpeg)$/i.test(o.name)?"jpg":"png",headers:r.headers,urlstream_upload:r.urlstream_upload})}),e.bind("CancelUpload",function(){a().cancelUpload()}),e.bind("Flash:UploadProcess",function(e,t){var o=e.getFile(n[t.id]);o.status!=i.FAILED&&(o.loaded=t.loaded,o.size=t.size,e.trigger("UploadProgress",o))}),e.bind("Flash:UploadChunkComplete",function(e,t){var o,r=e.getFile(n[t.id]);o={chunk:t.chunk,chunks:t.chunks,response:t.text},e.trigger("ChunkUploaded",r,o),r.status!==i.FAILED&&e.state!==i.STOPPED&&a().uploadNextChunk(),t.chunk==t.chunks-1&&(r.status=i.DONE,e.trigger("FileUploaded",r,{response:t.text}))}),e.bind("Flash:SelectFiles",function(t,o){var r,s,a,l=[];for(s=0;o.length>s;s++)r=o[s],a=i.guid(),n[a]=r.id,n[r.id]=a,l.push(new i.File(a,r.name,r.size));l.length&&e.trigger("FilesAdded",l)}),e.bind("Flash:SecurityError",function(t,o){e.trigger("Error",{code:i.SECURITY_ERROR,message:i.translate("Security error."),details:o.message,file:e.getFile(n[o.id])})}),e.bind("Flash:GenericError",function(t,o){e.trigger("Error",{code:i.GENERIC_ERROR,message:i.translate("Generic error."),details:o.message,file:e.getFile(n[o.id])})}),e.bind("Flash:IOError",function(t,o){e.trigger("Error",{code:i.IO_ERROR,message:i.translate("IO error."),details:o.message,file:e.getFile(n[o.id])})}),e.bind("Flash:ImageError",function(t,o){e.trigger("Error",{code:parseInt(o.code,10),message:i.translate("Image error."),file:e.getFile(n[o.id])})}),e.bind("Flash:StageEvent:rollOver",function(n){var o,r;o=t.getElementById(e.settings.browse_button),r=n.settings.browse_button_hover,o&&r&&i.addClass(o,r)}),e.bind("Flash:StageEvent:rollOut",function(n){var o,r;o=t.getElementById(e.settings.browse_button),r=n.settings.browse_button_hover,o&&r&&i.removeClass(o,r)}),e.bind("Flash:StageEvent:mouseDown",function(n){var o,r;o=t.getElementById(e.settings.browse_button),r=n.settings.browse_button_active,o&&r&&(i.addClass(o,r),i.addEvent(t.body,"mouseup",function(){i.removeClass(o,r)},n.id))}),e.bind("Flash:StageEvent:mouseUp",function(n){var o,r;o=t.getElementById(e.settings.browse_button),r=n.settings.browse_button_active,o&&r&&i.removeClass(o,r)}),e.bind("Flash:ExifData",function(t,i){e.trigger("ExifData",e.getFile(n[i.id]),i.data)}),e.bind("Flash:GpsData",function(t,i){e.trigger("GpsData",e.getFile(n[i.id]),i.data)}),e.bind("QueueChanged",function(){e.refresh()}),e.bind("FilesRemoved",function(e,t){var i;for(i=0;t.length>i;i++)a().removeFile(n[t[i].id])}),e.bind("StateChanged",function(){e.refresh()}),e.bind("Refresh",function(n){var o,r,s;a().setFileFilters(e.settings.filters,e.settings.multi_selection),o=t.getElementById(n.settings.browse_button),o&&(r=i.getPos(o,t.getElementById(n.settings.container)),s=i.getSize(o),i.extend(t.getElementById(n.id+"_flash_container").style,{top:r.y+"px",left:r.x+"px",width:s.w+"px",height:s.h+"px"}))
}),e.bind("DisableBrowse",function(e,t){a().disableBrowse(t)}),s({success:!0}))}),void 0)}})}(window,document,plupload),function(e){e.runtimes.BrowserPlus=e.addRuntime("browserplus",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(t,i){function n(i){var n,o,r,a=[];for(n=0;i.length>n;n++)o=i[n],r=e.guid(),s[r]=o,a.push(new e.File(r,o.name,o.size));n&&t.trigger("FilesAdded",a)}function o(){var o=!1;t.bind("PostInit",function(){function i(e,t){r.DragAndDrop.AddDropTarget({id:e},function(){r.DragAndDrop.AttachCallbacks({id:e,hover:function(e){!e&&t&&t()},drop:function(e){t&&t(),n(e)}},function(){})})}function s(){document.getElementById(d).style.top="-1000px"}var l,c=a.drop_element,d=t.id+"_droptarget",u=document.getElementById(c);u&&(document.attachEvent&&/MSIE/gi.test(navigator.userAgent)?(l=document.createElement("div"),l.setAttribute("id",d),e.extend(l.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0}),document.body.appendChild(l),e.addEvent(u,"dragenter",function(){var t,i;t=document.getElementById(c),i=e.getPos(t),e.extend(document.getElementById(d).style,{top:i.y+"px",left:i.x+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px"})}),i(d,s)):i(c)),e.addEvent(document.getElementById(a.browse_button),"click",function(t){var i,s,l,c,d=[],u=a.filters;if(t.preventDefault(),!o){e:for(i=0;u.length>i;i++)for(l=u[i].extensions.split(","),s=0;l.length>s;s++){if("*"===l[s]){d=[];break e}c=e.mimeTypes[l[s]],c&&-1===e.inArray(c,d)&&d.push(e.mimeTypes[l[s]])}r.FileBrowse.OpenBrowseDialog({mimeTypes:d},function(e){e.success&&n(e.value)})}}),u=l=null}),t.bind("CancelUpload",function(){r.Uploader.cancel({},function(){})}),t.bind("DisableBrowse",function(e,t){o=t}),t.bind("UploadFile",function(t,i){function n(o,s){var l;i.status!=e.FAILED&&(d.name=i.target_name||i.name,u&&(d.chunk=""+o,d.chunks=""+s),l=h.shift(),r.Uploader.upload({url:t.settings.url,files:{file:l},cookies:document.cookies,postvars:e.extend(d,t.settings.multipart_params),progressCallback:function(e){var n,r=0;for(a[o]=parseInt(e.filePercent*l.size/100,10),n=0;a.length>n;n++)r+=a[n];i.loaded=r,t.trigger("UploadProgress",i)}},function(r){var a;r.success?(a=r.value.statusCode,u&&t.trigger("ChunkUploaded",i,{chunk:o,chunks:s,response:r.value.body,status:a}),h.length>0?n(++o,s):(i.status=e.DONE,t.trigger("FileUploaded",i,{response:r.value.body,status:a}),a>=400&&t.trigger("Error",{code:e.HTTP_ERROR,message:e.translate("HTTP Error."),file:i,status:a}))):t.trigger("Error",{code:e.GENERIC_ERROR,message:e.translate("Generic Error."),file:i,details:r.error})}))}function o(e){i.size=e.size,u?r.FileAccess.chunk({file:e,chunkSize:u},function(e){if(e.success){var t=e.value,i=t.length;a=Array(i);for(var o=0;i>o;o++)a[o]=0,h.push(t[o]);n(0,i)}}):(a=Array(1),h.push(e),n(0,1))}var a,c=s[i.id],d={},u=t.settings.chunk_size,h=[];l&&/\.(png|jpg|jpeg)$/i.test(i.name)?BrowserPlus.ImageAlter.transform({file:c,quality:l.quality||90,actions:[{scale:{maxwidth:l.width,maxheight:l.height}}]},function(e){e.success&&o(e.value.file)}):o(c)}),i({success:!0})}var r=window.BrowserPlus,s={},a=t.settings,l=a.resize;r?r.init(function(e){var t=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"},{service:"FileAccess",version:"2"}];l&&t.push({service:"ImageAlter",version:"4"}),e.success?r.require({services:t},function(e){e.success?o():i()}):i()}):i()}})}(plupload),function(e,t,n,o){function r(t,i){var n;return"FileReader"in e?(n=new FileReader,n.readAsDataURL(t),n.onload=function(){i(n.result)},void 0):i(t.getAsDataURL())}function s(t,i){var n;return"FileReader"in e?(n=new FileReader,n.readAsBinaryString(t),n.onload=function(){i(n.result)},void 0):i(t.getAsBinary())}function a(e,i,n,o){var s,a,l,u,p=this;r(h[e.id],function(r){s=t.createElement("canvas"),s.style.display="none",t.body.appendChild(s),a=s.getContext("2d"),l=new Image,l.onerror=l.onabort=function(){o({success:!1})},l.onload=function(){var t,h,f,m;if(i.width||(i.width=l.width),i.height||(i.height=l.height),u=Math.min(i.width/l.width,i.height/l.height),1>u||1===u&&"image/jpeg"===n){if(t=Math.round(l.width*u),h=Math.round(l.height*u),s.width=t,s.height=h,a.drawImage(l,0,0,t,h),"image/jpeg"===n){if(f=new c(atob(r.substring(r.indexOf("base64,")+7))),f.headers&&f.headers.length&&(m=new d,m.init(f.get("exif")[0])&&(m.setExif("PixelXDimension",t),m.setExif("PixelYDimension",h),f.set("exif",m.getBinary()),p.hasEventListener("ExifData")&&p.trigger("ExifData",e,m.EXIF()),p.hasEventListener("GpsData")&&p.trigger("GpsData",e,m.GPS()))),i.quality)try{r=s.toDataURL(n,i.quality/100)}catch(g){r=s.toDataURL(n)}}else r=s.toDataURL(n);r=r.substring(r.indexOf("base64,")+7),r=atob(r),f&&f.headers&&f.headers.length&&(r=f.restore(r),f.purge()),s.parentNode.removeChild(s),o({success:!0,data:r})}else o({success:!1})},l.src=r})}function l(){function e(e,t){var i,o=r?0:-8*(t-1),s=0;for(i=0;t>i;i++)s|=n.charCodeAt(e+i)<<Math.abs(o+8*i);return s}function t(e,t,i){var i=3===arguments.length?i:n.length-t-1;n=n.substr(0,t)+e+n.substr(i+t)}function i(e,i,n){var o,s="",a=r?0:-8*(n-1);for(o=0;n>o;o++)s+=String.fromCharCode(255&i>>Math.abs(a+8*o));t(s,e,n)}var n,r=!1;return{II:function(e){return e===o?r:(r=e,void 0)},init:function(e){r=!1,n=e},SEGMENT:function(e,i,o){switch(arguments.length){case 1:return n.substr(e,n.length-e-1);case 2:return n.substr(e,i);case 3:t(o,e,i);break;default:return n}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,n){return n===o?e(t,4):(i(t,n,4),void 0)},SLONG:function(t){var i=e(t,4);return i>2147483647?i-4294967296:i},STRING:function(t,i){var n="";for(i+=t;i>t;t++)n+=String.fromCharCode(e(t,1));return n}}}function c(e){var t,i,n,r={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},s=[],a=o,d=0;if(t=new l,t.init(e),65496===t.SHORT(0)){for(i=2,n=Math.min(1048576,e.length);n>=i;)if(a=t.SHORT(i),a>=65488&&65495>=a)i+=2;else{if(65498===a||65497===a)break;d=t.SHORT(i+2)+2,r[a]&&t.STRING(i+4,r[a].signature.length)===r[a].signature&&s.push({hex:a,app:r[a].app.toUpperCase(),name:r[a].name.toUpperCase(),start:i,length:d,segment:t.SEGMENT(i,d)}),i+=d}return t.init(null),{headers:s,restore:function(e){t.init(e);var n=new c(e);if(!n.headers)return!1;for(var o=n.headers.length;o>0;o--){var r=n.headers[o-1];t.SEGMENT(r.start,r.length,"")}n.purge(),i=65504==t.SHORT(2)?4+t.SHORT(4):2;for(var o=0,a=s.length;a>o;o++)t.SEGMENT(i,0,s[o].segment),i+=s[o].length;return t.SEGMENT()},get:function(e){for(var t=[],i=0,n=s.length;n>i;i++)s[i].app===e.toUpperCase()&&t.push(s[i].segment);return t},set:function(e,t){var i=[];"string"==typeof t?i.push(t):i=t;for(var n=ii=0,o=s.length;o>n&&(s[n].app===e.toUpperCase()&&(s[n].segment=i[ii],s[n].length=i[ii].length,ii++),!(ii>=i.length));n++);},purge:function(){s=[],t.init(null)}}}}function d(){function e(e,t){var i,n,r,a,l,u,h,p,f=s.SHORT(e),m=[],g={};for(i=0;f>i;i++)if(h=u=e+12*i+2,r=t[s.SHORT(h)],r!==o){switch(a=s.SHORT(h+=2),l=s.LONG(h+=2),h+=4,m=[],a){case 1:case 7:for(l>4&&(h=s.LONG(h)+d.tiffHeader),n=0;l>n;n++)m[n]=s.BYTE(h+n);break;case 2:l>4&&(h=s.LONG(h)+d.tiffHeader),g[r]=s.STRING(h,l-1);continue;case 3:for(l>2&&(h=s.LONG(h)+d.tiffHeader),n=0;l>n;n++)m[n]=s.SHORT(h+2*n);break;case 4:for(l>1&&(h=s.LONG(h)+d.tiffHeader),n=0;l>n;n++)m[n]=s.LONG(h+4*n);break;case 5:for(h=s.LONG(h)+d.tiffHeader,n=0;l>n;n++)m[n]=s.LONG(h+4*n)/s.LONG(h+4*n+4);break;case 9:for(h=s.LONG(h)+d.tiffHeader,n=0;l>n;n++)m[n]=s.SLONG(h+4*n);break;case 10:for(h=s.LONG(h)+d.tiffHeader,n=0;l>n;n++)m[n]=s.SLONG(h+4*n)/s.SLONG(h+4*n+4);break;default:continue}p=1==l?m[0]:m,g[r]=c.hasOwnProperty(r)&&"object"!=typeof p?c[r][p]:p}return g}function t(){var t=o,i=d.tiffHeader;return s.II(18761==s.SHORT(i)),42!==s.SHORT(i+=2)?!1:(d.IFD0=d.tiffHeader+s.LONG(i+=2),t=e(d.IFD0,a.tiff),d.exifIFD="ExifIFDPointer"in t?d.tiffHeader+t.ExifIFDPointer:o,d.gpsIFD="GPSInfoIFDPointer"in t?d.tiffHeader+t.GPSInfoIFDPointer:o,!0)}function r(e,t,n){var o,r,l,c=0;if("string"==typeof t){var u=a[e.toLowerCase()];for(hex in u)if(u[hex]===t){t=hex;break}}for(o=d[e.toLowerCase()+"IFD"],r=s.SHORT(o),i=0;r>i;i++)if(l=o+12*i+2,s.SHORT(l)==t){c=l+8;break}return c?(s.LONG(c,n),!0):!1}var s,a,c,d={};return s=new l,a={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},c={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return d={tiffHeader:10},e!==o&&e.length?(s.init(e),65505===s.SHORT(0)&&"EXIF\0"===s.STRING(4,5).toUpperCase()?t():!1):!1},EXIF:function(){var t;if(t=e(d.exifIFD,a.exif),t.ExifVersion&&"array"===n.typeOf(t.ExifVersion)){for(var i=0,o="";t.ExifVersion.length>i;i++)o+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=o}return t},GPS:function(){var t;return t=e(d.gpsIFD,a.gps),t.GPSVersionID&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:r("exif",e,t)},getBinary:function(){return s.SEGMENT()}}}var u,h={};n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,o,r,s,a,l;return o=r=a=l=!1,e.XMLHttpRequest&&(i=new XMLHttpRequest,r=!!i.upload,o=!(!i.sendAsBinary&&!i.upload)),o&&(s=!!(i.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),a=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!s),l=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),u=n.ua.safari&&n.ua.windows,{html5:o,dragdrop:function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),jpgresize:a,pngresize:a,multipart:a||!!e.FileReader||!!e.FormData,canSendBinary:s,cantSendBlobInFormData:!(!(n.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:r,chunks:l,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(i,o){function r(e){var t,o,r,s=[],a={};for(o=0;e.length>o;o++)t=e[o],a[t.name]||(a[t.name]=!0,r=n.guid(),h[r]=t,s.push(new n.File(r,t.fileName||t.name,t.fileSize||t.size)));s.length&&i.trigger("FilesAdded",s)}var l,c;return l=this.getFeatures(),l.html5?(i.bind("Init",function(e){var o,s,a,l,c,d,u,h=[],p=e.settings.filters,f=t.body;o=t.createElement("div"),o.id=e.id+"_html5_container",n.extend(o.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),o.className="plupload html5",i.settings.container&&(f=t.getElementById(i.settings.container),"static"===n.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(o);e:for(a=0;p.length>a;a++)for(c=p[a].extensions.split(/,/),l=0;c.length>l;l++){if("*"===c[l]){h=[];break e}d=n.mimeTypes[c[l]],d&&-1===n.inArray(d,h)&&h.push(d)}if(o.innerHTML='<input id="'+i.id+'_html5"  style="font-size:999px" type="file" accept="'+h.join(",")+'" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",o.scrollTop=100,u=t.getElementById(i.id+"_html5"),e.features.triggerDialog?n.extend(u.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(u.style,{cssFloat:"right",styleFloat:"right"}),u.onchange=function(){r(this.files),this.value=""},s=t.getElementById(e.settings.browse_button)){var m=e.settings.browse_button_hover,g=e.settings.browse_button_active,v=e.features.triggerDialog?s:o;m&&(n.addEvent(v,"mouseover",function(){n.addClass(s,m)},e.id),n.addEvent(v,"mouseout",function(){n.removeClass(s,m)},e.id)),g&&(n.addEvent(v,"mousedown",function(){n.addClass(s,g)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(s,g)},e.id)),e.features.triggerDialog&&n.addEvent(s,"click",function(i){var n=t.getElementById(e.id+"_html5");n&&!n.disabled&&n.click(),i.preventDefault()},e.id)}}),i.bind("PostInit",function(){var e=t.getElementById(i.settings.drop_element);if(e){if(u)return n.addEvent(e,"dragenter",function(){var o,s,a;o=t.getElementById(i.id+"_drop"),o||(o=t.createElement("input"),o.setAttribute("type","file"),o.setAttribute("id",i.id+"_drop"),o.setAttribute("multiple","multiple"),n.addEvent(o,"change",function(){r(this.files),n.removeEvent(o,"change",i.id),o.parentNode.removeChild(o)},i.id),e.appendChild(o)),s=n.getPos(e,t.getElementById(i.settings.container)),a=n.getSize(e),"static"===n.getStyle(e,"position")&&n.extend(e.style,{position:"relative"}),n.extend(o.style,{position:"absolute",display:"block",top:0,left:0,width:a.w+"px",height:a.h+"px",opacity:0})},i.id),void 0;n.addEvent(e,"dragover",function(e){e.preventDefault()},i.id),n.addEvent(e,"drop",function(e){var t=e.dataTransfer;t&&t.files&&r(t.files),e.preventDefault()},i.id)}}),i.bind("Refresh",function(e){var o,r,s,a,l;o=t.getElementById(i.settings.browse_button),o&&(r=n.getPos(o,t.getElementById(e.settings.container)),s=n.getSize(o),a=t.getElementById(i.id+"_html5_container"),n.extend(a.style,{top:r.y+"px",left:r.x+"px",width:s.w+"px",height:s.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(o,"position")&&n.extend(o.style,{position:"relative"}),l=parseInt(n.getStyle(o,"z-index"),10),isNaN(l)&&(l=0),n.extend(o.style,{zIndex:l}),n.extend(a.style,{zIndex:l-1})))}),i.bind("DisableBrowse",function(e,i){var n=t.getElementById(e.id+"_html5");n&&(n.disabled=i)}),i.bind("CancelUpload",function(){c&&c.abort&&c.abort()}),i.bind("UploadFile",function(t,i){function o(e,t,i){var n;if(!File.prototype.slice)return(n=File.prototype.webkitSlice||File.prototype.mozSlice)?n.call(e,t,i):null;try{return e.slice(),e.slice(t,i)}catch(o){return e.slice(t,i-t)}}function r(r){function s(){function p(o){var r,u=0,h="----pluploadboundary"+n.guid(),p="--",w="\r\n",x="";if(c=new XMLHttpRequest,c.upload&&(c.upload.onprogress=function(e){i.loaded=Math.min(i.size,d+e.loaded-u),t.trigger("UploadProgress",i)}),c.onreadystatechange=function(){var e,l;if(4==c.readyState&&t.state!==n.STOPPED){try{e=c.status}catch(u){e=0}if(e>=400)t.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:e});else{if(m){if(l={chunk:a,chunks:m,response:c.responseText,status:e},t.trigger("ChunkUploaded",i,l),d+=y,l.cancelled)return i.status=n.FAILED,void 0;i.loaded=Math.min(i.size,(a+1)*v)}else i.loaded=i.size;t.trigger("UploadProgress",i),o=f=r=x=null,!m||++a>=m?(i.status=n.DONE,t.trigger("FileUploaded",i,{response:c.responseText,status:e})):s()}}},t.settings.multipart&&l.multipart){if(g.name=i.target_name||i.name,c.open("post",_,!0),n.each(t.settings.headers,function(e,t){c.setRequestHeader(t,e)}),"string"!=typeof o&&e.FormData)return r=new FormData,n.each(n.extend(g,t.settings.multipart_params),function(e,t){r.append(t,e)}),r.append(t.settings.file_data_name,o),c.send(r),void 0;if("string"==typeof o){if(c.setRequestHeader("Content-Type","multipart/form-data; boundary="+h),n.each(n.extend(g,t.settings.multipart_params),function(e,t){x+=p+h+w+'Content-Disposition: form-data; name="'+t+'"'+w+w,x+=unescape(encodeURIComponent(e))+w}),b=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",x+=p+h+w+'Content-Disposition: form-data; name="'+t.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+w+"Content-Type: "+b+w+w+o+w+p+h+p+w,u=x.length-o.length,o=x,c.sendAsBinary)c.sendAsBinary(o);else if(l.canSendBinary){for(var C=new Uint8Array(o.length),T=0;o.length>T;T++)C[T]=255&o.charCodeAt(T);c.send(C.buffer)}return}}_=n.buildUrl(t.settings.url,n.extend(g,t.settings.multipart_params)),c.open("post",_,!0),c.setRequestHeader("Content-Type","application/octet-stream"),n.each(t.settings.headers,function(e,t){c.setRequestHeader(t,e)}),c.send(o)}var f,m,g,v,y,b,_=t.settings.url;i.status!=n.DONE&&i.status!=n.FAILED&&t.state!=n.STOPPED&&(g={name:i.target_name||i.name},u.chunk_size&&i.size>u.chunk_size&&(l.chunks||"string"==typeof r)?(v=u.chunk_size,m=Math.ceil(i.size/v),y=Math.min(v,i.size-a*v),f="string"==typeof r?r.substring(a*v,a*v+y):o(r,a*v,a*v+y),g.chunk=a,g.chunks=m):(y=i.size,f=r),t.settings.multipart&&l.multipart&&"string"!=typeof f&&h&&l.cantSendBlobInFormData&&l.chunks&&t.settings.chunk_size?(h.onload=function(){p(h.result)},h.readAsBinaryString(f)):p(f))}var a=0,d=0,h="FileReader"in e?new FileReader:null;s()}var d,u=t.settings;d=h[i.id],l.jpgresize&&t.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?a.call(t,i,t.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",function(e){e.success?(i.size=e.data.length,r(e.data)):l.chunks?r(d):s(d,r)}):!l.chunks&&l.jpgresize?s(d,r):r(d)}),i.bind("Destroy",function(e){var i,o,r=t.body,s={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(i in s)o=t.getElementById(s[i]),o&&n.removeAllEvents(o,e.id);n.removeAllEvents(t.body,e.id),e.settings.container&&(r=t.getElementById(e.settings.container)),r.removeChild(t.getElementById(s.inputContainer))}),o({success:!0}),void 0):(o({success:!1}),void 0)}})}(window,document,plupload),function(e,t,i){function n(e){return t.getElementById(e)}i.runtimes.Html4=i.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:i.ua.gecko&&e.FormData||i.ua.webkit}},init:function(o,r){o.bind("Init",function(r){function s(){var e,a,l,c;d=i.guid(),v.push(d),e=t.createElement("form"),e.setAttribute("id","form_"+d),e.setAttribute("method","post"),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("encoding","multipart/form-data"),e.setAttribute("target",r.id+"_iframe"),e.style.position="absolute",a=t.createElement("input"),a.setAttribute("id","input_"+d),a.setAttribute("type","file"),a.setAttribute("accept",b),a.setAttribute("size",1),c=n(r.settings.browse_button),r.features.triggerDialog&&c&&i.addEvent(n(r.settings.browse_button),"click",function(e){a.disabled||a.click(),e.preventDefault()},r.id),i.extend(a.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"}),i.extend(e.style,{overflow:"hidden"}),l=r.settings.shim_bgcolor,l&&(e.style.background=l),y&&i.extend(a.style,{filter:"alpha(opacity=0)"}),i.addEvent(a,"change",function(t){var l,u=t.target,h=[];u.value&&(n("form_"+d).style.top="-1048575px",l=u.value.replace(/\\/g,"/"),l=l.substring(l.length,l.lastIndexOf("/")+1),h.push(new i.File(d,l)),r.features.triggerDialog?i.removeEvent(c,"click",r.id):i.removeAllEvents(e,r.id),i.removeEvent(a,"change",r.id),s(),h.length&&o.trigger("FilesAdded",h))},r.id),e.appendChild(a),m.appendChild(e),r.refresh()}function a(){var n=t.createElement("div");n.innerHTML='<iframe id="'+r.id+'_iframe" name="'+r.id+'_iframe" src="'+g+':&quot;&quot;" style="display:none"></iframe>',l=n.firstChild,m.appendChild(l),i.addEvent(l,"load",function(t){var n,o,s=t.target;if(c){try{n=s.contentWindow.document||s.contentDocument||e.frames[s.id].document}catch(a){return r.trigger("Error",{code:i.SECURITY_ERROR,message:i.translate("Security error."),file:c}),void 0}o=n.body.innerHTML,o&&(c.status=i.DONE,c.loaded=1025,c.percent=100,r.trigger("UploadProgress",c),r.trigger("FileUploaded",c,{response:o}))}},r.id)}var l,c,d,u,h,p,f,m=t.body,g="javascript",v=[],y=/MSIE/.test(navigator.userAgent),b=[],_=r.settings.filters;e:for(u=0;_.length>u;u++)for(h=_[u].extensions.split(/,/),f=0;h.length>f;f++){if("*"===h[f]){b=[];break e}p=i.mimeTypes[h[f]],p&&-1===i.inArray(p,b)&&b.push(p)}b=b.join(","),r.settings.container&&(m=n(r.settings.container),"static"===i.getStyle(m,"position")&&(m.style.position="relative")),r.bind("UploadFile",function(e,o){var r,s;o.status!=i.DONE&&o.status!=i.FAILED&&e.state!=i.STOPPED&&(r=n("form_"+o.id),s=n("input_"+o.id),s.setAttribute("name",e.settings.file_data_name),r.setAttribute("action",e.settings.url),i.each(i.extend({name:o.target_name||o.name},e.settings.multipart_params),function(e,n){var o=t.createElement("input");i.extend(o,{type:"hidden",name:n,value:e}),r.insertBefore(o,r.firstChild)}),c=o,n("form_"+d).style.top="-1048575px",r.submit())}),r.bind("FileUploaded",function(e){e.refresh()}),r.bind("StateChanged",function(t){t.state==i.STARTED?a():t.state==i.STOPPED&&e.setTimeout(function(){i.removeEvent(l,"load",t.id),l.parentNode&&l.parentNode.removeChild(l)},0),i.each(t.files,function(e){if(e.status===i.DONE||e.status===i.FAILED){var t=n("form_"+e.id);t&&t.parentNode.removeChild(t)}})}),r.bind("Refresh",function(e){var o,r,s,a,l,c,u,h,p;o=n(e.settings.browse_button),o&&(l=i.getPos(o,n(e.settings.container)),c=i.getSize(o),u=n("form_"+d),h=n("input_"+d),i.extend(u.style,{top:l.y+"px",left:l.x+"px",width:c.w+"px",height:c.h+"px"}),e.features.triggerDialog&&("static"===i.getStyle(o,"position")&&i.extend(o.style,{position:"relative"}),p=parseInt(o.style.zIndex,10),isNaN(p)&&(p=0),i.extend(o.style,{zIndex:p}),i.extend(u.style,{zIndex:p-1})),s=e.settings.browse_button_hover,a=e.settings.browse_button_active,r=e.features.triggerDialog?o:u,s&&(i.addEvent(r,"mouseover",function(){i.addClass(o,s)},e.id),i.addEvent(r,"mouseout",function(){i.removeClass(o,s)},e.id)),a&&(i.addEvent(r,"mousedown",function(){i.addClass(o,a)},e.id),i.addEvent(t.body,"mouseup",function(){i.removeClass(o,a)},e.id)))}),o.bind("FilesRemoved",function(e,t){var i,o;for(i=0;t.length>i;i++)o=n("form_"+t[i].id),o&&o.parentNode.removeChild(o)}),o.bind("DisableBrowse",function(e,i){var n=t.getElementById("input_"+d);n&&(n.disabled=i)}),o.bind("Destroy",function(e){var o,r,s,a={inputContainer:"form_"+d,inputFile:"input_"+d,browseButton:e.settings.browse_button};for(o in a)r=n(a[o]),r&&i.removeAllEvents(r,e.id);i.removeAllEvents(t.body,e.id),i.each(v,function(e){s=n("form_"+e),s&&m.removeChild(s)})}),s()}),r({success:!0})}})}(window,document,plupload);var UKEventType={FileUploaded:"UKFileUploaded",UploadComplete:"UKUploadComplete",UploadError:"UKUploadError"},UploadKit=function(e,t){if(!window.plupload)return console.error("Unable to initialize UploadKit; Plupload dependency not found"),null;var i=$(e),n=i.closest("form"),o=Date.now?Date.now():+new Date,r="";$("script").each(function(e,t){var i=$(t).attr("src")||"",n=i.indexOf("uploadkit.js");-1!==n&&(r=0===n?"./":i.substring(0,n))});var s=this,a=this.name=i.attr("name"),l=this.isMultiple=!!i.attr("multiple"),c=this.uploadUrl=i.data("uploadUrl")||n.attr("action"),d=this.maxFileSize=i.data("maxFileSize")||this.maxFileSize,u=(i.attr("class")+"").replace(/uk-input/g,""),h=this.$element=i.wrap('<div id="uk-container-'+o+'" class="uk-container '+u+'"/>').parent();h.data("uploadKit",this),i.data("uploadKit",this),i.attr("disabled",!0);var p=l?"<h1>No Files Selected</h1><h2>Browse for files to upload or drag and drop them here</h2>":"<h1>No File Selected</h1><h2>Browse for file to upload or drag and drop it here</h2>",f=this.$info=$('<div class="uk-info"/>').html(p).appendTo(h),m=this.$table=$('<table class="table table-condensed"/>').appendTo(h).hide();this.$thead=$("<thead/>").html("<tr><th/><th/><th>File Name</th><th>Size</th><th>Progress</th></tr>").appendTo(m);var g=this.$tbody=$("<tbody/>").appendTo(m),v=this.$browseButton=$('<a id="uk-browse-button-'+o+'" class="btn" href="#"/>').html('<i class="icon-file"/>Browse...').appendTo(h),y=this.$uploadButton=$('<a id="uk-upload-button-'+o+'" class="btn btn-primary" href="#"/>').html('<i class="icon-upload icon-white"/>Upload').appendTo(h).hide(),b=this.uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,gears,browserplus,html4",container:"uk-container-"+o,drop_element:"uk-container-"+o,browse_button:"uk-browse-button-"+o,file_data_name:a,multi_selection:l,url:c,max_file_size:d,flash_swf_url:"/assets/jquery.plupload.1.5.4/js/plupload.flash.swf",silverlight_xap_url:"/assets/jquery.plupload.1.5.4/js/plupload.silverlight.xap",filters:[]}),_=this.responses=[];b.bind("Init",function(){}),b.bind("FilesAdded",function(e,t){f.hide(),m.show(),y.removeClass("disabled").show();var i=t;if(!l){var n=e.files;n.length>0&&e.removeFile(n[0]),t.length>0&&(i=[t[0]]),g.children("tr.error").remove()}for(var o=0,r=i.length;r>o;o++)g.append('<tr id="'+i[o].id+'">'+'<td class="uk-close-column"><a class="close" title="Remove" href="#">&times;</a></td>'+'<td class="uk-icon-column"><i class="icon-file"/></td>'+"<td>"+i[o].name+"</td>"+'<td class="uk-size-column">'+plupload.formatSize(i[o].size)+"</td>"+'<td class="uk-progress-column">'+'<div class="progress progress-info progress-striped active">'+'<div class="bar"/>'+"</div>"+"</td>"+"</tr>")}),b.bind("FilesRemoved",function(e,t){for(var i=t,n=0,o=i.length;o>n;n++)g.children("#"+i[n].id).remove()}),b.bind("BeforeUpload",function(e){for(var i=t,o=n.serializeArray(),r=0,s=o.length;s>r;r++){var a=o[r],l=a.name;l&&(i[l]=a.value)}e.settings.multipart_params=i}),b.bind("UploadProgress",function(e,t){var i=g.find("#"+t.id),n=i.find(".bar");n.css("width",t.percent+"%")}),b.bind("FileUploaded",function(e,t,n){var o=g.find("#"+t.id),r=o.find(".progress"),s=r.find(".bar");r.removeClass("progress-info active").addClass("progress-success"),s.html("Done"),_.push(n),i.trigger($.Event(UKEventType.FileUploaded,{uploader:e,file:t,response:n}))}),b.bind("UploadComplete",function(e,t){i.trigger($.Event(UKEventType.UploadComplete,{uploader:e,files:t,responses:_}))}),b.bind("Error",function(e,t){var n,o=g.find("#"+t.file.id).addClass("error"),r=o.children(".uk-progress-column");switch(t.code){case-600:n="File size exceeds limit";break;default:n="Unknown error occurred"}r.html(n),0===e.files.length&&y.addClass("disabled"),i.trigger($.Event(UKEventType.UploadError,{uploader:e,error:t}))}),g.delegate("a.close","click",function(e){var t=$(this),i=t.closest("tr"),n=i.attr("id"),o=b.getFile(n);1>=b.files.length&&(f.show(),m.hide(),v.show(),y.hide()),o?b.removeFile(o):i.remove(),e.preventDefault()}),y.bind("click",function(e){return y.hasClass("disabled")?!1:(y.addClass("disabled"),_=s.responses=[],b.start(),e.preventDefault(),void 0)}),b.init()};UploadKit.prototype={$element:null,$info:null,$table:null,$thead:null,$tbody:null,$browseButton:null,$uploadButton:null,name:null,isMultiple:!1,uploadUrl:null,maxFileSize:"10mb",uploader:null,responses:null},$(function(){var e=$('input.uk-input[type="file"]');e.each(function(e,t){new UploadKit(t)})}),$(document).ready(function(){$(".change-upload-file-btn").bind("click",function(e){e.preventDefault();var t=$(this).find(".ui-btn-text:first");t.length||(t=$(this));var i=t.html(),n=$(this).attr("data-text");t.html(n),$(this).attr("data-text",i),$(this).parent().parent().find(".js-file-preview:first").toggle("fast").parent().find(".file-field:first").slideToggle("fast")}),$(".delete-file-btn").bind("click",function(e){e.preventDefault(),$(this).parent().parent().find(".js-file-preview:first").toggle("fast").parent().find(".file-field:first").slideToggle("fast").find("input.file").val("")}),$("ol#image_folders_nested_set li a").live("click",function(){$("ol#image_folders_nested_set li").removeClass("ui-selected"),$(this).parent().addClass("ui-selected")})});var CKEDITOR_BASEPATH="/assets/ckeditor/";/*
 * WYMeditor : what you see is What You Mean web-based editor
 * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/
 * Dual licensed under the MIT (MIT-license.txt)
 * and GPL (GPL-license.txt) licenses.
 *
 * For further information visit:
 *        http://www.wymeditor.org/
 *
 * File: jquery.gko.wymeditor.js
 *
 *        Main JS file with core classes and functions.
 *        See the documentation for more info.
 *
 * About: authors
 *
 *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)
 *        Volker Mische (vmx a-t gmx dotde)
 *        Scott Lewis (lewiscot a-t gmail dotcom)
 *        Bermi Ferrer (wymeditor a-t bermi dotorg)
 *        Daniel Reszka (d.reszka a-t wymeditor dotorg)
 *        Jonatan Lundin (jonatan.lundin a-t gmail dotcom)
 */
if(!WYMeditor)var WYMeditor={};(function(){if(window.console&&console.firebug)WYMeditor.console=window.console;else{var e=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];WYMeditor.console={};for(var t=0;e.length>t;++t)WYMeditor.console[e[t]]=function(){}}})(),$.extend(WYMeditor,{VERSION:"0.5-rc1-gko",INSTANCES:[],STRINGS:[],SKINS:[],NAME:"name",INDEX:"{Wym_Index}",WYM_INDEX:"wym_index",BASE_PATH:"{Wym_Base_Path}",CSS_PATH:"{Wym_Css_Path}",WYM_PATH:"{Wym_Wym_Path}",SKINS_DEFAULT_PATH:"/assets/wymeditor/skins/gko",SKINS_DEFAULT_CSS:"skin.css",SKINS_DEFAULT_JS:"skin.js",LANG_DEFAULT_PATH:"lang/",IFRAME_BASE_PATH:"{Wym_Iframe_Base_Path}",IFRAME_DEFAULT:"iframe/default/",JQUERY_PATH:"{Wym_Jquery_Path}",DIRECTION:"{Wym_Direction}",LOGO:"{Wym_Logo}",TOOLS:"{Wym_Tools}",TOOLS_ITEMS:"{Wym_Tools_Items}",TOOL_NAME:"{Wym_Tool_Name}",TOOL_TITLE:"{Wym_Tool_Title}",TOOL_CLASS:"{Wym_Tool_Class}",CLASSES:"{Wym_Classes}",CLASSES_ITEMS:"{Wym_Classes_Items}",CLASS_NAME:"{Wym_Class_Name}",CLASS_TITLE:"{Wym_Class_Title}",CONTAINERS:"{Wym_Containers}",CONTAINERS_ITEMS:"{Wym_Containers_Items}",CONTAINER_NAME:"{Wym_Container_Name}",CONTAINER_TITLE:"{Wym_Containers_Title}",CONTAINER_CLASS:"{Wym_Container_Class}",HTML:"{Wym_Html}",IFRAME:"{Wym_Iframe}",STATUS:"{Wym_Status}",DIALOG_TITLE:"{Wym_Dialog_Title}",DIALOG_BODY:"{Wym_Dialog_Body}",STRING:"string",BODY:"body",DIV:"div",P:"p",H1:"h1",H2:"h2",H3:"h3",H4:"h4",H5:"h5",H6:"h6",PRE:"pre",BLOCKQUOTE:"blockquote",A:"a",BR:"br",IMG:"img",TABLE:"table",TD:"td",TH:"th",UL:"ul",OL:"ol",LI:"li",CLASS:"class",HREF:"href",SRC:"src",TITLE:"title",TARGET:"target",ALT:"alt",REL:"rel",DIALOG_LINK:"Link",DIALOG_IMAGE:"Image",DIALOG_TABLE:"Table",DIALOG_PASTE:"Paste_From_Word",DIALOG_CLASS:"Css_Class",BOLD:"Bold",ITALIC:"Italic",CREATE_LINK:"CreateLink",INSERT_IMAGE:"InsertImage",INSERT_TABLE:"InsertTable",INSERT_HTML:"InsertHTML",APPLY_CLASS:"Apply_Style",PASTE:"Paste",INDENT:"Indent",OUTDENT:"Outdent",TOGGLE_HTML:"ToggleHtml",FORMAT_BLOCK:"FormatBlock",PREVIEW:"Preview",UNLINK:"Unlink",INSERT_UNORDEREDLIST:"InsertUnorderedList",INSERT_ORDEREDLIST:"InsertOrderedList",MAIN_CONTAINERS:new Array("p","h1","h2","h3","h4","h5","h6","pre","blockquote"),BLOCKS:new Array("address","blockquote","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","noscript","ol","p","pre","table","ul","dd","dt","li","tbody","td","tfoot","th","thead","tr","meter","section","article","aside","details","header","footer","nav","dialog","figure","figcaption","address","hgroup","mark","time","canvas","audio","video","source","output","progress","ruby","rt","rp","summary","command"),KEY:{BACKSPACE:8,ENTER:13,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,CURSOR:new Array(37,38,39,40),DELETE:46},NODE:{ELEMENT:1,ATTRIBUTE:2,TEXT:3},editor:function(e,t){this._index=WYMeditor.INSTANCES.push(this)-1,this._element=e,this._options=t,this._html=$(e).val(),this._options.html&&(this._html=this._options.html),this._options.basePath=this._options.basePath||this.computeBasePath(),this._options.skinPath=this._options.skinPath||this._options.basePath+WYMeditor.SKINS_DEFAULT_PATH+this._options.skin+"/",this._options.cssCompiledSkinPath=this._options.cssCompiledSkinPath||(this._options.cssSkinPath||this._options.skinPath)+this._options.skin+"/",this._options.jsCompiledSkinPath=this._options.jsCompiledSkinPath||(this._options.jsSkinPath||this._options.skinPath)+this._options.skin+"/",this._options.wymPath=this._options.wymPath||this.computeWymPath(),this._options.langPath=this._options.langPath||this._options.basePath+WYMeditor.LANG_DEFAULT_PATH,this._options.iframeBasePath=this._options.iframeBasePath||this._options.basePath+WYMeditor.IFRAME_DEFAULT,this._options.jQueryPath=this._options.jQueryPath||this.computeJqueryPath(),this.init()}}),$.fn.wymeditor=function(e){return e=$.extend({html:"",basePath:!1,skinPath:!1,jsSkinPath:!1,cssSkinPath:!1,wymPath:!1,iframeBasePath:!1,jQueryPath:!1,styles:!1,stylesheet:!1,skin:"default",initSkin:!0,loadSkin:!0,lang:"en",direction:"ltr",boxHtml:"<div class='wym_box'><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div>"+"<div class='wym_area_left'></div>"+"<div class='wym_area_right'>"+WYMeditor.CONTAINERS+WYMeditor.CLASSES+"</div>"+"<div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div>"+"<div class='wym_area_bottom'>"+WYMeditor.LOGO+"</div>"+"</div>",logoHtml:"<a class='wym_wymeditor_link' href='http://www.wymeditor.org/'>WYMeditor</a>",iframeHtml:"<div class='wym_iframe wym_section'><iframe src='"+WYMeditor.IFRAME_BASE_PATH+"wymiframe.html' onload='"+"this.contentWindow.parent.WYMeditor.INSTANCES["+WYMeditor.INDEX+"].initIframe(this)'>"+"</iframe>"+"</div>",editorStyles:[],toolsHtml:"<div class='wym_tools wym_section'><h2>{Tools}</h2><ul>"+WYMeditor.TOOLS_ITEMS+"</ul>"+"</div>",toolsItemHtml:"<li class='"+WYMeditor.TOOL_CLASS+"'>"+"<a href='#' name='"+WYMeditor.TOOL_NAME+"' title='"+WYMeditor.TOOL_TITLE+"'>"+WYMeditor.TOOL_TITLE+"</a>"+"</li>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"},{name:"Preview",title:"Preview",css:"wym_tools_preview"}],containersHtml:"<div class='wym_containers wym_section'><h2>{Containers}</h2><ul>"+WYMeditor.CONTAINERS_ITEMS+"</ul>"+"</div>",containersItemHtml:"<li class='"+WYMeditor.CONTAINER_CLASS+"'>"+"<a href='#' name='"+WYMeditor.CONTAINER_NAME+"'>"+WYMeditor.CONTAINER_TITLE+"</a>"+"</li>",containersItems:[{name:"P",title:"Paragraph",css:"wym_containers_p"},{name:"H1",title:"Heading_1",css:"wym_containers_h1"},{name:"H2",title:"Heading_2",css:"wym_containers_h2"},{name:"H3",title:"Heading_3",css:"wym_containers_h3"},{name:"H4",title:"Heading_4",css:"wym_containers_h4"},{name:"H5",title:"Heading_5",css:"wym_containers_h5"},{name:"H6",title:"Heading_6",css:"wym_containers_h6"},{name:"PRE",title:"Preformatted",css:"wym_containers_pre"},{name:"BLOCKQUOTE",title:"Blockquote",css:"wym_containers_blockquote"},{name:"TH",title:"Table_Header",css:"wym_containers_th"}],classesHtml:"<div class='wym_classes wym_section'><h2>{Classes}</h2><ul>"+WYMeditor.CLASSES_ITEMS+"</ul></div>",classesItemHtml:"<li class='wym_classes_"+WYMeditor.CLASS_NAME+"'>"+"<a href='#' name='"+WYMeditor.CLASS_NAME+"'>"+WYMeditor.CLASS_TITLE+"</a>"+"</li>",classesItems:[],statusHtml:"<div class='wym_status wym_section'><h2>{Status}</h2></div>",htmlHtml:"<div class='wym_html wym_section'><h2>{Source_Code}</h2><textarea class='wym_html_val'></textarea></div>",boxSelector:".wym_box",toolsSelector:".wym_tools",toolsListSelector:" ul",containersSelector:".wym_containers",classesSelector:".wym_classes",htmlSelector:".wym_html",iframeSelector:".wym_iframe iframe",iframeBodySelector:".wym_iframe",statusSelector:".wym_status",toolSelector:".wym_tools a",containerSelector:".wym_containers a",classSelector:".wym_classes a",classUnhiddenSelector:".wym_classes",classHiddenSelector:".wym_classes_hidden",htmlValSelector:".wym_html_val",hrefSelector:".wym_href",srcSelector:".wym_src",titleSelector:".wym_title",targetSelector:".wym_target",altSelector:".wym_alt",textSelector:".wym_text",sizeSelector:".wym_size",rowsSelector:".wym_rows",colsSelector:".wym_cols",captionSelector:".wym_caption",summarySelector:".wym_summary",submitSelector:".wym_submit",cancelSelector:".wym_cancel",previewSelector:"",dialogTypeSelector:".wym_dialog_type",dialogLinkSelector:".wym_dialog_link",dialogImageSelector:".wym_dialog_image",dialogTableSelector:".wym_dialog_table",dialogPasteSelector:".wym_dialog_paste",dialogPreviewSelector:".wym_dialog_preview",updateSelector:".wymupdate",updateEvent:"click",dialogFeatures:{width:560,height:300},dialogFeaturesPreview:"menubar=no,titlebar=no,toolbar=no,resizable=no,scrollbars=yes,width=560,height=300,top=0,left=0",dialogHtml:"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html dir='"+WYMeditor.DIRECTION+"'>"+"<head>"+"<link rel='stylesheet' type='text/css' media='screen'"+" href='"+WYMeditor.CSS_PATH+"' />"+"<title>"+WYMeditor.DIALOG_TITLE+"</title>"+"<script type='text/javascript' src='"+WYMeditor.JQUERY_PATH+"'></script>"+"<script type='text/javascript' src='"+WYMeditor.WYM_PATH+"'></script>"+"</head>"+WYMeditor.DIALOG_BODY+"</html>",dialogLinkHtml:"<div class='wym_dialog wym_dialog_link'><form><fieldset><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_LINK+"' />"+"<legend>{Link}</legend>"+"<div class='row'>"+"<label>{URL}</label>"+"<input type='text' class='wym_href' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Title}</label>"+"<input type='text' class='wym_title' value='' size='40' />"+"</div>"+"<div class='row row-indent'>"+"<input class='wym_submit button' type='button'"+" value='{Submit}' />"+"<input class='wym_cancel' type='button'"+"value='{Cancel}' />"+"</div>"+"</fieldset>"+"</form>"+"</div>",dialogImageHtml:"<div class='wym_dialog wym_dialog_image'><form><fieldset><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_IMAGE+"' />"+"<legend>{Image}</legend>"+"<div class='row'>"+"<label>{URL}</label>"+"<input type='text' class='wym_src' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Alternative_Text}</label>"+"<input type='text' class='wym_alt' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Title}</label>"+"<input type='text' class='wym_title' value='' size='40' />"+"</div>"+"<div class='row row-indent'>"+"<input class='wym_submit button' type='button'"+" value='{Submit}' />"+"<input class='wym_cancel' type='button'"+"value='{Cancel}' />"+"</div>"+"</fieldset>"+"</form>"+"</div>",dialogTableHtml:"<div class='wym_dialog wym_dialog_table'><form><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_TABLE+"' />"+"<div class='row'>"+"<label>{Caption}</label>"+"<input type='text' class='wym_caption' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Summary}</label>"+"<input type='text' class='wym_summary' value='' size='40' />"+"</div>"+"<div class='row'>"+"<label>{Number_Of_Rows}</label>"+"<input type='text' class='wym_rows' value='3' size='3' />"+"</div>"+"<div class='row'>"+"<label>{Number_Of_Cols}</label>"+"<input type='text' class='wym_cols' value='2' size='3' />"+"</div>"+"<div class='row row-indent'>"+"<input class='wym_submit button' type='button'"+" value='{Submit}' />"+"<input class='wym_cancel' type='button'"+"value='{Cancel}' />"+"</div>"+"</form>"+"</div>",dialogPasteHtml:"<div class='wym_dialog wym_dialog_paste'><form><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_PASTE+"' />"+"<fieldset>"+"<legend>{Paste_From_Word}</legend>"+"<div class='row'>"+"<textarea class='wym_text' rows='10' cols='50'></textarea>"+"</div>"+"<div class='row'>"+"<input class='wym_submit button' type='button'"+" value='{Submit}' />"+"<input class='wym_cancel' type='button'"+"value='{Cancel}' />"+"</div>"+"</fieldset>"+"</form>"+"</div>",dialogPreviewHtml:"<div class='wym_dialog wym_dialog_preview'></div>",dialogStyles:[],stringDelimiterLeft:"{",stringDelimiterRight:"}",preInit:null,preBind:null,postInit:null,preInitDialog:null,postInitDialog:null},e),this.each(function(){new WYMeditor.editor($(this),e)})},$.extend({wymeditors:function(e){return WYMeditor.INSTANCES[e]}}),WYMeditor.editor.prototype.init=function(){if($.browser.msie)var WymClass=new WYMeditor.WymClassExplorer(this);else if($.browser.mozilla)var WymClass=new WYMeditor.WymClassMozilla(this);else if($.browser.opera)var WymClass=new WYMeditor.WymClassOpera(this);else if($.browser.webkit)var WymClass=new WYMeditor.WymClassSafari(this);if(WymClass){$.isFunction(this._options.preInit)&&this._options.preInit(this);var SaxListener=new WYMeditor.XhtmlSaxListener;$.extend(SaxListener,WymClass),this.parser=new WYMeditor.XhtmlParser(SaxListener),(this._options.styles||this._options.stylesheet)&&this.configureEditorUsingRawCss(),this.helper=new WYMeditor.XmlHelper;for(var prop in WymClass)this[prop]=WymClass[prop];this._box=$(this._element).hide().after(this._options.boxHtml).next().addClass("wym_box_"+this._index),$.isFunction($.fn.data)&&($.data(this._box.get(0),WYMeditor.WYM_INDEX,this._index),$.data(this._element.get(0),WYMeditor.WYM_INDEX,this._index));var h=WYMeditor.Helper,iframeHtml=this._options.iframeHtml;iframeHtml=h.replaceAll(iframeHtml,WYMeditor.INDEX,this._index),iframeHtml=h.replaceAll(iframeHtml,WYMeditor.IFRAME_BASE_PATH,this._options.iframeBasePath);var boxHtml=$(this._box).html();boxHtml=h.replaceAll(boxHtml,WYMeditor.LOGO,this._options.logoHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS,this._options.toolsHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS,this._options.containersHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES,this._options.classesHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.HTML,this._options.htmlHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.IFRAME,iframeHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.STATUS,this._options.statusHtml);for(var aTools=eval(this._options.toolsItems),sTools="",i=0;aTools.length>i;i++){var oTool=aTools[i];if(oTool.name&&oTool.title){var sTool=this._options.toolsItemHtml,sTool=h.replaceAll(sTool,WYMeditor.TOOL_NAME,oTool.name);sTool=h.replaceAll(sTool,WYMeditor.TOOL_TITLE,this._options.stringDelimiterLeft+oTool.title+this._options.stringDelimiterRight),sTool=h.replaceAll(sTool,WYMeditor.TOOL_CLASS,oTool.css),sTools+=sTool}}boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS_ITEMS,sTools);for(var aClasses=eval(this._options.classesItems),sClasses="",i=0;aClasses.length>i;i++){var oClass=aClasses[i];if(oClass.name)if(oClass.rules&&oClass.rules.length>0){var sRules="",wym=this;$.each(oClass.rules,function(e,t){sClass=wym._options.classesItemHtml,sClass=h.replaceAll(sClass,WYMeditor.CLASS_NAME,oClass.name+(oClass.join||"")+(t.name||t)),sClass=h.replaceAll(sClass,WYMeditor.CLASS_TITLE,t.title||titleize(t.name||t)),sRules+=sClass});var sClassMultiple=this._options.classesItemHtmlMultiple;sClassMultiple=h.replaceAll(sClassMultiple,WYMeditor.CLASS_TITLE,oClass.title||titleize(oClass.name)),sClassMultiple=h.replaceAll(sClassMultiple,"{classesItemHtml}",sRules),sClasses+=sClassMultiple}else sClass=this._options.classesItemHtml,sClass=h.replaceAll(sClass,WYMeditor.CLASS_NAME,oClass.name),sClass=h.replaceAll(sClass,WYMeditor.CLASS_TITLE,oClass.title||titleize(oClass.name)),sClasses+=sClass}boxHtml=h.replaceAll(boxHtml,">"+WYMeditor.APPLY_CLASS+"<",">"+this._options.stringDelimiterLeft+WYMeditor.APPLY_CLASS+this._options.stringDelimiterRight+"<"),boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES_ITEMS,sClasses);for(var aContainers=eval(this._options.containersItems),sContainers="",i=0;aContainers.length>i;i++){var oContainer=aContainers[i];if(oContainer.name&&oContainer.title){var sContainer=this._options.containersItemHtml;sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_NAME,oContainer.name),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_TITLE,this._options.stringDelimiterLeft+oContainer.title+this._options.stringDelimiterRight),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_CLASS,oContainer.css),sContainers+=sContainer}}boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS_ITEMS,sContainers),boxHtml=this.replaceStrings(boxHtml),$(this._box).html(boxHtml),$(this._box).find(this._options.htmlSelector).hide(),this.loadSkin(),$(this._element).data("wymeditor",this)}},WYMeditor.editor.prototype.bindEvents=function(){var wym=this;$(this._box).find(this._options.toolSelector).unbind("click").bind("click",function(){return wym._iframe.contentWindow.focus(),wym.exec($(this).attr(WYMeditor.NAME)),!1}),$(this._box).find(this._options.containerSelector).unbind("click").bind("click",function(){return wym.container($(this).attr(WYMeditor.NAME)),!1}),$(this._box).find(this._options.htmlValSelector).keyup(function(){$(wym._doc.body).html($(this).val())}).focus(function(){$(this).toggleClass("hasfocus")}).blur(function(){$(this).toggleClass("hasfocus")}),$(this._box).find(this._options.classSelector).bind("click",function(e){var aClasses=eval(wym._options.classesItems),sName=$(this).attr(WYMeditor.NAME),oClass=WYMeditor.Helper.findByName(aClasses,sName),replacers=$([]);null==oClass&&$.each(aClasses,function(e,t){if(null==oClass&&t.rules&&t.rules.length>0){var i=sName.replace(t.name+(t.join||""),""),n=null;$.each(t.rules,function(e,o){i==(o.name||o)?n=e:replacers.push(t.name+(t.join||"")+(o.name||o))}),null!=n&&(oClass={expr:t.rules[n].expr||null})}}),oClass&&(replacers.each(function(e,t){wym.removeClass(t,oClass.expr)}),wym.toggleClass(sName,oClass.expr)),wym.exec(WYMeditor.APPLY_CLASS),wym._iframe.contentWindow.focus(),e.preventDefault()}),$(this._options.updateSelector).bind(this._options.updateEvent,function(){$.each(WYMeditor.INSTANCES,function(e,t){t.update()})})},WYMeditor.editor.prototype.ready=function(){return null!=this._doc},WYMeditor.editor.prototype.box=function(){return this._box},WYMeditor.editor.prototype.html=function(e){return"string"!=typeof e?$(this._doc.body).html():($(this._doc.body).html(e),void 0)},WYMeditor.editor.prototype.intercept_paste=function(e){var t=WYMeditor.INSTANCES[this.title];t.format_block(),t.exec(WYMeditor.PASTE),e&&e.preventDefault()},WYMeditor.editor.prototype.xhtml=function(){return this.parser.parse(this.html())},WYMeditor.editor.prototype.exec=function(e){switch(e){case WYMeditor.CREATE_LINK:((container=this.container())||this._selected_image)&&this.dialog(WYMeditor.DIALOG_LINK);break;case WYMeditor.INSERT_IMAGE:this.dialog(WYMeditor.DIALOG_IMAGE);break;case WYMeditor.INSERT_TABLE:this.dialog(WYMeditor.DIALOG_TABLE);break;case WYMeditor.PASTE:this.dialog(WYMeditor.DIALOG_PASTE);break;case WYMeditor.TOGGLE_HTML:this.update(),this.toggleHtml();break;case WYMeditor.PREVIEW:this.dialog(WYMeditor.PREVIEW);break;case WYMeditor.APPLY_CLASS:wym=this,$(wym._box).find(this._options.classUnhiddenSelector).find("a[name]").each(function(e,t){$(wym.selected()).hasClass($(t).attr("name"))?$(t).parent().addClass("enabled"):$(t).parent().removeClass("enabled")});break;default:this._exec(e)}},WYMeditor.editor.prototype.container=function(e){if(!e)return this.selected();var t=null;if(e.toLowerCase()==WYMeditor.TH){switch(t=this.container(),t.tagName.toLowerCase()){case WYMeditor.TD:case WYMeditor.TH:break;default:var i=new Array(WYMeditor.TD,WYMeditor.TH);t=this.findUp(this.container(),i)}null!=t&&(e=t.tagName.toLowerCase()==WYMeditor.TD?WYMeditor.TH:WYMeditor.TD,this.switchTo(t,e),this.update())}else{var i=new Array(WYMeditor.P,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,WYMeditor.H4,WYMeditor.H5,WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE);if(t=this.findUp(this.container(),i)){var n=null;if(e.toLowerCase()==WYMeditor.BLOCKQUOTE){var o=this.findUp(this.container(),WYMeditor.BLOCKQUOTE);if(null==o)n=this._doc.createElement(e),t.parentNode.insertBefore(n,t),n.appendChild(t),this.setFocusToNode(n.firstChild);else{var r=o.childNodes,s=r.length,a=null;s>0&&(a=r.item(0));for(var l=0;s>l;l++)o.parentNode.insertBefore(r.item(0),o);o.parentNode.removeChild(o),a&&this.setFocusToNode(a)}}else this.setFocusToNode(this.switchTo(t,e));this.update()}}},WYMeditor.editor.prototype.toggleClass=function(e,t){var i=$(this._selected_image?this._selected_image:this.selected(!0));null!=t&&(i=$(i.parentsOrSelf(t))),i.toggleClass(e),i.attr(WYMeditor.CLASS)||i.removeAttr(this._class)},WYMeditor.editor.prototype.toggleClassSelector=function(){var e=this,t=$(e._box).find(e._options.classUnhiddenSelector).hasClass(e._options.classHiddenSelector.substring(1));t?($(e._box).find(e._options.classUnhiddenSelector).removeClass(e._options.classHiddenSelector.substring(1)),$(e._box).find("a[name="+WYMeditor.APPLY_CLASS+"]").addClass("selected").parent().addClass("activated")):($(e._box).find(e._options.classUnhiddenSelector).addClass(e._options.classHiddenSelector.substring(1)),$(e._box).find("a[name="+WYMeditor.APPLY_CLASS+"]").removeClass("selected").parent().removeClass("activated")),e.exec(WYMeditor.APPLY_CLASS)},WYMeditor.editor.prototype.removeClass=function(e,t){var i=$(this._selected_image?this._selected_image:$(this.selected(!0)));null!=t&&(i=$(i.parentsOrSelf(t))),i.removeClass(e),i.attr(WYMeditor.CLASS)||i.removeAttr(this._class)},WYMeditor.editor.prototype.findUp=function(e,t){if(e){var i=e.tagName.toLowerCase();if(typeof t==WYMeditor.STRING)for(;i!=t&&i!=WYMeditor.BODY;)e=e.parentNode,i=e.tagName.toLowerCase();else for(var n=!1;!n&&i!=WYMeditor.BODY;){for(var o=0;t.length>o;o++)if(i==t[o]){n=!0;break}n||(e=e.parentNode,i=e.tagName.toLowerCase())}return i!=WYMeditor.BODY?e:null}return null},WYMeditor.editor.prototype.switchTo=function(e,t){e.getRangeAt&&(this.exec(WYMeditor.BOLD),e=e.focusNode.parentNode);var i=$(e).html(),n=this._doc.createElement(t),o=$(e).attr("class");return o&&$.each(o.split(" "),function(e,t){$(n).addClass(t)}),e.parentNode.replaceChild(n,e),$(n).html(i),this.setFocusToNode(n),n},WYMeditor.editor.prototype.replaceStrings=function(sVal){var wym=this;if(!WYMeditor.STRINGS[wym._options.lang])try{eval($.ajax({url:wym._options.langPath+wym._options.lang+".js",async:!1}).responseText)}catch(e){return WYMeditor.console&&WYMeditor.console.error("WYMeditor: error while parsing language file."),sVal}return $.each(WYMeditor.STRINGS[wym._options.lang],function(e,t){sVal=WYMeditor.Helper.replaceAll(sVal,wym.encloseString(e),t)}),sVal},WYMeditor.editor.prototype.encloseString=function(e){return this._options.stringDelimiterLeft+e+this._options.stringDelimiterRight},WYMeditor.editor.prototype.status=function(e){$(this._box).find(this._options.statusSelector).html(e)},WYMeditor.editor.prototype.update=function(){var e=this,t=e.xhtml().replace(/<\/([A-Za-z0-9]*)></g,function(e){return e.split(">").join(">\n")});t=t.replace(/src=\"system\/images/g,'src="/system/images'),$(t).find(bad_spans="span[id|=wym], span[id=undefined]").add($(t).filter(bad_spans)).each(function(i,n){html_to_replace_with=e.parser.parse($(n).html()),html_to_replace=e.parser.parse($(n).wrap("<div />").parent().html()),$.browser.msie&&(html_to_replace=new RegExp(html_to_replace.replace(/(\ [^\=]+\=)([^\ >]+)/,'$1"$2"'),"ig")),t=t.replace(html_to_replace,html_to_replace_with)}),t=t.replace(/(\ ?id=(\"|\')last\_paste(\"|\'))/gim,""),t=t.replace(/[%$]+wym-[^%$]*[%$]+/gim,""),t=t.replace(/^<br\ ?\/?>$/,""),$(e._element).val(t),$(e._box).find(e._options.htmlValSelector).not(".hasfocus").val(t)},WYMeditor.editor.prototype.dialog=function(e){var t=this;t.update();var i=this._wym._options.dialogPath+e+"?wymeditor=true";t._current_unique_stamp=t.uniqueStamp(),t._undo_on_cancel=!1,t._redo_on_cancel=!1;var n=this.selected();e!=WYMeditor.DIALOG_TABLE&&t.format_block(),e==WYMeditor.DIALOG_LINK&&$.browser.mozilla&&(selection=t._iframe.contentWindow.getSelection(),matches=$($(n).html().match(new RegExp(RegExp.escape(selection.anchorNode.textContent)+"(.*)"+RegExp.escape(selection.focusNode.textContent)))),null!=matches&&matches.length>0&&(possible_anchor_tag=matches.last()).length>0&&null!=(href_matches=possible_anchor_tag.get(0).match(/href="([^"]*)"/))&&null!=(href=$(href_matches).last().get(0))&&$(t._doc).find("a").each(function(e,t){$(t).html()==selection&&(n=t)})),ajax_loaded_callback=function(){t.dialog_ajax_callback(n)};var o=t._selected_image?t._selected_image.parentNode:n;if("undefined"!=typeof o&&null!==o)if(o.tagName.toLowerCase()!=WYMeditor.A){if(null==t._selected_image)if(null!=n&&n.tagName.toLowerCase()!=WYMeditor.A&&t._iframe.contentWindow.getSelection)if(selection=t._iframe.contentWindow.getSelection(),selection.focusNode.insertData){if(selection.anchorOffset>selection.focusOffset?(start_node=selection.focusNode,start=selection.focusOffset,end_node=selection.anchorNode,end=selection.anchorOffset):(start_node=selection.anchorNode,start=selection.anchorOffset,end_node=selection.focusNode,end=selection.focusOffset),"undefined"==typeof start_node.insertData){for(var r=start_node.childNodes.length-1,s=start_node;"function"!=typeof end_node.insertData||!r;)start_node=s.childNodes[r--];start=0}if("undefined"==typeof end_node.insertData){for(var a=end_node.childNodes.length-1,l=end_node;"function"!=typeof end_node.insertData||!a;)end_node=l.childNodes[a--];end=end_node.length}start_tag="%%"+t._current_unique_stamp+"%%",end_tag="$$"+t._current_unique_stamp+"$$",start_node===end_node&&(end+=start_tag.length),start_node.insertData(start,start_tag),end_node.insertData(end,end_tag),$(n).html($(n).html().replace(start_tag,"<span id='"+t._current_unique_stamp+"'>").replace(end_tag,"</span>"))}else t.wrap("<span id='"+t._current_unique_stamp+"'>","</span>");else t.wrap("<span id='"+t._current_unique_stamp+"'>","</span>")}else t._selected_image||(o._id_before_replaceable=o.id,o.id=""+this._current_unique_stamp),e!=WYMeditor.DIALOG_PASTE&&e!=WYMeditor.DIALOG_TABLE&&(i+=-1==i.indexOf("?")?"?":"&",port=window.location.port.length>0?":"+window.location.port:"",i+="current_link="+o.href.replace(window.location.protocol+"//"+window.location.hostname+port,""),i+="&target_blank="+("_blank"==o.target?"true":"false"));switch(dialog_title=t.replaceStrings(t.encloseString(e)),dialog_container=$("<div id='"+t._options.dialogId+"' class='editor_dialog'></div>"),e){case WYMeditor.DIALOG_TABLE:dialog_container.html(t.replaceStrings(t._options.dialogTableHtml)).dialog($.extend(t._options.dialogInlineFeatures,{title:dialog_title})),ajax_loaded_callback();break;case WYMeditor.DIALOG_PASTE:dialog_container.html(t.replaceStrings(t._options.dialogPasteHtml)).dialog($.extend(t._options.dialogInlineFeatures,{title:dialog_title})),ajax_loaded_callback();break;default:dialog_container.dialog($.extend(t._options.dialogFeatures,{title:dialog_title})).load(i,ajax_loaded_callback)}},WYMeditor.editor.prototype.dialog_ajax_callback=function(e){wym=this,_selected=e,$("#"+wym._options.dialogId+".editor_dialog").css("height","auto"),(iframes=$("#"+this._options.dialogId).find("iframe")).load(function(){WYMeditor.INIT_DIALOG(wym,_selected,!0),removeLoading("div#"+wym._options.dialogId),$(this).unbind("load")}),0==iframes.length?WYMeditor.INIT_DIALOG(this,e):attachLoading("div#"+wym._options.dialogId)},WYMeditor.editor.prototype.toggleHtml=function(){$(this._box).find(this._options.htmlSelector).toggle()},WYMeditor.editor.prototype.uniqueStamp=function(){return"wym-"+(new Date).getTime()},WYMeditor.editor.prototype.paste=function(e){wym=this,wym.format_block();var t;replaceable=$(wym._doc.body).find("#"+wym._current_unique_stamp),container=replaceable.get(0)||this.selected();var i=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").split(wym._newLine+wym._newLine),n=new RegExp(wym._newLine,"g");if(container&&container.tagName.toLowerCase()!=WYMeditor.BODY)for(contentAfterBreak="",insertedContentAfterBreak="",x=i.length-1;x>=0;x--)if(t=i[x].replace(n,"<br />"),0==x)i.length>1&&"span"==$(container).get(0).tagName.toLowerCase()&&$(container).attr("id")==""+wym._current_unique_stamp&&"p"==$(container).parent().get(0).tagName.toLowerCase()?(p=$(container).parent(),matches=p.html().match(new RegExp("([\\s\\S]*)<span id=['|\"]"+wym._current_unique_stamp+"['|\"]>.*</span>")),t=matches[1]+t+$(container).html(),p.html(t),null!=insertedContentAfterBreak&&insertedContentAfterBreak.length>0&&p.after(insertedContentAfterBreak),null!=contentAfterBreak&&contentAfterBreak.length>0&&(1==(last_paste=p.parent().find("p#last_paste")).length?last_paste.attr("id",null).html(last_paste.html()+contentAfterBreak):p.next().after("<p>"+contentAfterBreak+"</p>"))):$(container).html($(container).html().replace(/^<br\/?>$/,"")+t);else{if(i.length-1==x){var o=$(container).parent().html().match(new RegExp("<span id=['|\"]"+wym._current_unique_stamp+"['|\"]>.*</span>([\\s\\S]*)"));o&&o[1]&&(contentAfterBreak=o[1].split("</p>")[0]),t="<p id='last_paste'>"+t+"</p>"}else t="<p>"+t+"</p>";""==insertedContentAfterBreak?insertedContentAfterBreak+=t:insertedContentAfterBreak=t+insertedContentAfterBreak}else for(x=0;i.length>x;x++)t=i[x],t=t.replace(n,"<br />"),0==x&&0==$(container).html().replace(/<br\ ?\/?>/,"").length?$(container).html(t):$(wym._doc.body).append("<p>"+t+"</p>");null!=replaceable.get(0)&&("span"==replaceable.get(0).tagName.toLowerCase()&&replaceable.replaceWith(replaceable.html()),replaceable.attr("id",replaceable.get(0)._id_before_replaceable||null))},WYMeditor.editor.prototype.insert=function(e){null!=this._iframe.contentWindow.getSelection().focusNode?this._exec(WYMeditor.INSERT_HTML,e):this.paste(e)},WYMeditor.editor.prototype.wrap=function(e,t,i){e="undefined"!=typeof e?e:"",t="undefined"!=typeof t?t:"",null==i&&(i=this._iframe.contentWindow.getSelection()),null!=i.focusNode&&this._exec(WYMeditor.INSERT_HTML,e+i.toString()+t)},WYMeditor.editor.prototype.unwrap=function(e){null==e&&(e=this._iframe.contentWindow.getSelection()),null!=e.focusNode&&this._exec(WYMeditor.INSERT_HTML,e.toString())},WYMeditor.editor.prototype.setFocusToNode=function(e,t){var i=this._doc.createRange(),n=this._iframe.contentWindow.getSelection();t=t?0:1,i.selectNodeContents(e),n.addRange(i),n.collapse(e,t),this._iframe.contentWindow.focus()},WYMeditor.editor.prototype.addCssRules=function(e,t){var i=e.styleSheets[0];if(i)for(var n=0;t.length>n;n++){var o=t[n];o.name&&o.css&&this.addCssRule(i,o)}},WYMeditor.editor.prototype.format_block=function(e){var t=this,i=e||t.selected()||$(t._iframe).contents().find("body").get(0),n=i.tagName.toLowerCase();$.inArray(n,["strong","b","em","i","sub","sup","a"])>-1&&(n=i.parentNode.tagName.toLowerCase()),n==WYMeditor.BODY&&(t._selected_image=null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))},WYMeditor.editor.prototype.computeBasePath=function(){return null!=(script_path=this.computeWymPath())?((src_parts=script_path.split("/")).length>1&&src_parts.pop(),src_parts.join("/")+"/"):null},WYMeditor.editor.prototype.computeWymPath=function(){return $("script[src*=gko_wymeditor]").attr("src")},WYMeditor.editor.prototype.computeJqueryPath=function(){return $($.grep($("script"),function(e){return e.src&&e.src.match(/jquery(-(.*)){0,1}(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")},WYMeditor.editor.prototype.computeCssPath=function(){return $($.grep($("link"),function(e){return e.href&&e.href.match(/wymeditor\/skins\/(.*)screen\.css(\?.*)?$/)})).attr("href")},WYMeditor.editor.prototype.configureEditorUsingRawCss=function(){var e=new WYMeditor.WymCssParser;this._options.stylesheet?e.parse($.ajax({url:this._options.stylesheet,async:!1}).responseText):e.parse(this._options.styles,!1),0==this._options.classesItems.length&&(this._options.classesItems=e.css_settings.classesItems),0==this._options.editorStyles.length&&(this._options.editorStyles=e.css_settings.editorStyles),0==this._options.dialogStyles.length&&(this._options.dialogStyles=e.css_settings.dialogStyles)},WYMeditor.editor.prototype.listen=function(){$(this._doc.body).bind("mousedown",this.mousedown);for(var e=this._doc.body.getElementsByTagName("img"),t=0;e.length>t;t++)$(e[t]).bind("mousedown",this.mousedown);$(this._doc).find("a[href]").click(function(e){e.preventDefault()})},WYMeditor.editor.prototype.mousedown=function(e){var t=WYMeditor.INSTANCES[this.ownerDocument.title];t._selected_image=e.target.tagName.toLowerCase()==WYMeditor.IMG?e.target:null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),$.browser.mozilla||$(t._selected_image).addClass("selected_by_wym"),$.browser.webkit||e.stopPropagation()},WYMeditor.loadCss=function(e){$("<link rel='stylesheet' />").attr("href",e).appendTo($("head").get(0))},WYMeditor.editor.prototype.loadSkin=function(){if(this._options.loadSkin&&!WYMeditor.SKINS[this._options.skin]){var found=!1,rExp=new RegExp(this._options.skin+"/"+WYMeditor.SKINS_DEFAULT_CSS+"([?].+?)?$");
$("link").each(function(){this.href.match(rExp)&&(found=!0)}),found||WYMeditor.loadCss(this._options.cssCompiledSkinPath+WYMeditor.SKINS_DEFAULT_CSS)}$(this._box).addClass("wym_skin_"+this._options.skin),this._options.initSkin&&!WYMeditor.SKINS[this._options.skin]&&eval($.ajax({url:this._options.jsCompiledSkinPath+WYMeditor.SKINS_DEFAULT_JS,async:!1}).responseText),WYMeditor.SKINS[this._options.skin]&&WYMeditor.SKINS[this._options.skin].init&&WYMeditor.SKINS[this._options.skin].init(this)},WYMeditor.INIT_DIALOG=function(e,t,i){var t=t||e.selected(),n=$("#"+e._options.dialogId),o=$(i?n.find("iframe").contents():document);if(n.find("#wym_dialog_type").val(),e._selected_image)var r=$(e._selected_image);else var r=$(e._doc.body).find("#"+e._current_unique_stamp);n.find("input[type=text], textarea").first().focus(),o.find("body").addClass("wym_iframe_body").find("#cancel_button").add(n.find(".close_dialog")).click(function(t){e.close_dialog(t,!0)}),$.isFunction(e._options.preInitDialog)&&e._options.preInitDialog(e,window),$(e._options.dialogLinkSelector).find(e._options.submitSelector).click(function(t){if((sUrl=$(e._options.hrefSelector).val()).length>0)if(null!=r.get(0)){var i=$("<a></a>").attr({href:sUrl,title:$(e._options.titleSelector).val()});null!=(target=$(e._options.targetSelector).val())&&target.length>0&&i.attr("target",target),e._selected_image?null!=(parent=r.parent().get(0))&&"A"==parent.tagName.toUpperCase()?$(parent).attr({href:i.attr("href"),title:$(e._options.titleSelector).val(),target:target}):(r.before(i),$(i).append(r.get(0))):(i.attr({style:r.attr("style"),"class":r.attr("class")}),i.html(r.html()),r.replaceWith($("<div/>").append(i).html()))}else e._exec(WYMeditor.CREATE_LINK,e._current_unique_stamp),$("a[href="+e._current_unique_stamp+"]",e._doc.body).attr(WYMeditor.HREF,sUrl).attr(WYMeditor.TITLE,$(e._options.titleSelector).val()).attr(WYMeditor.TARGET,$(e._options.targetSelector).val());e.close_dialog(t)}),e._selected_image&&(imgDialog=$(e._options.dialogImageSelector),img=$(e._selected_image),size=img.attr(WYMeditor.REL)||o.find("#existing_image_size_area li.selected a").attr("rel")||"",src=img.attr(WYMeditor.SRC),size.length>0&&(src=src.replace("_"+size+".","."),o.find("#existing_image_size_area li.selected").removeClass("selected"),o.find("#existing_image_size_area li a[href='#"+size+"']").parents("li:first").addClass("selected")),imgDialog.find(e._options.srcSelector).val(src),imgDialog.find(e._options.titleSelector).val(img.attr(WYMeditor.TITLE)),imgDialog.find(e._options.altSelector).val(img.attr(WYMeditor.ALT)),imgDialog.find(e._options.sizeSelector).val(size),(src=src.split(".")).pop(),o.find("#existing_image_area_content li img[src^='"+src+"']").parents("li:first").addClass("selected")),$(e._options.dialogImageSelector).find(e._options.submitSelector),$(e._options.dialogImageSelector).find(e._options.submitSelector).click(function(t){form=$(this.form),null!=(url=form.find(e._options.srcSelector).val())&&url.length>0?((image=$(e._doc.createElement("IMG"))).attr(WYMeditor.SRC,url).attr(WYMeditor.TITLE,form.find(e._options.titleSelector).val()).attr(WYMeditor.ALT,form.find(e._options.titleSelector).val()).attr(WYMeditor.REL,form.find(e._options.sizeSelector).val()).load(function(){$(this).attr({width:$(this).width(),height:$(this).height()})}),null==r&&(r=$(e._doc.body).find("#"+e._current_unique_stamp)),null!=r&&r.after(image).remove()):($("iframe").contents().find(".save-loader").remove(),alert("Please select an image to insert.")),t.preventDefault()}),$(e._options.dialogTableSelector).find(e._options.submitSelector).click(function(t){if((iRows=$(e._options.rowsSelector).val())>0&&(iCols=$(e._options.colsSelector).val())>0){for((table=e._doc.createElement(WYMeditor.TABLE)).createCaption().innerHTML=$(e._options.captionSelector).val(),x=0;iRows>x;x++)for(newRow=table.insertRow(x),y=0;iCols>y;y++)newRow.insertCell(y);var i=$(e.findUp(e.container(),WYMeditor.MAIN_CONTAINERS)).get(0);i&&i.parentNode?$(i).after(table):$(e._doc.body).append(table)}e.close_dialog(t)}),$(e._options.dialogPasteSelector).find(e._options.submitSelector).click(function(t){e.paste($(e._options.textSelector).val()),e.close_dialog(t)}),$(e._options.dialogPreviewSelector).find(e._options.previewSelector).html(e.xhtml()),$.isFunction(e._options.postInitDialog)&&e._options.postInitDialog(e,window)},WYMeditor.editor.prototype.close_dialog=function(e,t){t&&((span=$(this._doc.body).find("span#"+this._current_unique_stamp)).length>0&&span.parent().html(span.parent().html().replace(new RegExp(["<span(.+?)",span.attr("id"),"(.+?)</span>"].join("")),span.html())),(remove_id=$(this._doc.body).find("#"+this._current_unique_stamp)).attr("id",remove_id.attr("_id_before_replaceable")||"").replaceWith(remove_id.html()),1==this._undo_on_cancel?this._exec("undo"):1==this._redo_on_cancel&&this._exec("redo")),$.browser.msie&&8>parseInt($.browser.version)&&this._iframe.contentWindow.focus(),$("#"+wym._options.dialogId).dialog("close").remove(),$(this._doc).find("a[href]").click(function(e){e.preventDefault()}),e&&e.preventDefault()},WYMeditor.XmlHelper=function(){return this._entitiesDiv=document.createElement("div"),this},WYMeditor.XmlHelper.prototype.tag=function(e,t,i){return t=t||!1,i=i||!1,"<"+e+(t?this.tagOptions(t):"")+(i?">":" />")},WYMeditor.XmlHelper.prototype.contentTag=function(e,t,i){return i=i||!1,"<"+e+(i?this.tagOptions(i):"")+">"+t+"</"+e+">"},WYMeditor.XmlHelper.prototype.cdataSection=function(e){return"<![CDATA["+e+"]]>"},WYMeditor.XmlHelper.prototype.escapeOnce=function(e){return this._fixDoubleEscape(this.escapeEntities(e))},WYMeditor.XmlHelper.prototype._fixDoubleEscape=function(e){return e.replace(/&amp;([a-z]+|(#\d+));/gi,"&$1;")},WYMeditor.XmlHelper.prototype.tagOptions=function(e){var t=this;t._formated_options="";for(var i in e){var n=e[i];"function"!=typeof n&&n.length>0&&(parseInt(i)==i&&"object"==typeof n&&(i=n.shift(),n=n.pop()),""!=i&&""!=n&&(t._formated_options+=" "+i+'="'+t.escapeOnce(n)+'"'))}return t._formated_options},WYMeditor.XmlHelper.prototype.escapeEntities=function(e,t){this._entitiesDiv.innerHTML=e,this._entitiesDiv.textContent=e;var i=this._entitiesDiv.innerHTML;return"undefined"==typeof t&&(0!=t&&(i=i.replace('"',"&quot;")),1==t&&(i=i.replace('"',"&#039;"))),i},WYMeditor.XmlHelper.prototype.parseAttributes=function(e){var t=[],i=e.split(/((=\s*")(")("))|((=\s*\')(\')(\'))|((=\s*[^>\s]*))/g);if(i.toString()!=e)for(var n in i){var o=i[n];if("function"!=typeof o&&0!=o.length){var r=new RegExp("(\\w+)\\s*"+o);if(match=e.match(r)){var s=o.replace(/^[\s=]+/,""),a=s.charAt(0);a='"'==a?'"':"'"==a?"'":"",""!=a&&(s='"'==a?s.replace(/^"|"+$/g,""):s.replace(/^'|'+$/g,"")),e=e.replace(match[0],""),t.push([match[1],s])}}}return t},WYMeditor.XhtmlValidator={_attributes:{core:{except:["base","head","html","meta","param","script","style","title"],attributes:["class","id","style","title","accesskey","tabindex","data","^data-.*"]},language:{except:["base","br","hr","iframe","param","script"],attributes:{dir:["ltr","rtl"],0:"lang",1:"xml:lang"}},keyboard:{attributes:{accesskey:/^(\w){1}$/,tabindex:/^(\d)+$/}}},_events:{window:{only:["body"],attributes:["onload","onunload"]},form:{only:["form","input","textarea","select","a","label","button"],attributes:["onchange","onsubmit","onreset","onselect","onblur","onfocus"]},keyboard:{except:["base","bdo","br","frame","frameset","head","html","iframe","meta","param","script","style","title"],attributes:["onkeydown","onkeypress","onkeyup"]},mouse:{except:["base","bdo","br","head","html","meta","param","script","style","title"],attributes:["onclick","ondblclick","onmousedown","onmousemove","onmouseover","onmouseout","onmouseup"]}},_tags:{a:{attributes:{0:"charset",1:"coords",2:"href",3:"hreflang",4:"name",rel:/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon|moodalbox)+$/,rev:/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon|moodalbox)+$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/,5:"type",target:/^(_blank)+$/}},0:"abbr",1:"acronym",2:"address",area:{attributes:{0:"alt",1:"coords",2:"href",nohref:/^(true|false)$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/},required:["alt"]},3:"b",base:{attributes:["href"],required:["href"]},bdo:{attributes:{dir:/^(ltr|rtl)$/},required:["dir"]},4:"big",blockquote:{attributes:["cite"]},5:"body",6:"br",button:{attributes:{disabled:/^(disabled)$/,type:/^(button|reset|submit)$/,0:"value"},inside:"form"},7:"caption",8:"cite",9:"code",col:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"},inside:"colgroup"},colgroup:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"}},10:"dd",del:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},11:"div",12:"dfn",13:"dl",14:"dt",15:"em",fieldset:{inside:"form"},form:{attributes:{0:"action",1:"accept",2:"accept-charset",3:"enctype",method:/^(get|post)$/},required:["action"]},head:{attributes:["profile"]},16:"h1",17:"h2",18:"h3",19:"h4",20:"h5",21:"h6",22:"hr",html:{attributes:["xmlns"]},23:"i",iframe:{attributes:["src","width","height","frameborder","scrolling","marginheight","marginwidth"],required:["src"]},img:{attributes:{align:/^(right|left|center|justify)$/,0:"alt",1:"src",2:"height",3:"ismap",4:"longdesc",5:"usemap",6:"width",7:"rel"},required:["alt","src"]},input:{attributes:{0:"accept",1:"alt",checked:/^(checked)$/,disabled:/^(disabled)$/,maxlength:/^(\d)+$/,2:"name",readonly:/^(readonly)$/,size:/^(\d)+$/,3:"src",type:/^(button|checkbox|file|hidden|image|password|radio|reset|submit|text|tel|search|url|email|datetime|date|month|week|time|datetime-local|number|range|color)$/,4:"value"},inside:"form"},ins:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},24:"kbd",label:{attributes:["for"],inside:"form"},25:"legend",26:"li",link:{attributes:{0:"charset",1:"href",2:"hreflang",media:/^(all|braille|print|projection|screen|speech|,|;| )+$/i,/*"rel":/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,*/
rel:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,rev:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,3:"type"},inside:"head"},map:{attributes:["id","name"],required:["id"]},meta:{attributes:{0:"content","http-equiv":/^(content\-type|expires|refresh|set\-cookie)$/i,1:"name",2:"scheme"},required:["content"]},27:"noscript",28:"ol",optgroup:{attributes:{0:"label",disabled:/^(disabled)$/},required:["label"]},option:{attributes:{0:"label",disabled:/^(disabled)$/,selected:/^(selected)$/,1:"value"},inside:"select"},29:"p",param:{attributes:["type","value","name"],required:["name"],inside:"object"},embed:{attributes:["width","height","allowfullscreen","allowscriptaccess","wmode","type","src","flashvars"],inside:"object"},object:{attributes:["archive","classid","codebase","codetype","data","declare","height","name","standby","type","usemap","width"]},30:"pre",q:{attributes:["cite"]},31:"samp",script:{attributes:{type:/^(text\/ecmascript|text\/javascript|text\/jscript|text\/vbscript|text\/vbs|text\/xml)$/,0:"charset",defer:/^(defer)$/,1:"src"},required:["type"]},select:{attributes:{disabled:/^(disabled)$/,multiple:/^(multiple)$/,0:"name",1:"size"},inside:"form"},32:"small",33:"span",34:"strong",style:{attributes:{0:"type",media:/^(screen|tty|tv|projection|handheld|print|braille|aural|all)$/},required:["type"]},35:"sub",36:"sup",table:{attributes:{0:"border",1:"cellpadding",2:"cellspacing",frame:/^(void|above|below|hsides|lhs|rhs|vsides|box|border)$/,rules:/^(none|groups|rows|cols|all)$/,3:"summary",4:"width"}},tbody:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},td:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},textarea:{attributes:["cols","rows","disabled","name","readonly"],required:["cols","rows"],inside:"form"},tfoot:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom)$/,2:"baseline"}},th:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},thead:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},37:"title",tr:{attributes:{align:/^(right|left|center|justify|char)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},38:"tt",39:"ul",40:"var",41:"section",42:"article",43:"aside",44:"details",45:"header",46:"footer",47:"nav",48:"dialog",49:"figure",50:"figcaption",51:"address",52:"hgroup",53:"mark",54:"time",55:"canvas",56:"audio",57:"video",58:"source",59:"output",60:"progress",61:"ruby",62:"rt",63:"rp",64:"summary",65:"command"},skipped_attributes:[],skipped_attribute_values:[],getValidTagAttributes:function(e,t){var i={},n=this.getPossibleTagAttributes(e),o=[];$.each(n||[],function(e,t){t.indexOf("*")>-1&&o.push(new RegExp(t))});var r=WYMeditor.Helper;for(var s in t){var a=t[s];r.contains(this.skipped_attributes,s)||r.contains(this.skipped_attribute_values,a)||"function"!=typeof a&&(r.contains(n,s)?this.doesAttributeNeedsValidation(e,s)?this.validateAttribute(e,s,a)&&(i[s]=a):i[s]=a:$.each(o,function(e,t){s.match(t)&&(i[s]=a)}))}return i},getUniqueAttributesAndEventsForTag:function(e){var t=[];if(this._tags[e]&&this._tags[e].attributes)for(k in this._tags[e].attributes)t.push(parseInt(k)==k?this._tags[e].attributes[k]:k);return t},getDefaultAttributesAndEventsForTags:function(){var e=[];for(var t in this._events)e.push(this._events[t]);for(var t in this._attributes)e.push(this._attributes[t]);return e},isValidTag:function(e){if(this._tags[e])return!0;for(var t in this._tags)if(this._tags[t]==e)return!0;return!1},getDefaultAttributesAndEventsForTag:function(e){var t=[];if(this.isValidTag(e)){var i=this.getDefaultAttributesAndEventsForTags();for(var n in i){var o=i[n];if("object"==typeof o){var r=WYMeditor.Helper;if(o.except&&r.contains(o.except,e)||o.only&&!r.contains(o.only,e))continue;var s=o.attributes?o.attributes:o.events;for(var a in s)t.push("string"!=typeof s[a]?a:s[a])}}}return t},doesAttributeNeedsValidation:function(e,t){return this._tags[e]&&(this._tags[e].attributes&&this._tags[e].attributes[t]||this._tags[e].required&&WYMeditor.Helper.contains(this._tags[e].required,t))},validateAttribute:function(e,t,i){return this._tags[e]&&this._tags[e].attributes&&this._tags[e].attributes[t]&&i.length>0&&!i.match(this._tags[e].attributes[t])||this._tags[e]&&this._tags[e].required&&WYMeditor.Helper.contains(this._tags[e].required,t)&&0==i.length?!1:"undefined"!=typeof this._tags[e]},getPossibleTagAttributes:function(e){return this._possible_tag_attributes||(this._possible_tag_attributes={}),this._possible_tag_attributes[e]||(this._possible_tag_attributes[e]=this.getUniqueAttributesAndEventsForTag(e).concat(this.getDefaultAttributesAndEventsForTag(e))),this._possible_tag_attributes[e]}},WYMeditor.ParallelRegex=function(e){return this._case=e,this._patterns=[],this._labels=[],this._regex=null,this},WYMeditor.ParallelRegex.prototype.addPattern=function(e,t){t=t||!0;var i=this._patterns.length;this._patterns[i]=e,this._labels[i]=t,this._regex=null},WYMeditor.ParallelRegex.prototype.match=function(e){if(0==this._patterns.length)return[!1,""];var t=e.match(this._getCompoundedRegex());if(!t)return[!1,""];for(var i=t[0],n=1;t.length>n;n++)if(t[n])return[this._labels[n-1],i];return[!0,t[0]]},WYMeditor.ParallelRegex.prototype._getCompoundedRegex=function(){if(null==this._regex){for(var e=0,t=this._patterns.length;t>e;e++)this._patterns[e]="("+this._untokenizeRegex(this._tokenizeRegex(this._patterns[e]).replace(/([\/\(\)])/g,"\\$1"))+")";this._regex=new RegExp(this._patterns.join("|"),this._getPerlMatchingFlags())}return this._regex},WYMeditor.ParallelRegex.prototype._tokenizeRegex=function(e){return e.replace(/\(\?(i|m|s|x|U)\)/,"~~~~~~Tk1$1~~~~~~").replace(/\(\?(\-[i|m|s|x|U])\)/,"~~~~~~Tk2$1~~~~~~").replace(/\(\?\=(.*)\)/,"~~~~~~Tk3$1~~~~~~").replace(/\(\?\!(.*)\)/,"~~~~~~Tk4$1~~~~~~").replace(/\(\?\<\=(.*)\)/,"~~~~~~Tk5$1~~~~~~").replace(/\(\?\<\!(.*)\)/,"~~~~~~Tk6$1~~~~~~").replace(/\(\?\:(.*)\)/,"~~~~~~Tk7$1~~~~~~")},WYMeditor.ParallelRegex.prototype._untokenizeRegex=function(e){return e.replace(/~~~~~~Tk1(.{1})~~~~~~/,"(?$1)").replace(/~~~~~~Tk2(.{2})~~~~~~/,"(?$1)").replace(/~~~~~~Tk3(.*)~~~~~~/,"(?=$1)").replace(/~~~~~~Tk4(.*)~~~~~~/,"(?!$1)").replace(/~~~~~~Tk5(.*)~~~~~~/,"(?<=$1)").replace(/~~~~~~Tk6(.*)~~~~~~/,"(?<!$1)").replace(/~~~~~~Tk7(.*)~~~~~~/,"(?:$1)")},WYMeditor.ParallelRegex.prototype._getPerlMatchingFlags=function(){return this._case?"m":"mi"},WYMeditor.StateStack=function(e){return this._stack=[e],this},WYMeditor.StateStack.prototype.getCurrent=function(){return this._stack[this._stack.length-1]},WYMeditor.StateStack.prototype.enter=function(e){this._stack.push(e)},WYMeditor.StateStack.prototype.leave=function(){return 1==this._stack.length?!1:(this._stack.pop(),!0)},WYMeditor.LEXER_ENTER=1,WYMeditor.LEXER_MATCHED=2,WYMeditor.LEXER_UNMATCHED=3,WYMeditor.LEXER_EXIT=4,WYMeditor.LEXER_SPECIAL=5,WYMeditor.Lexer=function(e,t,i){return t=t||"accept",this._case=i||!1,this._regexes={},this._parser=e,this._mode=new WYMeditor.StateStack(t),this._mode_handlers={},this._mode_handlers[t]=t,this},WYMeditor.Lexer.prototype.addPattern=function(e,t){var t=t||"accept";"undefined"==typeof this._regexes[t]&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e),"undefined"==typeof this._mode_handlers[t]&&(this._mode_handlers[t]=t)},WYMeditor.Lexer.prototype.addEntryPattern=function(e,t,i){"undefined"==typeof this._regexes[t]&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,i),"undefined"==typeof this._mode_handlers[i]&&(this._mode_handlers[i]=i)},WYMeditor.Lexer.prototype.addExitPattern=function(e,t){"undefined"==typeof this._regexes[t]&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,"__exit"),"undefined"==typeof this._mode_handlers[t]&&(this._mode_handlers[t]=t)},WYMeditor.Lexer.prototype.addSpecialPattern=function(e,t,i){"undefined"==typeof this._regexes[t]&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,"_"+i),"undefined"==typeof this._mode_handlers[i]&&(this._mode_handlers[i]=i)},WYMeditor.Lexer.prototype.mapHandler=function(e,t){this._mode_handlers[e]=t},WYMeditor.Lexer.prototype.parse=function(e){if("undefined"==typeof this._parser)return!1;for(var t,i=e.length;"object"==typeof(t=this._reduce(e));){var e=t[0],n=t[1],o=t[2],r=t[3];if(!this._dispatchTokens(n,o,r))return!1;if(""==e)return!0;if(e.length==i)return!1;i=e.length}return t?this._invokeParser(e,WYMeditor.LEXER_UNMATCHED):!1},WYMeditor.Lexer.prototype._dispatchTokens=function(e,t,i){return i=i||!1,this._invokeParser(e,WYMeditor.LEXER_UNMATCHED)?"boolean"==typeof i?this._invokeParser(t,WYMeditor.LEXER_MATCHED):this._isModeEnd(i)?this._invokeParser(t,WYMeditor.LEXER_EXIT)?this._mode.leave():!1:this._isSpecialMode(i)?(this._mode.enter(this._decodeSpecial(i)),this._invokeParser(t,WYMeditor.LEXER_SPECIAL)?this._mode.leave():!1):(this._mode.enter(i),this._invokeParser(t,WYMeditor.LEXER_ENTER)):!1},WYMeditor.Lexer.prototype._isModeEnd=function(e){return"__exit"===e},WYMeditor.Lexer.prototype._isSpecialMode=function(e){return"_"==e.substring(0,1)},WYMeditor.Lexer.prototype._decodeSpecial=function(e){return e.substring(1)},WYMeditor.Lexer.prototype._invokeParser=function(content,is_match){if(""===content)return!0;var current=this._mode.getCurrent(),handler=this._mode_handlers[current],result;return eval("result = this._parser."+handler+"(content, is_match);"),result},WYMeditor.Lexer.prototype._reduce=function(e){var t=this._regexes[this._mode.getCurrent()].match(e),i=t[1],n=t[0];if(n){var o=e.indexOf(i),r=e.substr(0,o);return e=e.substring(o+i.length),[e,r,i,n]}return!0},WYMeditor.XhtmlLexer=function(e){return $.extend(this,new WYMeditor.Lexer(e,"Text")),this.mapHandler("Text","Text"),this.addTokens(),this.init(),this},WYMeditor.XhtmlLexer.prototype.init=function(){},WYMeditor.XhtmlLexer.prototype.addTokens=function(){this.addCommentTokens("Text"),this.addScriptTokens("Text"),this.addCssTokens("Text"),this.addTagTokens("Text")},WYMeditor.XhtmlLexer.prototype.addCommentTokens=function(e){this.addEntryPattern("<!--",e,"Comment"),this.addExitPattern("-->","Comment")},WYMeditor.XhtmlLexer.prototype.addScriptTokens=function(e){this.addEntryPattern("<script",e,"Script"),this.addExitPattern("</script>","Script")},WYMeditor.XhtmlLexer.prototype.addCssTokens=function(e){this.addEntryPattern("<style",e,"Css"),this.addExitPattern("</style>","Css")},WYMeditor.XhtmlLexer.prototype.addTagTokens=function(e){this.addSpecialPattern("<\\s*[a-z0-9:-]+\\s*>",e,"OpeningTag"),this.addEntryPattern("<[a-z0-9:-]+[\\/ \\>]+",e,"OpeningTag"),this.addInTagDeclarationTokens("OpeningTag"),this.addSpecialPattern("</\\s*[a-z0-9:-]+\\s*>",e,"ClosingTag")},WYMeditor.XhtmlLexer.prototype.addInTagDeclarationTokens=function(e){this.addSpecialPattern("\\s+",e,"Ignore"),this.addAttributeTokens(e),this.addExitPattern("/>",e),this.addExitPattern(">",e)},WYMeditor.XhtmlLexer.prototype.addAttributeTokens=function(e){this.addSpecialPattern("\\s*[a-z-_0-9]*:?[a-z-_0-9]+\\s*(?==)\\s*",e,"TagAttributes"),this.addEntryPattern('=\\s*"',e,"DoubleQuotedAttribute"),this.addPattern('\\\\"',"DoubleQuotedAttribute"),this.addExitPattern('"',"DoubleQuotedAttribute"),this.addEntryPattern("=\\s*'",e,"SingleQuotedAttribute"),this.addPattern("\\\\'","SingleQuotedAttribute"),this.addExitPattern("'","SingleQuotedAttribute"),this.addSpecialPattern("=\\s*[^>\\s]*",e,"UnquotedAttribute")},WYMeditor.XhtmlParser=function(e,t){var t=t||"Text";return this._Lexer=new WYMeditor.XhtmlLexer(this),this._Listener=e,this._mode=t,this._matches=[],this._last_match="",this._current_match="",this},WYMeditor.XhtmlParser.prototype.parse=function(e){return this._Lexer.parse(this.beforeParsing(e)),this.afterParsing(this._Listener.getResult())},WYMeditor.XhtmlParser.prototype.beforeParsing=function(e){return(e.match(/class="MsoNormal"/)||e.match(/ns = "urn:schemas-microsoft-com/))&&this._Listener.avoidStylingTagsAndAttributes(),this._Listener.beforeParsing(e)},WYMeditor.XhtmlParser.prototype.afterParsing=function(e){return this._Listener._avoiding_tags_implicitly&&this._Listener.allowStylingTagsAndAttributes(),this._Listener.afterParsing(e)},WYMeditor.XhtmlParser.prototype.Ignore=function(){return!0},WYMeditor.XhtmlParser.prototype.Text=function(e){return this._Listener.addContent(e),!0},WYMeditor.XhtmlParser.prototype.Comment=function(e,t){return this._addNonTagBlock(e,t,"addComment")},WYMeditor.XhtmlParser.prototype.Script=function(e,t){return this._addNonTagBlock(e,t,"addScript")},WYMeditor.XhtmlParser.prototype.Css=function(e,t){return this._addNonTagBlock(e,t,"addCss")},WYMeditor.XhtmlParser.prototype._addNonTagBlock=function(e,t,i){switch(t){case WYMeditor.LEXER_ENTER:this._non_tag=e;break;case WYMeditor.LEXER_UNMATCHED:this._non_tag+=e;break;case WYMeditor.LEXER_EXIT:switch(i){case"addComment":this._Listener.addComment(this._non_tag+e);break;case"addScript":this._Listener.addScript(this._non_tag+e);break;case"addCss":this._Listener.addCss(this._non_tag+e)}}return!0},WYMeditor.XhtmlParser.prototype.OpeningTag=function(e,t){switch(t){case WYMeditor.LEXER_ENTER:this._tag=this.normalizeTag(e),this._tag_attributes={};break;case WYMeditor.LEXER_SPECIAL:this._callOpenTagListener(this.normalizeTag(e));break;case WYMeditor.LEXER_EXIT:this._callOpenTagListener(this._tag,this._tag_attributes)}return!0},WYMeditor.XhtmlParser.prototype.ClosingTag=function(e){return this._callCloseTagListener(this.normalizeTag(e)),!0},WYMeditor.XhtmlParser.prototype._callOpenTagListener=function(e,t){var t=t||{};this.autoCloseUnclosedBeforeNewOpening(e),this._Listener.isBlockTag(e)?(this._Listener._tag_stack.push(e),this._Listener.fixNestingBeforeOpeningBlockTag(e,t),this._Listener.openBlockTag(e,t),this._increaseOpenTagCounter(e)):this._Listener.isInlineTag(e)?this._Listener.inlineTag(e,t):(this._Listener.openUnknownTag(e,t),this._increaseOpenTagCounter(e)),this._Listener.last_tag=e,this._Listener.last_tag_opened=!0,this._Listener.last_tag_attributes=t},WYMeditor.XhtmlParser.prototype._callCloseTagListener=function(e){if(this._decreaseOpenTagCounter(e))if(this.autoCloseUnclosedBeforeTagClosing(e),this._Listener.isBlockTag(e)){var t=this._Listener._tag_stack.pop();if(0==t)return;t!=e&&(e=t),this._Listener.closeBlockTag(e)}else this._Listener.closeUnknownTag(e);else this._Listener.closeUnopenedTag(e);this._Listener.last_tag=e,this._Listener.last_tag_opened=!1},WYMeditor.XhtmlParser.prototype._increaseOpenTagCounter=function(e){this._Listener._open_tags[e]=this._Listener._open_tags[e]||0,this._Listener._open_tags[e]++},WYMeditor.XhtmlParser.prototype._decreaseOpenTagCounter=function(e){return this._Listener._open_tags[e]?(this._Listener._open_tags[e]--,0==this._Listener._open_tags[e]&&(this._Listener._open_tags[e]=void 0),!0):!1},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeNewOpening=function(e){this._autoCloseUnclosed(e,!1)},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeTagClosing=function(e){this._autoCloseUnclosed(e,!0)},WYMeditor.XhtmlParser.prototype._autoCloseUnclosed=function(e,t){var t=t||!1;if(this._Listener._open_tags)for(var i in this._Listener._open_tags){var n=this._Listener._open_tags[i];n>0&&this._Listener.shouldCloseTagAutomatically(i,e,t)&&this._callCloseTagListener(i,!0)}},WYMeditor.XhtmlParser.prototype.getTagReplacements=function(){return this._Listener.getTagReplacements()},WYMeditor.XhtmlParser.prototype.normalizeTag=function(e){e=e.replace(/^([\s<\/>]*)|([\s<\/>]*)$/gm,"").toLowerCase();var t=this._Listener.getTagReplacements();return t[e]?t[e]:e},WYMeditor.XhtmlParser.prototype.TagAttributes=function(e,t){return WYMeditor.LEXER_SPECIAL==t&&(this._current_attribute=e),!0},WYMeditor.XhtmlParser.prototype.DoubleQuotedAttribute=function(e,t){return WYMeditor.LEXER_UNMATCHED==t&&(this._tag_attributes[this._current_attribute]=e),!0},WYMeditor.XhtmlParser.prototype.SingleQuotedAttribute=function(e,t){return WYMeditor.LEXER_UNMATCHED==t&&(this._tag_attributes[this._current_attribute]=e),!0},WYMeditor.XhtmlParser.prototype.UnquotedAttribute=function(e){return this._tag_attributes[this._current_attribute]=e.replace(/^=/,""),!0},WYMeditor.XhtmlSaxListener=function(){return this.output="",this.helper=new WYMeditor.XmlHelper,this._open_tags={},this.validator=WYMeditor.XhtmlValidator,this._tag_stack=[],this.avoided_tags=["area"],this.entities={"&nbsp;":"&#160;","&iexcl;":"&#161;","&cent;":"&#162;","&pound;":"&#163;","&curren;":"&#164;","&yen;":"&#165;","&brvbar;":"&#166;","&sect;":"&#167;","&uml;":"&#168;","&copy;":"&#169;","&ordf;":"&#170;","&laquo;":"&#171;","&not;":"&#172;","&shy;":"&#173;","&reg;":"&#174;","&macr;":"&#175;","&deg;":"&#176;","&plusmn;":"&#177;","&sup2;":"&#178;","&sup3;":"&#179;","&acute;":"&#180;","&micro;":"&#181;","&para;":"&#182;","&middot;":"&#183;","&cedil;":"&#184;","&sup1;":"&#185;","&ordm;":"&#186;","&raquo;":"&#187;","&frac14;":"&#188;","&frac12;":"&#189;","&frac34;":"&#190;","&iquest;":"&#191;","&Agrave;":"&#192;","&Aacute;":"&#193;","&Acirc;":"&#194;","&Atilde;":"&#195;","&Auml;":"&#196;","&Aring;":"&#197;","&AElig;":"&#198;","&Ccedil;":"&#199;","&Egrave;":"&#200;","&Eacute;":"&#201;","&Ecirc;":"&#202;","&Euml;":"&#203;","&Igrave;":"&#204;","&Iacute;":"&#205;","&Icirc;":"&#206;","&Iuml;":"&#207;","&ETH;":"&#208;","&Ntilde;":"&#209;","&Ograve;":"&#210;","&Oacute;":"&#211;","&Ocirc;":"&#212;","&Otilde;":"&#213;","&Ouml;":"&#214;","&times;":"&#215;","&Oslash;":"&#216;","&Ugrave;":"&#217;","&Uacute;":"&#218;","&Ucirc;":"&#219;","&Uuml;":"&#220;","&Yacute;":"&#221;","&THORN;":"&#222;","&szlig;":"&#223;","&agrave;":"&#224;","&aacute;":"&#225;","&acirc;":"&#226;","&atilde;":"&#227;","&auml;":"&#228;","&aring;":"&#229;","&aelig;":"&#230;","&ccedil;":"&#231;","&egrave;":"&#232;","&eacute;":"&#233;","&ecirc;":"&#234;","&euml;":"&#235;","&igrave;":"&#236;","&iacute;":"&#237;","&icirc;":"&#238;","&iuml;":"&#239;","&eth;":"&#240;","&ntilde;":"&#241;","&ograve;":"&#242;","&oacute;":"&#243;","&ocirc;":"&#244;","&otilde;":"&#245;","&ouml;":"&#246;","&divide;":"&#247;","&oslash;":"&#248;","&ugrave;":"&#249;","&uacute;":"&#250;","&ucirc;":"&#251;","&uuml;":"&#252;","&yacute;":"&#253;","&thorn;":"&#254;","&yuml;":"&#255;","&OElig;":"&#338;","&oelig;":"&#339;","&Scaron;":"&#352;","&scaron;":"&#353;","&Yuml;":"&#376;","&fnof;":"&#402;","&circ;":"&#710;","&tilde;":"&#732;","&Alpha;":"&#913;","&Beta;":"&#914;","&Gamma;":"&#915;","&Delta;":"&#916;","&Epsilon;":"&#917;","&Zeta;":"&#918;","&Eta;":"&#919;","&Theta;":"&#920;","&Iota;":"&#921;","&Kappa;":"&#922;","&Lambda;":"&#923;","&Mu;":"&#924;","&Nu;":"&#925;","&Xi;":"&#926;","&Omicron;":"&#927;","&Pi;":"&#928;","&Rho;":"&#929;","&Sigma;":"&#931;","&Tau;":"&#932;","&Upsilon;":"&#933;","&Phi;":"&#934;","&Chi;":"&#935;","&Psi;":"&#936;","&Omega;":"&#937;","&alpha;":"&#945;","&beta;":"&#946;","&gamma;":"&#947;","&delta;":"&#948;","&epsilon;":"&#949;","&zeta;":"&#950;","&eta;":"&#951;","&theta;":"&#952;","&iota;":"&#953;","&kappa;":"&#954;","&lambda;":"&#955;","&mu;":"&#956;","&nu;":"&#957;","&xi;":"&#958;","&omicron;":"&#959;","&pi;":"&#960;","&rho;":"&#961;","&sigmaf;":"&#962;","&sigma;":"&#963;","&tau;":"&#964;","&upsilon;":"&#965;","&phi;":"&#966;","&chi;":"&#967;","&psi;":"&#968;","&omega;":"&#969;","&thetasym;":"&#977;","&upsih;":"&#978;","&piv;":"&#982;","&ensp;":"&#8194;","&emsp;":"&#8195;","&thinsp;":"&#8201;","&zwnj;":"&#8204;","&zwj;":"&#8205;","&lrm;":"&#8206;","&rlm;":"&#8207;","&ndash;":"&#8211;","&mdash;":"&#8212;","&lsquo;":"&#8216;","&rsquo;":"&#8217;","&sbquo;":"&#8218;","&ldquo;":"&#8220;","&rdquo;":"&#8221;","&bdquo;":"&#8222;","&dagger;":"&#8224;","&Dagger;":"&#8225;","&bull;":"&#8226;","&hellip;":"&#8230;","&permil;":"&#8240;","&prime;":"&#8242;","&Prime;":"&#8243;","&lsaquo;":"&#8249;","&rsaquo;":"&#8250;","&oline;":"&#8254;","&frasl;":"&#8260;","&euro;":"&#8364;","&image;":"&#8465;","&weierp;":"&#8472;","&real;":"&#8476;","&trade;":"&#8482;","&alefsym;":"&#8501;","&larr;":"&#8592;","&uarr;":"&#8593;","&rarr;":"&#8594;","&darr;":"&#8595;","&harr;":"&#8596;","&crarr;":"&#8629;","&lArr;":"&#8656;","&uArr;":"&#8657;","&rArr;":"&#8658;","&dArr;":"&#8659;","&hArr;":"&#8660;","&forall;":"&#8704;","&part;":"&#8706;","&exist;":"&#8707;","&empty;":"&#8709;","&nabla;":"&#8711;","&isin;":"&#8712;","&notin;":"&#8713;","&ni;":"&#8715;","&prod;":"&#8719;","&sum;":"&#8721;","&minus;":"&#8722;","&lowast;":"&#8727;","&radic;":"&#8730;","&prop;":"&#8733;","&infin;":"&#8734;","&ang;":"&#8736;","&and;":"&#8743;","&or;":"&#8744;","&cap;":"&#8745;","&cup;":"&#8746;","&int;":"&#8747;","&there4;":"&#8756;","&sim;":"&#8764;","&cong;":"&#8773;","&asymp;":"&#8776;","&ne;":"&#8800;","&equiv;":"&#8801;","&le;":"&#8804;","&ge;":"&#8805;","&sub;":"&#8834;","&sup;":"&#8835;","&nsub;":"&#8836;","&sube;":"&#8838;","&supe;":"&#8839;","&oplus;":"&#8853;","&otimes;":"&#8855;","&perp;":"&#8869;","&sdot;":"&#8901;","&lceil;":"&#8968;","&rceil;":"&#8969;","&lfloor;":"&#8970;","&rfloor;":"&#8971;","&lang;":"&#9001;","&rang;":"&#9002;","&loz;":"&#9674;","&spades;":"&#9824;","&clubs;":"&#9827;","&hearts;":"&#9829;","&diams;":"&#9830;"},this.block_tags=["a","abbr","acronym","address","area","b","base","bdo","big","blockquote","body","button","caption","cite","code","col","colgroup","dd","del","div","dfn","dl","dt","em","fieldset","form","head","h1","h2","h3","h4","h5","h6","html","i","iframe","ins","kbd","label","legend","li","map","noscript","object","ol","optgroup","option","p","pre","q","samp","script","select","small","span","strong","style","sub","sup","table","tbody","td","textarea","tfoot","th","thead","title","tr","tt","ul","var","extends","meter","section","article","aside","details","header","footer","nav","dialog","figure","figcaption","address","hgroup","mark","time","canvas","audio","video","source","output","progress","ruby","rt","rp","summary","command"],this.inline_tags=["br","embed","hr","img","input","param","source","wbr"],this},WYMeditor.XhtmlSaxListener.prototype.shouldCloseTagAutomatically=function(e,t,i){var i=i||!1;return"td"==e&&(i&&"tr"==t||!i&&"td"==t)?!0:"option"==e&&(i&&"select"==t||!i&&"option"==t)?!0:!1},WYMeditor.XhtmlSaxListener.prototype.beforeParsing=function(e){return this.output="",e},WYMeditor.XhtmlSaxListener.prototype.afterParsing=function(e){return e=this.replaceNamedEntities(e),e=this.joinRepeatedEntities(e),e=this.removeEmptyTags(e)},WYMeditor.XhtmlSaxListener.prototype.replaceNamedEntities=function(e){for(var t in this.entities)e=e.replace(new RegExp(t,"g"),this.entities[t]);return e},WYMeditor.XhtmlSaxListener.prototype.joinRepeatedEntities=function(e){var t="em|strong|sub|sup|acronym|pre|del|address";return e.replace(new RegExp("</("+t+")><\\1>",""),"").replace(new RegExp("(s*<("+t+")>s*){2}(.*)(s*</\\2>s*){2}",""),"<$2>$3<$2>")},WYMeditor.XhtmlSaxListener.prototype.removeEmptyTags=function(e){return e.replace(new RegExp("<("+this.block_tags.join("|").replace(/\|td/,"").replace(/\|th/,"")+")>(<br />|&#160;|&nbsp;|\\s)*</\\1>","g"),"")},WYMeditor.XhtmlSaxListener.prototype.removeBrInPre=function(e){var t=e.match(new RegExp("<pre[^>]*>(.*?)</pre>","gmi"));if(t)for(var i=0;t.length>i;i++)e=e.replace(t[i],t[i].replace(new RegExp("<br />","g"),String.fromCharCode(13,10)));return e},WYMeditor.XhtmlSaxListener.prototype.getResult=function(){return this.output},WYMeditor.XhtmlSaxListener.prototype.getTagReplacements=function(){return{b:"strong",i:"em"}},WYMeditor.XhtmlSaxListener.prototype.addContent=function(e){this.output+=e},WYMeditor.XhtmlSaxListener.prototype.addComment=function(e){this.remove_comments&&(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.addScript=function(e){this.remove_scripts||(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.addCss=function(e){this.remove_embeded_styles||(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.openBlockTag=function(e,t){this.output+=this.helper.tag(e,this.validator.getValidTagAttributes(e,t),!0)},WYMeditor.XhtmlSaxListener.prototype.inlineTag=function(e,t){this.output+=this.helper.tag(e,this.validator.getValidTagAttributes(e,t))},WYMeditor.XhtmlSaxListener.prototype.openUnknownTag=function(e,t){"area"===e&&(this.output+=this.helper.tag(e,t,!0))},WYMeditor.XhtmlSaxListener.prototype.closeBlockTag=function(e){this.output=this.output.replace(/<br \/>$/,"")+this._getClosingTagContent("before",e)+"</"+e+">"+this._getClosingTagContent("after",e)},WYMeditor.XhtmlSaxListener.prototype.closeUnknownTag=function(){},WYMeditor.XhtmlSaxListener.prototype.closeUnopenedTag=function(e){this.output+="</"+e+">"},WYMeditor.XhtmlSaxListener.prototype.avoidStylingTagsAndAttributes=function(){this.avoided_tags=["div","span"],this.validator.skipped_attributes=["style"],this.validator.skipped_attribute_values=["MsoNormal","main1"],this._avoiding_tags_implicitly=!0},WYMeditor.XhtmlSaxListener.prototype.allowStylingTagsAndAttributes=function(){this.avoided_tags=[],this.validator.skipped_attributes=[],this.validator.skipped_attribute_values=[],this._avoiding_tags_implicitly=!1},WYMeditor.XhtmlSaxListener.prototype.isBlockTag=function(e){return!WYMeditor.Helper.contains(this.avoided_tags,e)&&WYMeditor.Helper.contains(this.block_tags,e)},WYMeditor.XhtmlSaxListener.prototype.isInlineTag=function(e){return!WYMeditor.Helper.contains(this.avoided_tags,e)&&WYMeditor.Helper.contains(this.inline_tags,e)},WYMeditor.XhtmlSaxListener.prototype.insertContentAfterClosingTag=function(e,t){this._insertContentWhenClosingTag("after",e,t)},WYMeditor.XhtmlSaxListener.prototype.insertContentBeforeClosingTag=function(e,t){this._insertContentWhenClosingTag("before",e,t)},WYMeditor.XhtmlSaxListener.prototype.fixNestingBeforeOpeningBlockTag=function(e){"li"==e||"ul"!=e&&"ol"!=e||!this.last_tag||this.last_tag_opened||"li"!=this.last_tag||(this.output=this.output.replace(/<\/li>$/,""),this.insertContentAfterClosingTag(e,"</li>"))},WYMeditor.XhtmlSaxListener.prototype._insertContentWhenClosingTag=function(e,t,i){this["_insert_"+e+"_closing"]||(this["_insert_"+e+"_closing"]=[]),this["_insert_"+e+"_closing"][t]||(this["_insert_"+e+"_closing"][t]=[]),this["_insert_"+e+"_closing"][t].push(i)},WYMeditor.XhtmlSaxListener.prototype._getClosingTagContent=function(e,t){return this["_insert_"+e+"_closing"]&&this["_insert_"+e+"_closing"][t]&&this["_insert_"+e+"_closing"][t].length>0?this["_insert_"+e+"_closing"][t].pop():""},WYMeditor.WymCssLexer=function(e,t){var t="undefined"==typeof t?!0:t;return $.extend(this,new WYMeditor.Lexer(e,t?"Ignore":"WymCss")),this.mapHandler("WymCss","Ignore"),1==t&&(this.addEntryPattern("/\\*[<\\s]*WYMeditor[>\\s]*\\*/","Ignore","WymCss"),this.addExitPattern("/\\*[</\\s]*WYMeditor[>\\s]*\\*/","WymCss")),this.addSpecialPattern("[\\sa-z1-6]*\\.[a-z-_0-9]+","WymCss","WymCssStyleDeclaration"),this.addEntryPattern("/\\*","WymCss","WymCssComment"),this.addExitPattern("\\*/","WymCssComment"),this.addEntryPattern("{","WymCss","WymCssStyle"),this.addExitPattern("}","WymCssStyle"),this.addEntryPattern("/\\*","WymCssStyle","WymCssFeedbackStyle"),this.addExitPattern("\\*/","WymCssFeedbackStyle"),this},WYMeditor.WymCssParser=function(){return this._in_style=!1,this._has_title=!1,this.only_wym_blocks=!0,this.css_settings={classesItems:[],editorStyles:[],dialogStyles:[]},this},WYMeditor.WymCssParser.prototype.parse=function(e,t){var t="undefined"==typeof t?this.only_wym_blocks:t;this._Lexer=new WYMeditor.WymCssLexer(this,t),this._Lexer.parse(e)},WYMeditor.WymCssParser.prototype.Ignore=function(){return!0},WYMeditor.WymCssParser.prototype.WymCssComment=function(e,t){return e.match(/end[a-z0-9\s]*wym[a-z0-9\s]*/im)?!1:(t==WYMeditor.LEXER_UNMATCHED&&(this._in_style?this._current_item[this._current_element]&&(this._current_item[this._current_element].expressions?this._current_item[this._current_element].expressions.push(e):this._current_item[this._current_element].expressions=[e]):(this._has_title=!0,this._current_item={title:WYMeditor.Helper.trim(e)}),this._in_style=!0),!0)},WYMeditor.WymCssParser.prototype.WymCssStyle=function(e,t){return t==WYMeditor.LEXER_UNMATCHED?(e=WYMeditor.Helper.trim(e),""!=e&&(this._current_item[this._current_element].style=e)):t==WYMeditor.LEXER_EXIT&&(this._in_style=!1,this._has_title=!1,this.addStyleSetting(this._current_item)),!0},WYMeditor.WymCssParser.prototype.WymCssFeedbackStyle=function(e,t){return t==WYMeditor.LEXER_UNMATCHED&&(this._current_item[this._current_element].feedback_style=e.replace(/^([\s\/\*]*)|([\s\/\*]*)$/gm,"")),!0},WYMeditor.WymCssParser.prototype.WymCssStyleDeclaration=function(e){e=e.replace(/^([\s\.]*)|([\s\.*]*)$/gm,"");var t="";if(e.indexOf(".")>0){var i=e.split(".");this._current_element=i[1];var t=i[0]}else this._current_element=e;return this._has_title||(this._current_item={title:(t?t.toUpperCase()+": ":"")+this._current_element},this._has_title=!0),this._current_item[this._current_element]||(this._current_item[this._current_element]={name:this._current_element}),t&&(this._current_item[this._current_element].tags?this._current_item[this._current_element].tags.push(t):this._current_item[this._current_element].tags=[t]),!0},WYMeditor.WymCssParser.prototype.addStyleSetting=function(e){for(var t in e){var i=e[t];"object"==typeof i&&"title"!=t&&(this.css_settings.classesItems.push({name:WYMeditor.Helper.trim(i.name),title:e.title,expr:WYMeditor.Helper.trim((i.expressions||i.tags).join(", "))}),i.feedback_style&&this.css_settings.editorStyles.push({name:"."+WYMeditor.Helper.trim(i.name),css:i.feedback_style}),i.style&&this.css_settings.dialogStyles.push({name:"."+WYMeditor.Helper.trim(i.name),css:i.style}))}},$.fn.isPhantomNode=function(){return 3==this[0].nodeType?!/[^\t\n\r ]/.test(this[0].data):!1},WYMeditor.isPhantomNode=function(e){return 3==e.nodeType?!/[^\t\n\r ]/.test(e.data):!1},WYMeditor.isPhantomString=function(e){return!/[^\t\n\r ]/.test(e)},$.fn.parentsOrSelf=function(e){var t=this;return 3==t[0].nodeType&&(t=t.parents().slice(0,1)),1==t.filter(e).size()?t:t.parents(e).slice(0,1)},WYMeditor.Helper={replaceAll:function(e,t,i){return e.replace(new RegExp(t,"g"),i)},insertAt:function(e,t,i){return e.substr(0,i)+t+e.substring(i)},trim:function(e){return e.replace(/^(\s*)|(\s*)$/gm,"")},contains:function(e,t){for(var i=0;e.length>i;i++)if(e[i]===t)return!0;return!1},indexOf:function(e,t){for(var i=-1,n=0;e.length>n;n++)if(e[n]==t){i=n;break}return i},findByName:function(e,t){for(var i=0;e.length>i;i++){var n=e[i];if(n.name==t)return n}return null}},/*
 * WYMeditor : what you see is What You Mean web-based editor
 * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/
 * Dual licensed under the MIT (MIT-license.txt)
 * and GPL (GPL-license.txt) licenses.
 *
 * For further information visit:
 *        http://www.wymeditor.org/
 *
 * File Name:
 *        jquery.wymeditor.explorer.js
 *        MSIE specific class and functions.
 *        See the documentation for more info.
 *
 * File Authors:
 *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)
 *        Bermi Ferrer (wymeditor a-t bermi dotorg)
 *        Frdric Palluel-Lafleur (fpalluel a-t gmail dotcom)
 *        Jonatan Lundin (jonatan.lundin a-t gmail dotcom)
 */
WYMeditor.WymClassExplorer=function(e){this._wym=e,this._class="className",this._newLine="\r\n"},WYMeditor.WymClassExplorer.prototype.format_block=function(e){var t=this,i=e||t.selected()||$(t._iframe).contents().find("body").get(0),n=i.tagName.toLowerCase();$.inArray(n,["strong","b","em","i","sub","sup","a"])>-1&&(n=i.parentNode.tagName.toLowerCase()),n==WYMeditor.BODY&&(t._selected_image=null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),t._exec(WYMeditor.FORMAT_BLOCK,"<"+WYMeditor.P+">"))},WYMeditor.WymClassExplorer.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),$("html",this._doc).addClass("ie"),$(this._doc.body).html(this._wym._html);var wym=this;this._doc.body.onfocus=function(){wym._doc.designMode="on",wym._doc=iframe.contentWindow.document},this._doc.onbeforedeactivate=function(){wym.saveCaret()},this._doc.onkeyup=function(){wym.saveCaret(),wym.keyup()},this._doc.onclick=function(){wym.saveCaret()},this._doc.body.onbeforepaste=function(){wym._iframe.contentWindow.event.returnValue=!1},this._doc.body.onpaste=function(){wym._iframe.contentWindow.event.returnValue=!1,wym.paste(window.clipboardData.getData("Text"))},this._initialized&&($.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()),this._initialized=!0,this._doc.designMode="on";try{this._doc=iframe.contentWindow.document}catch(e){}},WYMeditor.WymClassExplorer.prototype._exec=function(e,t){switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var i=this.findUp(this.container(),WYMeditor.LI);if(i){var n=i.parentNode.parentNode;(i.parentNode.childNodes.length>1||n.tagName.toLowerCase()==WYMeditor.OL||n.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(e)}break;default:t?this._doc.execCommand(e,!1,t):this._doc.execCommand(e)}},WYMeditor.WymClassExplorer.prototype.selected=function(){var e=this._iframe.contentWindow.document.caretPos;return null!=e&&void 0!=e.parentElement?e.parentElement():void 0},WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()},WYMeditor.WymClassExplorer.prototype.addCssRule=function(e,t){e.addRule(t.name,t.css)},WYMeditor.WymClassExplorer.prototype.insert=function(e){var t=this._doc.selection.createRange();if($(t.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{t.pasteHTML(e)}catch(i){}else this.paste(e)},WYMeditor.WymClassExplorer.prototype.wrap=function(e,t){var i=this._doc.selection.createRange();if($(i.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{i.pasteHTML(e+i.text+t)}catch(n){}},WYMeditor.WymClassExplorer.prototype.unwrap=function(){var e=this._doc.selection.createRange();if($(e.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{var t=e.text;this._exec("Cut"),e.pasteHTML(t)}catch(i){}},WYMeditor.WymClassExplorer.prototype.keyup=function(){(wym=this)._selected_image=null,$(wym._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),wym.format_block()},WYMeditor.WymClassExplorer.prototype.setFocusToNode=function(e,t){(wym=this)._iframe.contentWindow.focus();var i=wym._doc.selection.createRange();t=t?!0:!1,i.moveToElementText(e),i.collapse(t),i.select(),e.focus()},/*
 * WYMeditor : what you see is What You Mean web-based editor
 * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/
 * Dual licensed under the MIT (MIT-license.txt)
 * and GPL (GPL-license.txt) licenses.
 *
 * For further information visit:
 *        http://www.wymeditor.org/
 *
 * File Name:
 *        jquery.wymeditor.mozilla.js
 *        Gecko specific class and functions.
 *        See the documentation for more info.
 *
 * File Authors:
 *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)
 *        Volker Mische (vmx a-t gmx dotde)
 *        Bermi Ferrer (wymeditor a-t bermi dotorg)
 *        Frdric Palluel-Lafleur (fpalluel a-t gmail dotcom)
 */
WYMeditor.WymClassMozilla=function(e){this._wym=e,this._class="class",this._newLine="\n"},WYMeditor.WymClassMozilla.prototype.initIframe=function(iframe){var wym=this;this._iframe=iframe,this._doc=iframe.contentDocument;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),$(".fieldWithErrors iframe").contents().find("body").addClass("fieldWithErrors"),this.html(this._wym._html),this.enableDesignMode(),$.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$(this._doc).bind("keydown",this.keydown),$(this._doc).bind("keyup",this.keyup),$(this._doc).bind("paste",this.intercept_paste),$(this._doc).bind("focus",function(){wym.enableDesignMode.call(wym)}),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassMozilla.prototype.html=function(e){if("string"!=typeof e)return $(this._doc.body).html();try{this._doc.designMode="off"}catch(t){}e=e.replace(/<em(\b[^>]*)>/gi,"<i$1>").replace(/<\/em>/gi,"</i>").replace(/<strong(\b[^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>"),$(this._doc.body).html(e),this.enableDesignMode()},WYMeditor.WymClassMozilla.prototype._exec=function(e,t){if(!this.selected())return!1;switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var i=this.selected(),n=this._iframe.contentWindow.getSelection(),o=n.anchorNode;if("#text"==o.nodeName&&(o=o.parentNode),i=this.findUp(i,WYMeditor.BLOCKS),o=this.findUp(o,WYMeditor.BLOCKS),i&&i==o&&i.tagName.toLowerCase()==WYMeditor.LI){var r=i.parentNode.parentNode;(i.parentNode.childNodes.length>1||r.tagName.toLowerCase()==WYMeditor.OL||r.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(e,"",null)}break;default:t?this._doc.execCommand(e,"",t):this._doc.execCommand(e,"",null)}var s=this.selected();s.tagName.toLowerCase()==WYMeditor.BODY&&this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)},WYMeditor.WymClassMozilla.prototype.selected=function(e){(null==e||"true"!=e.toString())&&(e=!1);var t=this._iframe.contentWindow.getSelection(),n=t.focusNode;if(n){if("#text"==n.nodeName){if(e&&t.toString().length>0){if(actual_node=null,parent_node=t.focusNode.parentNode,null!=parent_node)for(i=0;parent_node.childNodes.length>i;i++)child_node=parent_node.childNodes[i],"#text"!=child_node.nodeName&&child_node.innerHTML==t.toString()&&(actual_node=child_node);return null==actual_node?this.switchTo(t,"span"):actual_node}return n.parentNode}return n}return null},WYMeditor.WymClassMozilla.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassMozilla.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title];if(e.ctrlKey){if(66==e.keyCode)return t._exec(WYMeditor.BOLD),!1;if(73==e.keyCode)return t._exec(WYMeditor.ITALIC),!1}else 13==e.keyCode&&(e.shiftKey||(container=t.selected(),container&&container.tagName.toLowerCase()==WYMeditor.PRE&&(e.preventDefault(),t.insert("<p></p>"))))},WYMeditor.WymClassMozilla.prototype.keyup=function(e){if(null!=(wym=WYMeditor.INSTANCES[this.title])){wym._selected_image=null,$(wym._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym");var t=null;13!=e.keyCode||e.shiftKey?-1!=$.inArray(e.keyCode,[8,17,46,224])||e.metaKey||e.ctrlKey||wym.format_block():($(wym._doc.body).children(WYMeditor.BR).remove(),(t=wym.selected())&&t.tagName.toLowerCase()==WYMeditor.PRE&&wym._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))}},WYMeditor.WymClassMozilla.prototype.enableDesignMode=function(){if("off"==this._doc.designMode)try{this._doc.designMode="on",this._doc.execCommand("styleWithCSS","",!1)}catch(e){}},WYMeditor.WymClassMozilla.prototype.openBlockTag=function(e,t){var t=this.validator.getValidTagAttributes(e,t);if("span"==e&&t.style){var i=this.getTagForStyle(t.style);if(!i)return;this._tag_stack.pop();var e=i;this._tag_stack.push(i),t.style=""}this.output+=this.helper.tag(e,t,!0)},WYMeditor.WymClassMozilla.prototype.getTagForStyle=function(e){return/bold/.test(e)?"strong":/italic/.test(e)?"em":/sub/.test(e)?"sub":/super/.test(e)?"super":!1},/*
 * WYMeditor : what you see is What You Mean web-based editor
 * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/
 * Dual licensed under the MIT (MIT-license.txt)
 * and GPL (GPL-license.txt) licenses.
 *
 * For further information visit:
 *        http://www.wymeditor.org/
 *
 * File Name:
 *        jquery.wymeditor.opera.js
 *        Opera specific class and functions.
 *        See the documentation for more info.
 *
 * File Authors:
 *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)
 */
WYMeditor.WymClassOpera=function(e){this._wym=e,this._class="class",this._newLine="\r\n"},WYMeditor.WymClassOpera.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this.html(this._wym._html),$.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$(this._doc).bind("keydown",this.keydown),$(this._doc).bind("keyup",this.keyup),$(this._doc).bind("paste",this.intercept_paste),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassOpera.prototype._exec=function(e,t){t?this._doc.execCommand(e,!1,t):this._doc.execCommand(e)},WYMeditor.WymClassOpera.prototype.selected=function(){var e=this._iframe.contentWindow.getSelection(),t=e.focusNode;return t?"#text"==t.nodeName?t.parentNode:t:null},WYMeditor.WymClassOpera.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassOpera.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title],i=t._iframe.contentWindow.getSelection();startNode=i.getRangeAt(0).startContainer,$(startNode).parentsOrSelf(WYMeditor.MAIN_CONTAINERS.join(","))[0]||$(startNode).parentsOrSelf("li")||e.keyCode==WYMeditor.KEY.ENTER||e.keyCode==WYMeditor.KEY.LEFT||e.keyCode==WYMeditor.KEY.UP||e.keyCode==WYMeditor.KEY.RIGHT||e.keyCode==WYMeditor.KEY.DOWN||e.keyCode==WYMeditor.KEY.BACKSPACE||e.keyCode==WYMeditor.KEY.DELETE||t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)},WYMeditor.WymClassOpera.prototype.keyup=function(){var e=WYMeditor.INSTANCES[this.title];e._selected_image=null,$(e._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym")},/*
 * WYMeditor : what you see is What You Mean web-based editor
 * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/
 * Dual licensed under the MIT (MIT-license.txt)
 * and GPL (GPL-license.txt) licenses.
 *
 * For further information visit:
 *        http://www.wymeditor.org/
 *
 * File Name:
 *        jquery.wymeditor.safari.js
 *        Safari specific class and functions.
 *        See the documentation for more info.
 *
 * File Authors:
 *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)
 *        Scott Lewis (lewiscot a-t gmail dotcom)
 */
WYMeditor.WymClassSafari=function(e){this._wym=e,this._class="class",this._newLine="\n"},WYMeditor.WymClassSafari.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentDocument;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this.html(this._wym._html),$.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$(this._doc).bind("keydown",this.keydown),$(this._doc).bind("keyup",this.keyup),$(this._doc).bind("paste",this.intercept_paste),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassSafari.prototype._exec=function(e,t){if(!this.selected())return!1;switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var i=this.selected(),n=this._iframe.contentWindow.getSelection(),o=n.anchorNode;if("#text"==o.nodeName&&(o=o.parentNode),i=this.findUp(i,WYMeditor.BLOCKS),o=this.findUp(o,WYMeditor.BLOCKS),i&&i==o&&i.tagName.toLowerCase()==WYMeditor.LI){var r=i.parentNode.parentNode;(i.parentNode.childNodes.length>1||r.tagName.toLowerCase()==WYMeditor.OL||r.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(e,"",null)}break;case WYMeditor.INSERT_ORDEREDLIST:case WYMeditor.INSERT_UNORDEREDLIST:this._doc.execCommand(e,"",null);var i=this.selected(),s=this.findUp(i,WYMeditor.MAIN_CONTAINERS);s&&$(s).replaceWith($(s).html());break;default:t?this._doc.execCommand(e,"",t):this._doc.execCommand(e,"",null)}this.format_block()},WYMeditor.WymClassSafari.prototype.selected=function(e){(null==e||"true"!=e.toString())&&(e=!1);var t=this._iframe.contentWindow.getSelection(),n=t.focusNode;if(n){if("#text"==n.nodeName){if(e&&t.toString().length>0){if(actual_node=null,parent_node=t.focusNode.parentNode,null!=parent_node)for(i=0;parent_node.childNodes.length>i;i++)child_node=parent_node.childNodes[i],child_node.textContent==t.toString()&&(actual_node=child_node.parentNode);return null==actual_node?(this._selected_item=this.switchTo(t,"span"),this._selected_item):actual_node}return n.parentNode}return n}return null},WYMeditor.WymClassSafari.prototype.toggleClass=function(e,t){var i=null;i=this._selected_image?$(this._selected_image):$(this.selected(!0)||this._selected_item),null!=t&&(i=$(i.parentsOrSelf(t))),i.toggleClass(e),i.attr(WYMeditor.CLASS)||i.removeAttr(this._class)},WYMeditor.WymClassSafari.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassSafari.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title];e.ctrlKey?(66==e.keyCode&&(t._exec(WYMeditor.BOLD),e.preventDefault()),73==e.keyCode&&(t._exec(WYMeditor.ITALIC),e.preventDefault())):e.shiftKey&&13==e.keyCode&&(t._exec("InsertLineBreak"),e.preventDefault())},WYMeditor.WymClassSafari.prototype.keyup=function(e){var t=WYMeditor.INSTANCES[this.title];t._selected_image=null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym");var i=null;13!=e.keyCode||e.shiftKey?-1!=$.inArray(e.keyCode,[8,17,46,224])||e.metaKey||e.ctrlKey||(i=t.selected(),i&&(name=i.tagName.toLowerCase())&&($.inArray(name,["strong","b","em","i","sub","sup","a","span"])>-1&&(name=i.parentNode.tagName.toLowerCase()),(name==WYMeditor.BODY||name==WYMeditor.DIV)&&t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))):($(t._doc.body).children(WYMeditor.BR).remove(),i=t.selected(),i&&i.tagName.toLowerCase()==WYMeditor.PRE&&t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))},WYMeditor.WymClassSafari.prototype.openBlockTag=function(e,t){var t=this.validator.getValidTagAttributes(e,t);if("span"==e&&t.style){if(!(new_tag=this.getTagForStyle(t.style)))return;this._tag_stack.pop();var e=new_tag;this._tag_stack.push(new_tag),t.style="","string"==typeof t["class"]&&(t["class"]=t["class"].replace(/apple-style-span/gi,""))}this.output+=this.helper.tag(e,t,!0)},WYMeditor.WymClassSafari.prototype.getTagForStyle=function(e){return/bold/.test(e)?"strong":/italic/.test(e)?"em":/sub/.test(e)?"sub":/super/.test(e)?"sup":!1},RegExp.escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},WYMeditor.STRINGS.fr={Strong:"Mise en vidence",Emphasis:"Emphase",Superscript:"Exposant",Subscript:"Indice",Ordered_List:"Liste Ordonne",Unordered_List:"Liste Non-Ordonne",Indent:"Imbriqu",Outdent:"Non-imbriqu",Undo:"Annuler",Redo:"Rtablir",Link:"Lien",Unlink:"Supprimer le Lien",Image:"Image",Table:"Tableau",HTML:"HTML",Paragraph:"Paragraphe",Heading_1:"Titre 1",Heading_2:"Titre 2",Heading_3:"Titre 3",Heading_4:"Titre 4",Heading_5:"Titre 5",Heading_6:"Titre 6",Preformatted:"Pr-formatt",Blockquote:"Citation",Table_Header:"Cellule de titre",URL:"URL",Title:"Titre",Alternative_Text:"Texte alternatif",Caption:"Lgende",Summary:"Rsum",Number_Of_Rows:"Nombre de lignes",Number_Of_Cols:"Nombre de colonnes",Submit:"Envoyer",Cancel:"Annuler",Choose:"Choisir",Preview:"Prvisualisation",Paste_From_Word:"Copier depuis Word",Tools:"Outils",Containers:"Type de texte",Classes:"Type de contenu",Status:"Infos",Source_Code:"Code source"},WYMeditor.SKINS.gko={init:function(e){$(e._box).find(e._options.toolsSelector).addClass("wym_buttons"),$(e._box).find("div.wym_area_right ul").parents("div.wym_area_right").show().parents(e._options.boxSelector).find("div.wym_area_main").css({"margin-right":"155px"}),$(e._box).find("div.wym_area_left ul").parents("div.wym_area_left").show().parents(e._options.boxSelector).find("div.wym_area_main").css({"margin-left":"155px"}),$(e._box).find(".wym_tools_class").hover($.proxy(function(){this.toggleClassSelector()},e),$.proxy(function(){this.toggleClassSelector()},e)),$(".wym_skin_gko").animate({opacity:1},800)}},onOpenDialog=function(e){e=$(".ui-dialog"),e.height()<$(window).height()&&(iframed()?$(parent.document.body).addClass("hide-overflow"):$(document.body).addClass("hide-overflow"))},onCloseDialog=function(){iframed()?($(parent.document.body).removeClass("hide-overflow"),window.parent.$("#dialog_iframe").remove(),window.parent.$(".ui-dialog").remove()):($(document.body).removeClass("hide-overflow"),$("#dialog_iframe").remove(),$(".ui-dialog").remove(),$("#dialog_frame").remove(),$("#editor_dialog").remove())},WYMeditor.onload_functions=[];var wymeditor_inputs=[],wymeditors_loaded=0;"undefined"==typeof custom_wymeditor_boot_options&&(custom_wymeditor_boot_options={});var form_actions="<div id='dialog-form-actions'><div class='form-actions'><input id='submit_button' class='wym_submit button btn primary' type='submit' value='{Insert}' /><a href='' class='wym_cancel close_dialog button btn inline'>{Cancel}</a></div></div>",wymeditor_boot_options=$.extend({skin:"gko",basePath:"/",wymPath:"/assets/wymeditor/gko_wymeditor.js",cssSkinPath:"/assets/wym_skin/",jsSkinPath:"/assets/wymeditor/skins/",langPath:"/assets/wymeditor/lang/",iframeBasePath:"/",containersItems:[{name:"h2",title:"Heading_2",css:"icon-picture"},{name:"h3",title:"Heading_3",css:"icon-picture"},{name:"h4",title:"Heading_4",css:"icon-picture"},{name:"p",title:"Paragraph",css:"icon-picture"}],toolsItems:[{name:"Bold",title:"Bold",css:"icon-bold"},{name:"Italic",title:"Emphasis",css:" icon-italic"},{name:"InsertUnorderedList",title:"Unordered_List",css:"icon-list"},{name:"InsertOrderedList",title:"Ordered_List",css:"icon-th-list"},{name:"InsertImage",title:"Image",css:"icon-picture"},{name:"InsertTable",title:"Table",css:"icon-th-large"}],toolsHtml:"<div class='wym_tools wym_section wym_buttons btn-group'>"+WYMeditor.TOOLS_ITEMS+"</div>"+"<div class='wym_tools wym_section wym_buttons btn-group'>"+"<div btn-group'><ul>"+"<li class='dropdown'><button class='btn dropdown-toggle' data-toggle='dropdown'><i class='icon-share'></i><span class='caret'></span></button></button>"+"<ul class='dropdown-menu'>"+"<li><a href='#' name='"+WYMeditor.CREATE_LINK+"'>Ajouter un lien</a></li>"+"<li class='divider'></li>"+"<li><a href='#' name='"+WYMeditor.UNLINK+"'>Supprimer le Lien</a></li>"+"</ul></li></ul></div>"+"</div>"+"<div class='wym_tools wym_section wym_buttons btn-group'><div btn-group'><ul><a href='#' name='ToggleHtml' rel='tooltip' class='btn no-tooltip' title='HTML'><i class='icon-cog'></i></a></li></ul></div></div>",toolsItemHtml:"<a href='#' name='"+WYMeditor.TOOL_NAME+"' title='"+WYMeditor.TOOL_TITLE+"' rel='tooltip' class='btn no-tooltip'><i class='"+WYMeditor.TOOL_CLASS+"'></i></a>",containersHtml:"<div class='wym_containers wym_section btn-group'><ul class='nav'><li class='dropdown'><button class='btn dropdown-toggle' data-toggle='dropdown'><i class='icon-font'></i><span class='caret'></span></button><ul class='dropdown-menu'>"+WYMeditor.CONTAINERS_ITEMS+"</ul>"+"</li></ul></div>",containersItemHtml:"<li><a href='#' name='"+WYMeditor.CONTAINER_NAME+"'>"+WYMeditor.CONTAINER_TITLE+" ["+WYMeditor.CONTAINER_NAME+"]</a></li>",boxHtml:"<div class='wym_box'><div class='wym_area_top'><div class='btn-toolbar'>"+WYMeditor.CONTAINERS+WYMeditor.TOOLS+"</div>"+"</div>"+"<div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div>"+"</div>",iframeHtml:"<div class='wym_iframe wym_section'><iframe id='WYMeditor_"+WYMeditor.INDEX+"'"+($.browser.msie?" src='"+WYMeditor.IFRAME_BASE_PATH+"wymiframe'":"")+" frameborder='0' marginheight='0' marginwidth='0' border='0'"+" onload='this.contentWindow.parent.WYMeditor.INSTANCES["+WYMeditor.INDEX+"].loadIframe(this);'></iframe>"+"</div>",dialogImageHtml:"",dialogLinkHtml:"",dialogTableHtml:"<div class='wym_dialog wym_dialog_table'><form class='form-horizontal'><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_TABLE+"' />"+"<div class='control-group'>"+"<label for='wym_caption' class='control-label'>{Caption}</label>"+"<div class='controls'>"+"<input type='text' id='wym_caption' class='wym_caption' value='' size='40' />"+"</div>"+"</div>"+"<div class='control-group'>"+"<label for='wym_rows' class='control-label'>{Number_Of_Rows}</label>"+"<div class='controls'>"+"<input type='text' id='wym_rows' class='wym_rows' value='3' size='3' />"+"</div>"+"</div>"+"<div class='control-group'>"+"<label for='wym_cols' class='control-label'>{Number_Of_Cols}</label>"+"<div class='controls'>"+"<input type='text' id='wym_cols' class='wym_cols' value='2' size='3' />"+"</div>"+"</div>"+form_actions+"</form>"+"</div>",dialogPasteHtml:"<div class='wym_dialog wym_dialog_paste'><form class='form-horizontal'><input type='hidden' id='wym_dialog_type' class='wym_dialog_type' value='"+WYMeditor.DIALOG_PASTE+"' />"+"<div class='control-group'>"+"<textarea class='wym_text' rows='10' cols='50'></textarea>"+"</div>"+form_actions+"</form>"+"</div>",dialogPath:"/admin/dialogs/",dialogFeatures:{zIndex:1050,width:866,height:455,modal:!0,draggable:!0,resizable:!1,autoOpen:!0,open:onOpenDialog,close:onCloseDialog},dialogInlineFeatures:{zIndex:1050,width:600,height:485,modal:!0,draggable:!0,resizable:!1,autoOpen:!0,open:onOpenDialog,close:onCloseDialog},dialogId:"editor_dialog",dialogHtml:"<!DOCTYPE html><html dir='"+WYMeditor.DIRECTION+"'>"+"<head>"+"<link rel='stylesheet' type='text/css' media='screen' href='"+WYMeditor.CSS_PATH+"' />"+"<title>"+WYMeditor.DIALOG_TITLE+"</title>"+"<script type='text/javascript' src='"+WYMeditor.JQUERY_PATH+"'></script>"+"<script type='text/javascript' src='"+WYMeditor.WYM_PATH+"'></script>"+"</head>"+"<body>"+"<div id='page'>"+WYMeditor.DIALOG_BODY+"</div>"+"</body>"+"</html>",postInit:function(e){if(wymeditors_loaded+=1,WYMeditor.INSTANCES.length==wymeditors_loaded)for($(".wym_loading_overlay").remove(),i=0;WYMeditor.onload_functions.length>i;i++)WYMeditor.onload_functions[i]();$(e._iframe).contents().find("body").addClass("wym_iframe_body"),$(".field.hide-overflow").removeClass("hide-overflow").css("height","auto")},postInitDialog:function(){$.browser.msie&&($the_ui_dialog=$(".ui-dialog")).css("height",$the_ui_dialog.find("iframe").height()+$the_ui_dialog.find("iframe").contents().find(".form-actions").height()-12)},lang:"undefined"!=typeof I18n.locale?I18n.locale:"en"},custom_wymeditor_boot_options);WYMeditor.editor.prototype.loadIframe=function(e){var t=this,i=e.contentDocument||e.contentWindow;if(i.document&&(i=i.document),!$.browser.msie){i.open("text/html","replace"),html="<!DOCTYPE html>    <html>      <head>        <title>WYMeditor</title>        <meta charset='"+$("meta[charset]").attr("charset")+"' />        <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1' />      </head>      <body class='wym_iframe'>      </body>    </html>",i.write(html),i.close();var n=i.head||$(i).find("head").get(0);$.each(["gko_wym"],function(e,t){$("<link href='/assets/"+t+".css?"+Math.random().toString().split(".")[1]+"' media='all' rel='stylesheet' />").appendTo(n)})}null!=(id_of_editor=t._element.parent().attr("id"))&&$(i.body).addClass(id_of_editor),t.initIframe(e)},WYMeditor.init=function(){wymeditor_inputs=$(".wymeditor").filter(function(){for(i=0;WYMeditor.INSTANCES.length>i;i++)if(WYMeditor.INSTANCES[i]._element.attr("id")==$(this).attr("id"))return!1;return!0}),wymeditor_inputs.each(function(){(containing_field=$(this).parents(".field")).length>0&&""===containing_field.get(0).style.height.replace("auto","")&&containing_field.addClass("hide-overflow").css("height",$(this).outerHeight()-containing_field.offset().top+$(this).offset().top+45),$(this).hide()}),wymeditor_inputs.wymeditor(wymeditor_boot_options)},$(function(){WYMeditor.init()}),/*
 * HTML5 Sortable jQuery Plugin
 * http://farhadi.ir/projects/html5sortable
 * 
 * Copyright 2012, Ali Farhadi
 * Released under the MIT license.
 */
function(e){var t,i=e();e.fn.sortable=function(n){var o=String(n);return n=e.extend({connectWith:!1},n),this.each(function(){if(/^enable|disable|destroy$/.test(o)){var r=e(this).children(e(this).data("items")).attr("draggable","enable"==o);return"destroy"==o&&r.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"),void 0}var s,a,r=e(this).children(n.items),l=e("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');r.find(n.handle).mousedown(function(){s=!0}).mouseup(function(){s=!1}),e(this).data("items",n.items),i=i.add(l),n.connectWith&&e(n.connectWith).add(this).data("connectWith",n.connectWith),r.attr("draggable","true").on("dragstart.h5s",function(i){if(n.handle&&!s)return!1;s=!1;var o=i.originalEvent.dataTransfer;o.effectAllowed="move",o.setData("Text","dummy"),a=(t=e(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){t&&(t.removeClass("sortable-dragging").show(),i.detach(),a!=t.index()&&t.parent().trigger("sortupdate",{item:t}),t=null)}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,l]).on("dragover.h5s dragenter.h5s drop.h5s",function(o){return r.is(t)||n.connectWith===e(t).parent().data("connectWith")?"drop"==o.type?(o.stopPropagation(),i.filter(":visible").after(t),t.trigger("dragend.h5s"),!1):(o.preventDefault(),o.originalEvent.dataTransfer.dropEffect="move",r.is(this)?(n.forcePlaceholderSize&&l.height(t.outerHeight()),t.hide(),e(this)[l.index()<e(this).index()?"after":"before"](l),i.not(l).detach()):i.is(this)||e(this).children(n.items).length||(i.detach(),e(this).append(l)),!1):!0})})}}(jQuery),function(e){e.fn.dndPageScroll=function(t){t||(t={});var i={topId:"top_scroll_page",bottomId:"bottom_scroll_page",delay:50},t=e.extend(i,t),n=e("#"+t.topId);n.length||(n=e('<div id="top_scroll_page">&nbsp;</div>').appendTo("body"));var o=e("#"+t.bottomId);o.length||(o=e('<div id="bottom_scroll_page">&nbsp;</div>').appendTo("body"));var r=e("#top_scroll_page, #bottom_scroll_page");r.hide(),r.css({position:"fixed",left:0,right:0,height:20,zIndex:999999}),n.css({top:0}),o.css({bottom:0});var s,a;r.bind("dragenter",function(){return e(this).attr("id")==t.topId?"up":"down",!0}),r.bind("dragover",function(){if(e("html,body").is(":animated"))return!0;var i=e(window).scrollTop(),n=e(this).attr("id")==t.topId?-1:1,o=-1==n?s:a,r=-1==n?i:e(document).height()-(i+e(window).height());if(void 0!=o&&o==r&&r>0){var l=i+50*n;e("html,body").animate({scrollTop:l},t.delay,"linear")}return-1==n?s=r:a=r,!0});var l=function(){return r.hide(),timestamp=void 0,scrolltop=0,scrollbottom=0,!0};e(document).bind("dragstart",function(){return r.show(),!0}),e(document).bind("dragend",l),r.bind("mouseover",l)}}(jQuery),parseURL=function(e){var t={href:e},i=e.replace("//","/").split("/");return t.protocol=i[0],t.host=i[1],i[1]=i[1].split(":"),t.hostname=i[1][0],t.port=i[1].length>1?i[1][1]:"",i.splice(0,2),t.pathname="/"+i.join("/"),t.pathname=t.pathname.split("#"),t.hash=t.pathname.length>1?"#"+t.pathname[1]:"",t.pathname=t.pathname[0],t.pathname=t.pathname.split("?"),t.search=t.pathname.length>1?"?"+t.pathname[1]:"",t.pathname=t.pathname[0],t},iframed=function(){return parent&&parent.document.location.href!=document.location.href&&$.isFunction(parent.$)},attachLoading=function(e,t,i,n){"undefined"==typeof e&&(e="body"),container=$(e),"undefined"==typeof n&&(n=function(){}),"undefined"==typeof i&&(i=500),"undefined"==typeof t&&(t="Please wait..."),loader=$(e+" .gko-loader"),loader.length>0?loader.fadeIn(n):(container.append("<div class='gko-loader'><div class='progress progress-striped active'><div class='bar' style='width: 100%;'></div></div></div>"),loader=$(e+" .loader"),loader.css({"z-index":1e4,top:100}),loader.hide().fadeIn(i,n)),$("html").addClass("loading")},removeLoading=function(e,t,i){"undefined"==typeof e&&(e="body"),void 0==typeof t&&(t=500),"undefined"==typeof i&&(i=function(){$(this).remove()}),$(e+" .gko-loader").fadeOut(t,i),$("html").removeClass("loading")},parseValue=function(e){if("number"==typeof e)return e;if("string"==typeof e){var t=e.match(/\-?\d/g);return t&&t.constructor===Array?parseInt(t.join(""),10):0}return 0},timestamp=function(){return(new Date).getTime()},get_number_from_string=function(e){return e.replace(/[^\d]+/g,"")},getScreenSize=function(){var e=window.innerHeight>window.innerWidth?"landscape":"portrait",t="portrait"===e,i=t?480:320,n=t?320:480,o=t?screen.availHeight:screen.availWidth,r=t?screen.availWidth:screen.availHeight,s=Math.max(i,$(window).height()),a=Math.max(n,$(window).width()),l={width:Math.min(r,a),height:Math.min(o,s)};return l},init_text_editor=function(){$("textarea.wymeditor").each(function(){textarea=$(this),null!=(instance=WYMeditor.INSTANCES[$((textarea.next(".wym_box").find("iframe").attr("id")||"").split("_")).last().get(0)])&&(null!=(next=textarea.parent().next())&&next.length>0&&next.find("input, textarea").keydown($.proxy(function(e){shiftHeld=e.shiftKey,shiftHeld&&e.keyCode==$.ui.keyCode.TAB&&(this._iframe.contentWindow.focus(),e.preventDefault())},instance)).keyup(function(){shiftHeld=!1}),null!=(prev=textarea.parent().prev())&&prev.length>0&&prev.find("input, textarea").keydown($.proxy(function(e){e.keyCode==$.ui.keyCode.TAB&&(this._iframe.contentWindow.focus(),e.preventDefault())},instance)))})},init_modal_dialogs=function(){$('a[href*="dialog=true"]').not("#dialog_container a").each(function(e,t){$(t).data({"dialog-width":parseInt($($(t).attr("href").match("width=([0-9]*)")).last().get(0),10)||928,"dialog-height":parseInt($($(t).attr("href").match("height=([0-9]*)")).last().get(0),10)||473,"dialog-title":$(t).attr("title")||$(t).attr("name")||$(t).html()||null}).attr("href",$(t).attr("href").replace(/(\&(amp\;)?)?dialog\=true/,"").replace(/(\&(amp\;)?)?width\=\d+/,"").replace(/(\&(amp\;)?)?height\=\d+/,"").replace(/(\?&(amp\;)?)/,"?").replace(/\?$/,"")).on("click",function(e){e.preventDefault(),$anchor=$(this),iframe_src=(iframe_src=$anchor.attr("href"))+(iframe_src.indexOf("?")>-1?"&":"?")+"dialog=true",iframe=$("<iframe id='dialog_iframe' frameborder='0' marginheight='0' marginwidth='0' border='0' width='100%' height='100%' class='row-fluid'></iframe>");var i=getScreenSize(),n=Math.min(i.width,980),o=Math.min(i.height-100,980),r=$(t).data("dialog-type");"images"==r&&($anchor.data("dialog-width",i.width),n=i.width),iframe.dialog({title:$anchor.data("dialog-title"),zIndex:1050,modal:!0,resizable:!0,autoOpen:!0,width:i.width,height:o,open:onOpenDialog,close:onCloseDialog}),iframe.attr("src",iframe_src)})})};var images_dialog={initialised:!1,init:function(){this.initialised||($("#image_dialog_size_container ul li a").on("click",function(e){$("#image_dialog_size_container ul li").removeClass("active"),$(this).parent().addClass("active"),e.preventDefault()}),$("body#dialog_container").on("click","ul.js-selectable a",function(e){e.preventDefault();var t=$(this),i=$("#image_assignments_form");if(i.length>0){var n=t.closest("li").attr("id"),o=parseValue(n);$("#image_assignment_image_id").val(o),i.live("ajax:beforeSend.rails",function(){attachLoading("body#dialog_container")}).live("ajax:complete.rails",function(){removeLoading("body#dialog_container")}).submit()}else{var r=t.find("img:first"),s=$("#image_dialog_size_container li.active a").attr("data-size");image_url=r.attr("data-"+s),parent&&(null!=(wym_src=parent.document.getElementById("wym_src"))&&(wym_src.value=image_url),null!=(wym_title=parent.document.getElementById("wym_title"))&&(wym_title.value=r.attr("title")),null!=(wym_alt=parent.document.getElementById("wym_alt"))&&(wym_alt.value=r.attr("alt")),null!=(wym_dialog_submit=parent.document.getElementById("wym_dialog_submit"))&&wym_dialog_submit.click())}}),this.initialised=!0)}},link_dialog={initialised:!1,init:function(){this.initialised||(this.init_close(),this.page_tab(),this.web_tab(),this.email_tab(),this.document_tab(),this.initialised=!0)},init_close:function(){parent&&parent.document.location.href!=document.location.href&&null!=parent.document.getElementById("wym_dialog_submit")&&$("#dialog_container input#insert_link_submit").click(function(e){e.preventDefault(),$(parent.document.getElementById("wym_dialog_submit")).click()})},page_tab:function(){$("#link_to_page").on("click","a.selectable",function(e){var t=$(this),i=t.parent();i.parent(),console.log(t.attr("href")),$("#link_to_page ul.selection").find(".ui-selected").removeClass("ui-selected"),i.addClass("ui-selected"),link_dialog.update_parent(t.attr("href"),t.html()),e.preventDefault()})},document_tab:function(){$("#link_to_document li a").click(function(e){e.preventDefault(),link_dialog.update_parent($(this).attr("href"))})},web_tab:function(){$("#web_address_text").change(function(){link_dialog.update_parent($("#web_address_text").val(),null,"_blank")})},email_tab:function(){$("#email_address_text, #email_default_subject_text, #email_default_body_text").change(function(){var e=$("#email_default_subject_text").val(),t=$("#email_default_body_text").val(),i="mailto:"+$("#email_address_text").val(),n="?";e.length>0&&(i+=n+"subject="+e,n="&"),t.length>0&&(i+=n+"body="+t,n="&"),link_dialog.update_parent(i,i.replace("mailto:",""))})},update_parent:function(e,t,i){null!=parent&&(null!=(wym_href=parent.document.getElementById("wym_href"))&&(wym_href.value=e),null!=(wym_title=parent.document.getElementById("wym_title"))&&(wym_title.value=t),null!=(wym_target=parent.document.getElementById("wym_target"))&&(wym_target.value=i||""))}},pages_modal={initialised:!1,init:function(){this.initialised||($("#page_selection_modal").on("click","a.selectable",function(e){var t=$(this).parent();t.parent().find("> .ui-selected").removeClass("ui-selected"),t.addClass("ui-selected"),e.preventDefault()}),$("#page_selection_modal").on("click","a#validate_page_selection_btn",function(){var e=$("li.ui-selected:first"),t=e.data("type"),i=parseValue(e.attr("id")),n=e.find("a.selectable:first").html();$("#owner_name").html(n),$("#owner_id").val(i),$("#owner_type").val(t),$("#page_selection_modal").modal("hide")}),this.initialised=!0)}};selectable_list=function(){$.fn.selectAllRows=function(e){var t,i,n;return t=$.extend({column:"first",selectTip:"Click to Select All",unselectTip:"Click to Un-Select All"},e||{}),isNaN(t.column)?(i=$("thead tr th:"+t.column+"-child input:checkbox",this),n=$("tbody tr td:"+t.column+"-child input:checkbox",this)):(i=$("thead tr th:nth-child("+t.column+") input:checkbox",this),n=$("tbody tr td:nth-child("+t.column+") input:checkbox",this)),i.attr("title",t.selectTip),i.click(function(){var e=this.checked;n.each(function(){this.checked=e}),1==e?$(this).attr("title",t.unselectTip):$(this).attr("title",t.selectTip)}),$(this)}},make_sortable=function(e){var t=e.data("sortable-url"),i=e.data("sortable-handle"),n="UL"==e.get(0).tagName?"li":"tr";e.sortable().on("sortupdate",function(e,o){var r=$(o.item);$.ajax({type:"GET",url:t,items:n,handle:i,data:{position:r.prevAll().length+1,id:parseValue(r.attr("id"))},beforeSend:function(){attachLoading()},success:function(){},complete:function(){removeLoading()}})})},dnd_join_list=function(e,t,i){$.event.props.push("dataTransfer"),Modernizr.draganddrop&&($().dndPageScroll(),t.find("li").each(function(){$(this).attr("draggable","true")}),t.on({dragenter:function(e){e.stopPropagation(),e.preventDefault(),$(this).toggleClass("dragover")},dragover:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},dragleave:function(e){e.stopPropagation(),e.preventDefault(),$(this).toggleClass("dragover")},drop:function(e){e.stopPropagation(),e.preventDefault();var t=$(this),n=e.dataTransfer.getData("Text"),o=get_number_from_string(n),r=get_number_from_string(t.attr("id"));t.removeClass("dragover"),jQuery.ajax({type:"POST",url:i,data:{image_id:o,id:r},dataType:"script",beforeSend:function(){attachLoading("body")},error:function(e,t,i){alert(i)},complete:function(){removeLoading("body")}})}},"li"),e.on({dragstart:function(e){var t=$(this);t.css("opacity","0.5"),e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("text/plain",t.attr("id"))},dragend:function(e){e.stopPropagation(),e.preventDefault(),$(this).css("opacity","1")}},"li"))};