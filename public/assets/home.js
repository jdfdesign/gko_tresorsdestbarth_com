/**
 * author Christopher Blum
 *    - based on the idea of Remy Sharp, http://remysharp.com/2009/01/26/element-in-view-event-plugin/
 *    - forked from http://github.com/zuk/jquery.inview/
 */
(function(e){function a(){var t,n,r={height:s.innerHeight,width:s.innerWidth};if(!r.height){t=i.compatMode;if(t||!e.support.boxModel)n=t==="CSS1Compat"?o:i.body,r={height:n.clientHeight,width:n.clientWidth}}return r}function f(){return{top:s.pageYOffset||o.scrollTop||i.body.scrollTop,left:s.pageXOffset||o.scrollLeft||i.body.scrollLeft}}function l(){var i=e(),s,u=0;e.each(t,function(e,t){var n=t.data.selector,r=t.$element;i=i.add(n?r.find(n):r)}),s=i.length;if(s){n=n||a(),r=r||f();for(;u<s;u++){if(!e.contains(o,i[u]))continue;var l=e(i[u]),c={height:l.height(),width:l.width()},h=l.offset(),p=l.data("inview"),d,v,m;if(!r||!n)return;h.top+c.height>r.top&&h.top<r.top+n.height&&h.left+c.width>r.left&&h.left<r.left+n.width?(d=r.left>h.left?"right":r.left+n.width<h.left+c.width?"left":"both",v=r.top>h.top?"bottom":r.top+n.height<h.top+c.height?"top":"both",m=d+"-"+v,(!p||p!==m)&&l.data("inview",m).trigger("inview",[!0,d,v])):p&&l.data("inview",!1).trigger("inview",[!1])}}}var t={},n,r,i=document,s=window,o=i.documentElement,u=e.expando;e.event.special.inview={add:function(n){t[n.guid+"-"+this[u]]={data:n,$element:e(this)}},remove:function(e){try{delete t[e.guid+"-"+this[u]]}catch(n){}}},e(s).bind("scroll resize",function(){n=r=null}),!o.addEventListener&&o.attachEvent&&o.attachEvent("onfocusin",function(){r=null}),setInterval(l,250)})(jQuery);var $sidescroll=function(){var e=$(".parallax-item.category"),t=$(window),n={},r=!1,i=function(){s(),a(),u()},s=function(){o(),$(".inview").each(function(){$(this).find("div.ss-left").css({left:"0%"}).end().find("div.ss-right").css({right:"0%"})})},o=function(){n.width=t.width(),n.height=t.height()},u=function(){e.bind("inview",function(e,t,n,r){var i=$(this);t?i.addClass("inview"):i.removeClass("inview")}),$(window).on({debouncedresize:function(e){s()}}),$(window).on({"scroll.Scrolling":function(e){if(r)return!1;r=!0,setTimeout(function(){a(),r=!1},10)}})},a=function(){var e=t.scrollTop(),r=n.height/2+e;$(".inview").each(function(t){var i=$(this),s=i.find("div.ss-left"),o=i.find("div.ss-right"),u=i.offset().top,a=i.find(".headline:first");if(u>n.height+e)s.css({left:"-50%"}),o.css({right:"-50%"});else{var f=i.height()-300,l=(u+f/2-r)/(n.height/2+f/2),c=Math.max(l*50,0);s.css({left:-c+"%"}),o.css({right:-c+"%"})}})};return{init:i}}();(function(e){function r(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=!0,o=0,u=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(i=n.wheelDelta/120),n.detail&&(i=-n.detail/3),u=i,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(u=0,o=-1*i),n.wheelDeltaY!==undefined&&(u=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),r.unshift(t,i,o,u),(e.event.dispatch||e.event.handle).apply(this,r)}var t=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var n=t.length;n;)e.event.fixHooks[t[--n]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],r,!1);else this.onmousewheel=r},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],r,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(jQuery),function(e){var t=e.event,n,r;n=t.special.debouncedresize={setup:function(){e(this).on("resize",n.handler)},teardown:function(){e(this).off("resize",n.handler)},handler:function(e,i){var s=this,o=arguments,u=function(){e.type="debouncedresize",t.dispatch.apply(s,o)};r&&clearTimeout(r),i?u():r=setTimeout(u,n.threshold)},threshold:150}}(jQuery),function(e){var t,n=this,r=n.document,i=e(r),s=e(n),o=Array.prototype,u=1.28,a=!0,f=3e4,l=!1,c=navigator.userAgent.toLowerCase(),h=n.location.hash.replace(/#\//,""),p=function(){},d=function(){return!1},v=function(){var e=3,n=r.createElement("div"),i=n.getElementsByTagName("i");do n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->";while(i[0]);return e>4?e:t}(),m=function(){return{html:r.documentElement,body:r.body,head:r.getElementsByTagName("head")[0],title:r.title}},g="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",y=function(){var t=[];return e.each(g.split(" "),function(e,n){t.push(n),/_/.test(n)&&t.push(n.replace(/_/g,""))}),t}(),b=function(t){var n;return typeof t!="object"?t:(e.each(t,function(r,i){/^[a-z]+_/.test(r)&&(n="",e.each(r.split("_"),function(e,t){n+=e>0?t.substr(0,1).toUpperCase()+t.substr(1):t}),t[n]=i,delete t[r])}),t)},w=function(t){return e.inArray(t,y)>-1?Galleria[t.toUpperCase()]:t},E={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(e){return"http://www.youtube.com/embed/"+e},getThumb:function(t,n,r){r=r||p,e.getJSON("http://gdata.youtube.com/feeds/api/videos/"+t+"?v=2&alt=json-in-script&callback=?",function(e){try{n(e.entry.media$group.media$thumbnail[0].url)}catch(t){r()}}).error(r)}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(e){return"http://player.vimeo.com/video/"+e},getThumb:function(t,n,r){r=r||p,e.getJSON("http://vimeo.com/api/v2/video/"+t+".json?callback=?",function(e){try{n(e[0].thumbnail_medium)}catch(t){r()}}).error(r)}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(e){return"http://www.dailymotion.com/embed/video/"+e},getThumb:function(t,n,r){r=r||p,e.getJSON("https://api.dailymotion.com/video/"+t+"?fields=thumbnail_medium_url&callback=?",function(e){try{n(e.thumbnail_medium_url)}catch(t){r()}}).error(r)}}},S=function(e){var t;for(var n in E){t=e&&e.match(E[n].reg);if(t&&t.length)return{id:t[2],provider:n}}return!1},x={support:function(){var e=m().html;return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen}(),callback:p,enter:function(e,t){this.instance=e,this.callback=t||p;var n=m().html;n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullScreen&&n.webkitRequestFullScreen()},exit:function(e){this.callback=e||p,r.exitFullscreen?r.exitFullscreen():r.mozCancelFullScreen?r.mozCancelFullScreen():r.webkitCancelFullScreen&&r.webkitCancelFullScreen()},instance:null,listen:function(){if(!this.support)return;var e=function(){if(!x.instance)return;var e=x.instance._fullscreen;r.fullscreen||r.mozFullScreen||r.webkitIsFullScreen?e._enter(x.callback):e._exit(x.callback)};r.addEventListener("fullscreenchange",e,!1),r.addEventListener("mozfullscreenchange",e,!1),r.addEventListener("webkitfullscreenchange",e,!1)}},T={trunk:{},add:function(e,t,r,i){e=e||(new Date).getTime(),i=i||!1,this.clear(e);if(i){var s=t;t=function(){s(),T.add(e,t,r)}}this.trunk[e]=n.setTimeout(t,r)},clear:function(e){var t=function(e){n.clearTimeout(this.trunk[e]),delete this.trunk[e]},r;if(!!e&&e in this.trunk)t.call(T,e);else if(typeof e=="undefined")for(r in this.trunk)this.trunk.hasOwnProperty(r)&&t.call(T,r)}},N=[],C=[],k=!1,L=!1,A=[],O=function(t){Galleria.theme=t,e.each(A,function(e,t){t._initialized||t._init.call(t)})},M=function(){return{array:function(e){return o.slice.call(e,0)},create:function(e,t){t=t||"div";var n=r.createElement(t);return n.className=e,n},getScriptPath:function(t){t=t||e("script:last").attr("src");var n=t.split("/");return n.length==1?"":(n.pop(),n.join("/")+"/")},animate:function(){var t=function(e){var t="transition WebkitTransition MozTransition OTransition".split(" "),r;if(n.opera)return!1;for(r=0;t[r];r++)if(typeof e[t[r]]!="undefined")return t[r];return!1}((r.body||r.documentElement).style),i={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[t],s={_default:[.25,.1,.25,1],galleria:[.645,.045,.355,1],galleriaIn:[.55,.085,.68,.53],galleriaOut:[.25,.46,.45,.94],ease:[.25,0,.25,1],linear:[.25,.25,.75,.75],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},o=function(t,n,r){var i={};r=r||"transition",e.each("webkit moz ms o".split(" "),function(){i["-"+this+"-"+r]=n}),t.css(i)},u=function(e){o(e,"none","transition"),Galleria.WEBKIT&&Galleria.TOUCH&&(o(e,"translate3d(0,0,0)","transform"),e.data("revert")&&(e.css(e.data("revert")),e.data("revert",null)))},a,f,l,c,h,d,v;return function(r,m,g){g=e.extend({duration:400,complete:p,stop:!1},g),r=e(r);if(!g.duration){r.css(m),g.complete.call(r[0]);return}if(!t){r.animate(m,g);return}g.stop&&(r.unbind(i),u(r)),a=!1,e.each(m,function(e,t){v=r.css(e),M.parseValue(v)!=M.parseValue(t)&&(a=!0),r.css(e,v)});if(!a){n.setTimeout(function(){g.complete.call(r[0])},g.duration);return}f=[],l=g.easing in s?s[g.easing]:s._default,c=" "+g.duration+"ms"+" cubic-bezier("+l.join(",")+")",n.setTimeout(function(t,n,r,i){return function(){t.one(n,function(e){return function(){u(e),g.complete.call(e[0])}}(t));if(Galleria.WEBKIT&&Galleria.TOUCH){h={},d=[0,0,0],e.each(["left","top"],function(e,n){n in r&&(d[e]=M.parseValue(r[n])-M.parseValue(t.css(n))+"px",h[n]=r[n],delete r[n])});if(d[0]||d[1])t.data("revert",h),f.push("-webkit-transform"+i),o(t,"translate3d("+d.join(",")+")","transform")}e.each(r,function(e,t){f.push(e+i)}),o(t,f.join(",")),t.css(r)}}(r,i,m,c),2)}}(),removeAlpha:function(e){if(v<9&&e){var t=e.style,n=e.currentStyle,r=n&&n.filter||t.filter||"";/alpha/.test(r)&&(t.filter=r.replace(/alpha\([^)]*\)/i,""))}},forceStyles:function(t,n){t=e(t),t.attr("style")&&t.data("styles",t.attr("style")).removeAttr("style"),t.css(n)},revertStyles:function(){e.each(M.array(arguments),function(t,n){n=e(n),n.removeAttr("style"),n.attr("style",""),n.data("styles")&&n.attr("style",n.data("styles")).data("styles",null)})},moveOut:function(e){M.forceStyles(e,{position:"absolute",left:-1e4})},moveIn:function(){M.revertStyles.apply(M,M.array(arguments))},elem:function(t){return t instanceof e?{$:t,dom:t[0]}:{$:e(t),dom:t}},hide:function(e,t,n){n=n||p;var r=M.elem(e),i=r.$;e=r.dom,i.data("opacity")||i.data("opacity",i.css("opacity"));var s={opacity:0};if(t){var o=v<9&&e?function(){M.removeAlpha(e),e.style.visibility="hidden",n.call(e)}:n;M.animate(e,s,{duration:t,complete:o,stop:!0})}else v<9&&e?(M.removeAlpha(e),e.style.visibility="hidden"):i.css(s)},show:function(e,t,n){n=n||p;var r=M.elem(e),i=r.$;e=r.dom;var s=parseFloat(i.data("opacity"))||1,o={opacity:s};if(t){v<9&&(i.css("opacity",0),e.style.visibility="visible");var u=v<9&&e?function(){o.opacity==1&&M.removeAlpha(e),n.call(e)}:n;M.animate(e,o,{duration:t,complete:u,stop:!0})}else v<9&&o.opacity==1&&e?(M.removeAlpha(e),e.style.visibility="visible"):i.css(o)},optimizeTouch:function(){var t,n,r,i,s={},o=function(t){t.preventDefault(),s=e.extend({},t,!0)},u=function(){this.evt=s},a=function(){this.handler.call(t,this.evt)};return function(s){e(s).bind("touchend",function(s){t=s.target,i=!0;while(t.parentNode&&t!=s.currentTarget&&i)n=e(t).data("events"),r=e(t).data("fakes"),n&&"click"in n?(i=!1,s.preventDefault(),e(t).click(o).click(),n.click.pop(),e.each(n.click,u),e(t).data("fakes",n.click),delete n.click):r&&(i=!1,s.preventDefault(),e.each(r,a)),t=t.parentNode})}}(),addTimer:function(){return T.add.apply(T,M.array(arguments)),this},clearTimer:function(){return T.clear.apply(T,M.array(arguments)),this},wait:function(t){t=e.extend({until:d,success:p,error:function(){Galleria.raise("Could not complete wait function.")},timeout:3e3},t);var r=M.timestamp(),i,s,o=function(){s=M.timestamp(),i=s-r;if(t.until(i))return t.success(),!1;if(typeof t.timeout=="number"&&s>=r+t.timeout)return t.error(),!1;n.setTimeout(o,10)};n.setTimeout(o,10)},toggleQuality:function(e,t){if(v!==7&&v!==8||!e||e.nodeName.toUpperCase()!="IMG")return;typeof t=="undefined"&&(t=e.style.msInterpolationMode==="nearest-neighbor"),e.style.msInterpolationMode=t?"bicubic":"nearest-neighbor"},insertStyleTag:function(e){var t=r.createElement("style");m().head.appendChild(t);if(t.styleSheet)t.styleSheet.cssText=e;else{var n=r.createTextNode(e);t.appendChild(n)}},loadScript:function(t,n){var r=!1,i=e("<script>").attr({src:t,async:!0}).get(0);i.onload=i.onreadystatechange=function(){!r&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(r=!0,i.onload=i.onreadystatechange=null,typeof n=="function"&&n.call(this,this))},m().head.appendChild(i)},parseValue:function(e){if(typeof e=="number")return e;if(typeof e=="string"){var t=e.match(/\-?\d|\./g);return t&&t.constructor===Array?t.join("")*1:0}return 0},timestamp:function(){return(new Date).getTime()},loadCSS:function(i,s,o){var u,a=!1,f,l=function(){var e=new Image;e.onload=e.onerror=function(t){e=null,a=!0},e.src=i};return e("link[rel=stylesheet]").each(function(){if((new RegExp(i)).test(this.href))return u=this,!1}),typeof s=="function"&&(o=s,s=t),o=o||p,u?(o.call(u,u),u):(f=r.styleSheets.length,e("#"+s).length?(e("#"+s).attr("href",i),f--,a=!0):(u=e("<link>").attr({rel:"stylesheet",href:i,id:s}).get(0),n.setTimeout(function(){var t=e('link[rel="stylesheet"], style');t.length?t.get(0).parentNode.insertBefore(u,t[0]):m().head.appendChild(u);if(v){if(f>=31){Galleria.raise("You have reached the browser stylesheet limit (31)",!0);return}u.onreadystatechange=function(e){!a&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(a=!0)}}else{var s=r.createElement("a"),o=n.location;s.href=i,!/file/.test(o.protocol)&&o.hostname==s.hostname&&o.port==s.port&&o.protocol==s.protocol?e.ajax({url:i,success:function(){a=!0},error:l}):l()}},10)),typeof o=="function"&&M.wait({until:function(){return a&&r.styleSheets.length>f},success:function(){n.setTimeout(function(){o.call(u,u)},100)},error:function(){Galleria.raise("Theme CSS could not load",!0)},timeout:1e4}),u)}}}(),_=function(){var t=function(t,n,r,i){var s=this.getOptions("easing"),o=this.getStageWidth(),u={left:o*(t.rewind?-1:1)},a={left:0};r?(u.opacity=0,a.opacity=1):u.opacity=1,e(t.next).css(u),M.animate(t.next,a,{duration:t.speed,complete:function(e){return function(){n(),e.css({left:0})}}(e(t.next).add(t.prev)),queue:!1,easing:s}),i&&(t.rewind=!t.rewind),t.prev&&(u={left:0},a={left:o*(t.rewind?1:-1)},r&&(u.opacity=1,a.opacity=0),e(t.prev).css(u),M.animate(t.prev,a,{duration:t.speed,queue:!1,easing:s,complete:function(){e(this).css("opacity",0)}}))};return{fade:function(t,n){e(t.next).css({opacity:0,left:0}).show(),M.animate(t.next,{opacity:1},{duration:t.speed,complete:n}),t.prev&&(e(t.prev).css("opacity",1).show(),M.animate(t.prev,{opacity:0},{duration:t.speed}))},flash:function(t,n){e(t.next).css({opacity:0,left:0}),t.prev?M.animate(t.prev,{opacity:0},{duration:t.speed/2,complete:function(){M.animate(t.next,{opacity:1},{duration:t.speed,complete:n})}}):M.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},pulse:function(t,n){t.prev&&e(t.prev).hide(),e(t.next).css({opacity:0,left:0}).show(),M.animate(t.next,{opacity:1},{duration:t.speed,complete:n})},slide:function(e,n){t.apply(this,M.array(arguments))},fadeslide:function(e,n){t.apply(this,M.array(arguments).concat([!0]))},doorslide:function(e,n){t.apply(this,M.array(arguments).concat([!1,!0]))}}}();x.listen(),Galleria=function(){var r=this;this._options={},this._playing=!1,this._playtime=5e3,this._active=null,this._queue={length:0},this._data=[],this._dom={},this._thumbnails=[],this._layers=[],this._initialized=!1,this._firstrun=!1,this._stageWidth=0,this._stageHeight=0,this._target=t,this._binds=[],this._id=parseInt(Math.random()*1e4,10);var o="container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip",u="current total";e.each(o.split(" "),function(e,t){r._dom[t]=M.create("galleria-"+t)}),e.each(u.split(" "),function(e,t){r._dom[t]=M.create("galleria-"+t,"span")});var a=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(e){var t=e.keyCode||e.which;t in a.map&&typeof a.map[t]=="function"&&a.map[t].call(r,e)},attach:function(e){var t,n;for(t in e)e.hasOwnProperty(t)&&(n=t.toUpperCase(),n in a.keys?a.map[a.keys[n]]=e[t]:a.map[n]=e[t]);a.bound||(a.bound=!0,i.bind("keydown",a.press))},detach:function(){a.bound=!1,a.map={},i.unbind("keydown",a.press)}},f=this._controls={0:t,1:t,active:0,swap:function(){f.active=f.active?0:1},getActive:function(){return f[f.active]},getNext:function(){return f[1-f.active]}},l=this._carousel={next:r.$("thumb-nav-right"),prev:r.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var t=0,n=0,i=[0];e.each(r._thumbnails,function(r,s){s.ready&&(t+=s.outerWidth||e(s.container).outerWidth(!0),i[r+1]=t,n=Math.max(n,s.outerHeight||e(s.container).outerHeight(!0)))}),r.$("thumbnails").css({width:t,height:n}),l.max=t,l.hooks=i,l.width=r.$("thumbnails-list").width(),l.setClasses(),r.$("thumbnails-container").toggleClass("galleria-carousel",t>l.width),l.width=r.$("thumbnails-list").width()},bindControls:function(){var e;l.next.bind("click",function(t){t.preventDefault();if(r._options.carouselSteps==="auto"){for(e=l.current;e<l.hooks.length;e++)if(l.hooks[e]-l.hooks[l.current]>l.width){l.set(e-2);break}}else l.set(l.current+r._options.carouselSteps)}),l.prev.bind("click",function(t){t.preventDefault();if(r._options.carouselSteps==="auto")for(e=l.current;e>=0;e--){if(l.hooks[l.current]-l.hooks[e]>l.width){l.set(e+2);break}if(e===0){l.set(0);break}}else l.set(l.current-r._options.carouselSteps)})},set:function(e){e=Math.max(e,0);while(l.hooks[e-1]+l.width>=l.max&&e>=0)e--;l.current=e,l.animate()},getLast:function(e){return(e||l.current)-1},follow:function(e){if(e===0||e===l.hooks.length-2){l.set(e);return}var t=l.current;while(l.hooks[t]-l.hooks[l.current]<l.width&&t<=l.hooks.length)t++;e-1<l.current?l.set(e-1):e+2>t&&l.set(e-t+l.current+2)},setClasses:function(){l.prev.toggleClass("disabled",!l.current),l.next.toggleClass("disabled",l.hooks[l.current]+l.width>=l.max)},animate:function(e){l.setClasses();var t=l.hooks[l.current]*-1;if(isNaN(t))return;M.animate(r.get("thumbnails"),{left:t},{duration:r._options.carouselSpeed,easing:r._options.easing,queue:!1})}},c=this._tooltip={initialized:!1,open:!1,timer:"tooltip"+r._id,swapTimer:"swap"+r._id,init:function(){c.initialized=!0;var e=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";M.insertStyleTag(e),r.$("tooltip").css({opacity:.8,visibility:"visible",display:"none"})},move:function(e){var t=r.getMousePosition(e).x,n=r.getMousePosition(e).y,i=r.$("tooltip"),s=t,o=n,u=i.outerHeight(!0)+1,a=i.outerWidth(!0),f=u+15,l=r.$("container").width()-a-2,c=r.$("container").height()-u-2;!isNaN(s)&&!isNaN(o)&&(s+=10,o-=30,s=Math.max(0,Math.min(l,s)),o=Math.max(0,Math.min(c,o)),n<f&&(o=f),i.css({left:s,top:o}))},bind:function(t,n){if(Galleria.TOUCH)return;c.initialized||c.init();var i=function(t,n){c.define(t,n),e(t).hover(function(){M.clearTimer(c.swapTimer),r.$("container").unbind("mousemove",c.move).bind("mousemove",c.move).trigger("mousemove"),c.show(t),M.addTimer(c.timer,function(){r.$("tooltip").stop().show().animate({opacity:1}),c.open=!0},c.open?0:500)},function(){r.$("container").unbind("mousemove",c.move),M.clearTimer(c.timer),r.$("tooltip").stop().animate({opacity:0},200,function(){r.$("tooltip").hide(),M.addTimer(c.swapTimer,function(){c.open=!1},1e3)})}).click(function(){e(this).trigger("mouseout")})};typeof n=="string"?i(t in r._dom?r.get(t):t,n):e.each(t,function(e,t){i(r.get(e),t)})},show:function(t){t=e(t in r._dom?r.get(t):t);var i=t.data("tt"),s=function(e){n.setTimeout(function(e){return function(){c.move(e)}}(e),10),t.unbind("mouseup",s)};i=typeof i=="function"?i():i;if(!i)return;r.$("tooltip").html(i.replace(/\s/,"&nbsp;")),t.bind("mouseup",s)},define:function(t,n){if(typeof n!="function"){var i=n;n=function(){return i}}t=e(t in r._dom?r.get(t):t).data("tt",n),c.show(t)}},h=this._fullscreen={scrolled:0,crop:t,transition:t,active:!1,keymap:r._keyboard.map,enter:function(e){r._options.trueFullscreen&&x.support?x.enter(r,e):h._enter(e)},_enter:function(n){h.active=!0,M.hide(r.getActiveImage()),r.$("container").addClass("fullscreen"),h.scrolled=s.scrollTop(),M.forceStyles(r.get("container"),{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e4});var i={height:"100%",overflow:"hidden",margin:0,padding:0},o=r.getData(),u=r._options;M.forceStyles(m().html,i),M.forceStyles(m().body,i),h.keymap=e.extend({},r._keyboard.map),r.attachKeyboard({escape:r.exitFullscreen,right:r.next,left:r.prev}),h.crop=u.imageCrop,u.fullscreenCrop!=t&&(u.imageCrop=u.fullscreenCrop);if(o&&o.big&&o.image!==o.big){var a=new Galleria.Picture,f=a.isCached(o.big),l=r.getIndex(),c=r._thumbnails[l];r.trigger({type:Galleria.LOADSTART,cached:f,rewind:!1,index:l,imageTarget:r.getActiveImage(),thumbTarget:c,galleriaData:o}),a.load(o.big,function(t){r._scaleImage(t,{complete:function(t){r.trigger({type:Galleria.LOADFINISH,cached:f,index:l,rewind:!1,imageTarget:t.image,thumbTarget:c});var n=r._controls.getActive().image;n&&e(n).width(t.image.width).height(t.image.height).attr("style",e(t.image).attr("style")).attr("src",t.image.src)}})})}r.rescale(function(){M.addTimer(!1,function(){M.show(r.getActiveImage()),typeof n=="function"&&n.call(r)},100),r.trigger(Galleria.FULLSCREEN_ENTER)}),s.resize(function(){h.scale()})},scale:function(){r.rescale()},exit:function(e){r._options.trueFullscreen&&x.support?x.exit(e):h._exit(e)},_exit:function(e){h.active=!1,M.hide(r.getActiveImage()),r.$("container").removeClass("fullscreen"),M.revertStyles(r.get("container"),m().html,m().body),n.scrollTo(0,h.scrolled),r.detachKeyboard(),r.attachKeyboard(h.keymap),r._options.imageCrop=h.crop;var t=r.getData().big,i=r._controls.getActive().image;!r.getData().iframe&&i&&t&&t==i.src&&n.setTimeout(function(e){return function(){i.src=e}}(r.getData().image),1),r.rescale(function(){M.addTimer(!1,function(){M.show(r.getActiveImage()),typeof e=="function"&&e.call(r),s.trigger("resize")},50),r.trigger(Galleria.FULLSCREEN_EXIT)}),s.unbind("resize",h.scale)}},p=this._idle={timer:"idle"+r._id,trunk:[],bound:!1,add:function(t,n){if(!t)return;p.bound||p.addEvent(),t=e(t);var r={},i;for(i in n)n.hasOwnProperty(i)&&(r[i]=t.css(i));t.data("idle",{from:r,to:n,complete:!0,busy:!1}),p.addTimer(),p.trunk.push(t)},remove:function(t){t=jQuery(t),e.each(p.trunk,function(e,n){n&&n.length&&!n.not(t).length&&(r._idle.show(t),r._idle.trunk.splice(e,1))}),p.trunk.length||(p.removeEvent(),M.clearTimer(p.timer))},addEvent:function(){p.bound=!0,r.$("container").bind("mousemove click",p.showAll)},removeEvent:function(){p.bound=!1,r.$("container").unbind("mousemove click",p.showAll)},addTimer:function(){M.addTimer(p.timer,function(){p.hide()},r._options.idleTime)},hide:function(){if(!r._options.idleMode||r.getIndex()===!1||r.getData().iframe)return;r.trigger(Galleria.IDLE_ENTER),e.each(p.trunk,function(e,t){var n=t.data("idle");if(!n)return;t.data("idle").complete=!1,M.animate(t,n.to,{duration:r._options.idleSpeed})})},showAll:function(){M.clearTimer(p.timer),e.each(p.trunk,function(e,t){p.show(t)})},show:function(t){var n=t.data("idle");!n.busy&&!n.complete&&(n.busy=!0,r.trigger(Galleria.IDLE_EXIT),M.clearTimer(p.timer),M.animate(t,n.from,{duration:r._options.idleSpeed/2,complete:function(){e(this).data("idle").busy=!1,e(this).data("idle").complete=!0}})),p.addTimer()}},d=this._lightbox={width:0,height:0,initialized:!1,active:null,image:null,elems:{},keymap:!1,init:function(){r.trigger(Galleria.LIGHTBOX_OPEN);if(d.initialized)return;d.initialized=!0;var t="overlay box content shadow title info close prevholder prev nextholder next counter image",n={},i=r._options,s="",o="position:absolute;",u="lightbox-",a={overlay:"position:fixed;display:none;opacity:"+i.overlayOpacity+";filter:alpha(opacity="+i.overlayOpacity*100+");top:0;left:0;width:100%;height:100%;background:"+i.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:o+"background:#000;width:100%;height:100%;",content:o+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:o+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:o+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:o+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:o+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:o+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:o+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},f=function(t){return t.hover(function(){e(this).css("color","#bbb")},function(){e(this).css("color","#444")})},l={};v&&v>7&&(a.nextholder+="background:#000;filter:alpha(opacity=0);",a.prevholder+="background:#000;filter:alpha(opacity=0);"),e.each(a,function(e,t){s+=".galleria-"+u+e+"{"+t+"}"}),s+=".galleria-"+u+"box.iframe .galleria-"+u+"prevholder,"+".galleria-"+u+"box.iframe .galleria-"+u+"nextholder{"+"width:100px;height:100px;top:50%;margin-top:-70px}",M.insertStyleTag(s),e.each(t.split(" "),function(e,t){r.addElement("lightbox-"+t),n[t]=d.elems[t]=r.get("lightbox-"+t)}),d.image=new Galleria.Picture,e.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(t,n){var r=[];e.each(n.split(" "),function(e,t){r.push(u+t)}),l[u+t]=r}),r.append(l),e(n.image).append(d.image.container),e(m().body).append(n.overlay,n.box),M.optimizeTouch(n.box),f(e(n.close).bind("click",d.hide).html("&#215;")),e.each(["Prev","Next"],function(t,r){var i=e(n[r.toLowerCase()]).html(/v/.test(r)?"&#8249;&nbsp;":"&nbsp;&#8250;"),s=e(n[r.toLowerCase()+"holder"]);s.bind("click",function(){d["show"+r]()});if(v<8||Galleria.TOUCH){i.show();return}s.hover(function(){i.show()},function(e){i.stop().fadeOut(200)})}),e(n.overlay).bind("click",d.hide),Galleria.IPAD&&(r._options.lightboxTransitionSpeed=0)},rescale:function(t){var n=Math.min(s.width()-40,d.width),i=Math.min(s.height()-60,d.height),o=Math.min(n/d.width,i/d.height),u=Math.round(d.width*o)+40,a=Math.round(d.height*o)+60,f={width:u,height:a,"margin-top":Math.ceil(a/2)*-1,"margin-left":Math.ceil(u/2)*-1};t?e(d.elems.box).css(f):e(d.elems.box).animate(f,{duration:r._options.lightboxTransitionSpeed,easing:r._options.easing,complete:function(){var t=d.image,n=r._options.lightboxFadeSpeed;r.trigger({type:Galleria.LIGHTBOX_IMAGE,imageTarget:t.image}),e(t.container).show(),e(t.image).animate({opacity:1},n),M.show(d.elems.info,n)}})},hide:function(){d.image.image=null,s.unbind("resize",d.rescale),e(d.elems.box).hide(),M.hide(d.elems.info),r.detachKeyboard(),r.attachKeyboard(d.keymap),d.keymap=!1,M.hide(d.elems.overlay,200,function(){e(this).hide().css("opacity",r._options.overlayOpacity),r.trigger(Galleria.LIGHTBOX_CLOSE)})},showNext:function(){d.show(r.getNext(d.active))},showPrev:function(){d.show(r.getPrev(d.active))},show:function(t){d.active=t=typeof t=="number"?t:r.getIndex()||0,d.initialized||d.init(),d.keymap||(d.keymap=e.extend({},r._keyboard.map),r.attachKeyboard({escape:d.hide,right:d.showNext,left:d.showPrev})),s.unbind("resize",d.rescale);var i=r.getData(t),o=r.getDataLength(),u=r.getNext(t),a,f,l;M.hide(d.elems.info);try{for(l=r._options.preload;l>0;l--)f=new Galleria.Picture,a=r.getData(u),f.preload("big"in a?a.big:a.image),u=r.getNext(u)}catch(c){}d.image.isIframe=!!i.iframe,e(d.elems.box).toggleClass("iframe",!!i.iframe),d.image.load(i.iframe||i.big||i.image,function(r){d.width=r.isIframe?e(n).width():r.original.width,d.height=r.isIframe?e(n).height():r.original.height,e(r.image).css({width:r.isIframe?"100%":"100.1%",height:r.isIframe?"100%":"100.1%",top:0,zIndex:99998,opacity:0,visibility:"visible"}),d.elems.title.innerHTML=i.title||"",d.elems.counter.innerHTML=t+1+" / "+o,s.resize(d.rescale),d.rescale()}),e(d.elems.overlay).show().css("visibility","visible"),e(d.elems.box).show()}};return this},Galleria.prototype={constructor:Galleria,init:function(n,r){var i=this;r=b(r),this._original={target:n,options:r,data:null},this._target=this._dom.target=n.nodeName?n:e(n).get(0),this._original.html=this._target.innerHTML,C.push(this);if(!this._target){Galleria.raise("Target not found",!0);return}return this._options={autoplay:!1,carousel:!0,carouselFollow:!0,carouselSpeed:400,carouselSteps:"auto",clicknext:!1,dailymotion:{foreground:"%23EEEEEE",highlight:"%235BCEC5",background:"%23222222",logo:0,hideInfos:1},dataConfig:function(e){return{}},dataSelector:"img",dataSource:this._target,debug:t,dummy:t,easing:"galleria",extend:function(e){},fullscreenCrop:t,fullscreenDoubleTap:!0,fullscreenTransition:t,height:0,idleMode:!0,idleTime:3e3,idleSpeed:200,imageCrop:!1,imageMargin:0,imagePan:!1,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:t,initialTransition:t,keepSource:!1,layerFollow:!0,lightbox:!1,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:!0,maxScaleRatio:t,minScaleRatio:t,overlayOpacity:.85,overlayBackground:"#0b0b0b",pauseOnInteraction:!0,popupLinks:!1,preload:2,queue:!0,responsive:!1,show:0,showInfo:!0,showCounter:!0,showImagenav:!0,swipe:!0,thumbCrop:!0,thumbEventType:"click",thumbFit:!0,thumbMargin:0,thumbQuality:"auto",thumbnails:!0,touchTransition:t,transition:"fade",transitionInitial:t,transitionSpeed:400,trueFullscreen:!0,useCanvas:!1,vimeo:{title:0,byline:0,portrait:0,color:"aaaaaa"},wait:5e3,width:"auto",youtube:{modestbranding:1,autohide:1,color:"white",hd:1,rel:0,showinfo:0}},this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial,r&&r.debug===!1&&(a=!1),r&&typeof r.imageTimeout=="number"&&(f=r.imageTimeout),r&&typeof r.dummy=="string"&&(l=r.dummy),e(this._target).children().hide(),typeof Galleria.theme=="object"?this._init():A.push(this),this},_init:function(){var t=this,i=this._options;if(this._initialized)return Galleria.raise("Init failed: Gallery instance already initialized."),this;this._initialized=!0;if(!Galleria.theme)return Galleria.raise("Init failed: No theme found.",!0),this;e.extend(!0,i,Galleria.theme.defaults,this._original.options,Galleria.configure.options),function(e){if(!("getContext"in e)){e=null;return}L=L||{elem:e,context:e.getContext("2d"),cache:{},length:0}}(r.createElement("canvas")),this.bind(Galleria.DATA,function(){Galleria.QUIRK&&Galleria.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML."),this._original.data=this._data,this.get("total").innerHTML=this.getDataLength();var e=this.$("container"),r={width:0,height:0},i=function(){return t.$("stage").height()};M.wait({until:function(){return r=t._getWH(),e.width(r.width).height(r.height),i()&&r.width&&r.height>50},success:function(){t._width=r.width,t._height=r.height,Galleria.WEBKIT?n.setTimeout(function(){t._run()},1):t._run()},error:function(){i()?Galleria.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+r.width+"px, height: "+r.height+"px.",!0):Galleria.raise("Could not extract a stage height from the CSS. Traced height: "+i()+"px.",!0)},timeout:typeof this._options.wait=="number"?this._options.wait:!1})}),this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]}),M.hide(this.$("counter").append(this.get("current"),r.createTextNode(" / "),this.get("total"))),this.setCounter("&#8211;"),M.hide(t.get("tooltip")),this.$("container").addClass(Galleria.TOUCH?"touch":"notouch"),e.each(new Array(2),function(n){var r=new Galleria
.Picture;e(r.container).css({position:"absolute",top:0,left:0}).prepend(t._layers[n]=e(M.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]),t.$("images").append(r.container),t._controls[n]=r}),this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"}),this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"}),this.$("image-nav-right, image-nav-left").bind("click",function(e){i.clicknext&&e.stopPropagation(),i.pauseOnInteraction&&t.pause();var n=/right/.test(this.className)?"next":"prev";t[n]()}),e.each(["info","counter","image-nav"],function(e,n){i["show"+n.substr(0,1).toUpperCase()+n.substr(1).replace(/-/,"")]===!1&&M.moveOut(t.get(n.toLowerCase()))}),this.load(),!i.keepSource&&!v&&(this._target.innerHTML=""),this.get("errors")&&this.appendChild("target","errors"),this.appendChild("target","container");if(i.carousel){var o=0,u=i.show;this.bind(Galleria.THUMBNAIL,function(){this.updateCarousel(),++o==this.getDataLength()&&typeof u=="number"&&u>0&&this._carousel.follow(u)})}return i.responsive&&s.bind("resize",function(){t.isFullscreen()||t.resize()}),i.swipe&&(function(e){var n=[0,0],r=[0,0],i=30,s=100,o=!1,u=0,a,f={start:"touchstart",move:"touchmove",stop:"touchend"},l=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e},c=function(e){if(e.originalEvent.touches&&e.originalEvent.touches.length>1)return;a=l(e),r=[a.pageX,a.pageY],n[0]||(n=r),Math.abs(n[0]-r[0])>10&&e.preventDefault()},h=function(a){e.unbind(f.move,c);if(a.originalEvent.touches&&a.originalEvent.touches.length||o){o=!o;return}M.timestamp()-u<1e3&&Math.abs(n[0]-r[0])>i&&Math.abs(n[1]-r[1])<s&&(a.preventDefault(),t[n[0]>r[0]?"next":"prev"]()),n=r=[0,0]};e.bind(f.start,function(t){if(t.originalEvent.touches&&t.originalEvent.touches.length>1)return;a=l(t),u=M.timestamp(),n=r=[a.pageX,a.pageY],e.bind(f.move,c).one(f.stop,h)})}(t.$("images")),i.fullscreenDoubleTap&&this.$("stage").bind("touchstart",function(){var e,n,r,i,s,o,u=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e};return function(a){o=Galleria.utils.timestamp(),n=u(a).pageX,r=u(a).pageY;if(o-e<500&&n-i<20&&r-s<20){t.toggleFullscreen(),a.preventDefault(),t.$("stage").unbind("touchend",arguments.callee);return}e=o,i=n,s=r}}())),M.optimizeTouch(this.get("container")),e.each(Galleria.on.binds,function(n,r){e.inArray(r.hash,t._binds)==-1&&t.bind(r.type,r.callback)}),this},_getWH:function(){var t=this.$("container"),n=this.$("target"),r=this,i={},s;return e.each(["width","height"],function(e,o){r._options[o]&&typeof r._options[o]=="number"?i[o]=r._options[o]:(s=[M.parseValue(t.css(o)),M.parseValue(n.css(o)),t[o](),n[o]()],r["_"+o]||s.splice(s.length,M.parseValue(t.css("min-"+o)),M.parseValue(n.css("min-"+o))),i[o]=Math.max.apply(Math,s))}),r._options.height&&r._options.height<2&&(i.height=i.width*r._options.height),i},_createThumbnails:function(){this.get("total").innerHTML=this.getDataLength();var t,i,s,o,u,a,f=this,l=this._options,c=function(){var e=f.$("thumbnails").find(".active");return e.length?e.find("img").attr("src"):!1}(),h=typeof l.thumbnails=="string"?l.thumbnails.toLowerCase():null,p=function(e){return r.defaultView&&r.defaultView.getComputedStyle?r.defaultView.getComputedStyle(s.container,null)[e]:a.css(e)},d=function(t,n,r){return function(){e(r).append(t),f.trigger({type:Galleria.THUMBNAIL,thumbTarget:t,index:n,galleriaData:f.getData(n)})}},v=function(t){l.pauseOnInteraction&&f.pause();var n=e(t.currentTarget).data("index");f.getIndex()!==n&&f.show(n),t.preventDefault()},m=function(t){t.scale({width:t.data.width,height:t.data.height,crop:l.thumbCrop,margin:l.thumbMargin,canvas:l.useCanvas,complete:function(t){var n=["left","top"],r=["Width","Height"],i,s,o=f.getData(t.index),u=o.thumb.split(":");e.each(r,function(r,o){i=o.toLowerCase(),(l.thumbCrop!==!0||l.thumbCrop===i)&&l.thumbFit&&(s={},s[i]=t[i],e(t.container).css(s),s={},s[n[r]]=0,e(t.image).css(s)),t["outer"+o]=e(t.container)["outer"+o](!0)}),M.toggleQuality(t.image,l.thumbQuality===!0||l.thumbQuality==="auto"&&t.original.width<t.width*3),o.iframe&&u.length==2&&u[0]in E&&E[u[0]].getThumb(u[1],function(e){return function(t){e.src=t}}(t.image)),f.trigger({type:Galleria.THUMBNAIL,thumbTarget:t.image,index:t.data.order,galleriaData:f.getData(t.data.order)})}})};this._thumbnails=[],this.$("thumbnails").empty();for(t=0;this._data[t];t++)o=this._data[t],l.thumbnails===!0&&(o.thumb||o.image)?(s=new Galleria.Picture(t),s.index=t,i=o.thumb||o.image,this.$("thumbnails").append(s.container),a=e(s.container),s.data={width:M.parseValue(p("width")),height:M.parseValue(p("height")),order:t},l.thumbFit&&l.thumbCrop!==!0?a.css({width:"auto",height:"auto"}):a.css({width:s.data.width,height:s.data.height}),u=i.split(":"),u.length==2&&u[0]in E?s.load("data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",{height:s.data.height,width:s.data.height*1.25},m):s.load(i,m),l.preload==="all"&&s.preload(o.image)):o.iframe||h==="empty"||h==="numbers"?(s={container:M.create("galleria-image"),image:M.create("img","span"),ready:!0},h==="numbers"&&e(s.image).text(t+1),o.iframe&&e(s.image).addClass("iframe"),this.$("thumbnails").append(s.container),n.setTimeout(d(s.image,t,s.container),50+t*20)):s={container:null,image:null},e(s.container).add(l.keepSource&&l.linkSourceImages?o.original:null).data("index",t).bind(l.thumbEventType,v),c===i&&e(s.container).addClass("active"),this._thumbnails.push(s)},_run:function(){var r=this;r._createThumbnails(),M.wait({timeout:1e4,until:function(){return Galleria.OPERA&&r.$("stage").css("display","inline-block"),r._stageWidth=r.$("stage").width(),r._stageHeight=r.$("stage").height(),r._stageWidth&&r._stageHeight>50},success:function(){N.push(r),M.show(r.get("counter")),r._options.carousel&&r._carousel.bindControls(),r._options.autoplay&&(r.pause(),typeof r._options.autoplay=="number"&&(r._playtime=r._options.autoplay),r.trigger(Galleria.PLAY),r._playing=!0);if(r._firstrun){typeof r._options.show=="number"&&r.show(r._options.show);return}r._firstrun=!0,Galleria.History&&Galleria.History.change(function(e){isNaN(e)?n.history.go(-1):r.show(e,t,!0)}),r.trigger(Galleria.READY),Galleria.theme.init.call(r,r._options),e.each(Galleria.ready.callbacks,function(){this.call(r,r._options)}),r._options.extend.call(r,r._options),/^[0-9]{1,4}$/.test(h)&&Galleria.History?r.show(h,t,!0):r._data[r._options.show]&&r.show(r._options.show)},error:function(){Galleria.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+r._stageWidth+"px, height: "+r._stageHeight+"px.",!0)}})},load:function(t,n,r){var i=this;return this._data=[],this._thumbnails=[],this.$("thumbnails").empty(),typeof n=="function"&&(r=n,n=null),t=t||this._options.dataSource,n=n||this._options.dataSelector,r=r||this._options.dataConfig,/^function Object/.test(t.constructor)&&(t=[t]),t.constructor===Array?(this.validate(t)?(this._data=t,this._parseData().trigger(Galleria.DATA)):Galleria.raise("Load failed: JSON Array not valid."),this):(n+=",.video,.iframe",e(t).find(n).each(function(t,n){n=e(n);var s={},o=n.parent(),u=o.attr("href"),a=o.attr("rel");u&&(n[0].nodeName=="IMG"||n.hasClass("video"))&&S(u)?s.video=u:u&&n.hasClass("iframe")?s.iframe=u:s.image=s.big=u,a&&(s.big=a),e.each("big title description link layer".split(" "),function(e,t){n.data(t)&&(s[t]=n.data(t))}),i._data.push(e.extend({title:n.attr("title")||"",thumb:n.attr("src"),image:n.attr("src"),big:n.attr("src"),description:n.attr("alt")||"",link:n.attr("longdesc"),original:n.get(0)},s,r(n)))}),this.getDataLength()&&this._parseData().trigger(Galleria.DATA),this)},_parseData:function(){var t=this,n;return e.each(this._data,function(r,i){n=t._data[r],"thumb"in i==0&&(n.thumb=i.image),!1 in i&&(n.big=i.image);if("video"in i){var s=S(i.video);if(s){n.iframe=E[s.provider].embed(s.id)+function(){if(typeof t._options[s.provider]=="object"){var n="?",r=[];return e.each(t._options[s.provider],function(e,t){r.push(e+"="+t)}),s.provider=="youtube"&&(r=["wmode=opaque"].concat(r)),n+r.join("&")}return""}(),delete n.video;if(!("thumb"in n)||!n.thumb)n.thumb=s.provider+":"+s.id}}}),this},destroy:function(){return this.get("target").innerHTML=this._original.html,this},splice:function(){var e=this,t=M.array(arguments);return n.setTimeout(function(){o.splice.apply(e._data,t),e._parseData()._createThumbnails()},2),e},push:function(){var e=this,t=M.array(arguments);return n.setTimeout(function(){o.push.apply(e._data,t),e._parseData()._createThumbnails()},2),e},_getActive:function(){return this._controls.getActive()},validate:function(e){return!0},bind:function(e,t){return e=w(e),this.$("container").bind(e,this.proxy(t)),this},unbind:function(e){return e=w(e),this.$("container").unbind(e),this},trigger:function(t){return t=typeof t=="object"?e.extend(t,{scope:this}):{type:w(t),scope:this},this.$("container").trigger(t),this},addIdleState:function(e,t){return this._idle.add.apply(this._idle,M.array(arguments)),this},removeIdleState:function(e){return this._idle.remove.apply(this._idle,M.array(arguments)),this},enterIdleMode:function(){return this._idle.hide(),this},exitIdleMode:function(){return this._idle.showAll(),this},enterFullscreen:function(e){return this._fullscreen.enter.apply(this,M.array(arguments)),this},exitFullscreen:function(e){return this._fullscreen.exit.apply(this,M.array(arguments)),this},toggleFullscreen:function(e){return this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,M.array(arguments)),this},bindTooltip:function(e,t){return this._tooltip.bind.apply(this._tooltip,M.array(arguments)),this},defineTooltip:function(e,t){return this._tooltip.define.apply(this._tooltip,M.array(arguments)),this},refreshTooltip:function(e){return this._tooltip.show.apply(this._tooltip,M.array(arguments)),this},openLightbox:function(){return this._lightbox.show.apply(this._lightbox,M.array(arguments)),this},closeLightbox:function(){return this._lightbox.hide.apply(this._lightbox,M.array(arguments)),this},getActiveImage:function(){return this._getActive().image||t},getActiveThumb:function(){return this._thumbnails[this._active].image||t},getMousePosition:function(e){return{x:e.pageX-this.$("container").offset().left,y:e.pageY-this.$("container").offset().top}},addPan:function(t){if(this._options.imageCrop===!1)return;t=e(t||this.getActiveImage());var n=this,r=t.width()/2,i=t.height()/2,s=parseInt(t.css("left"),10),o=parseInt(t.css("top"),10),u=s||0,a=o||0,f=0,l=0,c=!1,h=M.timestamp(),p=0,d=0,m=function(e,n,r){if(e>0){d=Math.round(Math.max(e*-1,Math.min(0,n)));if(p!==d){p=d;if(v===8)t.parent()["scroll"+r](d*-1);else{var i={};i[r.toLowerCase()]=d,t.css(i)}}}},g=function(e){if(M.timestamp()-h<50)return;c=!0,r=n.getMousePosition(e).x,i=n.getMousePosition(e).y},y=function(e){if(!c)return;f=t.width()-n._stageWidth,l=t.height()-n._stageHeight,s=r/n._stageWidth*f*-1,o=i/n._stageHeight*l*-1,u+=(s-u)/n._options.imagePanSmoothness,a+=(o-a)/n._options.imagePanSmoothness,m(l,a,"Top"),m(f,u,"Left")};return v===8&&(t.parent().scrollTop(a*-1).scrollLeft(u*-1),t.css({top:0,left:0})),this.$("stage").unbind("mousemove",g).bind("mousemove",g),M.addTimer("pan"+n._id,y,50,!0),this},proxy:function(e,t){return typeof e!="function"?p:(t=t||this,function(){return e.apply(t,M.array(arguments))})},removePan:function(){return this.$("stage").unbind("mousemove"),M.clearTimer("pan"+this._id),this},addElement:function(t){var n=this._dom;return e.each(M.array(arguments),function(e,t){n[t]=M.create("galleria-"+t)}),this},attachKeyboard:function(e){return this._keyboard.attach.apply(this._keyboard,M.array(arguments)),this},detachKeyboard:function(){return this._keyboard.detach.apply(this._keyboard,M.array(arguments)),this},appendChild:function(e,t){return this.$(e).append(this.get(t)||t),this},prependChild:function(e,t){return this.$(e).prepend(this.get(t)||t),this},remove:function(e){return this.$(M.array(arguments).join(",")).remove(),this},append:function(e){var t,n;for(t in e)if(e.hasOwnProperty(t))if(e[t].constructor===Array)for(n=0;e[t][n];n++)this.appendChild(t,e[t][n]);else this.appendChild(t,e[t]);return this},_scaleImage:function(t,n){t=t||this._controls.getActive();if(!t)return;var r=this,i,s=function(t){e(t.container).children(":first").css({top:Math.max(0,M.parseValue(t.image.style.top)),left:Math.max(0,M.parseValue(t.image.style.left)),width:M.parseValue(t.image.width),height:M.parseValue(t.image.height)})};return n=e.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition},n),this._options.layerFollow&&this._options.imageCrop!==!0?typeof n.complete=="function"?(i=n.complete,n.complete=function(){i.call(t,t),s(t)}):n.complete=s:e(t.container).children(":first").css({top:0,left:0}),t.scale(n),this},updateCarousel:function(){return this._carousel.update(),this},resize:function(n,r){typeof n=="function"&&(r=n,n=t),n=e.extend({width:0,height:0},n);var i=this,s=this.$("container"),o=this._options.responsive=="aspect"&&(!n.width||!n.height),u;return e.each(n,function(e,t){t||(s[e]("auto"),n[e]=i._getWH()[e])}),o&&(u=Math.min(n.width/this._width,n.height/this._height)),e.each(n,function(e,t){s[e](u?u*i["_"+e]:t)}),this.rescale(r)},rescale:function(e,n,r){var i=this;typeof e=="function"&&(r=e,e=t);var s=function(){i._stageWidth=e||i.$("stage").width(),i._stageHeight=n||i.$("stage").height(),i._scaleImage(),i._options.carousel&&i.updateCarousel(),i.trigger(Galleria.RESCALE),typeof r=="function"&&r.call(i)};return Galleria.WEBKIT&&!Galleria.TOUCH&&!e&&!n?M.addTimer(!1,s,10):s.call(i),this},refreshImage:function(){return this._scaleImage(),this._options.imagePan&&this.addPan(),this},show:function(e,t,n){if(e===!1||!this._options.queue&&this._queue.stalled)return;e=Math.max(0,Math.min(parseInt(e,10),this.getDataLength()-1)),t=typeof t!="undefined"?!!t:e<this.getIndex(),n=n||!1;if(!n&&Galleria.History){Galleria.History.set(e.toString());return}return this._active=e,o.push.call(this._queue,{index:e,rewind:t}),this._queue.stalled||this._show(),this},_show:function(){var r=this,i=this._queue[0],s=this.getData(i.index);if(!s)return;var u=s.iframe||(this.isFullscreen()&&"big"in s?s.big:s.image),a=this._controls.getActive(),f=this._controls.getNext(),l=f.isCached(u),c=this._thumbnails[i.index],h=function(){e(f.image).trigger("mouseup")},p=function(t,i,s,u,a){return function(){var f;r._queue.stalled=!1,M.toggleQuality(i.image,r._options.imageQuality),r._layers[r._controls.active].innerHTML="",e(s.container).css({zIndex:0,opacity:0}).show(),s.isIframe&&e(s.container).find("iframe").remove(),r.$("container").toggleClass("iframe",!!t.iframe),e(i.container).css({zIndex:1,left:0,top:0}).show(),r._controls.swap(),r._options.imagePan&&r.addPan(i.image),(t.link||r._options.lightbox||r._options.clicknext)&&e(i.image).css({cursor:"pointer"}).bind("mouseup",function(){if(r._options.clicknext&&!Galleria.TOUCH){r._options.pauseOnInteraction&&r.pause(),r.next();return}if(t.link){r._options.popupLinks?f=n.open(t.link,"_blank"):n.location.href=t.link;return}r._options.lightbox&&r.openLightbox()}),o.shift.call(r._queue),r._queue.length&&r._show(),r._playCheck(),r.trigger({type:Galleria.IMAGE,index:u.index,imageTarget:i.image,thumbTarget:a.image,galleriaData:t})}}(s,f,a,i,c);this._options.carousel&&this._options.carouselFollow&&this._carousel.follow(i.index);if(this._options.preload){var d,v,m=this.getNext(),g;try{for(v=this._options.preload;v>0;v--)d=new Galleria.Picture,g=r.getData(m),d.preload(this.isFullscreen()&&"big"in g?g.big:g.image),m=r.getNext(m)}catch(y){}}M.show(f.container),f.isIframe=!!s.iframe,e(r._thumbnails[i.index].container).addClass("active").siblings(".active").removeClass("active"),r.trigger({type:Galleria.LOADSTART,cached:l,index:i.index,rewind:i.rewind,imageTarget:f.image,thumbTarget:c.image,galleriaData:s}),f.load(u,function(n){var o=e(r._layers[1-r._controls.active]).html(s.layer||"").hide();r._scaleImage(n,{complete:function(n){"image"in a&&M.toggleQuality(a.image,!1),M.toggleQuality(n.image,!1),r._queue.stalled=!0,r.removePan(),r.setInfo(i.index),r.setCounter(i.index),s.layer&&(o.show(),(s.link||r._options.lightbox||r._options.clicknext)&&o.css("cursor","pointer").unbind("mouseup").mouseup(h)),r.trigger({type:Galleria.LOADFINISH,cached:l,index:i.index,rewind:i.rewind,imageTarget:n.image,thumbTarget:r._thumbnails[i.index].image,galleriaData:r.getData(i.index)});var u=r._options.transition;e.each({initial:a.image===null,touch:Galleria.TOUCH,fullscreen:r.isFullscreen()},function(e,n){if(n&&r._options[e+"Transition"]!==t)return u=r._options[e+"Transition"],!1});if(u in _==0)p();else{var f={prev:a.container,next:n.container,rewind:i.rewind,speed:r._options.transitionSpeed||400};_[u].call(r,f,p)}}})})},getNext:function(e){return e=typeof e=="number"?e:this.getIndex(),e===this.getDataLength()-1?0:e+1},getPrev:function(e){return e=typeof e=="number"?e:this.getIndex(),e===0?this.getDataLength()-1:e-1},next:function(){return this.getDataLength()>1&&this.show(this.getNext(),!1),this},prev:function(){return this.getDataLength()>1&&this.show(this.getPrev(),!0),this},get:function(e){return e in this._dom?this._dom[e]:null},getData:function(e){return e in this._data?this._data[e]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active=="number"?this._active:!1},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(e){return typeof e=="undefined"?this._options:this._options[e]},setOptions:function(t,n){return typeof t=="object"?e.extend(this._options,t):this._options[t]=n,this},play:function(e){return this._playing=!0,this._playtime=e||this._playtime,this._playCheck(),this.trigger(Galleria.PLAY),this},pause:function(){return this._playing=!1,this.trigger(Galleria.PAUSE),this},playToggle:function(e){return this._playing?this.pause():this.play(e)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var e=this,t=0,n=20,r=M.timestamp(),i="play"+this._id;if(this._playing){M.clearTimer(i);var s=function(){t=M.timestamp()-r;if(t>=e._playtime&&e._playing){M.clearTimer(i),e.next();return}e._playing&&(e.trigger({type:Galleria.PROGRESS,percent:Math.ceil(t/e._playtime*100),seconds:Math.floor(t/1e3),milliseconds:t}),M.addTimer(i,s,n))};M.addTimer(i,s,n)}},setPlaytime:function(e){return this._playtime=e,this},setIndex:function(e){return this._active=e,this},setCounter:function(e){typeof e=="number"?e++:typeof e=="undefined"&&(e=this.getIndex()+1),this.get("current").innerHTML=e;if(v){var t=this.$("counter"),n=t.css("opacity");parseInt(n,10)===1?M.removeAlpha(t[0]):this.$("counter").css("opacity",n)}return this},setInfo:function(t){var n=this,r=this.getData(t);return e.each(["title","description"],function(e,t){var i=n.$("info-"+t);r[t]?i[r[t].length?"show":"hide"]().html(r[t]):i.empty().hide()}),this},hasInfo:function(e){var t="title description".split(" "),n;for(n=0;t[n];n++)if(!!this.getData(e)[t[n]])return!0;return!1},jQuery:function(t){var n=this,r=[];e.each(t.split(","),function(t,i){i=e.trim(i),n.get(i)&&r.push(i)});var i=e(n.get(r.shift()));return e.each(r,function(e,t){i=i.add(n.get(t))}),i},$:function(e){return this.jQuery.apply(this,M.array(arguments))}},e.each(y,function(e,t){var n=/_/.test(t)?t.replace(/_/g,""):t;Galleria[t.toUpperCase()]="galleria."+n}),e.extend(Galleria,{IE9:v===9,IE8:v===8,IE7:v===7,IE6:v===6,IE:v,WEBKIT:/webkit/.test(c),CHROME:/chrome/.test(c),SAFARI:/safari/.test(c)&&!/chrome/.test(c),QUIRK:v&&r.compatMode&&r.compatMode==="BackCompat",MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!n.opera,IPHONE:/iphone/.test(c),IPAD:/ipad/.test(c),ANDROID:/android/.test(c),TOUCH:"ontouchstart"in r}),Galleria.addTheme=function(e){return O(e),e},Galleria.loadTheme=function(r,i){var s=!1,o=N.length,u=n.setTimeout(function(){Galleria.raise("Theme at "+r+" could not load, check theme path.",!0)},5e3);return Galleria.theme=t,M.loadScript(r,function(){n.clearTimeout(u);if(o){var t=[];e.each(Galleria.get(),function(n,r){var s=e.extend(r._original.options,{data_source:r._data},i);r.$("container").remove();var o=new Galleria;o._id=r._id,o.init(r._original.target,s),t.push(o)}),N=t}}),Galleria},Galleria.get=function(e){if(!!C[e])return C[e];if(typeof e!="number")return C;Galleria.raise("Gallery index "+e+" not found")},Galleria.configure=function(t,n){var r={};return typeof t=="string"&&n?(r[t]=n,t=r):e.extend(r,t),Galleria.configure.options=r,e.each(Galleria.get(),function(e,t){t.setOptions(r)}),Galleria},Galleria.configure.options={},Galleria.on=function(t,n){if(!t)return;n=n||p;var r=t+n.toString().replace(/\s/g,"")+M.timestamp();return e.each(Galleria.get(),function(e,i){i._binds.push(r),i.bind(t,n)}),Galleria.on.binds.push({type:t,callback:n,hash:r}),Galleria},Galleria.on.binds=[],Galleria.run=function(t,n){return e(t||"#galleria").galleria(n),Galleria},Galleria.addTransition=function(e,t){return _[e]=t,Galleria},Galleria.utils=M,Galleria.log=function(){var t=M.array(arguments);if(!("console"in n&&"log"in n.console))return n.alert(t.join("<br>"));try{return n.console.log.apply(n.console,t)}catch(r){e.each(t,function(){n.console.log(this)})}},Galleria.ready=function(t){return e.each(N,function(e,n){t.call(n,n._options)}),Galleria.ready.callbacks.push(t),Galleria},Galleria.ready.callbacks=[],Galleria.raise=function(t,n){var r=n?"Fatal error":"Error",i=this,s={color:"#fff",position:"absolute",top:0,left:0,zIndex:1e5},o=function(t){var i='<div style="padding:4px;margin:0 0 2px;background:#'+(n?"811":"222")+'";>'+(n?"<strong>"+r+": </strong>":"")+t+"</div>";e.each(C,function(){var e=this.$("errors"),t=this.$("target");e.length||(t.css("position","relative"),e=this.addElement("errors").appendChild("target","errors").$("errors").css(s)),e.append(i)}),C.length||e("<div>").css(e.extend(s,{position:"fixed"})).append(i).appendTo(m().body)};if(a){o(t);if(n)throw new Error(r+": "+t)}else if(n){if(k)return;k=!0,n=!1,o("Gallery could not load.")}},Galleria.version=u,Galleria.requires=function(e,t){return t=t||"You need to upgrade Galleria to version "+e+" to use one or more components.",Galleria.version<e&&Galleria.raise(t,!0),Galleria},Galleria.Picture=function(t){this.id=t||null,this.image=null,this.container=M.create("galleria-image"),e(this.container).css({overflow:"hidden",position:"relative"}),this.original={width:0,height:0},this.ready=!1,this.isIframe=!1},Galleria.Picture.prototype={cache:{},show:function(){M.show(this.image)},hide:function(){M.moveOut(this.image)},clear:function(){this.image=null},isCached:function(e){return!!this.cache[e]},preload:function(t){e(new Image).load(function(e,t){return function(){t[e]=e}}(t,this.cache)).attr("src",t)},load:function(t,r,i){typeof r=="function"&&(i=r,r=null);if(this.isIframe){var s="if"+(new Date).getTime();return this.image=e("<iframe>",{src:t,frameborder:0,id:s,allowfullscreen:!0,css:{visibility:"hidden"}})[0],e(this.container).find("iframe,img").remove(),this.container.appendChild(this.image),e("#"+s).load(function(t,r){return function(){n.setTimeout(function(){e(t.image).css("visibility","visible"),typeof r=="function"&&r.call(t,t)},10)}}(this,i)),this.container}this.image=new Image;var o=0,u=!1,a=!1,f=e(this.container),c=e(this.image),h=function(t,i,s){return function(){var o=function(){e(this).unbind("load"),t.original=r||{height:this.height,width:this.width},t.container.appendChild(this),t.cache[s]=s,typeof i=="function"&&n.setTimeout(function(){i.call(t,t)},1)};!this.width||!this.height?n.setTimeout(function(t){return function(){t.width&&t.height?o.call(t):a?Galleria.raise("Could not extract width/height from image: "+t.src+". Traced measures: width:"+t.width+"px, height: "+t.height+"px."):(e(new Image).load(h).attr("src",t.src),a=!0)}}(this),2):o.call(this)}}(this,i,t);return f.find("iframe,img").remove(),c.css("display","block"),M.hide(this.image),e.each("minWidth minHeight maxWidth maxHeight".split(" "),function(e,t){c.css(t,/min/.test(t)?"0":"none")}),this.cache[t]?(c.load(h).attr("src",t),this.container):(c.load(h).error(function(){u?l?e(this).attr("src",l):Galleria.raise("Image not found: "+t):(u=!0,n.setTimeout(function(e,t){return function(){e.attr("src",t+"?"+M.timestamp())}}(e(this),t),50))}).attr("src",t),this.container)},scale:function(n){var r=this;n=e.extend({width:0,height:0,min:t,max:t,margin:0,complete:p,position:"center",crop:!1,canvas:!1},n);if(this.isIframe){e(this.image).width(n.width).height(n.height).removeAttr("width").removeAttr("height"),e(this.container).width(n.width).height(n.height),n.complete.call(r,r);try{this.image.contentWindow&&e(this.image.contentWindow).trigger("resize")}catch(i){}return this.container}if(!this.image)return this.container;var s,o,u=e(r.container),a;return M.wait({until:function(){return s=n.width||u.width()||M.parseValue(u.css("width")),o=n.height||u.height()||M.parseValue(u.css("height")),s&&o},success:function(){var t=(s-n.margin*2)/r.original.width,i=(o-n.margin*2)/r.original.height,u=Math.min(t,i),f=Math.max(t,i),l={"true":f,width:t,height:i,"false":u,landscape:r.original.width>r.original.height?f:u,portrait:r.original.width<r.original.height?f:u},c=l[n.crop.toString()],h="";n.max&&(c=Math.min(n.max,c)),n.min&&(c=Math.max(n.min,c)),e.each(["width","height"],function(t,n){e(r.image)[n](r[n]=r.image[n]=Math.round(r.original[n]*c))}),e(r.container).width(s).height(o),n.canvas&&L&&(L.elem.width=r.width,L.elem.height=r.height,h=r.image.src+":"+r.width+"x"+r.height,r.image.src=L.cache[h]||function(e){L.context.drawImage(r.image,0,0,r.original.width*c,r.original.height*c);try{return a=L.elem.toDataURL(),L.length+=a.length,L.cache[e]=a,a}catch(t){return r.image.src}}(h));var p={},d={},v=function(t,n,i){var s=0;if(/\%/.test(t)){var o=parseInt(t,10)/100,u=r.image[n]||e(r.image)[n]();s=Math.ceil(u*-1*o+i*o)}else s=M.parseValue(t);return s},m={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};e.each(n.position.toLowerCase().split(" "),function(e,t){t==="center"&&(t="50%"),p[e?"top":"left"]=t}),e.each(p,function(t,n){m.hasOwnProperty(n)&&e.extend(d,m[n])}),p=p.top?e.extend(p,d):d,p=e.extend({top:"50%",left:"50%"},p),e(r.image).css({position:"absolute",top:v(p.top,"height",o),left:v(p.left,"width",s)}),r.show(),r.ready=!0,n.complete.call(r,r)},error:function(){Galleria.raise("Could not scale image: "+r.image.src)},timeout:1e3}),this}},e.extend(e.easing,{galleria:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},galleriaIn:function(e,t,n,r,i){return r*(t/=i)*t+n},galleriaOut:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n}}),e.fn.galleria=function(t){var n=this.selector;return e(this).length?this.each(function(){e.data(this,"galleria")||e.data(this,"galleria",(new Galleria).init(this,t))}):(e(function(){e(n).length?e(n).galleria(t):Galleria.utils.wait({until:function(){return e(n).length},success:function(){e(n).galleria(t)},error:function(){Galleria.raise('Init failed: Galleria could not find the element "'+n+'".')},timeout:5e3})}),this)}}(jQuery),function(e,t,n){e.fn.jScrollPane=function(r){function i(r,i){function V(t){var i,o,g,y,w,E,x=!1,T=!1;s=t;if(u===n)w=r.scrollTop(),E=r.scrollLeft(),r.css({overflow:"hidden",padding:0}),a=r.innerWidth()+F,f=r.innerHeight(),r.width(a),u=e('<div class="jspPane" />').css("padding",j).append(r.children()),l=e('<div class="jspContainer" />').css({width:a+"px",height:f+"px"}).append(u).appendTo(r);else{r.css("width",""),x=s.stickToBottom&&mt(),T=s.stickToRight&&gt(),y=r.innerWidth()+F!=a||r.outerHeight()!=f,y&&(a=r.innerWidth()+F,f=r.innerHeight(),l.css({width:a+"px",height:f+"px"}));if(!y&&I==c&&u.outerHeight()==h){r.width(a);return}I=c,u.css("width",""),r.width(a),l.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}u.css("overflow","auto"),t.contentWidth?c=t.contentWidth:c=u[0].scrollWidth,h=u[0].scrollHeight,u.css("overflow",""),p=c/a,d=h/f,v=d>1,m=p>1,!m&&!v?(r.removeClass("jspScrollable"),u.css({top:0,width:l.width()-F}),bt(),St(),Tt(),rt()):(r.addClass("jspScrollable"),i=s.maintainPosition&&(b||S),i&&(o=dt(),g=vt()),J(),Q(),Y(),i&&(ht(T?c-a:o,!1),ct(x?h-f:g,!1)),Et(),yt(),kt(),s.enableKeyboardNavigation&&xt(),s.clickOnTrack&&nt(),Nt(),s.hijackInternalLinks&&Ct()),s.autoReinitialise&&!B?B=setInterval(function(){V(s)},s.autoReinitialiseDelay):!s.autoReinitialise&&B&&clearInterval(B),w&&r.scrollTop(0)&&ct(w,!1),E&&r.scrollLeft(0)&&ht(E,!1),r.trigger("jsp-initialised",[m||v])}function J(){v&&(l.append(e('<div class="jspVerticalBar" />').append(e('<div class="jspCap jspCapTop" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragTop" />'),e('<div class="jspDragBottom" />'))),e('<div class="jspCap jspCapBottom" />'))),x=l.find(">.jspVerticalBar"),T=x.find(">.jspTrack"),g=T.find(">.jspDrag"),s.showArrows&&(L=e('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",et(0,-1)).bind("click.jsp",wt),A=e('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",et(0,1)).bind("click.jsp",wt),s.arrowScrollOnHover&&(L.bind("mouseover.jsp",et(0,-1,L)),A.bind("mouseover.jsp",et(0,1,A))),Z(T,s.verticalArrowPositions,L,A)),C=f,l.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){C-=e(this).outerHeight()}),g.hover(function(){g.addClass("jspHover")},function(){g.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",wt),g.addClass("jspActive");var n=t.pageY-g.position().top;return e("html").bind("mousemove.jsp",function(e){st(e.pageY-n,!1)}).bind("mouseup.jsp mouseleave.jsp",it),!1}),K())}function K(){T.height(C+"px"),b=0,N=s.verticalGutter+T.outerWidth(),u.width(a-N-F);try{x.position().left===0&&u.css("margin-left",N+"px")}catch(e){}}function Q(){m&&(l.append(e('<div class="jspHorizontalBar" />').append(e('<div class="jspCap jspCapLeft" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragLeft" />'),e('<div class="jspDragRight" />'))),e('<div class="jspCap jspCapRight" />'))),O=l.find(">.jspHorizontalBar"),M=O.find(">.jspTrack"),w=M.find(">.jspDrag"),s.showArrows&&(P=e('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",et(-1,0)).bind("click.jsp",wt),H=e('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",et(1,0)).bind("click.jsp",wt),s.arrowScrollOnHover&&(P.bind("mouseover.jsp",et(-1,0,P)),H.bind("mouseover.jsp",et(1,0,H))),Z(M,s.horizontalArrowPositions,P,H)),w.hover(function(){w.addClass("jspHover")},function(){w.removeClass("jspHover")}).bind("mousedown.jsp",function(t){e("html").bind("dragstart.jsp selectstart.jsp",wt),w.addClass("jspActive");var n=t.pageX-w.position().left;return e("html").bind("mousemove.jsp",function(e){ut(e.pageX-n,!1)}).bind("mouseup.jsp mouseleave.jsp",it),!1}),_=l.innerWidth(),G())}function G(){l.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){_-=e(this).outerWidth()}),M.width(_+"px"),S=0}function Y(){if(m&&v){var t=M.outerHeight(),n=T.outerWidth();C-=t,e(O).find(">.jspCap:visible,>.jspArrow").each(function(){_+=e(this).outerWidth()}),_-=n,f-=n,a-=t,M.parent().append(e('<div class="jspCorner" />').css("width",t+"px")),K(),G()}m&&u.width(l.outerWidth()-F+"px"),h=u.outerHeight(),d=h/f,m&&(D=Math.ceil(1/p*_),D>s.horizontalDragMaxWidth?D=s.horizontalDragMaxWidth:D<s.horizontalDragMinWidth&&(D=s.horizontalDragMinWidth),w.width(D+"px"),E=_-D,at(S)),v&&(k=Math.ceil(1/d*C),k>s.verticalDragMaxHeight?k=s.verticalDragMaxHeight:k<s.verticalDragMinHeight&&(k=s.verticalDragMinHeight),g.height(k+"px"),y=C-k,ot(b))}function Z(e,t,n,r){var i="before",s="after",o;t=="os"&&(t=/Mac/.test(navigator.platform)?"after":"split"),t==i?s=t:t==s&&(i=t,o=n,n=r,r=o),e[i](n)[s](r)}function et(e,t,n){return function(){return tt(e,t,this,n),this.blur(),!1}}function tt(t,n,r,i){r=e(r).addClass("jspActive");var u,a,f=!0,l=function(){t!==0&&o.scrollByX(t*s.arrowButtonSpeed),n!==0&&o.scrollByY(n*s.arrowButtonSpeed),a=setTimeout(l,f?s.initialDelay:s.arrowRepeatFreq),f=!1};l(),u=i?"mouseout.jsp":"mouseup.jsp",i=i||e("html"),i.bind(u,function(){r.removeClass("jspActive"),a&&clearTimeout(a),a=null,i.unbind(u)})}function nt(){rt(),v&&T.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var r=e(this),i=r.offset(),u=t.pageY-i.top-b,a,l=!0,c=function(){var e=r.offset(),n=t.pageY-e.top-k/2,i=f*s.scrollPagePercent,d=y*i/(h-f);if(u<0)b-d>n?o.scrollByY(-i):st(n);else{if(!(u>0)){p();return}b+d<n?o.scrollByY(i):st(n)}a=setTimeout
(c,l?s.initialDelay:s.trackClickRepeatFreq),l=!1},p=function(){a&&clearTimeout(a),a=null,e(document).unbind("mouseup.jsp",p)};return c(),e(document).bind("mouseup.jsp",p),!1}}),m&&M.bind("mousedown.jsp",function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var r=e(this),i=r.offset(),u=t.pageX-i.left-S,f,l=!0,h=function(){var e=r.offset(),n=t.pageX-e.left-D/2,i=a*s.scrollPagePercent,d=E*i/(c-a);if(u<0)S-d>n?o.scrollByX(-i):ut(n);else{if(!(u>0)){p();return}S+d<n?o.scrollByX(i):ut(n)}f=setTimeout(h,l?s.initialDelay:s.trackClickRepeatFreq),l=!1},p=function(){f&&clearTimeout(f),f=null,e(document).unbind("mouseup.jsp",p)};return h(),e(document).bind("mouseup.jsp",p),!1}})}function rt(){M&&M.unbind("mousedown.jsp"),T&&T.unbind("mousedown.jsp")}function it(){e("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),g&&g.removeClass("jspActive"),w&&w.removeClass("jspActive")}function st(e,t){if(!v)return;e<0?e=0:e>y&&(e=y),t===n&&(t=s.animateScroll),t?o.animate(g,"top",e,ot):(g.css("top",e),ot(e))}function ot(e){if(!v)return!1;e===n&&(e=g.position().top),l.scrollTop(0),b=e;var t=b===0,i=b==y,s=e/y,o=-s*(h-f);if(q!=t||U!=i)q=t,U=i,r.trigger("jsp-arrow-change",[q,U,R,z]);ft(t,i),u.css("top",o),r.trigger("jsp-scroll-y",[-o,t,i]).trigger("scroll")}function ut(e,t){if(!m)return;e<0?e=0:e>E&&(e=E),t===n&&(t=s.animateScroll),t?o.animate(w,"left",e,at):(w.css("left",e),at(e))}function at(e){e===n&&(e=w.position().left),l.scrollTop(0),S=e;var t=S===0,i=S==E,s=e/E,o=-s*(c-a);if(R!=t||z!=i)R=t,z=i,r.trigger("jsp-arrow-change",[q,U,R,z]);lt(t,i),u.css("left",o),r.trigger("jsp-scroll-x",[-o,t,i]).trigger("scroll")}function ft(e,t){s.showArrows&&(L[e?"addClass":"removeClass"]("jspDisabled"),A[t?"addClass":"removeClass"]("jspDisabled"))}function lt(e,t){s.showArrows&&(P[e?"addClass":"removeClass"]("jspDisabled"),H[t?"addClass":"removeClass"]("jspDisabled"))}function ct(e,t){var n=e/(h-f);st(n*y,t)}function ht(e,t){var n=e/(c-a);ut(n*E,t)}function pt(t,n,r){var i,o,u,c=0,h=0,p,d,v,m,g,y;try{i=e(t)}catch(b){return}o=i.outerHeight(),u=i.outerWidth(),l.scrollTop(0),l.scrollLeft(0);while(!i.is(".jspPane")){c+=i.position().top,h+=i.position().left,i=i.offsetParent();if(/^body|html$/i.test(i[0].nodeName))return}p=vt(),v=p+f,c<p||n?g=c-s.verticalGutter:c+o>v&&(g=c-f+o+s.verticalGutter),g&&ct(g,r),d=dt(),m=d+a,h<d||n?y=h-s.horizontalGutter:h+u>m&&(y=h-a+u+s.horizontalGutter),y&&ht(y,r)}function dt(){return-u.position().left}function vt(){return-u.position().top}function mt(){var e=h-f;return e>20&&e-vt()<10}function gt(){var e=c-a;return e>20&&e-dt()<10}function yt(){l.unbind(X).bind(X,function(e,t,n,r){var i=S,u=b;return o.scrollBy(n*s.mouseWheelSpeed,-r*s.mouseWheelSpeed,!1),i==S&&u==b})}function bt(){l.unbind(X)}function wt(){return!1}function Et(){u.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){pt(e.target,!1)})}function St(){u.find(":input,a").unbind("focus.jsp")}function xt(){function a(){var e=S,r=b;switch(t){case 40:o.scrollByY(s.keyboardSpeed,!1);break;case 38:o.scrollByY(-s.keyboardSpeed,!1);break;case 34:case 32:o.scrollByY(f*s.scrollPagePercent,!1);break;case 33:o.scrollByY(-f*s.scrollPagePercent,!1);break;case 39:o.scrollByX(s.keyboardSpeed,!1);break;case 37:o.scrollByX(-s.keyboardSpeed,!1)}return n=e!=S||r!=b,n}var t,n,i=[];m&&i.push(O[0]),v&&i.push(x[0]),u.focus(function(){r.focus()}),r.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(r){if(r.target!==this&&(!i.length||!e(r.target).closest(i).length))return;var s=S,o=b;switch(r.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:t=r.keyCode,a();break;case 35:ct(h-f),t=null;break;case 36:ct(0),t=null}return n=r.keyCode==t&&s!=S||o!=b,!n}).bind("keypress.jsp",function(e){return e.keyCode==t&&a(),!n}),s.hideFocus?(r.css("outline","none"),"hideFocus"in l[0]&&r.attr("hideFocus",!0)):(r.css("outline",""),"hideFocus"in l[0]&&r.attr("hideFocus",!1))}function Tt(){r.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function Nt(){if(location.hash&&location.hash.length>1){var t,n,r=escape(location.hash.substr(1));try{t=e("#"+r+', a[name="'+r+'"]')}catch(i){return}t.length&&u.find(r)&&(l.scrollTop()===0?n=setInterval(function(){l.scrollTop()>0&&(pt(t,!0),e(document).scrollTop(l.position().top),clearInterval(n))},50):(pt(t,!0),e(document).scrollTop(l.position().top)))}}function Ct(){if(e(document.body).data("jspHijack"))return;e(document.body).data("jspHijack",!0),e(document.body).delegate("a[href*=#]","click",function(n){var r=this.href.substr(0,this.href.indexOf("#")),i=location.href,s,o,u,a,f,l;location.href.indexOf("#")!==-1&&(i=location.href.substr(0,location.href.indexOf("#")));if(r!==i)return;s=escape(this.href.substr(this.href.indexOf("#")+1)),o;try{o=e("#"+s+', a[name="'+s+'"]')}catch(c){return}if(!o.length)return;u=o.closest(".jspScrollable"),a=u.data("jsp"),a.scrollToElement(o,!0),u[0].scrollIntoView&&(f=e(t).scrollTop(),l=o.offset().top,(l<f||l>f+e(t).height())&&u[0].scrollIntoView()),n.preventDefault()})}function kt(){var e,t,n,r,i,s=!1;l.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(o){var u=o.originalEvent.touches[0];e=dt(),t=vt(),n=u.pageX,r=u.pageY,i=!1,s=!0}).bind("touchmove.jsp",function(u){if(!s)return;var a=u.originalEvent.touches[0],f=S,l=b;return o.scrollTo(e+n-a.pageX,t+r-a.pageY),i=i||Math.abs(n-a.pageX)>5||Math.abs(r-a.pageY)>5,f==S&&l==b}).bind("touchend.jsp",function(e){s=!1}).bind("click.jsp-touchclick",function(e){if(i)return i=!1,!1})}function Lt(){var e=vt(),t=dt();r.removeClass("jspScrollable").unbind(".jsp"),r.replaceWith(W.append(u.children())),W.scrollTop(e),W.scrollLeft(t),B&&clearInterval(B)}var s,o=this,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q=!0,R=!0,U=!1,z=!1,W=r.clone(!1,!1).empty(),X=e.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";j=r.css("paddingTop")+" "+r.css("paddingRight")+" "+r.css("paddingBottom")+" "+r.css("paddingLeft"),F=(parseInt(r.css("paddingLeft"),10)||0)+(parseInt(r.css("paddingRight"),10)||0),e.extend(o,{enable:function(e){v=e},reinitialise:function(t){t=e.extend({},s,t),V(t)},scrollToElement:function(e,t,n){pt(e,t,n)},scrollTo:function(e,t,n){ht(e,n),ct(t,n)},scrollToX:function(e,t){ht(e,t)},scrollToY:function(e,t){ct(e,t)},scrollToPercentX:function(e,t){ht(e*(c-a),t)},scrollToPercentY:function(e,t){ct(e*(h-f),t)},scrollBy:function(e,t,n){o.scrollByX(e,n),o.scrollByY(t,n)},scrollByX:function(e,t){var n=dt()+Math[e<0?"floor":"ceil"](e),r=n/(c-a);ut(r*E,t)},scrollByY:function(e,t){var n=vt()+Math[e<0?"floor":"ceil"](e),r=n/(h-f);st(r*y,t)},positionDragX:function(e,t){ut(e,t)},positionDragY:function(e,t){st(e,t)},animate:function(e,t,n,i){var o={};o[t]=n,e.animate(o,{duration:s.animateDuration,easing:s.animateEase,queue:!1,step:i,complete:function(){r.trigger("complete")}})},getContentPositionX:function(){return dt()},getContentPositionY:function(){return vt()},getContentWidth:function(){return c},getContentHeight:function(){return h},getPercentScrolledX:function(){return dt()/(c-a)},getPercentScrolledY:function(){return vt()/(h-f)},getIsScrollableH:function(){return m},getIsScrollableV:function(){return v},getContentPane:function(){return u},scrollToBottom:function(e){st(y,e)},hijackInternalLinks:e.noop,destroy:function(){Lt()}}),V(i)}return r=e.extend({},e.fn.jScrollPane.defaults,r),e.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){r[this]=r[this]||r.speed}),this.each(function(){var t=e(this),n=t.data("jsp");n?n.reinitialise(r):(e("script",t).filter('[type="text/javascript"],:not([type])').remove(),n=new i(t,r),t.data("jsp",n))})},e.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:n,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(jQuery,this),function(e,t,n){"use strict";e.fn.backstretch=function(r,s){return(r===n||r.length===0)&&e.error("No images were supplied for Backstretch"),e(t).scrollTop()===0&&t.scrollTo(0,0),this.each(function(){var t=e(this),n=t.data("backstretch");n&&(s=e.extend(n.options,s),n.destroy(!0)),n=new i(this,r,s),t.data("backstretch",n)})},e.backstretch=function(t,n){return e("body").backstretch(t,n).data("backstretch")},e.expr[":"].backstretch=function(t){return e(t).data("backstretch")!==n},e.fn.backstretch.defaults={centeredX:!0,centeredY:!0,duration:5e3,fade:0};var r={wrap:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999999},img:{position:"absolute",display:"none",margin:0,padding:0,border:"none",width:"auto",height:"auto",maxWidth:"none",zIndex:-999999}},i=function(n,i,o){this.options=e.extend({},e.fn.backstretch.defaults,o||{}),this.images=e.isArray(i)?i:[i],e.each(this.images,function(){e("<img />")[0].src=this}),this.isBody=n===document.body,this.$container=e(n),this.$wrap=e('<div class="backstretch"></div>').css(r.wrap).appendTo(this.$container),this.$root=this.isBody?s?e(t):e(document):this.$container;if(!this.isBody){var u=this.$container.css("position"),a=this.$container.css("zIndex");this.$container.css({position:u==="static"?"relative":u,zIndex:a==="auto"?0:a,background:"none"}),this.$wrap.css({zIndex:-999998})}this.$wrap.css({position:this.isBody&&s?"fixed":"absolute"}),this.index=0,this.show(this.index),e(t).on("resize.backstretch",e.proxy(this.resize,this)).on("orientationchange.backstretch",e.proxy(function(){this.isBody&&t.pageYOffset===0&&(t.scrollTo(0,1),this.resize())},this))};i.prototype={resize:function(){try{var e={left:0,top:0},n=this.isBody?this.$root.width():this.$root.innerWidth(),r=n,i=this.isBody?t.innerHeight?t.innerHeight:this.$root.height():this.$root.innerHeight(),s=r/this.$img.data("ratio"),o;s>=i?(o=(s-i)/2,this.options.centeredY&&(e.top="-"+o+"px")):(s=i,r=s*this.$img.data("ratio"),o=(r-n)/2,this.options.centeredX&&(e.left="-"+o+"px")),this.$wrap.css({width:n,height:i}).find("img:not(.deleteable)").css({width:r,height:s}).css(e)}catch(u){}return this},show:function(t){if(Math.abs(t)>this.images.length-1)return;this.index=t;var n=this,i=n.$wrap.find("img").addClass("deleteable"),s=e.Event("backstretch.show",{relatedTarget:n.$container[0]});return clearInterval(n.interval),n.$img=e("<img />").css(r.img).bind("load",function(t){var r=this.width||e(t.target).width(),o=this.height||e(t.target).height();e(this).data("ratio",r/o),n.resize(),e(this).fadeIn(n.options.speed||n.options.fade,function(){i.remove(),n.paused||n.cycle(),n.$container.trigger(s)})}).appendTo(n.$wrap),n.$img.attr("src",n.images[t]),n},next:function(){return this.show(this.index<this.images.length-1?this.index+1:0)},prev:function(){return this.show(this.index===0?this.images.length-1:this.index-1)},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this.next(),this},cycle:function(){return this.images.length>1&&(clearInterval(this.interval),this.interval=setInterval(e.proxy(function(){this.paused||this.next()},this),this.options.duration)),this},destroy:function(n){e(t).off("resize.backstretch orientationchange.backstretch"),clearInterval(this.interval),n||this.$wrap.remove(),this.$container.removeData("backstretch")}};var s=function(){var e=navigator.userAgent,n=navigator.platform,r=e.match(/AppleWebKit\/([0-9]+)/),i=!!r&&r[1],s=e.match(/Fennec\/([0-9]+)/),o=!!s&&s[1],u=e.match(/Opera Mobi\/([0-9]+)/),a=!!u&&u[1],f=e.match(/MSIE ([0-9]+)/),l=!!f&&f[1];return!((n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1||n.indexOf("iPod")>-1)&&i&&i<534||t.operamini&&{}.toString.call(t.operamini)==="[object OperaMini]"||u&&a<7458||e.indexOf("Android")>-1&&i&&i<533||o&&o<6||"palmGetResource"in t&&i&&i<534||e.indexOf("MeeGo")>-1&&e.indexOf("NokiaBrowser/8.5.0")>-1||l&&l<=6)}()}(jQuery,window),jQuery.fn.reverse=Array.prototype.reverse;var $container,$cover,$logo,$locales,$navbar,$activeSection,imagesCount=0,gridColCount=3,gridRowCount=2,gridItemHeight=300,headerHeight,footerHeight,deltaHeight,availableHeight,availableWidth,isAppleDevice,$notice,$facebook,$viewCartMenuLink,History=window.History,Home={init:function(){$container=$("#content"),$cover=$("#cover"),$locales=$("#locales"),$logo=$("#logo"),$navbar=$(".navbar:first"),$facebook=$("a#facebook"),headerHeight=$(".navbar:first").height(),footerHeight=$("#footer-container").height(),deltaHeight=headerHeight+footerHeight,$viewCartMenuLink=$("a#view-cart-menu-link");var e=navigator.userAgent.toLowerCase();isAppleDevice=$body.hasClass("mobile-device")||$body.hasClass("tablet-device"),isAppleDevice&&$("section.background-image").css("background-attachment","absolute"),$("section.background-image").each(function(e,t){imagesCount++;var n=$(t).data("bg");$("<img>").attr("src",n).on("load",function(){imagesCount--,isAppleDevice?$(t).backstretch($(this).attr("src")):$(t).css("background-image","url("+n+")"),Home.onImageLoaded()})})},onImageLoaded:function(){if(imagesCount==0){Home.resize(),Home.attachEvents(),$sidescroll.init(),$container.css({width:"100%",height:availableHeight});var e=$cover.find(".headline");e.css("opacity",0),$logo.css("opacity",0),$facebook.css("top",-50),$navbar.css("top",-50),$overlay.fadeOut(3e3,function(){$overlay.remove(),$logo.animate({opacity:1},1200,function(){e.css({opacity:1,textShadow:"#ffffff 10 10 600"}).animate({textShadow:"0 0 50 #ffffff"},1e3),$locales.show()}),$navbar.animate({top:0},200,function(){$("#scrollme").show(),Home.animateScrollme()})})}},animateScrollme:function(){for(var e=1;e<=10;e++)$("#scrollme").slideUp(2200).delay(300).slideDown(1600)},attachEvents:function(){$(window).on("debouncedresize",function(e){Home.resize()}),$(".category").on("click",function(e){e.stopPropagation(),e.preventDefault(),Grid.show($(this).parents("section:first"))}),$("a#treasures").on("click",function(e){e.stopPropagation(),e.preventDefault(),Category.show($("section#treasures"))}),$("a#pearls").on("click",function(e){e.stopPropagation(),e.preventDefault(),Category.show($("section#pearls"))}),$(".products").on("click"," a.back",function(e){e.stopPropagation(),e.preventDefault(),Grid.hide($(this).parents("section:first"))}),$(".product").on("click"," a.back",function(e){e.stopPropagation(),e.preventDefault(),Product.hide($(this).parents("section:first"))}).on("ajax:beforeSend","form.cart-form",function(e,t,n){}).on("ajax:complete",function(e,t,n){Home.showCartUpdateNotice()}),$(".tj_gallery_inner").hover(function(e){$(".tj_content",this).slideToggle()},function(e){var t=$(".tj_content");$(".tj_content",this).slideToggle()}).on("ajax:beforeSend",function(e,t,n){}).on("ajax:complete",function(evt,xhr,status){Product.show($(this).parents("section:first"),eval(xhr.responseText).html())})},resize:function(){Util.availableSpace(),$(".fullscreen").css({height:availableHeight,width:availableWidth}),$.each($(".parallax .headline"),function(e,t){var n=$(this),r=(availableHeight-n.height())/2;r=r<0?0:r,n.css("margin-top",r)}),$logo.css("margin-top",(availableHeight-$logo.height())/2),$locales.css("top",(availableHeight-$locales.height())/2),$locales.css("left",(availableWidth+$logo.width())/2),$facebook.css({top:headerHeight}),$(".products").each(function(e,t){Grid.resize($(t))}),$("article.product").each(function(e,t){Product.resize($(t))}),$activeSection&&Home.scrollToSection($activeSection)},scrollToSection:function(e){$("html, body").animate({scrollTop:e.position().top},500)},showCartUpdateNotice:function(){var e=$viewCartMenuLink.position();$notice===undefined&&($notice=$("<div class='notice'>Your selection has been updated !</div>").appendTo($body),$notice.css({display:"none",position:"fixed","z-index":1e4,left:e.left,top:e.top+50,"background-color":"green",color:"white",padding:8})),$notice.fadeIn("slow",function(){window.setTimeout(Home.hideCartUpdateNotice,2e3)})},hideCartUpdateNotice:function(){$notice.fadeOut("slow")},onHashChange:function(){var e=location.hash}},Product={show:function(e,t){var n=e.find(".products:first"),r=e.find(".product:first"),i=r.find(".content:first");e.data("state","product"),i.html(t);var s=i.find("article:first"),o=s.find(".product-info:first"),u=s.find(".carousel:first");Product.size(s),$("form.cart-form").attr("data-remote","true"),n.animate({left:-availableWidth},900,function(){$(this).removeClass("active")}),r.css("left",availableWidth).addClass("active").animate({left:0},900,function(){Product.initCarousel(u),o.jScrollPane()})},hide:function(e){var t=e.find(".products:first"),n=e.find(".product:first");e.data("state","grid"),t.addClass("active").stop().animate({left:0},900),n.stop().animate({left:availableWidth},900,function(){$(this).removeClass("active")})},size:function(e){var t=e.find(".carousel:first"),n=e.find(".product-info:first"),r=300,i=30,s=e.outerWidth(),o=availableHeight-120,u=s-r-i,a=Math.min(u,o);maxInfoWidth=s-a-i,t.css({"max-height":a,"max-width":a}),n.css({height:o,width:maxInfoWidth})},resize:function(e){var t=e.find(".product-info:first");Product.size(e),t.data("jsp").reinitialise()},initCarousel:function(e){typeof e!="undefined"&&(e.find(".item").length>1?e.carousel("pause"):e.find(".carousel-control").each(function(e){$(this).css({display:"none"})}))}},Grid={init:function(e){var t=e.find(".tj_container"),n=t.find(".tj_gallery"),r=t.find(".tj_nav"),i=r.find(".tj_prev"),s=r.find(".tj_next");n.data("anim",!1),Grid.scale(e),i.length&&i.on("click",function(e){return e.stopPropagation(),e.preventDefault(),n.data("anim")?!1:(n.data("anim",!0),Grid.paginate(n,-1),!1)}),s.length&&s.on("click",function(e){return e.stopPropagation(),e.preventDefault(),n.data("anim")?!1:(n.data("anim",!0),Grid.paginate(n,1),!1)}),e.data("initialized",!0)},scale:function(e){var t=e.find(".tj_container"),n=t.find(".tj_gallery"),r=t.find(".tj_nav"),s=r.find(".tj_nav_container"),o=n.children("li");numItems=o.length,itemPadding=8,maxItemWidth=286,minItemWidth=180,h=availableHeight-60,w=availableWidth-80,itemWidth=Math.min(maxItemWidth,Math.floor(w/4-3*itemPadding)),itemWidth=Math.max(minItemWidth,itemWidth),numVisibleRows=Math.floor(h/itemWidth),numVisibleRows===1&&(itemWidth=Math.max(Math.min(h/2,maxItemWidth),minItemWidth),numVisibleRows=Math.floor(h/itemWidth)),numCols=Math.floor(availableWidth/itemWidth),numVisibleItems=numCols*numVisibleRows,numRows=Math.ceil(numItems/numCols),numPages=Math.ceil(numRows/numVisibleRows),t.hide();var u={};u.currentRow=1,u.numVisibleRows=numVisibleRows,u.numRows=numRows,u.numCols=numCols,u.numVisibleItems=numVisibleItems,n.data("config",u);var a=itemWidth>200?"block":"none";o.each(function(e){var t=$(this),n=Math.ceil((e+1)/numCols),r,i=n%numVisibleRows;i===1?r="0px":i===0?r=(numVisibleRows-1)*itemWidth+"px":r=(i-1)*itemWidth+"px",t.css({height:itemWidth,width:itemWidth,position:"absolute",left:itemWidth*Math.floor(e%numCols),top:r,display:e>numVisibleItems-1?"none":"block"}).attr("class",function(e,t){if(t)return t.replace(/\btj_row_\S+/g,"")}).addClass("tj_row_"+Math.ceil((e+1)/numCols)).find(".tj_content").css("display","none").find(".description").css("display",a)});var f=h-itemWidth*numVisibleRows,l=w-itemWidth*numCols;n.parent().css({paddingTop:Math.floor(f/2),paddingBottom:Math.floor(f/2),paddingLeft:Math.floor(l/2),paddingRight:Math.floor(l/2)}),s.html("");for(i=0;i<numPages;i++)$("<a id='row_"+(i*numVisibleRows+1)+"' class='tj_page_nav' href='#'>&#8226;</a>").appendTo(s).on("click",function(e){e.stopPropagation(),e.preventDefault();if(n.data("anim"))return!1;n.data("anim",!0),$(this).parent().find(".active").removeClass("active"),$(this).addClass("active");var t=$(this).attr("id").replace(/[^\d]+/g,"");return Grid.paginate(n,n.data("config").currentRow>t?-1:1,t),!1});$("a#row_1").addClass("active"),t.show()},show:function(e){$activeSection=e,Home.scrollToSection(e);var t=$activeSection.find(".category:first"),n=$activeSection.find(".products:first");$activeSection.data("state","grid"),n.css("left",availableWidth).addClass("active"),n.data("initialized")||Grid.init(n),$body.addClass("noscroll"),t.stop().animate({left:-availableWidth},900,function(){$(this).removeClass("active")}),n.stop().animate({left:0},900)},hide:function(e){var t=e.find(".category:first"),n=e.find(".products:first");e.attr("data-state","category"),t.addClass("active").stop().animate({left:0},900),n.stop().animate({left:availableWidth},900,function(){$body.removeClass("noscroll")})},resize:function(e){Grid.scale(e)},paginate:function(e,t,n){var r=e.data("config");if(n!=undefined&&r.currentRow==n)return e.data("anim",!1),!1;if(t===1&&r.currentRow+r.numVisibleRows>r.numRows||t===-1&&r.currentRow-r.numVisibleRows<=0)return e.data("anim",!1),!1;if(n==undefined){var i=e.parent().parent().find(".tj_page_nav.active");i.length>0&&(i.removeClass("active"),t===1?i.next().addClass("active"):i.prev().addClass("active"))}var s="",o="";for(var u=0;u<r.numVisibleRows;++u)s+=".tj_row_"+(r.currentRow+u)+",",n!=undefined?(n>r.currentRow?t=1:t=-1,o+=".tj_row_"+(Number(n)+u)+","):t===1?o+=".tj_row_"+(r.currentRow+r.numVisibleRows+u)+",":o+=".tj_row_"+(r.currentRow-1-u)+",";var a=50,f;t===1?f=e.children(s):f=e.children(s).reverse(),f.each(function(e){var t=$(this);setTimeout(function(){t.fadeOut(500,"swing")},a+e*a)});var l;t===1?l=e.children(o):l=e.children(o).reverse();var c=l.length,h=0;l.each(function(t){var n=$(this);setTimeout(function(){n.fadeIn(500,"swing",function(){++h,h===c&&e.data("anim",!1)})},a*2+t*a)}),n!=undefined?t===1?r.currentRow=Number(n):r.currentRow=Number(n):t===1?r.currentRow+=r.numVisibleRows:r.currentRow-=r.numVisibleRows,e.data("config",r)}},Category={init:function(e){},show:function(e){if($activeSection==undefined)Home.scrollToSection(e);else{var t=$activeSection.attr("id"),n=e.attr("id"),r=$activeSection.data("state");if(r=="category")Home.scrollToSection(e,null);else if(r=="product"){var i=$activeSection.find(".category:first"),s=$activeSection.find(".products:first"),o=$activeSection.find(".product:first");o.stop().animate({left:availableWidth},900,function(){$(this).removeClass("active")}),s.addClass("active").stop().animate({left:availableWidth},1800,function(){$(this).removeClass("active")}),i.addClass("active").stop().animate({left:0},2700,function(){$body.removeClass("noscroll"),Home.scrollToSection(e,!1)})}else if(r=="grid"){var i=$activeSection.find(".category:first"),s=$activeSection.find(".products:first");s.addClass("active").stop().animate({left:availableWidth},900,function(){$(this).removeClass("active")}),i.addClass("active").stop().animate({left:0},1800,function(){$body.removeClass("noscroll"),Home.scrollToSection(e,!1)})}}e.data("state","category"),$activeSection=e},hide:function(e){},resize:function(e){}};